<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Mobile-Server Data Sync | Couchbase Docs</title>
    <link rel="canonical" href="https://ibsoln.github.io/myStaging/test/sync-gateway/2.7/shared-bucket-access.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="sync-gateway">
    <meta name="dcterms.identifier" content="2.7">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://ibsoln.github.io/myStaging/test">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="#">Server</a></li>
                  <li><a href="../../server//n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server//fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server//analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server//eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.1/index.html">Lite</a></li>
                  <li><a href="index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server//sdk/overview.html">SDKs</a></li>
                  <li><a href="#">C</a></li>
                  <li><a href="#">.NET</a></li>
                  <li><a href="#">Go</a></li>
                  <li><a href="#">Java</a></li>
                  <li><a href="#">Node.js</a></li>
                  <li><a href="#">PHP</a></li>
                  <li><a href="#">Python</a></li>
                  <li><a href="#">Scala</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server//connectors/intro.html">Connectors</a></li>
                  <li><a href="#">Elasticsearch</a></li>
                  <li><a href="../../server//connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="#">Kafka</a></li>
                  <li><a href="#">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../server//connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <a class="navbar-item component" href="index.html"><span class="title">Sync Gateway</span> <span class="version">2.7</span></a>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Introduction</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="introduction.html">Introduction</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="index.html">What&#8217;s New</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="data-modeling.html">Data Modeling</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Access Control</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="users-and-roles.html">Users and Roles</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="authentication.html">Authentication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sync-gateway-channels.html">Sync Gateway Channels</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="read-access.html">Read Access</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="write-access.html">Write Access</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sync-function.html">Sync Function</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Learn</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="config-properties.html">Configuration File</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="command-line-options.html">CLI</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="shared-bucket-access.html">Mobile-Server Data Sync</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-tombstones.html">Tombstones</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="indexing.html">Indexing</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="server-integration.html">Webhooks and Changes Feed</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="resolving-conflicts.html">Resolving Conflicts</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="integrating-external-stores.html">Integrating External Stores</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="running-replications.html">Inter-cluster Replication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="rest-api-client.html">REST API Client</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Manage</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="logging.html">Logging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="stats-monitoring.html">Stats Monitoring</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sgcollect-info.html">SGCollect Info</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="deployment.html">Deployment</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Sync Gateway on Kubernetes</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="kubernetes/deploy-cluster.html">Deploy a Cluster</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="kubernetes/manage-cluster.html">Manage a Cluster</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="upgrade.html">Upgrade</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="security.html">Security</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="load-balancer.html">Load Balancer</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="database-offline.html">Taking Databases Offline and Online</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="os-level-tuning.html">OS Level Tuning</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">API References</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="rest-api.html">Public REST API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="admin-rest-api.html">Admin REST API</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Release Notes &amp; Compatibility</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release Notes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="supported-os.html">Supported OS</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-matrix.html">Compatibility Matrix</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Sync Gateway</a></li>
    <li class="crumb">Learn</li>
    <li class="crumb"><a href="shared-bucket-access.html">Mobile-Server Data Sync</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="file:///Users/ianbridge/Documents/CouchbaseDocs/sg/modules/ROOT/pages/shared-bucket-access.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Mobile-Server Data Sync</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Sync Gateway uses the <em>Shared Bucket Access</em> feature to synchronize document changes made through Couchbase SDKs and N1QL queries to be synchronized to Couchbase Lite clients, and vice versa.
The following diagram shows different clients (mobile, web, desktop) writing data to the same bucket in Couchbase Server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/shared-bucket-access.png" alt="shared bucket access">
</div>
</div>
<div class="paragraph">
<p>In previous releases, you either had to ensure all writes happened through Sync Gateway, or had to set up bucket shadowing to ensure that the security and replication metadata needed by mobile applications was preserved.</p>
</div>
<div class="paragraph">
<p>As of Sync Gateway 1.5, the metadata created by the Sync Gateway is abstracted from applications reading and writing data directly to Couchbase Server.
Sync Gateway 1.5 utilizes a new feature of Couchbase Server 5.0 called XATTRs (e<strong>X</strong>tended <strong>ATTR</strong>ibutes) to store that metadata into an external document fragment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-enable-it"><a class="anchor" href="#how-to-enable-it"></a>How to enable it</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Shared bucket access is an opt-in feature, and can be enabled without bringing down the entire Sync Gateway cluster.</p>
</div>
<div class="paragraph">
<p>The <a href="getting-started.html" class="page">getting started</a> page includes step-by-step instructions to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Couchbase Server 5.0 or above.</p>
</li>
<li>
<p>Configure Couchbase Server with RBAC.</p>
</li>
<li>
<p>Install Sync Gateway with a configuration file that enables Mobile-Web data synchronization.
Another example is presented below.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "databases": {
        "db": {
            "bucket": "my-bucket",
            "username": "my-user",
            "password": "my-password",
            "server": "http://localhost:8091",
            "enable_shared_bucket_access": true, <i class="conum" data-value="1"></i><b>(1)</b>
            "import_docs": true <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>enable_shared_bucket_access</code> property is used to enable Web-Server data sync and must be <code><em>true</em></code> on all nodes participating in such a configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>import_docs</code> property is used to specify that a Sync Gateway node should (only) import document changes using the <a href="#import-process">Import process</a>. But note that it can only be set to <code>true</code> on a single node.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>From then on, documents can be inserted on the Server directly (with N1QL or SDKs) or through the Sync Gateway REST API.
The mobile metadata is no longer kept in the document, but in a system extended attribute in Couchbase Server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="import-process"><a class="anchor" href="#import-process"></a>Import process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The import process is a key part of mobile convergence.</p>
</div>
<div class="paragraph">
<p>It is the means by which Sync Gateway becomes aware of non-Sync Gateway data changes and obtains the mobile metadata it requires to replicate changes.
Any <a href="glossary.adoc#non-sync-gateway">non-Sync Gateway change</a> is eligible for import.</p>
</div>
<div class="paragraph">
<p>The document is first run through the Sync Function to compute read security and routing, with the following differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The import is processed with an admin user context in the Sync Function, similar to writes made through the Sync Gateway Admin API.
This means that <code>requireAccess</code>, <code>requireUser</code> and <code>requireRole</code> calls in the Sync Function are treated as no-ops.</p>
</li>
<li>
<p>During import, <code>oldDoc</code> is <code>nil</code> when the Sync Function is executed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify a filter function using the <a href="config-properties.html#databases-foo_db_import_filter" class="page">import_filter</a>  property, which will only import specific documents.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use the <a href="config-properties.html#log" class="page">Import+</a> log key to troubleshoot import processing issues in the logs.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note that <code>import_docs</code> only takes effect if the <code>enabled_shared_bucket_access</code> is set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Starting in Release 2.7, <code>import_docs</code> defaults to <code>true</code> for Enterprise Edition.
This implies that by default, all Enterprise Edition nodes in a cluster will participate in import processing.
In order to exclude a node, the <code>import_docs</code> flag must be <code>false</code>.
This <code>import_docs</code> flag must be explicitly set to <code>true</code> in Community Edition.</p>
</div>
<div class="paragraph">
<p>The following table describes the key behavior differences between Community Edition and Enterprise Edition when <code>import_docs</code> is enabled, disabled or not set at all.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>enabled_shared_bucket_access</code></th>
<th class="tableblock halign-left valign-top"><code>import_docs</code></th>
<th class="tableblock halign-left valign-top">Behavior (EE)</th>
<th class="tableblock halign-left valign-top">Behavior (CE)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assumes <code>import: true</code> by default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assumes <code>import: false</code> by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node omitted from import processing (supported for workload isolation)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node omitted from import processing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node participates in import processing, and is assigned import partitions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node performs import processing for all server mutations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs is false by default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs is false by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs property ignored, warning logged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">import docs property ignored, warning logged</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import docs is false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import docs is false</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="high-availability-of-import-processing"><a class="anchor" href="#high-availability-of-import-processing"></a>High Availability of Import processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In <em>Enterprise Edition</em>, import processing work is sharded across all Sync Gateway nodes with import enabled.
This implies that if one of the nodes fail, the failed shard is automatically picked up by the remaining nodes in the cluster.
This way, you get High Availability of import processing.</p>
</div>
<div class="paragraph">
<p>In <em>Community Edition</em>, there is no sharding of import across the nodes participating in the import processing. Each import node processes all server mutations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="workload-isolation"><a class="anchor" href="#workload-isolation"></a>Workload Isolation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in the table above, if <code>import_docs</code> is set to <code>false</code>, the node will not be participating in the import process.
This configuration is specifically recommended for workload isolation: to isolate import nodes from the client-facing nodes.
Workload isolation may be preferable in deployments with high write throughput.</p>
</div>
<div class="paragraph">
<p>The following diagram shows an example architecture of two Sync Gateway nodes handling the incoming client connections (<code>import_docs: false</code>) and two nodes sharing the import processing (<code>import_docs: true</code>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/workload-isolation.png" alt="workload isolation"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metadata-purge-interval"><a class="anchor" href="#metadata-purge-interval"></a>Metadata Purge Interval</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <a href="config-properties.html#databases-foo_db-enable_shared_bucket_access">$dbname.enable_shared_bucket_access</a> is enabled, <a href="glossary.html" class="page">mobile tombstones</a> are <strong>not</strong> retained indefinitely.
They are purged based on the server&#8217;s <em>metadata purge interval</em>.
To ensure tombstones are replicated to clients, you should set the server&#8217;s metadata purge interval based on your expected replication frequency (see the <a href="config-properties.html#databases-foo_db-enable_shared_bucket_access">$dbname.enable_shared_bucket_access</a> reference).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference"><a class="anchor" href="#reference"></a>Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The reference to the configuration properties can be found below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="config-properties.html#databases-foo_db-enable_shared_bucket_access">$dbname.enable_shared_bucket_access</a> to enable convergence for a given database.</p>
</li>
<li>
<p><a href="config-properties.html#databases-foo_db-import_docs">$dbname.import_docs</a> to give a particular Sync Gateway node the role of importing the documents.</p>
</li>
<li>
<p><a href="config-properties.html#databases-foo_db-import_filter">$dbname.import_filter</a> to select which document(s) to make aware to mobile clients.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="faq"><a class="anchor" href="#faq"></a>FAQ</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="how-do-i-query-the-documents-sync-metadata"><a class="anchor" href="#how-do-i-query-the-documents-sync-metadata"></a>How do I query the document&#8217;s sync metadata?</h3>
<div class="paragraph">
<p>Starting in Couchbase Server 5.5, the N1QL query language supports the ability to select extended attributes (xattrs) where the document&#8217;s sync metadata is stored.
The following query shows an example of that feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT meta().xattrs._sync FROM `travel-sample` WHERE meta().id = "mydocId"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Prior to 5.5, there is no way to query the mobile metadata with <code>shared_bucket_access_enabled: true</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The sync metadata is maintained internally by Sync Gateway and its structure can change at any time.
It should not be used to drive business logic of applications. The direct use of the N1QL query is <strong>unsupported</strong> and must not be used in production environments.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="how-do-i-access-a-blob-stored-in-couchbase-lite"><a class="anchor" href="#how-do-i-access-a-blob-stored-in-couchbase-lite"></a>How do I access a blob stored in Couchbase Lite?</h3>
<div class="paragraph">
<p>See the <a href="../../couchbase-lite/2.1/swift.html#blobs" class="page">Blob</a> example.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-do-i-access-an-attachment-from-a-webapp"><a class="anchor" href="#how-do-i-access-an-attachment-from-a-webapp"></a>How do I access an attachment from a WebApp?</h3>
<div class="paragraph">
<p>Attachments can be accessed through Sync Gateway&#8217;s REST API using the <a href="rest-api.html#/attachment/get__db___doc___attachment_" class="page">/{db}/{doc}/{attachment}</a> endpoint.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-from-bucket-shadowing"><a class="anchor" href="#migrating-from-bucket-shadowing"></a>Migrating from Bucket Shadowing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As of Sync Gateway 1.5, the Bucket Shadowing feature is deprecated and no longer supported.
The following steps outline a recommended method for migrating from Bucket Shadowing to the latest version with interoperability between Couchbase Server SDKs and Couchbase Mobile.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the recommendations in the <a href="#">server:install:upgrade-online.adoc</a> to upgrade all instances to 5.0.</p>
</li>
<li>
<p>Create a new bucket on Couchbase Server (<strong>bucket 2</strong>).</p>
</li>
<li>
<p>Install Sync Gateway 1.5 on a separate node with shared access enabled and connect it to the new bucket (<strong>bucket 2</strong>).</p>
</li>
<li>
<p>Setup a <a href="running-replications.html">push replication</a> from the Sync Gateway instance used for Bucket Shadowing to the Sync Gateway 1.5 instance.</p>
</li>
<li>
<p>Once the replication has completed, test your application is performing as expected.</p>
</li>
<li>
<p>Update the load balancer to direct incoming traffic to the Sync Gateway 1.5 instance when you are ready to upgrade.</p>
</li>
<li>
<p>Delete the first bucket (<strong>bucket 1</strong>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/bucket-shadowing-migration.png" alt="bucket shadowing migration"></span></p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
