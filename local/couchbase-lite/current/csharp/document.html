<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Documents&#8201;&#8212;&#8201;Data Model | Couchbase Docs</title>
<link rel="canonical" href="http://127.0.0.1:5000/couchbase-lite/current/csharp/document.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite concepts -- Data model -- Documents">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="3.0">
<meta name="page-url" content="/couchbase-lite/current/csharp/document.html">
<meta name="generator" content="Antora 3.0.0-alpha.5">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="http://127.0.0.1:5000/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="http://127.0.0.1:5000/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile Local
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    <a href="../../../home/mobile.html">Mobile Local</a>
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Couchbase Lite</span>
        <select class="version_list" data-component="couchbase-lite">
          <option value="3.0" data-url="../index.html" selected>3.0</option>
          <option value="2.8" data-url="../../2.8/index.html">2.8</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../index.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../cbl-whatsnew.html">New in 3.0</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../android/quickstart.html">Android</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/kotlin.html">Kotlin</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../android/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0/couchbase-lite-android/">API References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0/couchbase-lite-android-ktx">Kotlin Extensions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../c/quickstart.html">C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/gs-downloads.html">Download</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/c_fleece.html">Fleece API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/field-level-encryption.html">Field Level Encryption</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/replication.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-c/">API&#160;References</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="quickstart.html">.Net</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list is-current-page" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-n1ql-mobile-server-diffs.html">N1QL Mobile - Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-net/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../java/quickstart.html">Java</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../java/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-java/">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../objc/quickstart.html">Objective-C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../objc/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../objc/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-objc/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/quickstart.html">Swift</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#swift:landing-replications.adoc">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-swift/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../javascript.html">JavaScript</a>
  </span>
</li>
</ul>
      </div>
      <div class="version_items hide" data-version="2.8">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/index.html">Introduction</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../cbl-whatsnew.html">What&#8217;s New</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../android/quickstart.html">Android</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/android/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-predictive.html">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/android/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/android/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-android/">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="quickstart.html">C#.Net</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list is-current-page" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-lite:csharp:query-predictive.adoc">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/csharp/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/csharp/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-net">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../java/quickstart.html">Java</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/java/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-predictive.html">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/java/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/java/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-java/">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../objc/quickstart.html">Objective-C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/objc/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-lite:objc:query-predictive.adoc">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/objc/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/objc/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-objc">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-crashes.html">Decoding Crash Logs</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/quickstart.html">Swift</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/swift/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-predictive.html">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/swift/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/swift/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-swift">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-crashes.html">Decoding Crash Logs</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/javascript.html">JavaScript</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/javascript.html">JavaScript</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Sync Gateway</span>
        <select class="version_list" data-component="sync-gateway">
          <option value="3.0" data-url="../../../sync-gateway/current/index.html" selected>3.0</option>
          <option value="2.8" data-url="../../../sync-gateway/2.8/index.html">2.8</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/introduction.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/whatsnew.html"><strong><em>New in 3.0</em></strong></a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/index.html">Quick Links</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-prepare.html">Prepare</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-verify-install.html">Verify</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Configuration</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-bootstrap.html">Bootstrap</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-database.html">Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-db-security.html">Database Security</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-access-control.html">Access Control</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-import-filter.html">Import Filter</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-isgr.html">Inter-Sync&#160;Gateway Replication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-properties-legacy.html">Legacy Pre-3.0&#160;BETA Configuration</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-javascript-functions.html">Javascript Functions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-environment-variables.html">Environment Variables</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Security</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/secure-sgw-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-users.html">User Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-certs.html">TLS Cert Authentication</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Access Control</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-concepts.html">Concepts</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-model.html">Access Control Model</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/channels.html">Channels</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/roles.html">Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/users.html">Users</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function.html">Sync Function</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api.html">API Reference</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-access-cmd.html">access()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-channel-cmd.html">channel()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-expiry-cmd.html">expiry()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-access-cmd.html">requireAccess()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-admin-cmd.html">requireAdmin()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-role-cmd.html">requireRole()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-user-cmd.html">requireUser()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-role-cmd.html">role()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-throw-cmd.html">throw()</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how.html">How-to</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-create-users.html">Create Users</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-create-roles.html">Create Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-assign-users-to-roles.html">Assign User to Role</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-control-document-access.html">Control Document Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-verify-access.html">Verify Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-use-xattrs-for-access-grants.html">Use XATTRS for Access Grants</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/auto-purge-channel-access-revocation.html">Auto-Purge Channel Access Revocation</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">REST API</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-admin.html">Admin REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-metrics.html">Metrics REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api.html">Public REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-access-rbac-roles.html">RBAC Role - Endpoint Cross-Reference</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-with-couchbase-server.html">Sync with Server</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-using-app.html">Sync with Application</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Inter-Sync Gateway Replication</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-run.html">Initialize</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-manage.html">Manage</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-monitor.html">Monitor</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-conflict-resolution.html">Inter Syncgateway Conflict Resolution</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/delta-sync.html">Delta Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/import-filter.html">Import Filter</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/revisions.html">Revisions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/managing-tombstones.html">Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/resync.html">Resync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-monitoring.html">Stats Monitoring</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/database-offline.html">Database Offline</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging and Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sgcollect-info.html">SG Collect Info</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Deploy</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deployment.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/command-line-options.html">Command Line Options</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/load-balancer.html">Load Balancer</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/os-level-tuning.html">OS Level Tuning</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/webhooks.html">Webhooks</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/changes-feed.html">Changes Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/integrating-external-stores.html">External Stores</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-prometheus.html">Prometheus Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/setting-up-dr-cluster.html">Disaster Recovery</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Use Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deploy-cluster-to-kubernetes.html">Deploy</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Server Compatibility</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-collections.html">Collections</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-eventing.html">Eventing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-transactions.html">Transactions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-xdcr.html">XDCR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/supported-environments.html">Supported Environments</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/compatibility.html">Compatibility Matrix</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Legacy Features</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sg-replicate.html">SG Replicate</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sgreplicate-resolving-conflicts.html">SG Replicate - Resolving Conflicts (depr)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-logging-pre2-1.html">Legacy Pre-2.1 Logging</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/glossary.html">Glossary</a>
  </span>
</li>
</ul>
      </div>
      <div class="version_items hide" data-version="2.8">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/introduction.html">Introduction</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/2.8/index.html">Quick Start</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/whatsnew.html">What&#8217;s New</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-prepare.html">Prepare</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-verify-install.html">Verify</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Concepts</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/users.html">Users</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/roles.html">Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/channels.html">Channels</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/managing-tombstones.html">Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/revisions.html">Revisions</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-properties-legacy.html">Configuration</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">REST API</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-access.html">REST API Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api.html">Public REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-admin.html">Admin REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-metrics.html">Metrics REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::rest-api-client-app.adoc">REST API Client</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Security</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-users.html">User Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-certs.html">TLS Certificate Authentication</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Access Control</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function.html">Sync Function</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::read-access.adoc">Read Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::write-access.adoc">Write Access</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-with-couchbase-server.html">Sync with Couchbase Server</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-using-app.html">Sync with Couchbase Lite</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Inter-Sync Gateway Replication</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-run.html">Initialize</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-manage.html">Manage</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-monitor.html">Monitor</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-conflict-resolution.html">Conflict Resolution</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/managing-tombstones.html">Managing Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/delta-sync.html">Delta Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/resync.html">Resync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/import-filter.html">Import filter</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-monitoring.html">Monitor</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging and Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sgcollect-info.html">SG Collect</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/database-offline.html">Take Database Offline/Online</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deployment.html">Deploy</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/command-line-options.html">Command Line Options</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/load-balancer.html">Load Balancer</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/os-level-tuning.html">OS-level Tuning</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/webhooks.html">Webhooks</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/2.8/server-integration.html">Changes Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/integrating-external-stores.html">External Stores</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-prometheus.html">Prometheus Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/indexing.html">Indexing versus Views</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/setting-up-dr-cluster.html">Disaster Recovery</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Server Compatibility</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-collections.html">Collections</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-eventing.html">Eventing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-transactions.html">Transactions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-xdcr.html">XDCR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Use Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deploy-cluster-to-kubernetes.html">Deploy</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::pn-supported-os.adoc">Supported OS</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/compatibility.html">Compatibility Matrix</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Legacy Features</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::resolving-conflicts.adoc">Conflict Resolution 1.x Clients</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sg-replicate.html">SG-Replicate</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-logging-pre2-1.html">Log Rotation pre-2.1</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/glossary.html">Sync Gateway Glossary</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/glossary.html">Sync Gateway Glossary</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2@">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/pages/document.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="quickstart.html">.Net</a></li>
<li class="crumb"><a href="document.html">Documents</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Documents&#8201;&#8212;&#8201;Data Model</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Couchbase Lite concepts&#8201;&#8212;&#8201;Data model&#8201;&#8212;&#8201;Documents</em><br>
Related Content&#8201;&#8212;&#8201;<a href="database.html" class="page">Databases</a> | <a href="blob.html" class="page">Blobs</a> | <a href="indexing.html" class="page">Indexing</a> |</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Couchbase Lite the term 'document' is refers to an entry in the database; a record, or row in a table if you like.</p>
</div>
<div class="paragraph">
<p>Each document has an ID (primary key in other databases) by which it can be located.
This ID can be automatically generated (as a UUID) or specified programmatically;
the only constraints are that it must be unique within the database, and it can&#8217;t be changed.
The document also has a value which contains the actual application data.
This value is stored as a dictionary collection of key-value (k-v) pairs where the values themselves may comprise different types of data such as numbers, strings, arrays or even nested objects&#8201;&#8212;&#8201;see: <a href="#data-types">Data Types</a></p>
</div>
<div class="paragraph">
<p>The document body is stored in an internal, efficient, binary form (
<a href="https://github.com/couchbaselabs/fleece#readme">Fleece</a>
).<br>
This internal form is easily converted into a manageable native dictionary format for manipulation in applications.</p>
</div>
<div class="paragraph">
<p>Couchbase Lite also provides for the direct handling of JSON data implemented in most cases by the provision of a <code>ToJSON()</code> method on appropriate API classes (for example, on MutableDocument, Dictionary, Blob and Array)&#8201;&#8212;&#8201;see <a href="#lbl-json-data">Working with JSON Data</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="constructing-a-document"><a class="anchor" href="#constructing-a-document"></a>Constructing a Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An individual document often represents a single instance of an object in application code.
A document might be considered equivalent to a row in a relational table; with each of the document’s attributes being equivalent to a column.</p>
</div>
<div class="paragraph">
<p>Documents can contain nested structures.
This allows developers to express many-to-many relationships without requiring a reference or junction table; and is naturally expressive of hierarchical data.</p>
</div>
<div class="paragraph">
<p>Most apps will work with one or more documents, persisting them to a local database and optionally syncing the either centrally or to the cloud.</p>
</div>
<div class="paragraph">
<p>In this section we provide an example of how you might create a <code>hotel</code> document, which provides basic contact details and price data.</p>
</div>
<div class="listingblock">
<div class="title">Data Model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">hotel: {
  type: string (value = `hotel`)
  name: string
  address: dictionary {
    street: string
    city: string
    state: string
    country: string
    code: string
  }
  phones: array
  rate: float
}</code></pre>
</div>
</div>
<div id="ex-usage" class="olist arabic">
<ol class="arabic">
<li>
<p>Open or create your database</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">//
// Program.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;

namespace api_walkthrough
{
    class Program
    {
        private static Database _Database;
        private static Replicator _Replicator;
        private static URLEndpointListener _listener;
        private static ListenerToken _ListenerToken;
        private static bool _NeedsExtraDocs;

        <mark>region Private Methods

        private static void GettingStarted()
        {

            // using System;
            // using Couchbase.Lite;
            // using Couchbase.Lite.Query;
            // using Couchbase.Lite.Sync;

            // Get the database (and create it if it doesn't exist)
            var database = new Database("mydb");
            // Create a new document (i.e. a record) in the database
            string id = null;
            using (var mutableDoc = new MutableDocument())
            {
                mutableDoc.SetFloat("version", 2.0f)
                    .SetString("type", "SDK");

                // Save it to the database
                database.Save(mutableDoc);
                id = mutableDoc.Id;
            }

            // Update a document
            using (var doc = database.GetDocument(id))
            using (var mutableDoc = doc.ToMutable())
            {
                mutableDoc.SetString("language", "C</mark>");
                database.Save(mutableDoc);

                using (var docAgain = database.GetDocument(id))
                {
                    Console.WriteLine($"Document ID :: {docAgain.Id}");
                    Console.WriteLine($"Learning {docAgain.GetString("language")}");
                }
            }

            // Create a query to fetch documents of type SDK
            // i.e. SELECT * FROM database WHERE type = "SDK"
            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(database))
                .Where(Expression.Property("type").EqualTo(Expression.String("SDK"))))
            {
                // Run the query
                var result = query.Execute();
                Console.WriteLine($"Number of rows :: {result.AllResults().Count}");
            }

            // Create replicator to push and pull changes to and from the cloud
            var targetEndpoint = new URLEndpoint(new Uri("ws://localhost:4984/getting-started-db"));
            var replConfig = new ReplicatorConfiguration(database, targetEndpoint);

            // Add authentication
            replConfig.Authenticator = new BasicAuthenticator("john", "pass");

            // Create replicator (make sure to add an instance or static variable
            // named _Replicator)
            var _Replicator = new Replicator(replConfig);
            _Replicator.AddChangeListenersender, args) =&gt;             {                 if (args.Status.Error != null)                 {                     Console.WriteLine($"Error :: {args.Status.Error}");                 }             });              _Replicator.Start();              // Later, stop and dispose the replicator <strong>before</strong> closing/disposing the         }            private static void TestReplicatorConflictResolver()         {             var target = new URLEndpoint(new Uri("ws://localhost:4984/mydatabase";
            var replConfig = new ReplicatorConfiguration(database, target);
            replConfig.ConflictResolver = new LocalWinConflictResolver();

            var replicator = new Replicator(replConfig);
            replicator.Start();
        }

        private static void TestSaveWithConflictHandler()
        {
            using (var document = database.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                database.Save(mutableDocument, (updated, current) =&gt;
                {
                    var currentDict = current.ToDictionary();
                    var newDict = updated.ToDictionary();
                    var result = newDict.Concat(currentDict)
                        .GroupBy(kv =&gt; kv.Key)
                        .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
                    updated.SetData(result);
                    return true;
                });
            }
        }

        private static bool IsValidCredential(string name, SecureString password) { return true;  } // helper
        private static void TestInitListener()
        {
            var db = new Database("other-database");
            _Database = db;

            var config = new URLEndpointListenerConfiguration(_Database);
            config.TlsIdentity = null; // Use with anonymous self-signed cert
            config.Authenticator = new ListenerPasswordAuthenticatorsender, username, password) =&gt;             {                 if(IsValidCredential(username, password {
                    return true;
                }

                return false;
            });

            _listener = new URLEndpointListener(config);
        }

        private static void TestListenerStart()
        {
            // CouchbaseLiteException will be thrown when the listener cannot be started. The most common error
            // would be that the configured port has already been used.
            _listener.Start();
        }

        private static void TestListenerStop()
        {
            _listener.Stop();
        }

        private static void TestCreateSelfSignedCert()
        {
            TLSIdentity identity;
            X509Store _store =
             new X509Store(StoreName.My);
              // The identity will be stored in the secure
              // storage using the given label.
            DateTimeOffset fiveMinToExpireCert = DateTimeOffset.UtcNow.AddMinutes(5);

            identity = TLSIdentity.CreateIdentity(true, /* isServer <strong>/
                new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "Couchbase Inc" } },
                    // The common name attribute is required
                    // when creating a CSR. If it is not presented
                    // in the cert, an exception is thrown.
                fiveMinToExpireCert,
                    // If the expiration date is not specified,
                    // the certs expiration will be 365 days
                _store,
                "CBL-Server-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.

        }

        private static void TestImportTLSIdentity()
        {
            TLSIdentity identity;
            X509Store _store = new X509Store(StoreName.My); // The identity will be stored in the secure storage using the given label
            byte[] data = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates

            identity = TLSIdentity.ImportIdentity(_store,
                data,
                "123", // The password that is needed to access the certificate data
                "CBL-Client-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.
        }

          private static void TestClientCertAuthenticatorRootCerts()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;

            byte[] caData, clientData;
            clientData = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates
            caData = File.ReadAllBytes("C:\\client-ca.der");

            // Root certs
            var rootCert = new X509Certificate2(caData);
            var auth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(rootCert));

            // Create URL Endpoint Listener
            var listenerConfig = new URLEndpointListenerConfiguration(_Database);
            listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.
            listenerConfig.Authenticator = auth;
            _listener = new URLEndpointListener(listenerConfig);
            _listener.Start();

            // Client identity
            identity = TLSIdentity.ImportIdentity(_store,
                clientData,
                "123",
                "CBL-Client-Cert",
                null);

            // Replicator -- Client
            var database = new Database("client-database");
            var builder = new UriBuilder(
                "wss",
                "localhost",
                _listener.Port,
                $"/{_listener.Config.Database.Name}"
            );

            var url = builder.Uri;
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.ReplicatorType = ReplicatorType.PushAndPull;
            config.Continuous = false;
            config.Authenticator = new ClientCertificateAuthenticator(identity);
            config.AcceptOnlySelfSignedServerCertificate = true;
            config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
            using (var replicator = new Replicator(config)) {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
            // end::client-cert-authenticator-root-cert
        }

        private static void TestClientCertAuthenticator()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;


            // Create Listener Certificate Authenticator
            var auth = new ListenerCertificateAuthenticatorsender, cert) =&gt;             {                 if (cert.Count != 1) {                     return false;                 }                  return cert[0].SubjectName.Name?.Replace("CN=", "") == "couchbase";             });              // Create URL Endpoint Listener             var listenerConfig = new URLEndpointListenerConfiguration(_Database);             listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.             listenerConfig.Authenticator = auth;             _listener = new URLEndpointListener(listenerConfig);             _listener.Start();              // User Identity             identity = TLSIdentity.CreateIdentity(false,                 new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "couchbase" } },                 null,                 _store,                 ClientCertLabel,                 null);              // Replicator -- Client             var database = new Database("client-database");             var builder = new UriBuilder(                 "wss",                 "localhost",                 _listener.Port,                 $"/{_listener.Config.Database.Name}"             );              var url = builder.Uri;             var target = new URLEndpoint(url);             var config = new ReplicatorConfiguration(database, target);             config.ReplicatorType = ReplicatorType.PushAndPull;             config.Continuous = false;             config.Authenticator = new ClientCertificateAuthenticator(identity);             config.AcceptOnlySelfSignedServerCertificate = false;             config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];             using (var replicator = new Replicator(config {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
        }

        private static void UseEncryption()
        {
            // Enterprise edition only

            // Create a new, or open an existing database with encryption enabled
            var config = new DatabaseConfiguration
            {
                // Or, derive a key yourself and pass a byte array of the proper size
                EncryptionKey = new EncryptionKey("password")
            };

            using (var db = new Database("seekrit", config)) {
                // Change the encryption key (or add encryption if the DB is unencrypted)
                db.ChangeEncryptionKey(new EncryptionKey("betterpassw0rd"));

                // Remove encryption
                db.ChangeEncryptionKey(null);
            }
        }

        private static void ResetReplicatorCheckpoint()
        {
            var database = _Database;
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            using (var replicator = new Replicator(config)) {
              // replicator is a Replicator instance
              if (resetCheckpointRequired_Example) {
                  replicator.Start(true); <i class="conum" data-value="1"></i><b>(1)</b>
              else
                replicator.Start(false);
              }




            }
        }

        private static void Read1xAttachment()
        {
            var db = _Database;
            using (var document = new MutableDocument()) {
                var attachments = document.GetDictionary("_attachments");
                var avatar = attachments.GetBlob("avatar");
                var content = avatar?.Content;
            }
        }

        private static void CreateNewDatabase()
        {
            var db = new Database("my-database");

            _Database = db;
        }

        private static void CloseDatabase()
        {
          database.close()

        }

        private static void ChangeLogging()
        {
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Query, LogLevel.Verbose);
        }

        private static void LoadPrebuilt()
        {
            // Note: Getting the path to a database is platform-specific.  For .NET Core / .NET Framework this
            // can be a simple filesystem path.  For UWP, you will need to get the path from your assets.  For
            // iOS you need to get the path from the main bundle.  For Android you need to extract it from your
            // assets to a temporary directory and then pass that path.
            var path = Path.Combine(Environment.CurrentDirectory, "travel-sample.cblite2" + Path.DirectorySeparatorChar);
            if (!Database.Exists("travel-sample", null)) {
                _NeedsExtraDocs = true;
                Database.Copy(path, "travel-sample", null);
            }

            _Database.Close();
            _Database = new Database("travel-sample");
        }

        private static void QueryDeletedDocuments()
        {
            // Query documents that have been deleted
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.IsDeleted);
        }

        private static void CreateDocument()
        {
            var db = _Database;
            using (var newTask = new MutableDocument("xyz")) {
                newTask.SetString("type", "task")
                    .SetString("owner", "todo")
                    .SetDate("createdAt", DateTimeOffset.UtcNow);

                db.Save(newTask);
            }
        }

        private static void UpdateDocument()
        {
            var db = _Database;
            using(var document = db.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                db.Save(mutableDocument);
            }
        }

        private static void UseTypedAccessors()
        {
            using (var newTask = new MutableDocument()) {
                newTask.SetValue("createdAt", DateTimeOffset.UtcNow);
                var date = newTask.GetDate("createdAt");

                Console.WriteLine(date);
            }
        }

        private static void DoBatchOperation()
        {
            var db = _Database;
            db.InBatch) =&gt;             {                 for (var i = 0; i &lt; 10; i) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "user");
                        doc.SetString("name", $"user {i}");
                        doc.SetBoolean("admin", false);
                        db.Save(doc);
                        Console.WriteLine($"Saved user document {doc.GetString("name")}");
                    }
                }
            });
        }

        private static void DatabaseChangeListener()
        {
            var db = _Database;

            db.AddDocumentChangeListener("user.john", (sender, args) =&gt;
            {
                using (var doc = Db.GetDocument(args.DocumentID)) {
                    Console.WriteLine($"Status :: {doc.GetString("verified_account")}");
                }
            });
        }

        private static void DocumentExpiration()
        {
            var db = _Database;

            // Purge the document one day from now
            var ttl = DateTimeOffset.UtcNow.AddDays(1);
            db.SetDocumentExpiration("doc123", ttl);

            // Reset expiration
            db.SetDocumentExpiration("doc1", null);

            // Query documents that will be expired in less than five minutes
            var fiveMinutesFromNow = DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeMilliseconds();
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.Expiration.LessThan(Expression.Double(fiveMinutesFromNow)));
        }

        private static void UseBlob()
        {
            var db = _Database;
            using (var newTask = new MutableDocument()) {
                // Note: Reading the data is implementation dependent, as with prebuilt databases
                var image = File.ReadAllBytes("avatar.jpg"); // &lt;.&gt;
                var blob = new Blob("image/jpeg", image); // &lt;.&gt;
                 newTask.SetBlob("avatar", blob); // &lt;.&gt;
                db.Save(newTask);

                var taskBlob = newTask.GetBlob("avatar");
                using (var bitmap = SKBitmap.Decode(taskBlob.ContentStream)) {
                    Console.WriteLine($"Bitmap dimensions: {bitmap.Width} x {bitmap.Height} ({bitmap.BytesPerPixel} bytes per pixel)");
                }
            }
        }

        public void CreateIndex()
        {
            var db = _database;
            string[] indexProperties = new string[] {"type", "name" };
            var config = new ValueIndexConfiguration(indexProperties);
            db.CreateIndex("TypeNameIndex", config);
        }

        public void CreateIndex_Querybuilder()
        {
            // For value types, this is optional but provides performance enhancements
            var db = _database;
            var index = IndexBuilder.ValueIndex(
                ValueIndexItem.Expression(Expression.Property("type")),
                ValueIndexItem.Expression(Expression.Property("name"))); // &lt;.&gt;
            db.CreateIndex("TypeNameIndex", index);
        }
        private static void SelectMeta()
        {
            Console.WriteLine("Select Meta");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("type"),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document ID :: {result.GetString("id")}");
                    Console.WriteLine($"Document Name :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectAll()
        {
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))) {
                // All user properties will be available here
            }

            var query = QueryBuilder
                .Select(SelectResult.All())
                .From(DataSource.Database(db)); // &lt;.&gt;

            // Adds a query change listener.
            // Changes will be posted on the main queue.
            var token = query.AddChangeListener((sender, args) =&gt; // &lt;.&gt;
            {
                var allResult = args.Results.AllResults();
                foreach (var result in allResult) {
                    Console.WriteLine(result.Keys);
                    /* Update UI */
                }
            });


            query.RemoveChangeListener(token);
            query.Dispose();
        }

        private static void SelectWhere()
        {
            Console.WriteLine("Where");
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    var dict = result.GetDictionary(db.Name);
                    Console.WriteLine($"Document Name :: {dict?.GetString("name")}");
                }
            }
        }

        private static void UseCollectionContains()
        {
            Console.WriteLine("Collection Operator CONTAINS");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"),
                    SelectResult.Property("public_likes"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel"))
                    .And(ArrayFunction.Contains(Expression.Property("public_likes"),
                        Expression.String("Armani Langworth"))))) {
                foreach (var result in query.Execute()) {
                    var publicLikes = result.GetArray("public_likes");
                    var jsonString = JsonConvert.SerializeObject(publicLikes);
                    Console.WriteLine($"Public Likes :: {jsonString}");
                }
            }
        }

        private static void UseCollectionIn()
        {
            Console.WriteLine("Collection Operator IN");
            var db = _Database;

            var values = new IExpression[]
                { Expression.Property("first"), Expression.Property("last"), Expression.Property("username") };

            using (var query = QueryBuilder.Select(
                    SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.String("Armani").In(values))) {
                foreach (var result in query.Execute()) {
                    var body = result.GetDictionary(0);
                    var jsonString = JsonConvert.SerializeObject(body);
                    Console.WriteLine($"In results :: {jsonString}");
                }
            }
        }

        private static void SelectLike()
        {
            Console.WriteLine("Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Royal Engineers Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardLike()
        {
            Console.WriteLine("Wildcard Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Eng%e%"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardCharacterLike()
        {
            Console.WriteLine("Wildchard Characters");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Like(Expression.String("Royal Eng____rs Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectRegex()
        {
            Console.WriteLine("Regex");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Regex(Expression.String("\\bEng.*e\\b"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectJoin()
        {
            Console.WriteLine("Join");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Expression.Property("name").From("airline")),
                    SelectResult.Expression(Expression.Property("callsign").From("airline")),
                    SelectResult.Expression(Expression.Property("destinationairport").From("route")),
                    SelectResult.Expression(Expression.Property("stops").From("route")),
                    SelectResult.Expression(Expression.Property("airline").From("route")))
                .From(DataSource.Database(db).As("airline"))
                .Join(Join.InnerJoin(DataSource.Database(db).As("route"))
                    .On(Meta.ID.From("airline").EqualTo(Expression.Property("airlineid").From("route"))))
                .Where(Expression.Property("type").From("route").EqualTo(Expression.String("route"))
                    .And(Expression.Property("type").From("airline").EqualTo(Expression.String("airline")))
                    .And(Expression.Property("sourceairport").From("route").EqualTo(Expression.String("RIX"))))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void GroupBy()
        {
            Console.WriteLine("GroupBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Function.Count(Expression.All())),
                    SelectResult.Property("country"),
                    SelectResult.Property("tz"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("airport"))
                    .And(Expression.Property("geo.alt").GreaterThanOrEqualTo(Expression.Int(300))))
                .GroupBy(Expression.Property("country"), Expression.Property("tz"))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine(
                        $"There are {result.GetInt("$1")} airports in the {result.GetString("tz")} timezone located in {result.GetString("country")} and above 300 ft");
                }
            }
        }

        private static void OrderBy()
        {
            Console.WriteLine("OrderBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("title"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .OrderBy(Ordering.Property("title").Ascending())
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Title :: {result.GetString("title")}");
                }
            }
        }

      // ### EXPLAIN statement
      private static void TestExplainStatement()
      // For Documentation
      {
        var db = _Database;
        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
            .GroupBy(Expression.Property("country"))
            .OrderBy(Ordering.Property("title").Ascending()) // &lt;.&gt;

          Console.WriteLine(query.Explain()); // &lt;.&gt;

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("%hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;
  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Function.Lower(Expression.Property("type")).EqualTo(Expression.String("hotel"))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type")).EqualTo(Expression.String("hotel")); // &lt;.&gt;

          Console.WriteLine(query.Explain());

      }

      // end query-explain


        public void CreateFullTextIndex()
        {
            string[] indexProperties = new string[] { "overview", "name" };
            var config = new FullTextIndexConfiguration(indexProperties);
            db.CreateIndex("overviewFTSIndex", config);
        }

        public void FullTextSearch()
        {
            Console.WriteLine("Full text search");

            var db = _database;
            var ftsQuery = db.CreateQuery("SELECT * FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)");
            foreach (var result in ftsQuery.Execute())
            {
                Console.WriteLine($"Document id {result.GetString(0)}");
            }
            }
        }


        private static void CreateFullTextIndex_Querybuilder()
        {
            var db = _Database;

            if (_NeedsExtraDocs) {
                var tasks = new[] { "buy groceries", "play chess", "book travels", "buy museum tickets" };
                foreach (var task in tasks) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "task");
                        doc.SetString("name", task);
                        db.Save(doc);
                    }
                }
            }


            var index = IndexBuilder.FullTextIndex(FullTextIndexItem.Property("overview")).IgnoreAccents(false);
            db.CreateIndex("overviewFTSIndex", index);
        }

        private static void FullTextSearch_Querybuilder()
        {
            Console.WriteLine("Full text search");
            var db = _Database;

            var whereClause = FullTextFunction.Match("overviewFTSIndex", "'michigan'");

            using (var query = QueryBuilder.Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(whereClause)) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document id {result.GetString(0)}");
                }
            }
        }
        private static void StartReplication()
        {
            var db = _Database;

            /*
             * This requires Sync Gateway running with the following config, or equivalent:
             *
             * {
             *     "log":["*"],
             *     "databases": {
             *         "db": {
             *             "server":"walrus:",
             *             "users": {
             *                 "GUEST": {"disabled": false, "admin_channels": ["*"] }
             *             }
             *         }
             *     }
             * }
             */

            // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(db, target)
            {
                ReplicatorType = ReplicatorType.Pull
            };

            var replicator = new Replicator(config);
            replicator.Start();

            _Replicator = replicator;
        }

        private static void VerboseReplicatorLogging()
        {
            // deprecated
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Network, LogLevel.Verbose);
        }

        private static void ConsoleLogging()
        {
            Database.Log.Console.Domains = LogDomain.All; // &lt;.&gt;
            Database.Log.Console.LogLevel = LogLevel.Verbose; // &lt;.&gt;


            Database.Log.Console.Domains = LogDomain.Database;

        }

        private static void FileLogging()
        {
            var tempFolder = Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;().DefaultDirectory(), "cbllog");
            var config = new LogFileConfiguration(tempFolder) // &lt;.&gt;
            {
                MaxRotateCount = 5, // &lt;.&gt;
                MaxSize = 10240, // &lt;.&gt;
                UsePlainText = false  // &lt;.&gt;
            };
            Database.Log.File.Config = config; // Apply configuration
            Database.Log.File.Level = LogLevel.Info; // &lt;.&gt;

        }

        private static void EnableCustomLogging()
        {
            Database.Log.Custom = new LogTestLogger(); // &lt;.&gt;
            or
            Database.Log.Custom = new LogTestLogger { Level = LogLevel.Warning };

        }

        private static void WriteConsoleLog()
        {
            Database.Log.Console.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }
        private static void WriteCustomLog()
        {
            Database.Log.Custom?.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }


        private static void WriteFileLog()
        {
            Database.Log.File.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }

        private static void EnableBasicAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new BasicAuthenticator("john", "pass");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void EnableSessionAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void SetupReplicatorListener()
        {
            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
                    Console.WriteLine("Replication stopped");
                }
            });
        }




    //  BEGIN PendingDocuments IB -- 11/Feb/21 --
    private static void ReplicatorPendingDocuments()
    {
        var url = new Uri("ws://localhost:4984/mydatabase");
        var target = new URLEndpoint(url);
        var database = new Database("myDB");
        var config = new ReplicatorConfiguration(database, target);
        config.ReplicatorType  = ReplicatorType.Push;

        var replicator = new Replicator(config);

        var mydocids =
          new HashSet &lt;string&gt; (replicator.GetPendingDocumentIDs()); // &lt;.&gt;


        if (mydocids.Count &gt; 0)
        {
            Console.WriteLine($"There are {mydocids.Count} documents pending");
            replicator.AddChangeListener((sender, change) =&gt;
            {
                Console.WriteLine($"Replicator activity level is " +
                                  change.Status.Activity.ToString());
                // iterate and report-on previously
                // retrieved pending docids 'list'
                foreach (var thisId in mydocids)
                    if (!replicator.IsDocumentPending(thisId)) // &lt;.&gt;
                    {
                        Console.WriteLine($"Doc ID {thisId} now pushed");
                    };
            });

            replicator.Start();
        }
    }


//  END PendingDocuments IB -- 11/Feb/21 --



		private static void ReplicatorDocumentEvent()
        {
            var replicator = _Replicator;

            var token = replicator.AddDocumentReplicationListener((sender, args) =&gt;
            {
                var direction = args.IsPush ? "Push" : "Pull";
                Console.WriteLine($"Replication type :: {direction}");
                foreach (var document in args.Documents) {
                    if (document.Error == null) {
                        Console.WriteLine($"Doc ID :: {document.Id}");
                        if (document.Flags.HasFlag(DocumentFlags.Deleted)) {
                            Console.WriteLine("Successfully replicated a deleted document");
                        }
                    } else {
                        // There was an error
                    }
                }
            });

            replicator.Start();

            replicator.RemoveChangeListener(token);
        }

        private static void SetupReplicatorErrorListener()
        {
            // This can be done in the SetupReplicatorListener method
            // But it is separate so that we can have two documentation entries

            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Error != null) {
                    Console.WriteLine($"Error :: {args.Status.Error}");
                }
            });
        }

        private static void DatabaseReplica()
        {
            var db = _Database;
            using (var database2 = new Database("backup")) {
                // EE feature: This code will not compile on the community edition
                var targetDatabase = new DatabaseEndpoint(database2);
                var config = new ReplicatorConfiguration(db, targetDatabase)
                {
                    ReplicatorType = ReplicatorType.Push
                };

                var replicator = new Replicator(config);
                replicator.Start();

                _Replicator?.Stop();
                _Replicator = replicator;
            }
        }

        private static void PinCertificate()
        {
            // Note: No certificate is included here, so this code is for show only
            var url = new Uri("wss://localhost:4984/db");
            var target = new URLEndpoint(url);
            var db = _Database;

            // Note: `GetCertificate` is a fake method. This would be the platform-specific method
            // to find and load the certificate as an instance of `X509Certificate2`.
            // For .NET Core / .NET Framework this can be loaded from the filesystem path.
            // For UWP, from the assets directory.
            // For iOS, from the main bundle.
            // For Android, from the assets directory.
            var certificate = GetCertificate("cert.cer");
            var config = new ReplicatorConfiguration(db, target)
            {
                PinnedServerCertificate = certificate
            };
        }

        private static void ReplicationCustomHeaders()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target)
            {
                Headers = new Dictionary&lt;string, string&gt;
                {
                    ["CustomHeaderName"] = "Value"
                }
            };
        }

        private static void PushWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PushFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (flags.HasFlag(DocumentFlags.Deleted)) {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void PullWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PullFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (document.GetString("type") == "draft") {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        public void TestCustomRetryConfig()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);

        //  other config as required . . .

            config.Heartbeat = TimeSpan.FromSeconds(120); //  &lt;.&gt;
            config.Maxattempts = 20; //  &lt;.&gt;
            config.MaxAttemptWaitTime = TimeSpan.FromSeconds(600); //  &lt;.&gt;

        //  other config as required . . .

            var repl = new Replicator(config);

        }


        private static void UsePredictiveModel()
        {
            using (var db = new Database("mydb")) {
                var model = new ImageClassifierModel();
                Database.Prediction.RegisterModel("ImageClassifier", model);

                var index = IndexBuilder.ValueIndex(ValueIndexItem.Property("label"));
                db.CreateIndex("value-index-image-classifier", index);

                Database.Prediction.UnregisterModel("ImageClassifier");
            }
        }

        private static void UsePredictiveIndex()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });

                var index = IndexBuilder.PredictiveIndex("ImageClassifier", input);
                db.CreateIndex("predictive-index-image-classifier", index);
            }
        }

        private static void DoPredictiveQuery()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });
                var prediction = PredictiveModel.predict("ImageClassifier", input); // &lt;1&gt;

                using (var q = QueryBuilder.Select(SelectResult.All())
                    .From(DataSource.Database(db))
                    .Where(prediction.Property("label").EqualTo(Expression.String("car"))
                        .And(prediction.Property("probability").GreaterThanOrEqualTo(Expression.Double(0.8))))) {
                    var result = q.Execute();
                    Console.WriteLine($"Number of rows: {result.Count()}");
                }
            }
        }

        static void Main(string[] args)
        {
            // This only needs to be done once for whatever platform the executable is running
            // (UWP, iOS, Android, or desktop)
            Couchbase.Lite.Support.NetDesktop.Activate();

            CreateNewDatabase();
            CreateDocument();
            UpdateDocument();
            UseTypedAccessors();
            DoBatchOperation();
            UseBlob();
            SelectMeta();

            LoadPrebuilt();
            CreateIndex();
            SelectWhere();
            UseCollectionContains();
            SelectLike();
            SelectWildcardLike();
            SelectWildcardCharacterLike();
            SelectRegex();
            SelectJoin();
            GroupBy();
            OrderBy();

            CreateFullTextIndex();
            FullTextSearch();
            StartReplication();
            SetupReplicatorListener();

            _Replicator.Stop();
            while (_Replicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
                // Database cannot close until replicators are stopped
                Console.WriteLine($"Waiting for replicator to stop (currently {_Replicator.Status.Activity})...");
                Thread.Sleep(200);
            }

            _Database.Close();
        }

        #endregion
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  ACTIVE SIDE  ----------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */

    class ActivePeer : IMessageEndpointDelegate
    {
        ActivePeer()
        {
            var id = "";

            var database = new Database("dbname");

            // The delegate must implement the `IMessageEndpointDelegate` protocol.
            var messageEndpointTarget = new MessageEndpoint(uid: "UID:123", target: "",
                protocolType: ProtocolType.MessageStream, delegateObject: this);

            var config = new ReplicatorConfiguration(database, messageEndpointTarget);

            // Create the replicator object
            var replicator = new Replicator(config);
            // Start the replicator
            replicator.Start();
        }

        /* implementation of MessageEndpointDelegate */
        public IMessageEndpointConnection CreateConnection(MessageEndpoint endpoint)
        {
            var connection = new ActivePeerConnection(); /* implements MessageEndpointConnection */
            return connection;
        }
    }

    class ActivePeerConnection : IMessageEndpointConnection
    {
        private IReplicatorConnection _replicatorConnection;

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public async Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // await socket.Open(), etc
            // throw MessagingException if something goes wrong
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  PASSIVE SIDE  ---------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */
    class PassivePeerConnection : IMessageEndpointConnection
    {
        private MessageEndpointListener _messageEndpointListener;
        private IReplicatorConnection _replicatorConnection;

        public void StartListener()
        {
            var database = new Database("mydb");
            var config = new MessageEndpointListenerConfiguration(database, ProtocolType.MessageStream);
            _messageEndpointListener = new MessageEndpointListener(config);
        }

        public void StopListener()
        {
            _messageEndpointListener?.CloseAll();
        }

        public void AcceptConnection()
        {
            var connection = new PassivePeerConnection(); /* implements MessageEndpointConnection */
            _messageEndpointListener?.Accept(connection);
        }

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // socket should already be open on the passive side
            return Task.FromResult(true);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    // tensorFlowModel is a fake implementation
    // this would be the implementation of the ml model you have chosen
    class TensorFlowModel
    {
        public static IDictionary&lt;string, object&gt; PredictImage(byte[] data)
        {
            // Do calculations, etc
            return null;
        }
    }

    class ImageClassifierModel : IPredictiveModel
    {
        public DictionaryObject Predict(DictionaryObject input)
        {
            var blob = input.GetBlob("photo");
            if (blob == null) {
                return null;
            }

            var imageData = blob.Content;
            // tensorFlowModel is a fake implementation
            // this would be the implementation of the ml model you have chosen
            var modelOutput = TensorFlowModel.PredictImage(imageData);
            return new MutableDictionaryObject(modelOutput); // &lt;1&gt;
        }
    }

    private class LogTestLogger : ILogger
    {
        public LogLevel Level { get; set; }

        public void Reset()
        {
            _lines.Clear();
        }

        public void Log(LogLevel level, LogDomain domain, string message)
        {
            // handle the message, for example piping it to
            // a third party framework
        }
    }

    class LocalWinConflictResolver : IConflictResolver
    {
        Document Resolve(Conflict conflict)
        {
            return conflict.LocalDocument;
        }
    }

    class RemoteWinConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            return conflict.RemoteDocument;
        }
    }

    class MergeConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            var localDict = conflict.LocalDocument.ToDictionary();
            var remoteDict = conflict.RemoteDocument.ToDictionary();
            var result = localDict.Concat(remoteDict)
               .GroupBy(kv =&gt; kv.Key)
               .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
            return new MutableDocument(conflict.DocumentID, result);
        }
    }
}

// N1QL QUERY

  public List&lt;Result&gt; docsonly_N1QLQueryString(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = \"hotel\""); // &lt;.&gt;

      return thisQuery.Execute().AllResults();

  }


  public  List&lt;Result&gt; docsonly_N1QLQueryStringParams(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      // Declared elsewhere: Database argDB

      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = $type"); // &lt;.&gt;

      var n1qlParams = new Parameters();
      n1qlParams.SetString("type", "hotel"); // &lt;.&gt;
      thisQuery.Parameters = n1qlParams;

      return thisQuery.Execute().AllResults();

  }


// QUERY RESULT SET HANDLING EXAMPLES

    public static void testQuerySyntaxAll()
    {
        // For Documentation
        var dbName = "travel-sample";

        string thisDocsId;
        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        Dictionary&lt;string,object&gt; hotel = new Dictionary&lt;string,object&gt;();

        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
              .Select(SelectResult.All())
              .From(DataSource.Database(this_Db));


        var results = query.Execute().AllResults();

        if (results?.Count &gt; 0)
        {
            List&lt;Dictionary&lt;string,object&gt;&gt; hotels = new List&lt;Dictionary&lt;string,object&gt;&gt;();
            foreach (var result in results)
            {
                // get the result into our dictionary object
                var thisDocsProps = result.GetDictionary(dbName); // &lt;.&gt;

                if (thisDocsProps != null)
                {
                    thisDocsId = thisDocsProps.GetString("id"); // &lt;.&gt;
                    thisDocsName = thisDocsProps.GetString("name");
                    thisDocsCity = thisDocsProps.GetString("city");
                    thisDocsType = thisDocsProps.GetString("type");
                    hotel = thisDocsProps.ToDictionary();
                    hotels.Add(hotel);
                }

            }
        }


    foreach (var result in query.Execute().AsEnumerable()) {

        // get the result into a JSON String
                var thisDocsJSONString = result.ToJSON();// &lt;.&gt;

        // Get a native dictionary object using the JSON string
        var dictFromJSONstring =
              JsonConvert.
                DeserializeObject&lt;Dictionary&lt;string, object&gt;&gt;
                  (thisDocsJSONString); // &lt;.&gt;

        // use the created dictionary
        if (dictFromJSONstring != null)
        {
            thisDocsId = dictFromJSONstring["id"].ToString();
            thisDocsName = dictFromJSONstring["name"].ToString();
            thisDocsCity = dictFromJSONstring["city"].ToString();
            thisDocsType = dictFromJSONstring["type"].ToString();
        }

        //Get a custom object using the JSON string
        Hotel this_hotel =
            JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocsJSONString); // &lt;.&gt;

        // Store this hotel object in a list of hotels
        hotels.Add(
            this_hotel.Id.ToString(),
                this_hotel);

    } // end foreach result
  }


    private static void testQuerySyntaxProps()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        var this_Db = new Database("hotels") ;

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();

        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var query = QueryBuilder.Select(
                SelectResult.Property("type"),
                SelectResult.Property("name"),
                SelectResult.Property("city")).From(DataSource.Database(this_Db));

        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            // get the returned array of k-v pairs into a dictionary
            hotel = result.ToDictionary();

            // add hotel dictionary to list of hotel dictionaries
            hotels.Add(hotel);

            // use the properties of the returned array of k-v pairs directly
            thisDocsType = result.GetString("type");
            thisDocsName = result.GetString("name");
            thisDocsCity = result.GetString("city");

        }

    } // test-query-access-props



    private static void testQuerySyntaxCount()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var this_Db = new Database("hotels") ;

        var query =
          QueryBuilder
            .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount")) // &lt;.&gt;
            .From(DataSource.Database(this_Db));




        var results = query.Execute().AllResults();

        foreach (var result in results)
        {

            var numberOfDocs = result.GetInt("mycount"); // &lt;.&gt;

        }

    }




    private static void ibQueryForID()
    {

        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();


        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID).As("this_ID"))
                .From(DataSource.Database(this_Db));



        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            var thisDocsID = result.GetString("this_ID"); // &lt;.&gt;
            var doc = this_Db.GetDocument(thisDocsID);
        }

    }


    private static void testQueryPagination()
    {
      // For Documentation
      var dbName = "travel-sample";
      // var this_Db = new Database(dbName);

      var this_Db = new Database("hotels") ;

      var thisLimit = 20;
      var thisOffset = 0;

      // get a count of the number of docs matching the query
      var countQuery =
          QueryBuilder
              .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount"))
              .From(DataSource.Database(this_Db));
      var numberOfDocs =
          countQuery.Execute().AllResults().ElementAt(0).GetInt("mycount");

      if (numberOfDocs &lt; thisLimit) {
          thisLimit = numberOfDocs;
      }

      while (thisOffset &lt; numberOfDocs)
      {
          var listQuery =
              QueryBuilder
                  .Select(SelectResult.All())
                  .From(DataSource.Database(this_Db))
                  .Limit(Expression.Int(thisLimit), Expression.Int(thisOffset)); // &lt;.&gt;

          foreach (var result in listQuery.Execute().AllResults())
          {
              // Display and or process query results batch

          }

          thisOffset = thisOffset + thisLimit;

      } // end while

    }

    // JSONAPIMETHODS



        public void JsonApiDocument()
        {

            Database this_DB = new Database("travel-sample");
            Database newDb = new Database("ournewdb");

            // Get a document
            var thisDoc = this_Db.GetDocument("hotel_10025");

            // Get document data as JSON String
            var thisDocAsJsonString = thisDoc?.ToJSON(); // &lt;.&gt;

            // Get Json Object from the Json String
            JObject myJsonObj = JObject.Parse(thisDocAsJsonString);

            // Get Native Object (anhotel) from JSON String
            List&lt;Hotel&gt; thehotels = new List&lt;Hotel&gt;();

            Hotel anhotel = new Hotel();
            anhotel = JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocAsJsonString);
            thehotels.Add(anhotel);

            // Update the retrieved native object
            anhotel.Name = "A Copy of " + anhotel.Name;
            anhotel.Id = "2001";

            // Convert the updated object back to a JSON string
            var newJsonString = JsonConvert.SerializeObject(anhotel);

            // Update new document with JSOn String
            MutableDocument newhotel =
                new MutableDocument(anhotel.Id, newJsonString); // &lt;.&gt;

            foreach (string key in newhotel.ToDictionary().Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}",
                    key, newhotel.GetValue(key));
            }

            newDb.Save(newhotel);

            var thatDoc = newDb.GetDocument("2001").ToJSON(); // &lt;.&gt;
            System.Console.Write(thatDoc);



        //    JSON String = { "description":"Very good and central","id":"1000","country":"France","name":"Hotel Ted","type":"hotel","city":"Paris"}
        //             type = hotel
        //             id = 1000
        //             country = France
        //             city = Paris
        //             description = Very good and central
        //             name = Hotel Ted
        //         */

        } // End JSONAPIDocument


    public void JsonApiArray()
        {
            // Init for docs
            //var this_Db = DataStore.getDbHandle();
            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }


            Database dbNew = new Database(ourdbname);

            // JSON String -- an Array (3 elements. including embedded arrays)
            var thisJSONstring = "[{'id':'1000','type':'hotel','name':'Hotel Ted','city':'Paris','country':'France','description':'Undefined description for Hotel Ted'},{'id':'1001','type':'hotel','name':'Hotel Fred','city':'London','country':'England','description':'Undefined description for Hotel Fred'},                        {'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}]".Replace("'", "\"");

            // Get JSON Array from JSON String
            JArray myJsonObj = JArray.Parse(thisJSONstring);

            // Create mutable array using JSON String Array
            var myArray = new MutableArrayObject();
            myArray.SetJSON(thisJSONstring);  // &lt;.&gt;


            // Create a new documenty for each array element
            for (int i = 0; i &lt; myArray.Count; i)             {                 var dict = myArray.GetDictionary(i);                 var docid = myArray[i].Dictionary.GetString("id");                 var newdoc = new MutableDocument(docid, dict.ToDictionary(; <i class="conum" data-value="2"></i><b>(2)</b>
                dbNew.Save(newdoc);
            }

            // Get one of the created docs and iterate through one of the embedded arrays
            var extendedDoc = dbNew.GetDocument("1002");
            var features = extendedDoc.GetArray("features");
            <i class="conum" data-value="3"></i><b>(3)</b>
            foreach (string feature in features) {
                System.Console.Write(feature);
                //process array item as required
            }
            var featuresJSON = extendedDoc.GetArray("features").ToJSON(); <i class="conum" data-value="4"></i><b>(4)</b>

        }


        public void JsonApiDictionary()
        {

            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }
            Database dbNew = new Database(ourdbname);


            // Get dictionary from JSONstring
            var aJSONstring = "{'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDict = new MutableDictionaryObject(json: aJSONstring); <i class="conum" data-value="5"></i><b>(5)</b>

            // use dictionary to get name value
            var name = myDict.GetString("name");


            // Iterate through keys
            foreach (string key in myDict.Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}", key, myDict.GetValue(key).ToString());

            }

            /</strong>

                mono-stdout: Data -- id = 1002
                mono-stdout: Data -- type = hotel
                mono-stdout: Data -- name = Hotel Ned
                mono-stdout: Data -- city = Balmain
                mono-stdout: Data -- country = Australia
                mono-stdout: Data -- description = Undefined description for Hotel Ned
                mono-stdout: Data -- features = Couchbase.Lite.MutableArrayObject

            <strong>/
        } /</strong> end of func <strong>/


         public void JsonApiBlob()
        {
            // Init
            var ourpath = DataStore.getUserFolder();
            var ourdbname = "ournewdb";
            var userName = "ian";
            //ourpath = Path.Combine(ourpath,userName);

            if (Database.Exists(ourdbname, ourpath))
            {
                Database.Delete(ourdbname, ourpath);
            }
            var dbCfg = new DatabaseConfiguration();
            dbCfg.Directory=ourpath;
            Database dbNew = new Database(ourdbname,dbCfg);


            // Initialize base document for blob from a JSON string
            var docId = "1002";
            var aJSONstring = "{'ref':'hotel_1002','type':'hotel','name':'Hotel Ned'," +
                "'city':'Balmain','country':'Australia'," +
                "'description':'Undefined description for Hotel Ned'," +
                "'features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDoc = new MutableDocument(docId, aJSONstring); <i class="conum" data-value="6"></i><b>(6)</b>


            // Get the content (an image), create blob and add to doc)
            var defaultDirectory =
                Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;()
                            .DefaultDirectory(),
                                userName);
            var myImagePath = Path.Combine(defaultDirectory, "avatarimage.jpg");
            var myImageUri = new Uri(myImagePath.ToString());
            var myBlob = new Blob("image/jpg", myImageUri); <i class="conum" data-value="7"></i><b>(7)</b>
            myDoc.SetBlob("avatar", myBlob); <i class="conum" data-value="8"></i><b>(8)</b>


            // This example generates a 'blob not saved' exception
            try { Console.WriteLine("myBlob (unsaved) as JSON = {0}", myBlob.ToJSON());}
                catch (Exception e)
                    {Console.WriteLine("Exception = {0}", e.Message);}

            dbNew.Save(myDoc);

            // Alternatively -- depending on use case
            dbNew.SaveBlob(new Blob("image/jpg", myImageUri)); <i class="conum" data-value="9"></i><b>(9)</b>


            // Retrieve saved doc, get blob as JSON andheck its still a 'blob'
            var sameDoc = dbNew.GetDocument(docId);
            var reconstitutedBlob = new MutableDictionaryObject().
                SetDictionary("blobCOPY", new MutableDictionaryObject(sameDoc.GetBlob("avatar").ToJSON())); <i class="conum" data-value="10"></i><b>(10)</b>

            if (Blob.IsBlob(
                    reconstitutedBlob.GetDictionary("blobCOPY").ToDictionary()))  <i class="conum" data-value="11"></i><b>(11)</b>
            {
               //... process accordingly
               Console.WriteLine("Its a Blob!!");
            }

            var datavalue = "";
            foreach (string key in myDoc.Keys)
            {
                if (key == "features")
                {
                    datavalue = "features are: ";
                    foreach (string item in myDoc.GetArray(key))
                    {
                        datavalue = datavalue + ", " + item;
                    }
                }
                else if (key == "avatar")
                {
                    datavalue = sameDoc.GetBlob(key).ToJSON();
                }
                else
                {
                    datavalue = sameDoc.GetValue(key).ToString();
                }

                System.Console.WriteLine(" Data -- {0} = {1}", key, datavalue);
            }

            // System.Console.WriteLine(" reconstitutedBlob = {0}", reconstitutedBlob.GetDictionary("blobCOPY").ToJSON());



            //}

            /</strong>


                Exception = Missing Digest Due To Blob Is Not Saved To Database yet.

                Data -- id = 1002
                Data -- type = hotel
                Data -- name = Hotel Ned
                Data -- city = Balmain
                Data -- country = Australia
                Data -- description = Undefined description for Hotel Ned
                Data -- features = features are: , Cable TV, Toaster, Microwave
                Data -- avatar = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

                blobAsJSONstring = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

            <strong>/
        } /</strong> end of func <strong>/




  } // end of class



// p2p sync items


var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="12"></i><b>(12)</b>

thisConfig.Authenticator =
  new ListenerPasswordAuthenticator(
    (sender, username, password) =&gt;
      {
      return username.equals("valid.user")  &amp;&amp; (password == validPassword);
      }
  ); <i class="conum" data-value="13"></i><b>(13)</b>

_thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="14"></i><b>(14)</b>

_thisListener.Start(); <i class="conum" data-value="15"></i><b>(15)</b>




var theListenerEndpoint = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="16"></i><b>(16)</b>

var thisConfig = new ReplicatorConfiguration(thisDB, theListenerEndpoint); <i class="conum" data-value="17"></i><b>(17)</b>

thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="18"></i><b>(18)</b>

thisConfig.Authenticator =
  new BasicAuthenticator("valid.user", "valid.password.string"); <i class="conum" data-value="19"></i><b>(19)</b>

var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="20"></i><b>(20)</b>

thisReplicator.Start(); <i class="conum" data-value="21"></i><b>(21)</b>








// PASSIVE PEER STUFF
// Stuff I adapted
//
//
// p2pSync-websockets.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;
namespace api_walkthrough
{
  class Program
  {
  private static Database _Database;
  private static Replicator _Replicator;
  private static ListenerToken _thisListenerToken;
  private static bool _NeedsExtraDocs;

  #region Private Methods
  private static void GettingStarted()
  {

    // Initialize the listener config
    var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="22"></i><b>(22)</b>

    thisConfig.Port = 55990; <i class="conum" data-value="23"></i><b>(23)</b>

    thisConfig.NetworkInterface = "10.1.1.10"; <i class="conum" data-value="24"></i><b>(24)</b>

    thisConfig.EnableDeltaSync = true; <i class="conum" data-value="25"></i><b>(25)</b>

    thisConfig.DisableTLS = false; <i class="conum" data-value="26"></i><b>(26)</b>

    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="27"></i><b>(27)</b>

    // Configure the client authenticator
    // Here we are using Basic Authentication) <i class="conum" data-value="28"></i><b>(28)</b>
    SecureString validPassword =  new SecureString(); /</strong> example only <strong>/
    // Get SecureString input for validPassword
    var validUser = "valid.username";
    thisConfig.Authenticator = new ListenerPasswordAuthenticator(
      (sender, validUser, validPassword) =&gt;
        {
          return username.equals(validUser)  &amp;&amp; password == validPassword);
        }
      );

    // Initialize the listener
    _thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="29"></i><b>(29)</b>

    // Start the listener
    thisListener.Start(); <i class="conum" data-value="30"></i><b>(30)</b>

  }

  thisConfig.disableTLS = true;


  // Use “anonymous” cert. These are self signed certs created by the system
  thisConfig.TlsIdentity = null;


  thisConfig.EnableDeltaSync = true;


  int connectionCount = thisListener.Status.ConnectionCount; <i class="conum" data-value="31"></i><b>(31)</b>
  int activeConnectionCount = thisListener.Status.ActiveConnectionCount;  <i class="conum" data-value="32"></i><b>(32)</b>



  thisListener.Stop();


// Additional snippets


foreach(NetworkInterface ni in NetworkInterface.GetAllNetworkInterfaces())
{
  if(ni.NetworkInterfaceType == NetworkInterfaceType.Wireless80211 ||
      ni.NetworkInterfaceType == NetworkInterfaceType.Ethernet)
  {
    // do something with the interface(s)
  }
}



var thisConfig = new URLEndpointListenerConfiguration(thisDB);
_thisListener = new URLEndpointListener(thisConfig);

_thisListener.Start();

 Console.WriteLine("URLS are {0} ", thisListener.Urls;


    thisConfig.DisableTLS = true; <i class="conum" data-value="33"></i><b>(33)</b>


    // . . . preceding application logic . . .
    // Get the database (and create it if it doesn't exist)
    var thisDB = new Database("mydb");


    // Use CA Cert
    // Create a TLSIdentity from an imported key-pair
    // . . . previously declared variables include ...
    TLSIdentity thisIdentity;
    X509Store _store =
      new X509Store(StoreName.My); // create and label x509 store

    // Get keys and certificates from PKCS12 data
    byte[] thisIdData =
      File.ReadAllBytes("c:client.p12"); <i class="conum" data-value="34"></i><b>(34)</b>
    // . . . other user code . . .

    thisIdentity = TLSIdentity.ImportIdentity(
      _store,
      thisIdData, <i class="conum" data-value="35"></i><b>(35)</b>
      "123", // Password to access certificate data
      "couchbase-demo-cert",
      null); // Label to get cert in certificate map
        // NOTE: If a null label is supplied then the same
        // default directory for a Couchbase Lite database
        // is used for map.


    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="36"></i><b>(36)</b>

    // Set the TLS Identity
    thisConfig.TlsIdentity = thisIdentity; <i class="conum" data-value="37"></i><b>(37)</b>


    // Configure the client authenticator
    // to validate using ROOT CA

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="38"></i><b>(38)</b>
    var clientData = File.ReadAllBytes("c:client.p12");
    var ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData); <i class="conum" data-value="39"></i><b>(39)</b>

    // Configure the authenticator to use the root certs
    var thisAuth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(thisRootCert));

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="40"></i><b>(40)</b>

    // Initialize the listener using the config
    _listener = new URLEndpointListener(thisConfig);

    // Configure the client authenticator
    // to validate using application logic

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="41"></i><b>(41)</b>
    clientData = File.ReadAllBytes("c:client.p12");
    ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData);

    // Configure the authenticator to pass the root certs
    // To a user supplied code block for authentication
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert) =&gt; {
          // . . . user supplied code block
          // . . . returns boolean value (true=authenticated)
        }); <i class="conum" data-value="42"></i><b>(42)</b>

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="43"></i><b>(43)</b>




// END Additional






// Listener Callouts


  &lt;.&gt; Initialize the listener instance using the configuration settings.
  &lt;.&gt; Start the listener, ready to accept connections and incoming data from active peers.



  &lt;.&gt; <code>connectionCount</code> -- the total number of connections served by the listener
  &lt;.&gt; <code>activeConnectionCount</code> -- the number of active (BUSY) connections currently being served by the listener
  //

  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; PKCS12 data containing private key, public key, and certificates
  &lt;.&gt; The key pair as stored in the byte array
  &lt;.&gt; The password required to access the certificate data
  &lt;.&gt; The key label assigned to the cert in certificate map and used for retrieval
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>


  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; When creating a certificate, the common name attribute is required to create a CSR. If the common name is not present in the certificate an exception is thrown.
  &lt;.&gt; If the expiration date is not specified, the expiration date of the certificate is 365 days after creation
  &lt;.&gt; The key label to get cert in certificate map
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>










  // cert is a pre-populated object of type:SecCertificate representing a certificate
  // Work in progress. Code snippet to be provided.



  // prev content of listener-config-client-auth-self-signed (for ios)
  thisConfig.authenticator = ListenerCertificateAuthenticator.init {
    (cert) -&gt; Bool in
    var cert:SecCertificate
    var certCommonName:CFString?
    let status=SecCertificateCopyCommonName(cert, &amp;certCommonName)
    if (self._allowlistedUsers.contains(["name": certCommonName! as String])) {
      return true
    }
    return false
  }
  // Work in progress. Code snippet to be provided.


public class URLEndpointListener {
    // Properties <i class="conum" data-value="1"></i><b>(1)</b>
    public let config: URLEndpointListenerConfiguration
    public let port UInt16?
    public let tlsIdentity: TLSIdentity?
    public let urls: Array&lt;URL&gt;?
    public let status: ConnectionStatus?
    // Constructors <i class="conum" data-value="2"></i><b>(2)</b>
    public init(config: URLEndpointListenerConfiguration)
    // Methods <i class="conum" data-value="3"></i><b>(3)</b>
    public func start() throws
    public func stop()
}


let config = URLEndpointListenerConfiguration.init(database: self.oDB)
thisConfig.port = tls ? wssPort : wsPort
thisConfig.disableTLS = !tls
thisConfig.authenticator = auth
self.listener = URLEndpointListener.init(config: config) <i class="conum" data-value="1"></i><b>(1)</b>


// ACTIVE PEER STUFF
// Replication code
//
// Copyright (c) 2019 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

public class Examples {
  private static final String TAG = "EXAMPLE ACTIVE PEER";
  private static final String thisDBNAME = "local-database";
  private final Context context;
  // private Database database;
  // private Replicator replicator;

  public Examples(Context context) { this.context = context; }

  String user = "syncuser";
  String password = "sync9455";
  SecCertificate cert=null;
  String passivePeerEndpoint = "10.1.1.12:8920";
  String passivePeerPort = "8920";
  String passiveDbName = "userdb";
  Database thisDB;
  Replicator thisReplicator;
  ListenerToken replicatorListener;

  //@Test
  public void testActPeerSync() throws CouchbaseLiteException, URISyntaxException {
    // . . . preceding code. for example . . .
    private static ListenerToken _thisListenerToken;
    var Database thisDB;
    // . . . other code . . .
    // initialize the replicator configuration

    var thisUrl = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="44"></i><b>(44)</b>
    var config = new ReplicatorConfiguration(thisDB, thisUrl);


    // Set replicator type
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

    // Set autopurge option
    // here we override its default
    thisConfig.EnableAutoPurge = false; <i class="conum" data-value="45"></i><b>(45)</b>

    // Configure Sync Mode
    thisConfig.Continuous = true; // default value

    // Configure Server Security -- only accept self-signed certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="46"></i><b>(46)</b>

    // Configure Client Security <i class="conum" data-value="47"></i><b>(47)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");

    /</strong> Optionally set a conflict resolver call back <strong>/ <i class="conum" data-value="48"></i><b>(48)</b>
    // Use built-in resolver
    thisConfig.ConflictResolver = new LocalWinConflictResolver();  //

    // optionally use custom resolver
    thisConfig.ConflictResolver = new ConflictResolver(
      (conflict) =&gt; {
        /</strong> define resolver function */
      }
    ); //

    // Initialize and start a replicator
    // Initialize replicator with configuration data
    var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="49"></i><b>(49)</b>

    //Optionally add a change listener <i class="conum" data-value="50"></i><b>(50)</b>
    _thisListenerToken =
      thisReplicator.AddChangeListenersender, args) =&gt;         {           if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {               Console.WriteLine("Replication stopped");           }         });      // Start replicator     thisReplicator.Start(); <i class="conum" data-value="51"></i><b>(51)</b>  }  // Additional snippets      // Configure Server Security -- only accept CA certs     thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="52"></i><b>(52)</b>       // Return the remote pinned cert (the listener's cert)     byte returnedCert = new byte(thisConfig.getPinnedCertificate(; // Get listener cert if pinned
    // Configure Client Security <i class="conum" data-value="53"></i><b>(53)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");


    // Only CA Certs accepted
    thisConfig.AcceptOnlySelfSignedServerCertificate =
      false; <i class="conum" data-value="54"></i><b>(54)</b>

    var thisCert =
      new X509Certificate2(caData); <i class="conum" data-value="55"></i><b>(55)</b>

    thisConfig.PinnedServerCertificate =
      thisCert; <i class="conum" data-value="56"></i><b>(56)</b>













    // Code to refactor
    Log.i(TAG, "The Replicator is currently " + thisReplicator.Status().getActivityLevel());

    Log.i(TAG, "The Replicator has processed " + t);

    if (thisReplicator.Status().getActivityLevel() == Replicator.ActivityLevel.BUSY) {
          Log.i(TAG, "Replication Processing");
          Log.i(TAG, "It has completed " + thisReplicator.Status().getProgess().getTotal() + " changes");
      }
    _thisReplicator.Stop();
    while (_thisReplicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
        // Database cannot close until replicators are stopped
        Console.WriteLine($"Waiting for replicator to stop (currently {_thisReplicator.Status.Activity})...");
        Thread.Sleep(200);
    }
    _thisDatabase.Close();

      // Stop replication.
      thisReplicator.Stop(); <i class="conum" data-value="57"></i><b>(57)</b>


  }

{
  CouchbaseLite.init(context);
  Database thisDB = new Database("passivepeerdb");  <i class="conum" data-value="58"></i><b>(58)</b>
  // Initialize the listener config
  final URLEndpointListenerConfiguration thisConfig = new URLEndpointListenerConfiguration(database);
  thisConfig.Port(55990)             // &lt;.&gt; Default- port is selected
  thisConfig.DisableTls(false)       // &lt;.&gt; Optional. Defaults to false. You get TLS encryption out-of-box
  thisConfig.EnableDeltaSync(true)   // &lt;.&gt; Optional. Defaults to false.

  // Configure the client authenticator (if using basic auth)
  ListenerPasswordAuthenticator auth = new ListenerPasswordAuthenticator { "Our Username", "Our Password"}; <i class="conum" data-value="59"></i><b>(59)</b>
  thisConfig.Authenticator(auth); <i class="conum" data-value="60"></i><b>(60)</b>

  // Initialize the listener
  final URLEndpointListener listener = new URLEndpointListener( thisConfig ); <i class="conum" data-value="61"></i><b>(61)</b>

  // Start the listener
  listener.Start(); <i class="conum" data-value="62"></i><b>(62)</b>
    }



Map&lt;String, String&gt; X509_ATTRIBUTES = mapOf(
           TLSIdentity.CERT_ATTRIBUTE_COMMON_NAME to "Couchbase Demo",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION to "Couchbase",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION_UNIT to "Mobile",
           TLSIdentity.CERT_ATTRIBUTE_EMAIL_ADDRESS to "<a href="mailto:noreply@couchbase.com">noreply@couchbase.com</a>"
       )

TLSIdentity thisIdentity = new TLSIdentity.createIdentity(true, X509_ATTRIBUTES, null, "test-alias");



. . . work in progress - GetHashCode snippet to be provided

TLSIdentity.DeleteIdentity(_store, "alias-to-delete", null);


// OPTIONALLY:: Retrieve a stored TLS identity using its alias/label

TLSIdentity thisIdentity = new TLSIdentity.getIdentity("CBL-Demo-Server-Cert")


    // Configure the client authenticator (if using Basic Authentication)
    // String validUser = new String("validUsername"); // an example username
    // String validPassword = new String("validPasswordValue"); // an example password

    // ListenerPasswordAuthenticator thisAuth = new ListenerPasswordAuthenticator( <i class="conum" data-value="63"></i><b>(63)</b>
    //   validUser, validPassword -&gt; validUser == "validUsername" &amp;&amp; validPassword == "validPasswordValue" );

    // if (thisAuth) {
    //   thisConfig.Authenticator(auth);
    // }
    // else {
    //   // . . . authentication failed take appropriate exception action
    //   return
    // };




    ListenerToken thisListener = new thisReplicator.addChangeListener(change -&gt; { <i class="conum" data-value="64"></i><b>(64)</b>
      if (change.Status().getError() != null) {
        Log.i(TAG, "Error code ::  " + change.Status().getError().getCode());
      }
    });




// g u b b i n s


    // Configure TLS Cert CA auth using key-stored cert id alias 'doc-sync-server'

    // TLSIdentity thisIdentity = new TLSIdentity.getIdentity("doc-sync-server"); // Get existing TLS ID from sec storage

    // ClientCertificateAuthenticator thisAuth = new ClientCertificateAuthenticator(thisIdentity);

    // thisConfig.Authenticator(thisAuth);



    // USE KEYCHAIN IDENTITY IF EXISTS
    // Check if Id exists in keychain. If so use that Id

    // STILL NEED TO REFACTOR

    do {
      if let thisIdentity = try TLSIdentity.identity(withLabel: "doco-sync-server") {
          print("An identity with label : doco-sync-server already exists in keychain")
          return thisIdentity
          }
    } catch
    {return nil}
    thisAuthenticator.ClientCertificateAuthenticator(identity: thisIdentity )
    thisConfig.thisAuthenticator




String thisAlias = "alias-to-delete";
KeyStore thisKeystore = KeyStore.getInstance("PKCS12"); <i class="conum" data-value="65"></i><b>(65)</b>
thisKeyStore.load= null;
if (thisAlias != null) {
   thisKeystore.deleteEntry(thisAlias);  <i class="conum" data-value="66"></i><b>(66)</b>
}



// cert auth
let rootCertData = SecCertificateCopyData(cert) as Data
let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])

SecCertificate thisCert = new SecCertificate(); // populated as nec.

Data rootCertData = new Data(SecCertificateCopyData(thisCert));

let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])
// cert auth


// C A L L O U T S

&lt;.&gt; Configure to accept only CA certs
&lt;.&gt; Configure the pinned certificate using data from the byte array <code>cert</code>
&lt;.&gt; Set the certificate to be compared with that provided by the server

&lt;.&gt; PKCS12 data containing private key, public key, and certificates
&lt;.&gt; This is the default value and means that TLS is enabled

&lt;.&gt; Refuse self-signed certificates
&lt;.&gt; Get the identity
&lt;.&gt; Set the Client Certificate Authenticator to require signed certificates with this identity



    // Configure the client authenticator
    // to validate using ROOT CA <i class="conum" data-value="67"></i><b>(67)</b>
    byte[] thisCaData; // byte array for CA data
    using (var thisReader = new BinaryReader(stream)) {
      thisCaData = thisReader.ReadBytes(int stream.Length);
    }; // Get cert data

    var thisRootCert = new X509Certificate(thisCaData); //

    thisConfig.Authenticator = new  ListenerCertificateAuthenticator(
      new X509Certificate2Collection(thisRootCert)
    );




    var db = new Database("other-database");
    _Database = db;
    X509Store _store = new X509Store(StoreName.My);
    TLSIdentity thisIdentity;


    // Configure the expected server-supplied
    // credentials -- only accept CA Certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="68"></i><b>(68)</b>

    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="69"></i><b>(69)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="70"></i><b>(70)</b>






    byte[] thisCaData, thisClientData;
    thisClientData = File.ReadAllBytes("C:\\client.p12"); <i class="conum" data-value="71"></i><b>(71)</b>
    thisCaData = File.ReadAllBytes("C:\\client-ca.der");

    // Root certs
    var thisRootCert = new X509Certificate2(thisCaData);
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert));

    // Create URL Endpoint Listener
    var thisConfig = new URLEndpointListenerConfiguration(_Database);
    thisConfig.DisableTLS = false; <i class="conum" data-value="72"></i><b>(72)</b>
    thisConfig.Authenticator = thisAuth;
    _listener = new URLEndpointListener(thisConfig);
    _listener.Start();

    // Client identity
    thisIdentity = TLSIdentity.ImportIdentity(_store,
        thisClientData,
        "123",
        "CBL-Client-Cert",
        null);

    // Replicator -- Client
    var database = new Database("client-database");
    var builder = new UriBuilder(
        "wss",
        "localhost",
        _listener.Port,
        $"/{_listener.thisConfig.Database.Name}"
    );

    var url = builder.Uri;
    var target = new URLEndpoint(url);
    var thisConfig = new ReplicatorConfiguration(database, target);
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;
    thisConfig.Continuous = false;
    thisConfig.Authenticator = new ClientCertificateAuthenticator(thisIdentity);
    thisConfig.AcceptOnlySelfSignedServerCertificate = true;
    thisConfig.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
    using (var replicator = new Replicator(thisConfig)) {
        replicator.Start();
    }





    // Stop listener after replicator is stopped
    _listener.Stop();



    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="73"></i><b>(73)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="74"></i><b>(74)</b>



  // For replications

  // BEGIN -- snippets --
  //    Purpose -- code samples for use in replication topic

  public class MyClass
  {
      public Database Database { get; set; }
      public Replicator Replicator { get; set; } <i class="conum" data-value="75"></i><b>(75)</b>

      public void StartReplication()
      {
  }

          var url = new Uri("wss://localhost:4984/db"); <i class="conum" data-value="76"></i><b>(76)</b>
          var target = new URLEndpoint(url);
          var config = new ReplicatorConfiguration(Database, target)
          {
              ReplicatorType = ReplicatorType.Pull
          };

          Replicator = new Replicator(config);
          Replicator.Start();
      }

      // &lt;.&gt; A replication is an asynchronous operation.
      // To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
      // &lt;.&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
      // You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.

      public void InitReplication()
      {
        // initialize the replicator configuration

        var thisUrl = new URLEndpoint("wss://l10.0.2.2:4984/anotherDB"); <i class="conum" data-value="77"></i><b>(77)</b>
        var config = new ReplicatorConfiguration(thisDB, thisUrl);

      }
  }
 }



  public class supporting_datatypes
  {
      public void datatype_dictionary()
      {
          var database = new Database(name: "mydb");

          // NOTE: No error handling, for brevity (see getting started)
          var document = database.GetDocument("doc1");

          // Getting a dictionary from the document's properties
          var dict = document.GetDictionary("address");

          // Access a value with a key from the dictionary
          var street = dict.GetString("street");

          // Iterate dictionary
          foreach (var key in dict.Keys)
          {
              Console.WriteLine($"Key {key} = {dict.GetValue(key)}");
          }

          // Create a mutable copy
          var mutDict = dict.ToMutable();
      }

      public void datatype_mutable_dictionary()
      {

          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable dictionary and populate some keys/values
          var mutable_dict = new MutableDictionaryObject();
          mutable_dict.SetString("street", "1 Main st.");
          mutable_dict.SetString("city", "San Francisco");

          // Add the dictionary to a document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetDictionary("address", mutable_dict);
          database.Save(doc);

      }


      public void datatype_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          var document = database.GetDocument("doc1");

          // Getting a phones array from the document's properties
          var array = document.GetArray("phones");

          // Get element count
          var count = array.Count();

          // Access an array element by index
          if (count &gt;= 0) { var phone = array[1]; }

          // Iterate dictionary
          for (int i = 0; i &lt; count; i++)
          {
              Console.WriteLine($"Item {i.ToString()} = {array[i]}");
          }

          // Create a mutable copy
          var mutable_array = array.ToMutable();


      }

        public void datatype_mutable_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable array and populate data into the array
          var mutable_array = new MutableArrayObject();
          mutable_array.AddString("650-000-0000");
          mutable_array.AddString("650-000-0001");

          // Set the array to document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetArray("phones", mutable_array);
          database.Save(doc);
      }

  } // end  class supporting_datatypes</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>+
See: <a href="database.html" class="page">Databases</a> for more information</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize a new mutable document</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">//
// Program.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;

namespace api_walkthrough
{
    class Program
    {
        private static Database _Database;
        private static Replicator _Replicator;
        private static URLEndpointListener _listener;
        private static ListenerToken _ListenerToken;
        private static bool _NeedsExtraDocs;

        <mark>region Private Methods

        private static void GettingStarted()
        {

            // using System;
            // using Couchbase.Lite;
            // using Couchbase.Lite.Query;
            // using Couchbase.Lite.Sync;

            // Get the database (and create it if it doesn't exist)
            var database = new Database("mydb");
            // Create a new document (i.e. a record) in the database
            string id = null;
            using (var mutableDoc = new MutableDocument())
            {
                mutableDoc.SetFloat("version", 2.0f)
                    .SetString("type", "SDK");

                // Save it to the database
                database.Save(mutableDoc);
                id = mutableDoc.Id;
            }

            // Update a document
            using (var doc = database.GetDocument(id))
            using (var mutableDoc = doc.ToMutable())
            {
                mutableDoc.SetString("language", "C</mark>");
                database.Save(mutableDoc);

                using (var docAgain = database.GetDocument(id))
                {
                    Console.WriteLine($"Document ID :: {docAgain.Id}");
                    Console.WriteLine($"Learning {docAgain.GetString("language")}");
                }
            }

            // Create a query to fetch documents of type SDK
            // i.e. SELECT * FROM database WHERE type = "SDK"
            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(database))
                .Where(Expression.Property("type").EqualTo(Expression.String("SDK"))))
            {
                // Run the query
                var result = query.Execute();
                Console.WriteLine($"Number of rows :: {result.AllResults().Count}");
            }

            // Create replicator to push and pull changes to and from the cloud
            var targetEndpoint = new URLEndpoint(new Uri("ws://localhost:4984/getting-started-db"));
            var replConfig = new ReplicatorConfiguration(database, targetEndpoint);

            // Add authentication
            replConfig.Authenticator = new BasicAuthenticator("john", "pass");

            // Create replicator (make sure to add an instance or static variable
            // named _Replicator)
            var _Replicator = new Replicator(replConfig);
            _Replicator.AddChangeListenersender, args) =&gt;             {                 if (args.Status.Error != null)                 {                     Console.WriteLine($"Error :: {args.Status.Error}");                 }             });              _Replicator.Start();              // Later, stop and dispose the replicator <strong>before</strong> closing/disposing the         }            private static void TestReplicatorConflictResolver()         {             var target = new URLEndpoint(new Uri("ws://localhost:4984/mydatabase";
            var replConfig = new ReplicatorConfiguration(database, target);
            replConfig.ConflictResolver = new LocalWinConflictResolver();

            var replicator = new Replicator(replConfig);
            replicator.Start();
        }

        private static void TestSaveWithConflictHandler()
        {
            using (var document = database.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                database.Save(mutableDocument, (updated, current) =&gt;
                {
                    var currentDict = current.ToDictionary();
                    var newDict = updated.ToDictionary();
                    var result = newDict.Concat(currentDict)
                        .GroupBy(kv =&gt; kv.Key)
                        .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
                    updated.SetData(result);
                    return true;
                });
            }
        }

        private static bool IsValidCredential(string name, SecureString password) { return true;  } // helper
        private static void TestInitListener()
        {
            var db = new Database("other-database");
            _Database = db;

            var config = new URLEndpointListenerConfiguration(_Database);
            config.TlsIdentity = null; // Use with anonymous self-signed cert
            config.Authenticator = new ListenerPasswordAuthenticatorsender, username, password) =&gt;             {                 if(IsValidCredential(username, password {
                    return true;
                }

                return false;
            });

            _listener = new URLEndpointListener(config);
        }

        private static void TestListenerStart()
        {
            // CouchbaseLiteException will be thrown when the listener cannot be started. The most common error
            // would be that the configured port has already been used.
            _listener.Start();
        }

        private static void TestListenerStop()
        {
            _listener.Stop();
        }

        private static void TestCreateSelfSignedCert()
        {
            TLSIdentity identity;
            X509Store _store =
             new X509Store(StoreName.My);
              // The identity will be stored in the secure
              // storage using the given label.
            DateTimeOffset fiveMinToExpireCert = DateTimeOffset.UtcNow.AddMinutes(5);

            identity = TLSIdentity.CreateIdentity(true, /* isServer <strong>/
                new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "Couchbase Inc" } },
                    // The common name attribute is required
                    // when creating a CSR. If it is not presented
                    // in the cert, an exception is thrown.
                fiveMinToExpireCert,
                    // If the expiration date is not specified,
                    // the certs expiration will be 365 days
                _store,
                "CBL-Server-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.

        }

        private static void TestImportTLSIdentity()
        {
            TLSIdentity identity;
            X509Store _store = new X509Store(StoreName.My); // The identity will be stored in the secure storage using the given label
            byte[] data = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates

            identity = TLSIdentity.ImportIdentity(_store,
                data,
                "123", // The password that is needed to access the certificate data
                "CBL-Client-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.
        }

          private static void TestClientCertAuthenticatorRootCerts()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;

            byte[] caData, clientData;
            clientData = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates
            caData = File.ReadAllBytes("C:\\client-ca.der");

            // Root certs
            var rootCert = new X509Certificate2(caData);
            var auth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(rootCert));

            // Create URL Endpoint Listener
            var listenerConfig = new URLEndpointListenerConfiguration(_Database);
            listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.
            listenerConfig.Authenticator = auth;
            _listener = new URLEndpointListener(listenerConfig);
            _listener.Start();

            // Client identity
            identity = TLSIdentity.ImportIdentity(_store,
                clientData,
                "123",
                "CBL-Client-Cert",
                null);

            // Replicator -- Client
            var database = new Database("client-database");
            var builder = new UriBuilder(
                "wss",
                "localhost",
                _listener.Port,
                $"/{_listener.Config.Database.Name}"
            );

            var url = builder.Uri;
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.ReplicatorType = ReplicatorType.PushAndPull;
            config.Continuous = false;
            config.Authenticator = new ClientCertificateAuthenticator(identity);
            config.AcceptOnlySelfSignedServerCertificate = true;
            config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
            using (var replicator = new Replicator(config)) {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
            // end::client-cert-authenticator-root-cert
        }

        private static void TestClientCertAuthenticator()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;


            // Create Listener Certificate Authenticator
            var auth = new ListenerCertificateAuthenticatorsender, cert) =&gt;             {                 if (cert.Count != 1) {                     return false;                 }                  return cert[0].SubjectName.Name?.Replace("CN=", "") == "couchbase";             });              // Create URL Endpoint Listener             var listenerConfig = new URLEndpointListenerConfiguration(_Database);             listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.             listenerConfig.Authenticator = auth;             _listener = new URLEndpointListener(listenerConfig);             _listener.Start();              // User Identity             identity = TLSIdentity.CreateIdentity(false,                 new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "couchbase" } },                 null,                 _store,                 ClientCertLabel,                 null);              // Replicator -- Client             var database = new Database("client-database");             var builder = new UriBuilder(                 "wss",                 "localhost",                 _listener.Port,                 $"/{_listener.Config.Database.Name}"             );              var url = builder.Uri;             var target = new URLEndpoint(url);             var config = new ReplicatorConfiguration(database, target);             config.ReplicatorType = ReplicatorType.PushAndPull;             config.Continuous = false;             config.Authenticator = new ClientCertificateAuthenticator(identity);             config.AcceptOnlySelfSignedServerCertificate = false;             config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];             using (var replicator = new Replicator(config {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
        }

        private static void UseEncryption()
        {
            // Enterprise edition only

            // Create a new, or open an existing database with encryption enabled
            var config = new DatabaseConfiguration
            {
                // Or, derive a key yourself and pass a byte array of the proper size
                EncryptionKey = new EncryptionKey("password")
            };

            using (var db = new Database("seekrit", config)) {
                // Change the encryption key (or add encryption if the DB is unencrypted)
                db.ChangeEncryptionKey(new EncryptionKey("betterpassw0rd"));

                // Remove encryption
                db.ChangeEncryptionKey(null);
            }
        }

        private static void ResetReplicatorCheckpoint()
        {
            var database = _Database;
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            using (var replicator = new Replicator(config)) {
              // replicator is a Replicator instance
              if (resetCheckpointRequired_Example) {
                  replicator.Start(true); <i class="conum" data-value="1"></i><b>(1)</b>
              else
                replicator.Start(false);
              }




            }
        }

        private static void Read1xAttachment()
        {
            var db = _Database;
            using (var document = new MutableDocument()) {
                var attachments = document.GetDictionary("_attachments");
                var avatar = attachments.GetBlob("avatar");
                var content = avatar?.Content;
            }
        }

        private static void CreateNewDatabase()
        {
            var db = new Database("my-database");

            _Database = db;
        }

        private static void CloseDatabase()
        {
          database.close()

        }

        private static void ChangeLogging()
        {
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Query, LogLevel.Verbose);
        }

        private static void LoadPrebuilt()
        {
            // Note: Getting the path to a database is platform-specific.  For .NET Core / .NET Framework this
            // can be a simple filesystem path.  For UWP, you will need to get the path from your assets.  For
            // iOS you need to get the path from the main bundle.  For Android you need to extract it from your
            // assets to a temporary directory and then pass that path.
            var path = Path.Combine(Environment.CurrentDirectory, "travel-sample.cblite2" + Path.DirectorySeparatorChar);
            if (!Database.Exists("travel-sample", null)) {
                _NeedsExtraDocs = true;
                Database.Copy(path, "travel-sample", null);
            }

            _Database.Close();
            _Database = new Database("travel-sample");
        }

        private static void QueryDeletedDocuments()
        {
            // Query documents that have been deleted
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.IsDeleted);
        }

        private static void CreateDocument()
        {
            var db = _Database;
            using (var newTask = new MutableDocument("xyz")) {
                newTask.SetString("type", "task")
                    .SetString("owner", "todo")
                    .SetDate("createdAt", DateTimeOffset.UtcNow);

                db.Save(newTask);
            }
        }

        private static void UpdateDocument()
        {
            var db = _Database;
            using(var document = db.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                db.Save(mutableDocument);
            }
        }

        private static void UseTypedAccessors()
        {
            using (var newTask = new MutableDocument()) {
                newTask.SetValue("createdAt", DateTimeOffset.UtcNow);
                var date = newTask.GetDate("createdAt");

                Console.WriteLine(date);
            }
        }

        private static void DoBatchOperation()
        {
            var db = _Database;
            db.InBatch) =&gt;             {                 for (var i = 0; i &lt; 10; i) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "user");
                        doc.SetString("name", $"user {i}");
                        doc.SetBoolean("admin", false);
                        db.Save(doc);
                        Console.WriteLine($"Saved user document {doc.GetString("name")}");
                    }
                }
            });
        }

        private static void DatabaseChangeListener()
        {
            var db = _Database;

            db.AddDocumentChangeListener("user.john", (sender, args) =&gt;
            {
                using (var doc = Db.GetDocument(args.DocumentID)) {
                    Console.WriteLine($"Status :: {doc.GetString("verified_account")}");
                }
            });
        }

        private static void DocumentExpiration()
        {
            var db = _Database;

            // Purge the document one day from now
            var ttl = DateTimeOffset.UtcNow.AddDays(1);
            db.SetDocumentExpiration("doc123", ttl);

            // Reset expiration
            db.SetDocumentExpiration("doc1", null);

            // Query documents that will be expired in less than five minutes
            var fiveMinutesFromNow = DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeMilliseconds();
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.Expiration.LessThan(Expression.Double(fiveMinutesFromNow)));
        }

        private static void UseBlob()
        {
            var db = _Database;
            using (var newTask = new MutableDocument()) {
                // Note: Reading the data is implementation dependent, as with prebuilt databases
                var image = File.ReadAllBytes("avatar.jpg"); // &lt;.&gt;
                var blob = new Blob("image/jpeg", image); // &lt;.&gt;
                 newTask.SetBlob("avatar", blob); // &lt;.&gt;
                db.Save(newTask);

                var taskBlob = newTask.GetBlob("avatar");
                using (var bitmap = SKBitmap.Decode(taskBlob.ContentStream)) {
                    Console.WriteLine($"Bitmap dimensions: {bitmap.Width} x {bitmap.Height} ({bitmap.BytesPerPixel} bytes per pixel)");
                }
            }
        }

        public void CreateIndex()
        {
            var db = _database;
            string[] indexProperties = new string[] {"type", "name" };
            var config = new ValueIndexConfiguration(indexProperties);
            db.CreateIndex("TypeNameIndex", config);
        }

        public void CreateIndex_Querybuilder()
        {
            // For value types, this is optional but provides performance enhancements
            var db = _database;
            var index = IndexBuilder.ValueIndex(
                ValueIndexItem.Expression(Expression.Property("type")),
                ValueIndexItem.Expression(Expression.Property("name"))); // &lt;.&gt;
            db.CreateIndex("TypeNameIndex", index);
        }
        private static void SelectMeta()
        {
            Console.WriteLine("Select Meta");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("type"),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document ID :: {result.GetString("id")}");
                    Console.WriteLine($"Document Name :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectAll()
        {
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))) {
                // All user properties will be available here
            }

            var query = QueryBuilder
                .Select(SelectResult.All())
                .From(DataSource.Database(db)); // &lt;.&gt;

            // Adds a query change listener.
            // Changes will be posted on the main queue.
            var token = query.AddChangeListener((sender, args) =&gt; // &lt;.&gt;
            {
                var allResult = args.Results.AllResults();
                foreach (var result in allResult) {
                    Console.WriteLine(result.Keys);
                    /* Update UI */
                }
            });


            query.RemoveChangeListener(token);
            query.Dispose();
        }

        private static void SelectWhere()
        {
            Console.WriteLine("Where");
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    var dict = result.GetDictionary(db.Name);
                    Console.WriteLine($"Document Name :: {dict?.GetString("name")}");
                }
            }
        }

        private static void UseCollectionContains()
        {
            Console.WriteLine("Collection Operator CONTAINS");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"),
                    SelectResult.Property("public_likes"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel"))
                    .And(ArrayFunction.Contains(Expression.Property("public_likes"),
                        Expression.String("Armani Langworth"))))) {
                foreach (var result in query.Execute()) {
                    var publicLikes = result.GetArray("public_likes");
                    var jsonString = JsonConvert.SerializeObject(publicLikes);
                    Console.WriteLine($"Public Likes :: {jsonString}");
                }
            }
        }

        private static void UseCollectionIn()
        {
            Console.WriteLine("Collection Operator IN");
            var db = _Database;

            var values = new IExpression[]
                { Expression.Property("first"), Expression.Property("last"), Expression.Property("username") };

            using (var query = QueryBuilder.Select(
                    SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.String("Armani").In(values))) {
                foreach (var result in query.Execute()) {
                    var body = result.GetDictionary(0);
                    var jsonString = JsonConvert.SerializeObject(body);
                    Console.WriteLine($"In results :: {jsonString}");
                }
            }
        }

        private static void SelectLike()
        {
            Console.WriteLine("Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Royal Engineers Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardLike()
        {
            Console.WriteLine("Wildcard Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Eng%e%"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardCharacterLike()
        {
            Console.WriteLine("Wildchard Characters");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Like(Expression.String("Royal Eng____rs Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectRegex()
        {
            Console.WriteLine("Regex");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Regex(Expression.String("\\bEng.*e\\b"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectJoin()
        {
            Console.WriteLine("Join");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Expression.Property("name").From("airline")),
                    SelectResult.Expression(Expression.Property("callsign").From("airline")),
                    SelectResult.Expression(Expression.Property("destinationairport").From("route")),
                    SelectResult.Expression(Expression.Property("stops").From("route")),
                    SelectResult.Expression(Expression.Property("airline").From("route")))
                .From(DataSource.Database(db).As("airline"))
                .Join(Join.InnerJoin(DataSource.Database(db).As("route"))
                    .On(Meta.ID.From("airline").EqualTo(Expression.Property("airlineid").From("route"))))
                .Where(Expression.Property("type").From("route").EqualTo(Expression.String("route"))
                    .And(Expression.Property("type").From("airline").EqualTo(Expression.String("airline")))
                    .And(Expression.Property("sourceairport").From("route").EqualTo(Expression.String("RIX"))))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void GroupBy()
        {
            Console.WriteLine("GroupBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Function.Count(Expression.All())),
                    SelectResult.Property("country"),
                    SelectResult.Property("tz"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("airport"))
                    .And(Expression.Property("geo.alt").GreaterThanOrEqualTo(Expression.Int(300))))
                .GroupBy(Expression.Property("country"), Expression.Property("tz"))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine(
                        $"There are {result.GetInt("$1")} airports in the {result.GetString("tz")} timezone located in {result.GetString("country")} and above 300 ft");
                }
            }
        }

        private static void OrderBy()
        {
            Console.WriteLine("OrderBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("title"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .OrderBy(Ordering.Property("title").Ascending())
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Title :: {result.GetString("title")}");
                }
            }
        }

      // ### EXPLAIN statement
      private static void TestExplainStatement()
      // For Documentation
      {
        var db = _Database;
        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
            .GroupBy(Expression.Property("country"))
            .OrderBy(Ordering.Property("title").Ascending()) // &lt;.&gt;

          Console.WriteLine(query.Explain()); // &lt;.&gt;

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("%hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;
  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Function.Lower(Expression.Property("type")).EqualTo(Expression.String("hotel"))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type")).EqualTo(Expression.String("hotel")); // &lt;.&gt;

          Console.WriteLine(query.Explain());

      }

      // end query-explain


        public void CreateFullTextIndex()
        {
            string[] indexProperties = new string[] { "overview", "name" };
            var config = new FullTextIndexConfiguration(indexProperties);
            db.CreateIndex("overviewFTSIndex", config);
        }

        public void FullTextSearch()
        {
            Console.WriteLine("Full text search");

            var db = _database;
            var ftsQuery = db.CreateQuery("SELECT * FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)");
            foreach (var result in ftsQuery.Execute())
            {
                Console.WriteLine($"Document id {result.GetString(0)}");
            }
            }
        }


        private static void CreateFullTextIndex_Querybuilder()
        {
            var db = _Database;

            if (_NeedsExtraDocs) {
                var tasks = new[] { "buy groceries", "play chess", "book travels", "buy museum tickets" };
                foreach (var task in tasks) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "task");
                        doc.SetString("name", task);
                        db.Save(doc);
                    }
                }
            }


            var index = IndexBuilder.FullTextIndex(FullTextIndexItem.Property("overview")).IgnoreAccents(false);
            db.CreateIndex("overviewFTSIndex", index);
        }

        private static void FullTextSearch_Querybuilder()
        {
            Console.WriteLine("Full text search");
            var db = _Database;

            var whereClause = FullTextFunction.Match("overviewFTSIndex", "'michigan'");

            using (var query = QueryBuilder.Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(whereClause)) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document id {result.GetString(0)}");
                }
            }
        }
        private static void StartReplication()
        {
            var db = _Database;

            /*
             * This requires Sync Gateway running with the following config, or equivalent:
             *
             * {
             *     "log":["*"],
             *     "databases": {
             *         "db": {
             *             "server":"walrus:",
             *             "users": {
             *                 "GUEST": {"disabled": false, "admin_channels": ["*"] }
             *             }
             *         }
             *     }
             * }
             */

            // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(db, target)
            {
                ReplicatorType = ReplicatorType.Pull
            };

            var replicator = new Replicator(config);
            replicator.Start();

            _Replicator = replicator;
        }

        private static void VerboseReplicatorLogging()
        {
            // deprecated
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Network, LogLevel.Verbose);
        }

        private static void ConsoleLogging()
        {
            Database.Log.Console.Domains = LogDomain.All; // &lt;.&gt;
            Database.Log.Console.LogLevel = LogLevel.Verbose; // &lt;.&gt;


            Database.Log.Console.Domains = LogDomain.Database;

        }

        private static void FileLogging()
        {
            var tempFolder = Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;().DefaultDirectory(), "cbllog");
            var config = new LogFileConfiguration(tempFolder) // &lt;.&gt;
            {
                MaxRotateCount = 5, // &lt;.&gt;
                MaxSize = 10240, // &lt;.&gt;
                UsePlainText = false  // &lt;.&gt;
            };
            Database.Log.File.Config = config; // Apply configuration
            Database.Log.File.Level = LogLevel.Info; // &lt;.&gt;

        }

        private static void EnableCustomLogging()
        {
            Database.Log.Custom = new LogTestLogger(); // &lt;.&gt;
            or
            Database.Log.Custom = new LogTestLogger { Level = LogLevel.Warning };

        }

        private static void WriteConsoleLog()
        {
            Database.Log.Console.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }
        private static void WriteCustomLog()
        {
            Database.Log.Custom?.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }


        private static void WriteFileLog()
        {
            Database.Log.File.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }

        private static void EnableBasicAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new BasicAuthenticator("john", "pass");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void EnableSessionAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void SetupReplicatorListener()
        {
            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
                    Console.WriteLine("Replication stopped");
                }
            });
        }




    //  BEGIN PendingDocuments IB -- 11/Feb/21 --
    private static void ReplicatorPendingDocuments()
    {
        var url = new Uri("ws://localhost:4984/mydatabase");
        var target = new URLEndpoint(url);
        var database = new Database("myDB");
        var config = new ReplicatorConfiguration(database, target);
        config.ReplicatorType  = ReplicatorType.Push;

        var replicator = new Replicator(config);

        var mydocids =
          new HashSet &lt;string&gt; (replicator.GetPendingDocumentIDs()); // &lt;.&gt;


        if (mydocids.Count &gt; 0)
        {
            Console.WriteLine($"There are {mydocids.Count} documents pending");
            replicator.AddChangeListener((sender, change) =&gt;
            {
                Console.WriteLine($"Replicator activity level is " +
                                  change.Status.Activity.ToString());
                // iterate and report-on previously
                // retrieved pending docids 'list'
                foreach (var thisId in mydocids)
                    if (!replicator.IsDocumentPending(thisId)) // &lt;.&gt;
                    {
                        Console.WriteLine($"Doc ID {thisId} now pushed");
                    };
            });

            replicator.Start();
        }
    }


//  END PendingDocuments IB -- 11/Feb/21 --



		private static void ReplicatorDocumentEvent()
        {
            var replicator = _Replicator;

            var token = replicator.AddDocumentReplicationListener((sender, args) =&gt;
            {
                var direction = args.IsPush ? "Push" : "Pull";
                Console.WriteLine($"Replication type :: {direction}");
                foreach (var document in args.Documents) {
                    if (document.Error == null) {
                        Console.WriteLine($"Doc ID :: {document.Id}");
                        if (document.Flags.HasFlag(DocumentFlags.Deleted)) {
                            Console.WriteLine("Successfully replicated a deleted document");
                        }
                    } else {
                        // There was an error
                    }
                }
            });

            replicator.Start();

            replicator.RemoveChangeListener(token);
        }

        private static void SetupReplicatorErrorListener()
        {
            // This can be done in the SetupReplicatorListener method
            // But it is separate so that we can have two documentation entries

            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Error != null) {
                    Console.WriteLine($"Error :: {args.Status.Error}");
                }
            });
        }

        private static void DatabaseReplica()
        {
            var db = _Database;
            using (var database2 = new Database("backup")) {
                // EE feature: This code will not compile on the community edition
                var targetDatabase = new DatabaseEndpoint(database2);
                var config = new ReplicatorConfiguration(db, targetDatabase)
                {
                    ReplicatorType = ReplicatorType.Push
                };

                var replicator = new Replicator(config);
                replicator.Start();

                _Replicator?.Stop();
                _Replicator = replicator;
            }
        }

        private static void PinCertificate()
        {
            // Note: No certificate is included here, so this code is for show only
            var url = new Uri("wss://localhost:4984/db");
            var target = new URLEndpoint(url);
            var db = _Database;

            // Note: `GetCertificate` is a fake method. This would be the platform-specific method
            // to find and load the certificate as an instance of `X509Certificate2`.
            // For .NET Core / .NET Framework this can be loaded from the filesystem path.
            // For UWP, from the assets directory.
            // For iOS, from the main bundle.
            // For Android, from the assets directory.
            var certificate = GetCertificate("cert.cer");
            var config = new ReplicatorConfiguration(db, target)
            {
                PinnedServerCertificate = certificate
            };
        }

        private static void ReplicationCustomHeaders()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target)
            {
                Headers = new Dictionary&lt;string, string&gt;
                {
                    ["CustomHeaderName"] = "Value"
                }
            };
        }

        private static void PushWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PushFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (flags.HasFlag(DocumentFlags.Deleted)) {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void PullWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PullFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (document.GetString("type") == "draft") {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        public void TestCustomRetryConfig()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);

        //  other config as required . . .

            config.Heartbeat = TimeSpan.FromSeconds(120); //  &lt;.&gt;
            config.Maxattempts = 20; //  &lt;.&gt;
            config.MaxAttemptWaitTime = TimeSpan.FromSeconds(600); //  &lt;.&gt;

        //  other config as required . . .

            var repl = new Replicator(config);

        }


        private static void UsePredictiveModel()
        {
            using (var db = new Database("mydb")) {
                var model = new ImageClassifierModel();
                Database.Prediction.RegisterModel("ImageClassifier", model);

                var index = IndexBuilder.ValueIndex(ValueIndexItem.Property("label"));
                db.CreateIndex("value-index-image-classifier", index);

                Database.Prediction.UnregisterModel("ImageClassifier");
            }
        }

        private static void UsePredictiveIndex()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });

                var index = IndexBuilder.PredictiveIndex("ImageClassifier", input);
                db.CreateIndex("predictive-index-image-classifier", index);
            }
        }

        private static void DoPredictiveQuery()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });
                var prediction = PredictiveModel.predict("ImageClassifier", input); // &lt;1&gt;

                using (var q = QueryBuilder.Select(SelectResult.All())
                    .From(DataSource.Database(db))
                    .Where(prediction.Property("label").EqualTo(Expression.String("car"))
                        .And(prediction.Property("probability").GreaterThanOrEqualTo(Expression.Double(0.8))))) {
                    var result = q.Execute();
                    Console.WriteLine($"Number of rows: {result.Count()}");
                }
            }
        }

        static void Main(string[] args)
        {
            // This only needs to be done once for whatever platform the executable is running
            // (UWP, iOS, Android, or desktop)
            Couchbase.Lite.Support.NetDesktop.Activate();

            CreateNewDatabase();
            CreateDocument();
            UpdateDocument();
            UseTypedAccessors();
            DoBatchOperation();
            UseBlob();
            SelectMeta();

            LoadPrebuilt();
            CreateIndex();
            SelectWhere();
            UseCollectionContains();
            SelectLike();
            SelectWildcardLike();
            SelectWildcardCharacterLike();
            SelectRegex();
            SelectJoin();
            GroupBy();
            OrderBy();

            CreateFullTextIndex();
            FullTextSearch();
            StartReplication();
            SetupReplicatorListener();

            _Replicator.Stop();
            while (_Replicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
                // Database cannot close until replicators are stopped
                Console.WriteLine($"Waiting for replicator to stop (currently {_Replicator.Status.Activity})...");
                Thread.Sleep(200);
            }

            _Database.Close();
        }

        #endregion
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  ACTIVE SIDE  ----------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */

    class ActivePeer : IMessageEndpointDelegate
    {
        ActivePeer()
        {
            var id = "";

            var database = new Database("dbname");

            // The delegate must implement the `IMessageEndpointDelegate` protocol.
            var messageEndpointTarget = new MessageEndpoint(uid: "UID:123", target: "",
                protocolType: ProtocolType.MessageStream, delegateObject: this);

            var config = new ReplicatorConfiguration(database, messageEndpointTarget);

            // Create the replicator object
            var replicator = new Replicator(config);
            // Start the replicator
            replicator.Start();
        }

        /* implementation of MessageEndpointDelegate */
        public IMessageEndpointConnection CreateConnection(MessageEndpoint endpoint)
        {
            var connection = new ActivePeerConnection(); /* implements MessageEndpointConnection */
            return connection;
        }
    }

    class ActivePeerConnection : IMessageEndpointConnection
    {
        private IReplicatorConnection _replicatorConnection;

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public async Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // await socket.Open(), etc
            // throw MessagingException if something goes wrong
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  PASSIVE SIDE  ---------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */
    class PassivePeerConnection : IMessageEndpointConnection
    {
        private MessageEndpointListener _messageEndpointListener;
        private IReplicatorConnection _replicatorConnection;

        public void StartListener()
        {
            var database = new Database("mydb");
            var config = new MessageEndpointListenerConfiguration(database, ProtocolType.MessageStream);
            _messageEndpointListener = new MessageEndpointListener(config);
        }

        public void StopListener()
        {
            _messageEndpointListener?.CloseAll();
        }

        public void AcceptConnection()
        {
            var connection = new PassivePeerConnection(); /* implements MessageEndpointConnection */
            _messageEndpointListener?.Accept(connection);
        }

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // socket should already be open on the passive side
            return Task.FromResult(true);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    // tensorFlowModel is a fake implementation
    // this would be the implementation of the ml model you have chosen
    class TensorFlowModel
    {
        public static IDictionary&lt;string, object&gt; PredictImage(byte[] data)
        {
            // Do calculations, etc
            return null;
        }
    }

    class ImageClassifierModel : IPredictiveModel
    {
        public DictionaryObject Predict(DictionaryObject input)
        {
            var blob = input.GetBlob("photo");
            if (blob == null) {
                return null;
            }

            var imageData = blob.Content;
            // tensorFlowModel is a fake implementation
            // this would be the implementation of the ml model you have chosen
            var modelOutput = TensorFlowModel.PredictImage(imageData);
            return new MutableDictionaryObject(modelOutput); // &lt;1&gt;
        }
    }

    private class LogTestLogger : ILogger
    {
        public LogLevel Level { get; set; }

        public void Reset()
        {
            _lines.Clear();
        }

        public void Log(LogLevel level, LogDomain domain, string message)
        {
            // handle the message, for example piping it to
            // a third party framework
        }
    }

    class LocalWinConflictResolver : IConflictResolver
    {
        Document Resolve(Conflict conflict)
        {
            return conflict.LocalDocument;
        }
    }

    class RemoteWinConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            return conflict.RemoteDocument;
        }
    }

    class MergeConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            var localDict = conflict.LocalDocument.ToDictionary();
            var remoteDict = conflict.RemoteDocument.ToDictionary();
            var result = localDict.Concat(remoteDict)
               .GroupBy(kv =&gt; kv.Key)
               .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
            return new MutableDocument(conflict.DocumentID, result);
        }
    }
}

// N1QL QUERY

  public List&lt;Result&gt; docsonly_N1QLQueryString(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = \"hotel\""); // &lt;.&gt;

      return thisQuery.Execute().AllResults();

  }


  public  List&lt;Result&gt; docsonly_N1QLQueryStringParams(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      // Declared elsewhere: Database argDB

      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = $type"); // &lt;.&gt;

      var n1qlParams = new Parameters();
      n1qlParams.SetString("type", "hotel"); // &lt;.&gt;
      thisQuery.Parameters = n1qlParams;

      return thisQuery.Execute().AllResults();

  }


// QUERY RESULT SET HANDLING EXAMPLES

    public static void testQuerySyntaxAll()
    {
        // For Documentation
        var dbName = "travel-sample";

        string thisDocsId;
        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        Dictionary&lt;string,object&gt; hotel = new Dictionary&lt;string,object&gt;();

        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
              .Select(SelectResult.All())
              .From(DataSource.Database(this_Db));


        var results = query.Execute().AllResults();

        if (results?.Count &gt; 0)
        {
            List&lt;Dictionary&lt;string,object&gt;&gt; hotels = new List&lt;Dictionary&lt;string,object&gt;&gt;();
            foreach (var result in results)
            {
                // get the result into our dictionary object
                var thisDocsProps = result.GetDictionary(dbName); // &lt;.&gt;

                if (thisDocsProps != null)
                {
                    thisDocsId = thisDocsProps.GetString("id"); // &lt;.&gt;
                    thisDocsName = thisDocsProps.GetString("name");
                    thisDocsCity = thisDocsProps.GetString("city");
                    thisDocsType = thisDocsProps.GetString("type");
                    hotel = thisDocsProps.ToDictionary();
                    hotels.Add(hotel);
                }

            }
        }


    foreach (var result in query.Execute().AsEnumerable()) {

        // get the result into a JSON String
                var thisDocsJSONString = result.ToJSON();// &lt;.&gt;

        // Get a native dictionary object using the JSON string
        var dictFromJSONstring =
              JsonConvert.
                DeserializeObject&lt;Dictionary&lt;string, object&gt;&gt;
                  (thisDocsJSONString); // &lt;.&gt;

        // use the created dictionary
        if (dictFromJSONstring != null)
        {
            thisDocsId = dictFromJSONstring["id"].ToString();
            thisDocsName = dictFromJSONstring["name"].ToString();
            thisDocsCity = dictFromJSONstring["city"].ToString();
            thisDocsType = dictFromJSONstring["type"].ToString();
        }

        //Get a custom object using the JSON string
        Hotel this_hotel =
            JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocsJSONString); // &lt;.&gt;

        // Store this hotel object in a list of hotels
        hotels.Add(
            this_hotel.Id.ToString(),
                this_hotel);

    } // end foreach result
  }


    private static void testQuerySyntaxProps()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        var this_Db = new Database("hotels") ;

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();

        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var query = QueryBuilder.Select(
                SelectResult.Property("type"),
                SelectResult.Property("name"),
                SelectResult.Property("city")).From(DataSource.Database(this_Db));

        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            // get the returned array of k-v pairs into a dictionary
            hotel = result.ToDictionary();

            // add hotel dictionary to list of hotel dictionaries
            hotels.Add(hotel);

            // use the properties of the returned array of k-v pairs directly
            thisDocsType = result.GetString("type");
            thisDocsName = result.GetString("name");
            thisDocsCity = result.GetString("city");

        }

    } // test-query-access-props



    private static void testQuerySyntaxCount()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var this_Db = new Database("hotels") ;

        var query =
          QueryBuilder
            .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount")) // &lt;.&gt;
            .From(DataSource.Database(this_Db));




        var results = query.Execute().AllResults();

        foreach (var result in results)
        {

            var numberOfDocs = result.GetInt("mycount"); // &lt;.&gt;

        }

    }




    private static void ibQueryForID()
    {

        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();


        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID).As("this_ID"))
                .From(DataSource.Database(this_Db));



        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            var thisDocsID = result.GetString("this_ID"); // &lt;.&gt;
            var doc = this_Db.GetDocument(thisDocsID);
        }

    }


    private static void testQueryPagination()
    {
      // For Documentation
      var dbName = "travel-sample";
      // var this_Db = new Database(dbName);

      var this_Db = new Database("hotels") ;

      var thisLimit = 20;
      var thisOffset = 0;

      // get a count of the number of docs matching the query
      var countQuery =
          QueryBuilder
              .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount"))
              .From(DataSource.Database(this_Db));
      var numberOfDocs =
          countQuery.Execute().AllResults().ElementAt(0).GetInt("mycount");

      if (numberOfDocs &lt; thisLimit) {
          thisLimit = numberOfDocs;
      }

      while (thisOffset &lt; numberOfDocs)
      {
          var listQuery =
              QueryBuilder
                  .Select(SelectResult.All())
                  .From(DataSource.Database(this_Db))
                  .Limit(Expression.Int(thisLimit), Expression.Int(thisOffset)); // &lt;.&gt;

          foreach (var result in listQuery.Execute().AllResults())
          {
              // Display and or process query results batch

          }

          thisOffset = thisOffset + thisLimit;

      } // end while

    }

    // JSONAPIMETHODS



        public void JsonApiDocument()
        {

            Database this_DB = new Database("travel-sample");
            Database newDb = new Database("ournewdb");

            // Get a document
            var thisDoc = this_Db.GetDocument("hotel_10025");

            // Get document data as JSON String
            var thisDocAsJsonString = thisDoc?.ToJSON(); // &lt;.&gt;

            // Get Json Object from the Json String
            JObject myJsonObj = JObject.Parse(thisDocAsJsonString);

            // Get Native Object (anhotel) from JSON String
            List&lt;Hotel&gt; thehotels = new List&lt;Hotel&gt;();

            Hotel anhotel = new Hotel();
            anhotel = JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocAsJsonString);
            thehotels.Add(anhotel);

            // Update the retrieved native object
            anhotel.Name = "A Copy of " + anhotel.Name;
            anhotel.Id = "2001";

            // Convert the updated object back to a JSON string
            var newJsonString = JsonConvert.SerializeObject(anhotel);

            // Update new document with JSOn String
            MutableDocument newhotel =
                new MutableDocument(anhotel.Id, newJsonString); // &lt;.&gt;

            foreach (string key in newhotel.ToDictionary().Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}",
                    key, newhotel.GetValue(key));
            }

            newDb.Save(newhotel);

            var thatDoc = newDb.GetDocument("2001").ToJSON(); // &lt;.&gt;
            System.Console.Write(thatDoc);



        //    JSON String = { "description":"Very good and central","id":"1000","country":"France","name":"Hotel Ted","type":"hotel","city":"Paris"}
        //             type = hotel
        //             id = 1000
        //             country = France
        //             city = Paris
        //             description = Very good and central
        //             name = Hotel Ted
        //         */

        } // End JSONAPIDocument


    public void JsonApiArray()
        {
            // Init for docs
            //var this_Db = DataStore.getDbHandle();
            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }


            Database dbNew = new Database(ourdbname);

            // JSON String -- an Array (3 elements. including embedded arrays)
            var thisJSONstring = "[{'id':'1000','type':'hotel','name':'Hotel Ted','city':'Paris','country':'France','description':'Undefined description for Hotel Ted'},{'id':'1001','type':'hotel','name':'Hotel Fred','city':'London','country':'England','description':'Undefined description for Hotel Fred'},                        {'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}]".Replace("'", "\"");

            // Get JSON Array from JSON String
            JArray myJsonObj = JArray.Parse(thisJSONstring);

            // Create mutable array using JSON String Array
            var myArray = new MutableArrayObject();
            myArray.SetJSON(thisJSONstring);  // &lt;.&gt;


            // Create a new documenty for each array element
            for (int i = 0; i &lt; myArray.Count; i)             {                 var dict = myArray.GetDictionary(i);                 var docid = myArray[i].Dictionary.GetString("id");                 var newdoc = new MutableDocument(docid, dict.ToDictionary(; <i class="conum" data-value="2"></i><b>(2)</b>
                dbNew.Save(newdoc);
            }

            // Get one of the created docs and iterate through one of the embedded arrays
            var extendedDoc = dbNew.GetDocument("1002");
            var features = extendedDoc.GetArray("features");
            <i class="conum" data-value="3"></i><b>(3)</b>
            foreach (string feature in features) {
                System.Console.Write(feature);
                //process array item as required
            }
            var featuresJSON = extendedDoc.GetArray("features").ToJSON(); <i class="conum" data-value="4"></i><b>(4)</b>

        }


        public void JsonApiDictionary()
        {

            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }
            Database dbNew = new Database(ourdbname);


            // Get dictionary from JSONstring
            var aJSONstring = "{'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDict = new MutableDictionaryObject(json: aJSONstring); <i class="conum" data-value="5"></i><b>(5)</b>

            // use dictionary to get name value
            var name = myDict.GetString("name");


            // Iterate through keys
            foreach (string key in myDict.Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}", key, myDict.GetValue(key).ToString());

            }

            /</strong>

                mono-stdout: Data -- id = 1002
                mono-stdout: Data -- type = hotel
                mono-stdout: Data -- name = Hotel Ned
                mono-stdout: Data -- city = Balmain
                mono-stdout: Data -- country = Australia
                mono-stdout: Data -- description = Undefined description for Hotel Ned
                mono-stdout: Data -- features = Couchbase.Lite.MutableArrayObject

            <strong>/
        } /</strong> end of func <strong>/


         public void JsonApiBlob()
        {
            // Init
            var ourpath = DataStore.getUserFolder();
            var ourdbname = "ournewdb";
            var userName = "ian";
            //ourpath = Path.Combine(ourpath,userName);

            if (Database.Exists(ourdbname, ourpath))
            {
                Database.Delete(ourdbname, ourpath);
            }
            var dbCfg = new DatabaseConfiguration();
            dbCfg.Directory=ourpath;
            Database dbNew = new Database(ourdbname,dbCfg);


            // Initialize base document for blob from a JSON string
            var docId = "1002";
            var aJSONstring = "{'ref':'hotel_1002','type':'hotel','name':'Hotel Ned'," +
                "'city':'Balmain','country':'Australia'," +
                "'description':'Undefined description for Hotel Ned'," +
                "'features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDoc = new MutableDocument(docId, aJSONstring); <i class="conum" data-value="6"></i><b>(6)</b>


            // Get the content (an image), create blob and add to doc)
            var defaultDirectory =
                Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;()
                            .DefaultDirectory(),
                                userName);
            var myImagePath = Path.Combine(defaultDirectory, "avatarimage.jpg");
            var myImageUri = new Uri(myImagePath.ToString());
            var myBlob = new Blob("image/jpg", myImageUri); <i class="conum" data-value="7"></i><b>(7)</b>
            myDoc.SetBlob("avatar", myBlob); <i class="conum" data-value="8"></i><b>(8)</b>


            // This example generates a 'blob not saved' exception
            try { Console.WriteLine("myBlob (unsaved) as JSON = {0}", myBlob.ToJSON());}
                catch (Exception e)
                    {Console.WriteLine("Exception = {0}", e.Message);}

            dbNew.Save(myDoc);

            // Alternatively -- depending on use case
            dbNew.SaveBlob(new Blob("image/jpg", myImageUri)); <i class="conum" data-value="9"></i><b>(9)</b>


            // Retrieve saved doc, get blob as JSON andheck its still a 'blob'
            var sameDoc = dbNew.GetDocument(docId);
            var reconstitutedBlob = new MutableDictionaryObject().
                SetDictionary("blobCOPY", new MutableDictionaryObject(sameDoc.GetBlob("avatar").ToJSON())); <i class="conum" data-value="10"></i><b>(10)</b>

            if (Blob.IsBlob(
                    reconstitutedBlob.GetDictionary("blobCOPY").ToDictionary()))  <i class="conum" data-value="11"></i><b>(11)</b>
            {
               //... process accordingly
               Console.WriteLine("Its a Blob!!");
            }

            var datavalue = "";
            foreach (string key in myDoc.Keys)
            {
                if (key == "features")
                {
                    datavalue = "features are: ";
                    foreach (string item in myDoc.GetArray(key))
                    {
                        datavalue = datavalue + ", " + item;
                    }
                }
                else if (key == "avatar")
                {
                    datavalue = sameDoc.GetBlob(key).ToJSON();
                }
                else
                {
                    datavalue = sameDoc.GetValue(key).ToString();
                }

                System.Console.WriteLine(" Data -- {0} = {1}", key, datavalue);
            }

            // System.Console.WriteLine(" reconstitutedBlob = {0}", reconstitutedBlob.GetDictionary("blobCOPY").ToJSON());



            //}

            /</strong>


                Exception = Missing Digest Due To Blob Is Not Saved To Database yet.

                Data -- id = 1002
                Data -- type = hotel
                Data -- name = Hotel Ned
                Data -- city = Balmain
                Data -- country = Australia
                Data -- description = Undefined description for Hotel Ned
                Data -- features = features are: , Cable TV, Toaster, Microwave
                Data -- avatar = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

                blobAsJSONstring = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

            <strong>/
        } /</strong> end of func <strong>/




  } // end of class



// p2p sync items


var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="12"></i><b>(12)</b>

thisConfig.Authenticator =
  new ListenerPasswordAuthenticator(
    (sender, username, password) =&gt;
      {
      return username.equals("valid.user")  &amp;&amp; (password == validPassword);
      }
  ); <i class="conum" data-value="13"></i><b>(13)</b>

_thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="14"></i><b>(14)</b>

_thisListener.Start(); <i class="conum" data-value="15"></i><b>(15)</b>




var theListenerEndpoint = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="16"></i><b>(16)</b>

var thisConfig = new ReplicatorConfiguration(thisDB, theListenerEndpoint); <i class="conum" data-value="17"></i><b>(17)</b>

thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="18"></i><b>(18)</b>

thisConfig.Authenticator =
  new BasicAuthenticator("valid.user", "valid.password.string"); <i class="conum" data-value="19"></i><b>(19)</b>

var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="20"></i><b>(20)</b>

thisReplicator.Start(); <i class="conum" data-value="21"></i><b>(21)</b>








// PASSIVE PEER STUFF
// Stuff I adapted
//
//
// p2pSync-websockets.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;
namespace api_walkthrough
{
  class Program
  {
  private static Database _Database;
  private static Replicator _Replicator;
  private static ListenerToken _thisListenerToken;
  private static bool _NeedsExtraDocs;

  #region Private Methods
  private static void GettingStarted()
  {

    // Initialize the listener config
    var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="22"></i><b>(22)</b>

    thisConfig.Port = 55990; <i class="conum" data-value="23"></i><b>(23)</b>

    thisConfig.NetworkInterface = "10.1.1.10"; <i class="conum" data-value="24"></i><b>(24)</b>

    thisConfig.EnableDeltaSync = true; <i class="conum" data-value="25"></i><b>(25)</b>

    thisConfig.DisableTLS = false; <i class="conum" data-value="26"></i><b>(26)</b>

    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="27"></i><b>(27)</b>

    // Configure the client authenticator
    // Here we are using Basic Authentication) <i class="conum" data-value="28"></i><b>(28)</b>
    SecureString validPassword =  new SecureString(); /</strong> example only <strong>/
    // Get SecureString input for validPassword
    var validUser = "valid.username";
    thisConfig.Authenticator = new ListenerPasswordAuthenticator(
      (sender, validUser, validPassword) =&gt;
        {
          return username.equals(validUser)  &amp;&amp; password == validPassword);
        }
      );

    // Initialize the listener
    _thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="29"></i><b>(29)</b>

    // Start the listener
    thisListener.Start(); <i class="conum" data-value="30"></i><b>(30)</b>

  }

  thisConfig.disableTLS = true;


  // Use “anonymous” cert. These are self signed certs created by the system
  thisConfig.TlsIdentity = null;


  thisConfig.EnableDeltaSync = true;


  int connectionCount = thisListener.Status.ConnectionCount; <i class="conum" data-value="31"></i><b>(31)</b>
  int activeConnectionCount = thisListener.Status.ActiveConnectionCount;  <i class="conum" data-value="32"></i><b>(32)</b>



  thisListener.Stop();


// Additional snippets


foreach(NetworkInterface ni in NetworkInterface.GetAllNetworkInterfaces())
{
  if(ni.NetworkInterfaceType == NetworkInterfaceType.Wireless80211 ||
      ni.NetworkInterfaceType == NetworkInterfaceType.Ethernet)
  {
    // do something with the interface(s)
  }
}



var thisConfig = new URLEndpointListenerConfiguration(thisDB);
_thisListener = new URLEndpointListener(thisConfig);

_thisListener.Start();

 Console.WriteLine("URLS are {0} ", thisListener.Urls;


    thisConfig.DisableTLS = true; <i class="conum" data-value="33"></i><b>(33)</b>


    // . . . preceding application logic . . .
    // Get the database (and create it if it doesn't exist)
    var thisDB = new Database("mydb");


    // Use CA Cert
    // Create a TLSIdentity from an imported key-pair
    // . . . previously declared variables include ...
    TLSIdentity thisIdentity;
    X509Store _store =
      new X509Store(StoreName.My); // create and label x509 store

    // Get keys and certificates from PKCS12 data
    byte[] thisIdData =
      File.ReadAllBytes("c:client.p12"); <i class="conum" data-value="34"></i><b>(34)</b>
    // . . . other user code . . .

    thisIdentity = TLSIdentity.ImportIdentity(
      _store,
      thisIdData, <i class="conum" data-value="35"></i><b>(35)</b>
      "123", // Password to access certificate data
      "couchbase-demo-cert",
      null); // Label to get cert in certificate map
        // NOTE: If a null label is supplied then the same
        // default directory for a Couchbase Lite database
        // is used for map.


    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="36"></i><b>(36)</b>

    // Set the TLS Identity
    thisConfig.TlsIdentity = thisIdentity; <i class="conum" data-value="37"></i><b>(37)</b>


    // Configure the client authenticator
    // to validate using ROOT CA

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="38"></i><b>(38)</b>
    var clientData = File.ReadAllBytes("c:client.p12");
    var ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData); <i class="conum" data-value="39"></i><b>(39)</b>

    // Configure the authenticator to use the root certs
    var thisAuth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(thisRootCert));

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="40"></i><b>(40)</b>

    // Initialize the listener using the config
    _listener = new URLEndpointListener(thisConfig);

    // Configure the client authenticator
    // to validate using application logic

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="41"></i><b>(41)</b>
    clientData = File.ReadAllBytes("c:client.p12");
    ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData);

    // Configure the authenticator to pass the root certs
    // To a user supplied code block for authentication
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert) =&gt; {
          // . . . user supplied code block
          // . . . returns boolean value (true=authenticated)
        }); <i class="conum" data-value="42"></i><b>(42)</b>

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="43"></i><b>(43)</b>




// END Additional






// Listener Callouts


  &lt;.&gt; Initialize the listener instance using the configuration settings.
  &lt;.&gt; Start the listener, ready to accept connections and incoming data from active peers.



  &lt;.&gt; <code>connectionCount</code> -- the total number of connections served by the listener
  &lt;.&gt; <code>activeConnectionCount</code> -- the number of active (BUSY) connections currently being served by the listener
  //

  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; PKCS12 data containing private key, public key, and certificates
  &lt;.&gt; The key pair as stored in the byte array
  &lt;.&gt; The password required to access the certificate data
  &lt;.&gt; The key label assigned to the cert in certificate map and used for retrieval
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>


  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; When creating a certificate, the common name attribute is required to create a CSR. If the common name is not present in the certificate an exception is thrown.
  &lt;.&gt; If the expiration date is not specified, the expiration date of the certificate is 365 days after creation
  &lt;.&gt; The key label to get cert in certificate map
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>










  // cert is a pre-populated object of type:SecCertificate representing a certificate
  // Work in progress. Code snippet to be provided.



  // prev content of listener-config-client-auth-self-signed (for ios)
  thisConfig.authenticator = ListenerCertificateAuthenticator.init {
    (cert) -&gt; Bool in
    var cert:SecCertificate
    var certCommonName:CFString?
    let status=SecCertificateCopyCommonName(cert, &amp;certCommonName)
    if (self._allowlistedUsers.contains(["name": certCommonName! as String])) {
      return true
    }
    return false
  }
  // Work in progress. Code snippet to be provided.


public class URLEndpointListener {
    // Properties <i class="conum" data-value="1"></i><b>(1)</b>
    public let config: URLEndpointListenerConfiguration
    public let port UInt16?
    public let tlsIdentity: TLSIdentity?
    public let urls: Array&lt;URL&gt;?
    public let status: ConnectionStatus?
    // Constructors <i class="conum" data-value="2"></i><b>(2)</b>
    public init(config: URLEndpointListenerConfiguration)
    // Methods <i class="conum" data-value="3"></i><b>(3)</b>
    public func start() throws
    public func stop()
}


let config = URLEndpointListenerConfiguration.init(database: self.oDB)
thisConfig.port = tls ? wssPort : wsPort
thisConfig.disableTLS = !tls
thisConfig.authenticator = auth
self.listener = URLEndpointListener.init(config: config) <i class="conum" data-value="1"></i><b>(1)</b>


// ACTIVE PEER STUFF
// Replication code
//
// Copyright (c) 2019 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

public class Examples {
  private static final String TAG = "EXAMPLE ACTIVE PEER";
  private static final String thisDBNAME = "local-database";
  private final Context context;
  // private Database database;
  // private Replicator replicator;

  public Examples(Context context) { this.context = context; }

  String user = "syncuser";
  String password = "sync9455";
  SecCertificate cert=null;
  String passivePeerEndpoint = "10.1.1.12:8920";
  String passivePeerPort = "8920";
  String passiveDbName = "userdb";
  Database thisDB;
  Replicator thisReplicator;
  ListenerToken replicatorListener;

  //@Test
  public void testActPeerSync() throws CouchbaseLiteException, URISyntaxException {
    // . . . preceding code. for example . . .
    private static ListenerToken _thisListenerToken;
    var Database thisDB;
    // . . . other code . . .
    // initialize the replicator configuration

    var thisUrl = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="44"></i><b>(44)</b>
    var config = new ReplicatorConfiguration(thisDB, thisUrl);


    // Set replicator type
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

    // Set autopurge option
    // here we override its default
    thisConfig.EnableAutoPurge = false; <i class="conum" data-value="45"></i><b>(45)</b>

    // Configure Sync Mode
    thisConfig.Continuous = true; // default value

    // Configure Server Security -- only accept self-signed certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="46"></i><b>(46)</b>

    // Configure Client Security <i class="conum" data-value="47"></i><b>(47)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");

    /</strong> Optionally set a conflict resolver call back <strong>/ <i class="conum" data-value="48"></i><b>(48)</b>
    // Use built-in resolver
    thisConfig.ConflictResolver = new LocalWinConflictResolver();  //

    // optionally use custom resolver
    thisConfig.ConflictResolver = new ConflictResolver(
      (conflict) =&gt; {
        /</strong> define resolver function */
      }
    ); //

    // Initialize and start a replicator
    // Initialize replicator with configuration data
    var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="49"></i><b>(49)</b>

    //Optionally add a change listener <i class="conum" data-value="50"></i><b>(50)</b>
    _thisListenerToken =
      thisReplicator.AddChangeListenersender, args) =&gt;         {           if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {               Console.WriteLine("Replication stopped");           }         });      // Start replicator     thisReplicator.Start(); <i class="conum" data-value="51"></i><b>(51)</b>  }  // Additional snippets      // Configure Server Security -- only accept CA certs     thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="52"></i><b>(52)</b>       // Return the remote pinned cert (the listener's cert)     byte returnedCert = new byte(thisConfig.getPinnedCertificate(; // Get listener cert if pinned
    // Configure Client Security <i class="conum" data-value="53"></i><b>(53)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");


    // Only CA Certs accepted
    thisConfig.AcceptOnlySelfSignedServerCertificate =
      false; <i class="conum" data-value="54"></i><b>(54)</b>

    var thisCert =
      new X509Certificate2(caData); <i class="conum" data-value="55"></i><b>(55)</b>

    thisConfig.PinnedServerCertificate =
      thisCert; <i class="conum" data-value="56"></i><b>(56)</b>













    // Code to refactor
    Log.i(TAG, "The Replicator is currently " + thisReplicator.Status().getActivityLevel());

    Log.i(TAG, "The Replicator has processed " + t);

    if (thisReplicator.Status().getActivityLevel() == Replicator.ActivityLevel.BUSY) {
          Log.i(TAG, "Replication Processing");
          Log.i(TAG, "It has completed " + thisReplicator.Status().getProgess().getTotal() + " changes");
      }
    _thisReplicator.Stop();
    while (_thisReplicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
        // Database cannot close until replicators are stopped
        Console.WriteLine($"Waiting for replicator to stop (currently {_thisReplicator.Status.Activity})...");
        Thread.Sleep(200);
    }
    _thisDatabase.Close();

      // Stop replication.
      thisReplicator.Stop(); <i class="conum" data-value="57"></i><b>(57)</b>


  }

{
  CouchbaseLite.init(context);
  Database thisDB = new Database("passivepeerdb");  <i class="conum" data-value="58"></i><b>(58)</b>
  // Initialize the listener config
  final URLEndpointListenerConfiguration thisConfig = new URLEndpointListenerConfiguration(database);
  thisConfig.Port(55990)             // &lt;.&gt; Default- port is selected
  thisConfig.DisableTls(false)       // &lt;.&gt; Optional. Defaults to false. You get TLS encryption out-of-box
  thisConfig.EnableDeltaSync(true)   // &lt;.&gt; Optional. Defaults to false.

  // Configure the client authenticator (if using basic auth)
  ListenerPasswordAuthenticator auth = new ListenerPasswordAuthenticator { "Our Username", "Our Password"}; <i class="conum" data-value="59"></i><b>(59)</b>
  thisConfig.Authenticator(auth); <i class="conum" data-value="60"></i><b>(60)</b>

  // Initialize the listener
  final URLEndpointListener listener = new URLEndpointListener( thisConfig ); <i class="conum" data-value="61"></i><b>(61)</b>

  // Start the listener
  listener.Start(); <i class="conum" data-value="62"></i><b>(62)</b>
    }



Map&lt;String, String&gt; X509_ATTRIBUTES = mapOf(
           TLSIdentity.CERT_ATTRIBUTE_COMMON_NAME to "Couchbase Demo",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION to "Couchbase",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION_UNIT to "Mobile",
           TLSIdentity.CERT_ATTRIBUTE_EMAIL_ADDRESS to "<a href="mailto:noreply@couchbase.com">noreply@couchbase.com</a>"
       )

TLSIdentity thisIdentity = new TLSIdentity.createIdentity(true, X509_ATTRIBUTES, null, "test-alias");



. . . work in progress - GetHashCode snippet to be provided

TLSIdentity.DeleteIdentity(_store, "alias-to-delete", null);


// OPTIONALLY:: Retrieve a stored TLS identity using its alias/label

TLSIdentity thisIdentity = new TLSIdentity.getIdentity("CBL-Demo-Server-Cert")


    // Configure the client authenticator (if using Basic Authentication)
    // String validUser = new String("validUsername"); // an example username
    // String validPassword = new String("validPasswordValue"); // an example password

    // ListenerPasswordAuthenticator thisAuth = new ListenerPasswordAuthenticator( <i class="conum" data-value="63"></i><b>(63)</b>
    //   validUser, validPassword -&gt; validUser == "validUsername" &amp;&amp; validPassword == "validPasswordValue" );

    // if (thisAuth) {
    //   thisConfig.Authenticator(auth);
    // }
    // else {
    //   // . . . authentication failed take appropriate exception action
    //   return
    // };




    ListenerToken thisListener = new thisReplicator.addChangeListener(change -&gt; { <i class="conum" data-value="64"></i><b>(64)</b>
      if (change.Status().getError() != null) {
        Log.i(TAG, "Error code ::  " + change.Status().getError().getCode());
      }
    });




// g u b b i n s


    // Configure TLS Cert CA auth using key-stored cert id alias 'doc-sync-server'

    // TLSIdentity thisIdentity = new TLSIdentity.getIdentity("doc-sync-server"); // Get existing TLS ID from sec storage

    // ClientCertificateAuthenticator thisAuth = new ClientCertificateAuthenticator(thisIdentity);

    // thisConfig.Authenticator(thisAuth);



    // USE KEYCHAIN IDENTITY IF EXISTS
    // Check if Id exists in keychain. If so use that Id

    // STILL NEED TO REFACTOR

    do {
      if let thisIdentity = try TLSIdentity.identity(withLabel: "doco-sync-server") {
          print("An identity with label : doco-sync-server already exists in keychain")
          return thisIdentity
          }
    } catch
    {return nil}
    thisAuthenticator.ClientCertificateAuthenticator(identity: thisIdentity )
    thisConfig.thisAuthenticator




String thisAlias = "alias-to-delete";
KeyStore thisKeystore = KeyStore.getInstance("PKCS12"); <i class="conum" data-value="65"></i><b>(65)</b>
thisKeyStore.load= null;
if (thisAlias != null) {
   thisKeystore.deleteEntry(thisAlias);  <i class="conum" data-value="66"></i><b>(66)</b>
}



// cert auth
let rootCertData = SecCertificateCopyData(cert) as Data
let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])

SecCertificate thisCert = new SecCertificate(); // populated as nec.

Data rootCertData = new Data(SecCertificateCopyData(thisCert));

let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])
// cert auth


// C A L L O U T S

&lt;.&gt; Configure to accept only CA certs
&lt;.&gt; Configure the pinned certificate using data from the byte array <code>cert</code>
&lt;.&gt; Set the certificate to be compared with that provided by the server

&lt;.&gt; PKCS12 data containing private key, public key, and certificates
&lt;.&gt; This is the default value and means that TLS is enabled

&lt;.&gt; Refuse self-signed certificates
&lt;.&gt; Get the identity
&lt;.&gt; Set the Client Certificate Authenticator to require signed certificates with this identity



    // Configure the client authenticator
    // to validate using ROOT CA <i class="conum" data-value="67"></i><b>(67)</b>
    byte[] thisCaData; // byte array for CA data
    using (var thisReader = new BinaryReader(stream)) {
      thisCaData = thisReader.ReadBytes(int stream.Length);
    }; // Get cert data

    var thisRootCert = new X509Certificate(thisCaData); //

    thisConfig.Authenticator = new  ListenerCertificateAuthenticator(
      new X509Certificate2Collection(thisRootCert)
    );




    var db = new Database("other-database");
    _Database = db;
    X509Store _store = new X509Store(StoreName.My);
    TLSIdentity thisIdentity;


    // Configure the expected server-supplied
    // credentials -- only accept CA Certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="68"></i><b>(68)</b>

    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="69"></i><b>(69)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="70"></i><b>(70)</b>






    byte[] thisCaData, thisClientData;
    thisClientData = File.ReadAllBytes("C:\\client.p12"); <i class="conum" data-value="71"></i><b>(71)</b>
    thisCaData = File.ReadAllBytes("C:\\client-ca.der");

    // Root certs
    var thisRootCert = new X509Certificate2(thisCaData);
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert));

    // Create URL Endpoint Listener
    var thisConfig = new URLEndpointListenerConfiguration(_Database);
    thisConfig.DisableTLS = false; <i class="conum" data-value="72"></i><b>(72)</b>
    thisConfig.Authenticator = thisAuth;
    _listener = new URLEndpointListener(thisConfig);
    _listener.Start();

    // Client identity
    thisIdentity = TLSIdentity.ImportIdentity(_store,
        thisClientData,
        "123",
        "CBL-Client-Cert",
        null);

    // Replicator -- Client
    var database = new Database("client-database");
    var builder = new UriBuilder(
        "wss",
        "localhost",
        _listener.Port,
        $"/{_listener.thisConfig.Database.Name}"
    );

    var url = builder.Uri;
    var target = new URLEndpoint(url);
    var thisConfig = new ReplicatorConfiguration(database, target);
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;
    thisConfig.Continuous = false;
    thisConfig.Authenticator = new ClientCertificateAuthenticator(thisIdentity);
    thisConfig.AcceptOnlySelfSignedServerCertificate = true;
    thisConfig.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
    using (var replicator = new Replicator(thisConfig)) {
        replicator.Start();
    }





    // Stop listener after replicator is stopped
    _listener.Stop();



    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="73"></i><b>(73)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="74"></i><b>(74)</b>



  // For replications

  // BEGIN -- snippets --
  //    Purpose -- code samples for use in replication topic

  public class MyClass
  {
      public Database Database { get; set; }
      public Replicator Replicator { get; set; } <i class="conum" data-value="75"></i><b>(75)</b>

      public void StartReplication()
      {
  }

          var url = new Uri("wss://localhost:4984/db"); <i class="conum" data-value="76"></i><b>(76)</b>
          var target = new URLEndpoint(url);
          var config = new ReplicatorConfiguration(Database, target)
          {
              ReplicatorType = ReplicatorType.Pull
          };

          Replicator = new Replicator(config);
          Replicator.Start();
      }

      // &lt;.&gt; A replication is an asynchronous operation.
      // To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
      // &lt;.&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
      // You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.

      public void InitReplication()
      {
        // initialize the replicator configuration

        var thisUrl = new URLEndpoint("wss://l10.0.2.2:4984/anotherDB"); <i class="conum" data-value="77"></i><b>(77)</b>
        var config = new ReplicatorConfiguration(thisDB, thisUrl);

      }
  }
 }



  public class supporting_datatypes
  {
      public void datatype_dictionary()
      {
          var database = new Database(name: "mydb");

          // NOTE: No error handling, for brevity (see getting started)
          var document = database.GetDocument("doc1");

          // Getting a dictionary from the document's properties
          var dict = document.GetDictionary("address");

          // Access a value with a key from the dictionary
          var street = dict.GetString("street");

          // Iterate dictionary
          foreach (var key in dict.Keys)
          {
              Console.WriteLine($"Key {key} = {dict.GetValue(key)}");
          }

          // Create a mutable copy
          var mutDict = dict.ToMutable();
      }

      public void datatype_mutable_dictionary()
      {

          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable dictionary and populate some keys/values
          var mutable_dict = new MutableDictionaryObject();
          mutable_dict.SetString("street", "1 Main st.");
          mutable_dict.SetString("city", "San Francisco");

          // Add the dictionary to a document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetDictionary("address", mutable_dict);
          database.Save(doc);

      }


      public void datatype_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          var document = database.GetDocument("doc1");

          // Getting a phones array from the document's properties
          var array = document.GetArray("phones");

          // Get element count
          var count = array.Count();

          // Access an array element by index
          if (count &gt;= 0) { var phone = array[1]; }

          // Iterate dictionary
          for (int i = 0; i &lt; count; i++)
          {
              Console.WriteLine($"Item {i.ToString()} = {array[i]}");
          }

          // Create a mutable copy
          var mutable_array = array.ToMutable();


      }

        public void datatype_mutable_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable array and populate data into the array
          var mutable_array = new MutableArrayObject();
          mutable_array.AddString("650-000-0000");
          mutable_array.AddString("650-000-0001");

          // Set the array to document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetArray("phones", mutable_array);
          database.Save(doc);
      }

  } // end  class supporting_datatypes</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and populate a mutable dictionary <code>address</code></p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">//
// Program.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;

namespace api_walkthrough
{
    class Program
    {
        private static Database _Database;
        private static Replicator _Replicator;
        private static URLEndpointListener _listener;
        private static ListenerToken _ListenerToken;
        private static bool _NeedsExtraDocs;

        <mark>region Private Methods

        private static void GettingStarted()
        {

            // using System;
            // using Couchbase.Lite;
            // using Couchbase.Lite.Query;
            // using Couchbase.Lite.Sync;

            // Get the database (and create it if it doesn't exist)
            var database = new Database("mydb");
            // Create a new document (i.e. a record) in the database
            string id = null;
            using (var mutableDoc = new MutableDocument())
            {
                mutableDoc.SetFloat("version", 2.0f)
                    .SetString("type", "SDK");

                // Save it to the database
                database.Save(mutableDoc);
                id = mutableDoc.Id;
            }

            // Update a document
            using (var doc = database.GetDocument(id))
            using (var mutableDoc = doc.ToMutable())
            {
                mutableDoc.SetString("language", "C</mark>");
                database.Save(mutableDoc);

                using (var docAgain = database.GetDocument(id))
                {
                    Console.WriteLine($"Document ID :: {docAgain.Id}");
                    Console.WriteLine($"Learning {docAgain.GetString("language")}");
                }
            }

            // Create a query to fetch documents of type SDK
            // i.e. SELECT * FROM database WHERE type = "SDK"
            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(database))
                .Where(Expression.Property("type").EqualTo(Expression.String("SDK"))))
            {
                // Run the query
                var result = query.Execute();
                Console.WriteLine($"Number of rows :: {result.AllResults().Count}");
            }

            // Create replicator to push and pull changes to and from the cloud
            var targetEndpoint = new URLEndpoint(new Uri("ws://localhost:4984/getting-started-db"));
            var replConfig = new ReplicatorConfiguration(database, targetEndpoint);

            // Add authentication
            replConfig.Authenticator = new BasicAuthenticator("john", "pass");

            // Create replicator (make sure to add an instance or static variable
            // named _Replicator)
            var _Replicator = new Replicator(replConfig);
            _Replicator.AddChangeListenersender, args) =&gt;             {                 if (args.Status.Error != null)                 {                     Console.WriteLine($"Error :: {args.Status.Error}");                 }             });              _Replicator.Start();              // Later, stop and dispose the replicator <strong>before</strong> closing/disposing the         }            private static void TestReplicatorConflictResolver()         {             var target = new URLEndpoint(new Uri("ws://localhost:4984/mydatabase";
            var replConfig = new ReplicatorConfiguration(database, target);
            replConfig.ConflictResolver = new LocalWinConflictResolver();

            var replicator = new Replicator(replConfig);
            replicator.Start();
        }

        private static void TestSaveWithConflictHandler()
        {
            using (var document = database.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                database.Save(mutableDocument, (updated, current) =&gt;
                {
                    var currentDict = current.ToDictionary();
                    var newDict = updated.ToDictionary();
                    var result = newDict.Concat(currentDict)
                        .GroupBy(kv =&gt; kv.Key)
                        .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
                    updated.SetData(result);
                    return true;
                });
            }
        }

        private static bool IsValidCredential(string name, SecureString password) { return true;  } // helper
        private static void TestInitListener()
        {
            var db = new Database("other-database");
            _Database = db;

            var config = new URLEndpointListenerConfiguration(_Database);
            config.TlsIdentity = null; // Use with anonymous self-signed cert
            config.Authenticator = new ListenerPasswordAuthenticatorsender, username, password) =&gt;             {                 if(IsValidCredential(username, password {
                    return true;
                }

                return false;
            });

            _listener = new URLEndpointListener(config);
        }

        private static void TestListenerStart()
        {
            // CouchbaseLiteException will be thrown when the listener cannot be started. The most common error
            // would be that the configured port has already been used.
            _listener.Start();
        }

        private static void TestListenerStop()
        {
            _listener.Stop();
        }

        private static void TestCreateSelfSignedCert()
        {
            TLSIdentity identity;
            X509Store _store =
             new X509Store(StoreName.My);
              // The identity will be stored in the secure
              // storage using the given label.
            DateTimeOffset fiveMinToExpireCert = DateTimeOffset.UtcNow.AddMinutes(5);

            identity = TLSIdentity.CreateIdentity(true, /* isServer <strong>/
                new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "Couchbase Inc" } },
                    // The common name attribute is required
                    // when creating a CSR. If it is not presented
                    // in the cert, an exception is thrown.
                fiveMinToExpireCert,
                    // If the expiration date is not specified,
                    // the certs expiration will be 365 days
                _store,
                "CBL-Server-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.

        }

        private static void TestImportTLSIdentity()
        {
            TLSIdentity identity;
            X509Store _store = new X509Store(StoreName.My); // The identity will be stored in the secure storage using the given label
            byte[] data = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates

            identity = TLSIdentity.ImportIdentity(_store,
                data,
                "123", // The password that is needed to access the certificate data
                "CBL-Client-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.
        }

          private static void TestClientCertAuthenticatorRootCerts()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;

            byte[] caData, clientData;
            clientData = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates
            caData = File.ReadAllBytes("C:\\client-ca.der");

            // Root certs
            var rootCert = new X509Certificate2(caData);
            var auth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(rootCert));

            // Create URL Endpoint Listener
            var listenerConfig = new URLEndpointListenerConfiguration(_Database);
            listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.
            listenerConfig.Authenticator = auth;
            _listener = new URLEndpointListener(listenerConfig);
            _listener.Start();

            // Client identity
            identity = TLSIdentity.ImportIdentity(_store,
                clientData,
                "123",
                "CBL-Client-Cert",
                null);

            // Replicator -- Client
            var database = new Database("client-database");
            var builder = new UriBuilder(
                "wss",
                "localhost",
                _listener.Port,
                $"/{_listener.Config.Database.Name}"
            );

            var url = builder.Uri;
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.ReplicatorType = ReplicatorType.PushAndPull;
            config.Continuous = false;
            config.Authenticator = new ClientCertificateAuthenticator(identity);
            config.AcceptOnlySelfSignedServerCertificate = true;
            config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
            using (var replicator = new Replicator(config)) {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
            // end::client-cert-authenticator-root-cert
        }

        private static void TestClientCertAuthenticator()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;


            // Create Listener Certificate Authenticator
            var auth = new ListenerCertificateAuthenticatorsender, cert) =&gt;             {                 if (cert.Count != 1) {                     return false;                 }                  return cert[0].SubjectName.Name?.Replace("CN=", "") == "couchbase";             });              // Create URL Endpoint Listener             var listenerConfig = new URLEndpointListenerConfiguration(_Database);             listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.             listenerConfig.Authenticator = auth;             _listener = new URLEndpointListener(listenerConfig);             _listener.Start();              // User Identity             identity = TLSIdentity.CreateIdentity(false,                 new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "couchbase" } },                 null,                 _store,                 ClientCertLabel,                 null);              // Replicator -- Client             var database = new Database("client-database");             var builder = new UriBuilder(                 "wss",                 "localhost",                 _listener.Port,                 $"/{_listener.Config.Database.Name}"             );              var url = builder.Uri;             var target = new URLEndpoint(url);             var config = new ReplicatorConfiguration(database, target);             config.ReplicatorType = ReplicatorType.PushAndPull;             config.Continuous = false;             config.Authenticator = new ClientCertificateAuthenticator(identity);             config.AcceptOnlySelfSignedServerCertificate = false;             config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];             using (var replicator = new Replicator(config {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
        }

        private static void UseEncryption()
        {
            // Enterprise edition only

            // Create a new, or open an existing database with encryption enabled
            var config = new DatabaseConfiguration
            {
                // Or, derive a key yourself and pass a byte array of the proper size
                EncryptionKey = new EncryptionKey("password")
            };

            using (var db = new Database("seekrit", config)) {
                // Change the encryption key (or add encryption if the DB is unencrypted)
                db.ChangeEncryptionKey(new EncryptionKey("betterpassw0rd"));

                // Remove encryption
                db.ChangeEncryptionKey(null);
            }
        }

        private static void ResetReplicatorCheckpoint()
        {
            var database = _Database;
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            using (var replicator = new Replicator(config)) {
              // replicator is a Replicator instance
              if (resetCheckpointRequired_Example) {
                  replicator.Start(true); <i class="conum" data-value="1"></i><b>(1)</b>
              else
                replicator.Start(false);
              }




            }
        }

        private static void Read1xAttachment()
        {
            var db = _Database;
            using (var document = new MutableDocument()) {
                var attachments = document.GetDictionary("_attachments");
                var avatar = attachments.GetBlob("avatar");
                var content = avatar?.Content;
            }
        }

        private static void CreateNewDatabase()
        {
            var db = new Database("my-database");

            _Database = db;
        }

        private static void CloseDatabase()
        {
          database.close()

        }

        private static void ChangeLogging()
        {
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Query, LogLevel.Verbose);
        }

        private static void LoadPrebuilt()
        {
            // Note: Getting the path to a database is platform-specific.  For .NET Core / .NET Framework this
            // can be a simple filesystem path.  For UWP, you will need to get the path from your assets.  For
            // iOS you need to get the path from the main bundle.  For Android you need to extract it from your
            // assets to a temporary directory and then pass that path.
            var path = Path.Combine(Environment.CurrentDirectory, "travel-sample.cblite2" + Path.DirectorySeparatorChar);
            if (!Database.Exists("travel-sample", null)) {
                _NeedsExtraDocs = true;
                Database.Copy(path, "travel-sample", null);
            }

            _Database.Close();
            _Database = new Database("travel-sample");
        }

        private static void QueryDeletedDocuments()
        {
            // Query documents that have been deleted
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.IsDeleted);
        }

        private static void CreateDocument()
        {
            var db = _Database;
            using (var newTask = new MutableDocument("xyz")) {
                newTask.SetString("type", "task")
                    .SetString("owner", "todo")
                    .SetDate("createdAt", DateTimeOffset.UtcNow);

                db.Save(newTask);
            }
        }

        private static void UpdateDocument()
        {
            var db = _Database;
            using(var document = db.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                db.Save(mutableDocument);
            }
        }

        private static void UseTypedAccessors()
        {
            using (var newTask = new MutableDocument()) {
                newTask.SetValue("createdAt", DateTimeOffset.UtcNow);
                var date = newTask.GetDate("createdAt");

                Console.WriteLine(date);
            }
        }

        private static void DoBatchOperation()
        {
            var db = _Database;
            db.InBatch) =&gt;             {                 for (var i = 0; i &lt; 10; i) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "user");
                        doc.SetString("name", $"user {i}");
                        doc.SetBoolean("admin", false);
                        db.Save(doc);
                        Console.WriteLine($"Saved user document {doc.GetString("name")}");
                    }
                }
            });
        }

        private static void DatabaseChangeListener()
        {
            var db = _Database;

            db.AddDocumentChangeListener("user.john", (sender, args) =&gt;
            {
                using (var doc = Db.GetDocument(args.DocumentID)) {
                    Console.WriteLine($"Status :: {doc.GetString("verified_account")}");
                }
            });
        }

        private static void DocumentExpiration()
        {
            var db = _Database;

            // Purge the document one day from now
            var ttl = DateTimeOffset.UtcNow.AddDays(1);
            db.SetDocumentExpiration("doc123", ttl);

            // Reset expiration
            db.SetDocumentExpiration("doc1", null);

            // Query documents that will be expired in less than five minutes
            var fiveMinutesFromNow = DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeMilliseconds();
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.Expiration.LessThan(Expression.Double(fiveMinutesFromNow)));
        }

        private static void UseBlob()
        {
            var db = _Database;
            using (var newTask = new MutableDocument()) {
                // Note: Reading the data is implementation dependent, as with prebuilt databases
                var image = File.ReadAllBytes("avatar.jpg"); // &lt;.&gt;
                var blob = new Blob("image/jpeg", image); // &lt;.&gt;
                 newTask.SetBlob("avatar", blob); // &lt;.&gt;
                db.Save(newTask);

                var taskBlob = newTask.GetBlob("avatar");
                using (var bitmap = SKBitmap.Decode(taskBlob.ContentStream)) {
                    Console.WriteLine($"Bitmap dimensions: {bitmap.Width} x {bitmap.Height} ({bitmap.BytesPerPixel} bytes per pixel)");
                }
            }
        }

        public void CreateIndex()
        {
            var db = _database;
            string[] indexProperties = new string[] {"type", "name" };
            var config = new ValueIndexConfiguration(indexProperties);
            db.CreateIndex("TypeNameIndex", config);
        }

        public void CreateIndex_Querybuilder()
        {
            // For value types, this is optional but provides performance enhancements
            var db = _database;
            var index = IndexBuilder.ValueIndex(
                ValueIndexItem.Expression(Expression.Property("type")),
                ValueIndexItem.Expression(Expression.Property("name"))); // &lt;.&gt;
            db.CreateIndex("TypeNameIndex", index);
        }
        private static void SelectMeta()
        {
            Console.WriteLine("Select Meta");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("type"),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document ID :: {result.GetString("id")}");
                    Console.WriteLine($"Document Name :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectAll()
        {
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))) {
                // All user properties will be available here
            }

            var query = QueryBuilder
                .Select(SelectResult.All())
                .From(DataSource.Database(db)); // &lt;.&gt;

            // Adds a query change listener.
            // Changes will be posted on the main queue.
            var token = query.AddChangeListener((sender, args) =&gt; // &lt;.&gt;
            {
                var allResult = args.Results.AllResults();
                foreach (var result in allResult) {
                    Console.WriteLine(result.Keys);
                    /* Update UI */
                }
            });


            query.RemoveChangeListener(token);
            query.Dispose();
        }

        private static void SelectWhere()
        {
            Console.WriteLine("Where");
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    var dict = result.GetDictionary(db.Name);
                    Console.WriteLine($"Document Name :: {dict?.GetString("name")}");
                }
            }
        }

        private static void UseCollectionContains()
        {
            Console.WriteLine("Collection Operator CONTAINS");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"),
                    SelectResult.Property("public_likes"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel"))
                    .And(ArrayFunction.Contains(Expression.Property("public_likes"),
                        Expression.String("Armani Langworth"))))) {
                foreach (var result in query.Execute()) {
                    var publicLikes = result.GetArray("public_likes");
                    var jsonString = JsonConvert.SerializeObject(publicLikes);
                    Console.WriteLine($"Public Likes :: {jsonString}");
                }
            }
        }

        private static void UseCollectionIn()
        {
            Console.WriteLine("Collection Operator IN");
            var db = _Database;

            var values = new IExpression[]
                { Expression.Property("first"), Expression.Property("last"), Expression.Property("username") };

            using (var query = QueryBuilder.Select(
                    SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.String("Armani").In(values))) {
                foreach (var result in query.Execute()) {
                    var body = result.GetDictionary(0);
                    var jsonString = JsonConvert.SerializeObject(body);
                    Console.WriteLine($"In results :: {jsonString}");
                }
            }
        }

        private static void SelectLike()
        {
            Console.WriteLine("Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Royal Engineers Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardLike()
        {
            Console.WriteLine("Wildcard Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Eng%e%"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardCharacterLike()
        {
            Console.WriteLine("Wildchard Characters");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Like(Expression.String("Royal Eng____rs Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectRegex()
        {
            Console.WriteLine("Regex");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Regex(Expression.String("\\bEng.*e\\b"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectJoin()
        {
            Console.WriteLine("Join");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Expression.Property("name").From("airline")),
                    SelectResult.Expression(Expression.Property("callsign").From("airline")),
                    SelectResult.Expression(Expression.Property("destinationairport").From("route")),
                    SelectResult.Expression(Expression.Property("stops").From("route")),
                    SelectResult.Expression(Expression.Property("airline").From("route")))
                .From(DataSource.Database(db).As("airline"))
                .Join(Join.InnerJoin(DataSource.Database(db).As("route"))
                    .On(Meta.ID.From("airline").EqualTo(Expression.Property("airlineid").From("route"))))
                .Where(Expression.Property("type").From("route").EqualTo(Expression.String("route"))
                    .And(Expression.Property("type").From("airline").EqualTo(Expression.String("airline")))
                    .And(Expression.Property("sourceairport").From("route").EqualTo(Expression.String("RIX"))))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void GroupBy()
        {
            Console.WriteLine("GroupBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Function.Count(Expression.All())),
                    SelectResult.Property("country"),
                    SelectResult.Property("tz"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("airport"))
                    .And(Expression.Property("geo.alt").GreaterThanOrEqualTo(Expression.Int(300))))
                .GroupBy(Expression.Property("country"), Expression.Property("tz"))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine(
                        $"There are {result.GetInt("$1")} airports in the {result.GetString("tz")} timezone located in {result.GetString("country")} and above 300 ft");
                }
            }
        }

        private static void OrderBy()
        {
            Console.WriteLine("OrderBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("title"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .OrderBy(Ordering.Property("title").Ascending())
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Title :: {result.GetString("title")}");
                }
            }
        }

      // ### EXPLAIN statement
      private static void TestExplainStatement()
      // For Documentation
      {
        var db = _Database;
        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
            .GroupBy(Expression.Property("country"))
            .OrderBy(Ordering.Property("title").Ascending()) // &lt;.&gt;

          Console.WriteLine(query.Explain()); // &lt;.&gt;

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("%hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;
  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Function.Lower(Expression.Property("type")).EqualTo(Expression.String("hotel"))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type")).EqualTo(Expression.String("hotel")); // &lt;.&gt;

          Console.WriteLine(query.Explain());

      }

      // end query-explain


        public void CreateFullTextIndex()
        {
            string[] indexProperties = new string[] { "overview", "name" };
            var config = new FullTextIndexConfiguration(indexProperties);
            db.CreateIndex("overviewFTSIndex", config);
        }

        public void FullTextSearch()
        {
            Console.WriteLine("Full text search");

            var db = _database;
            var ftsQuery = db.CreateQuery("SELECT * FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)");
            foreach (var result in ftsQuery.Execute())
            {
                Console.WriteLine($"Document id {result.GetString(0)}");
            }
            }
        }


        private static void CreateFullTextIndex_Querybuilder()
        {
            var db = _Database;

            if (_NeedsExtraDocs) {
                var tasks = new[] { "buy groceries", "play chess", "book travels", "buy museum tickets" };
                foreach (var task in tasks) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "task");
                        doc.SetString("name", task);
                        db.Save(doc);
                    }
                }
            }


            var index = IndexBuilder.FullTextIndex(FullTextIndexItem.Property("overview")).IgnoreAccents(false);
            db.CreateIndex("overviewFTSIndex", index);
        }

        private static void FullTextSearch_Querybuilder()
        {
            Console.WriteLine("Full text search");
            var db = _Database;

            var whereClause = FullTextFunction.Match("overviewFTSIndex", "'michigan'");

            using (var query = QueryBuilder.Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(whereClause)) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document id {result.GetString(0)}");
                }
            }
        }
        private static void StartReplication()
        {
            var db = _Database;

            /*
             * This requires Sync Gateway running with the following config, or equivalent:
             *
             * {
             *     "log":["*"],
             *     "databases": {
             *         "db": {
             *             "server":"walrus:",
             *             "users": {
             *                 "GUEST": {"disabled": false, "admin_channels": ["*"] }
             *             }
             *         }
             *     }
             * }
             */

            // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(db, target)
            {
                ReplicatorType = ReplicatorType.Pull
            };

            var replicator = new Replicator(config);
            replicator.Start();

            _Replicator = replicator;
        }

        private static void VerboseReplicatorLogging()
        {
            // deprecated
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Network, LogLevel.Verbose);
        }

        private static void ConsoleLogging()
        {
            Database.Log.Console.Domains = LogDomain.All; // &lt;.&gt;
            Database.Log.Console.LogLevel = LogLevel.Verbose; // &lt;.&gt;


            Database.Log.Console.Domains = LogDomain.Database;

        }

        private static void FileLogging()
        {
            var tempFolder = Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;().DefaultDirectory(), "cbllog");
            var config = new LogFileConfiguration(tempFolder) // &lt;.&gt;
            {
                MaxRotateCount = 5, // &lt;.&gt;
                MaxSize = 10240, // &lt;.&gt;
                UsePlainText = false  // &lt;.&gt;
            };
            Database.Log.File.Config = config; // Apply configuration
            Database.Log.File.Level = LogLevel.Info; // &lt;.&gt;

        }

        private static void EnableCustomLogging()
        {
            Database.Log.Custom = new LogTestLogger(); // &lt;.&gt;
            or
            Database.Log.Custom = new LogTestLogger { Level = LogLevel.Warning };

        }

        private static void WriteConsoleLog()
        {
            Database.Log.Console.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }
        private static void WriteCustomLog()
        {
            Database.Log.Custom?.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }


        private static void WriteFileLog()
        {
            Database.Log.File.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }

        private static void EnableBasicAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new BasicAuthenticator("john", "pass");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void EnableSessionAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void SetupReplicatorListener()
        {
            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
                    Console.WriteLine("Replication stopped");
                }
            });
        }




    //  BEGIN PendingDocuments IB -- 11/Feb/21 --
    private static void ReplicatorPendingDocuments()
    {
        var url = new Uri("ws://localhost:4984/mydatabase");
        var target = new URLEndpoint(url);
        var database = new Database("myDB");
        var config = new ReplicatorConfiguration(database, target);
        config.ReplicatorType  = ReplicatorType.Push;

        var replicator = new Replicator(config);

        var mydocids =
          new HashSet &lt;string&gt; (replicator.GetPendingDocumentIDs()); // &lt;.&gt;


        if (mydocids.Count &gt; 0)
        {
            Console.WriteLine($"There are {mydocids.Count} documents pending");
            replicator.AddChangeListener((sender, change) =&gt;
            {
                Console.WriteLine($"Replicator activity level is " +
                                  change.Status.Activity.ToString());
                // iterate and report-on previously
                // retrieved pending docids 'list'
                foreach (var thisId in mydocids)
                    if (!replicator.IsDocumentPending(thisId)) // &lt;.&gt;
                    {
                        Console.WriteLine($"Doc ID {thisId} now pushed");
                    };
            });

            replicator.Start();
        }
    }


//  END PendingDocuments IB -- 11/Feb/21 --



		private static void ReplicatorDocumentEvent()
        {
            var replicator = _Replicator;

            var token = replicator.AddDocumentReplicationListener((sender, args) =&gt;
            {
                var direction = args.IsPush ? "Push" : "Pull";
                Console.WriteLine($"Replication type :: {direction}");
                foreach (var document in args.Documents) {
                    if (document.Error == null) {
                        Console.WriteLine($"Doc ID :: {document.Id}");
                        if (document.Flags.HasFlag(DocumentFlags.Deleted)) {
                            Console.WriteLine("Successfully replicated a deleted document");
                        }
                    } else {
                        // There was an error
                    }
                }
            });

            replicator.Start();

            replicator.RemoveChangeListener(token);
        }

        private static void SetupReplicatorErrorListener()
        {
            // This can be done in the SetupReplicatorListener method
            // But it is separate so that we can have two documentation entries

            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Error != null) {
                    Console.WriteLine($"Error :: {args.Status.Error}");
                }
            });
        }

        private static void DatabaseReplica()
        {
            var db = _Database;
            using (var database2 = new Database("backup")) {
                // EE feature: This code will not compile on the community edition
                var targetDatabase = new DatabaseEndpoint(database2);
                var config = new ReplicatorConfiguration(db, targetDatabase)
                {
                    ReplicatorType = ReplicatorType.Push
                };

                var replicator = new Replicator(config);
                replicator.Start();

                _Replicator?.Stop();
                _Replicator = replicator;
            }
        }

        private static void PinCertificate()
        {
            // Note: No certificate is included here, so this code is for show only
            var url = new Uri("wss://localhost:4984/db");
            var target = new URLEndpoint(url);
            var db = _Database;

            // Note: `GetCertificate` is a fake method. This would be the platform-specific method
            // to find and load the certificate as an instance of `X509Certificate2`.
            // For .NET Core / .NET Framework this can be loaded from the filesystem path.
            // For UWP, from the assets directory.
            // For iOS, from the main bundle.
            // For Android, from the assets directory.
            var certificate = GetCertificate("cert.cer");
            var config = new ReplicatorConfiguration(db, target)
            {
                PinnedServerCertificate = certificate
            };
        }

        private static void ReplicationCustomHeaders()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target)
            {
                Headers = new Dictionary&lt;string, string&gt;
                {
                    ["CustomHeaderName"] = "Value"
                }
            };
        }

        private static void PushWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PushFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (flags.HasFlag(DocumentFlags.Deleted)) {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void PullWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PullFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (document.GetString("type") == "draft") {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        public void TestCustomRetryConfig()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);

        //  other config as required . . .

            config.Heartbeat = TimeSpan.FromSeconds(120); //  &lt;.&gt;
            config.Maxattempts = 20; //  &lt;.&gt;
            config.MaxAttemptWaitTime = TimeSpan.FromSeconds(600); //  &lt;.&gt;

        //  other config as required . . .

            var repl = new Replicator(config);

        }


        private static void UsePredictiveModel()
        {
            using (var db = new Database("mydb")) {
                var model = new ImageClassifierModel();
                Database.Prediction.RegisterModel("ImageClassifier", model);

                var index = IndexBuilder.ValueIndex(ValueIndexItem.Property("label"));
                db.CreateIndex("value-index-image-classifier", index);

                Database.Prediction.UnregisterModel("ImageClassifier");
            }
        }

        private static void UsePredictiveIndex()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });

                var index = IndexBuilder.PredictiveIndex("ImageClassifier", input);
                db.CreateIndex("predictive-index-image-classifier", index);
            }
        }

        private static void DoPredictiveQuery()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });
                var prediction = PredictiveModel.predict("ImageClassifier", input); // &lt;1&gt;

                using (var q = QueryBuilder.Select(SelectResult.All())
                    .From(DataSource.Database(db))
                    .Where(prediction.Property("label").EqualTo(Expression.String("car"))
                        .And(prediction.Property("probability").GreaterThanOrEqualTo(Expression.Double(0.8))))) {
                    var result = q.Execute();
                    Console.WriteLine($"Number of rows: {result.Count()}");
                }
            }
        }

        static void Main(string[] args)
        {
            // This only needs to be done once for whatever platform the executable is running
            // (UWP, iOS, Android, or desktop)
            Couchbase.Lite.Support.NetDesktop.Activate();

            CreateNewDatabase();
            CreateDocument();
            UpdateDocument();
            UseTypedAccessors();
            DoBatchOperation();
            UseBlob();
            SelectMeta();

            LoadPrebuilt();
            CreateIndex();
            SelectWhere();
            UseCollectionContains();
            SelectLike();
            SelectWildcardLike();
            SelectWildcardCharacterLike();
            SelectRegex();
            SelectJoin();
            GroupBy();
            OrderBy();

            CreateFullTextIndex();
            FullTextSearch();
            StartReplication();
            SetupReplicatorListener();

            _Replicator.Stop();
            while (_Replicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
                // Database cannot close until replicators are stopped
                Console.WriteLine($"Waiting for replicator to stop (currently {_Replicator.Status.Activity})...");
                Thread.Sleep(200);
            }

            _Database.Close();
        }

        #endregion
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  ACTIVE SIDE  ----------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */

    class ActivePeer : IMessageEndpointDelegate
    {
        ActivePeer()
        {
            var id = "";

            var database = new Database("dbname");

            // The delegate must implement the `IMessageEndpointDelegate` protocol.
            var messageEndpointTarget = new MessageEndpoint(uid: "UID:123", target: "",
                protocolType: ProtocolType.MessageStream, delegateObject: this);

            var config = new ReplicatorConfiguration(database, messageEndpointTarget);

            // Create the replicator object
            var replicator = new Replicator(config);
            // Start the replicator
            replicator.Start();
        }

        /* implementation of MessageEndpointDelegate */
        public IMessageEndpointConnection CreateConnection(MessageEndpoint endpoint)
        {
            var connection = new ActivePeerConnection(); /* implements MessageEndpointConnection */
            return connection;
        }
    }

    class ActivePeerConnection : IMessageEndpointConnection
    {
        private IReplicatorConnection _replicatorConnection;

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public async Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // await socket.Open(), etc
            // throw MessagingException if something goes wrong
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  PASSIVE SIDE  ---------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */
    class PassivePeerConnection : IMessageEndpointConnection
    {
        private MessageEndpointListener _messageEndpointListener;
        private IReplicatorConnection _replicatorConnection;

        public void StartListener()
        {
            var database = new Database("mydb");
            var config = new MessageEndpointListenerConfiguration(database, ProtocolType.MessageStream);
            _messageEndpointListener = new MessageEndpointListener(config);
        }

        public void StopListener()
        {
            _messageEndpointListener?.CloseAll();
        }

        public void AcceptConnection()
        {
            var connection = new PassivePeerConnection(); /* implements MessageEndpointConnection */
            _messageEndpointListener?.Accept(connection);
        }

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // socket should already be open on the passive side
            return Task.FromResult(true);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    // tensorFlowModel is a fake implementation
    // this would be the implementation of the ml model you have chosen
    class TensorFlowModel
    {
        public static IDictionary&lt;string, object&gt; PredictImage(byte[] data)
        {
            // Do calculations, etc
            return null;
        }
    }

    class ImageClassifierModel : IPredictiveModel
    {
        public DictionaryObject Predict(DictionaryObject input)
        {
            var blob = input.GetBlob("photo");
            if (blob == null) {
                return null;
            }

            var imageData = blob.Content;
            // tensorFlowModel is a fake implementation
            // this would be the implementation of the ml model you have chosen
            var modelOutput = TensorFlowModel.PredictImage(imageData);
            return new MutableDictionaryObject(modelOutput); // &lt;1&gt;
        }
    }

    private class LogTestLogger : ILogger
    {
        public LogLevel Level { get; set; }

        public void Reset()
        {
            _lines.Clear();
        }

        public void Log(LogLevel level, LogDomain domain, string message)
        {
            // handle the message, for example piping it to
            // a third party framework
        }
    }

    class LocalWinConflictResolver : IConflictResolver
    {
        Document Resolve(Conflict conflict)
        {
            return conflict.LocalDocument;
        }
    }

    class RemoteWinConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            return conflict.RemoteDocument;
        }
    }

    class MergeConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            var localDict = conflict.LocalDocument.ToDictionary();
            var remoteDict = conflict.RemoteDocument.ToDictionary();
            var result = localDict.Concat(remoteDict)
               .GroupBy(kv =&gt; kv.Key)
               .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
            return new MutableDocument(conflict.DocumentID, result);
        }
    }
}

// N1QL QUERY

  public List&lt;Result&gt; docsonly_N1QLQueryString(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = \"hotel\""); // &lt;.&gt;

      return thisQuery.Execute().AllResults();

  }


  public  List&lt;Result&gt; docsonly_N1QLQueryStringParams(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      // Declared elsewhere: Database argDB

      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = $type"); // &lt;.&gt;

      var n1qlParams = new Parameters();
      n1qlParams.SetString("type", "hotel"); // &lt;.&gt;
      thisQuery.Parameters = n1qlParams;

      return thisQuery.Execute().AllResults();

  }


// QUERY RESULT SET HANDLING EXAMPLES

    public static void testQuerySyntaxAll()
    {
        // For Documentation
        var dbName = "travel-sample";

        string thisDocsId;
        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        Dictionary&lt;string,object&gt; hotel = new Dictionary&lt;string,object&gt;();

        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
              .Select(SelectResult.All())
              .From(DataSource.Database(this_Db));


        var results = query.Execute().AllResults();

        if (results?.Count &gt; 0)
        {
            List&lt;Dictionary&lt;string,object&gt;&gt; hotels = new List&lt;Dictionary&lt;string,object&gt;&gt;();
            foreach (var result in results)
            {
                // get the result into our dictionary object
                var thisDocsProps = result.GetDictionary(dbName); // &lt;.&gt;

                if (thisDocsProps != null)
                {
                    thisDocsId = thisDocsProps.GetString("id"); // &lt;.&gt;
                    thisDocsName = thisDocsProps.GetString("name");
                    thisDocsCity = thisDocsProps.GetString("city");
                    thisDocsType = thisDocsProps.GetString("type");
                    hotel = thisDocsProps.ToDictionary();
                    hotels.Add(hotel);
                }

            }
        }


    foreach (var result in query.Execute().AsEnumerable()) {

        // get the result into a JSON String
                var thisDocsJSONString = result.ToJSON();// &lt;.&gt;

        // Get a native dictionary object using the JSON string
        var dictFromJSONstring =
              JsonConvert.
                DeserializeObject&lt;Dictionary&lt;string, object&gt;&gt;
                  (thisDocsJSONString); // &lt;.&gt;

        // use the created dictionary
        if (dictFromJSONstring != null)
        {
            thisDocsId = dictFromJSONstring["id"].ToString();
            thisDocsName = dictFromJSONstring["name"].ToString();
            thisDocsCity = dictFromJSONstring["city"].ToString();
            thisDocsType = dictFromJSONstring["type"].ToString();
        }

        //Get a custom object using the JSON string
        Hotel this_hotel =
            JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocsJSONString); // &lt;.&gt;

        // Store this hotel object in a list of hotels
        hotels.Add(
            this_hotel.Id.ToString(),
                this_hotel);

    } // end foreach result
  }


    private static void testQuerySyntaxProps()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        var this_Db = new Database("hotels") ;

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();

        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var query = QueryBuilder.Select(
                SelectResult.Property("type"),
                SelectResult.Property("name"),
                SelectResult.Property("city")).From(DataSource.Database(this_Db));

        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            // get the returned array of k-v pairs into a dictionary
            hotel = result.ToDictionary();

            // add hotel dictionary to list of hotel dictionaries
            hotels.Add(hotel);

            // use the properties of the returned array of k-v pairs directly
            thisDocsType = result.GetString("type");
            thisDocsName = result.GetString("name");
            thisDocsCity = result.GetString("city");

        }

    } // test-query-access-props



    private static void testQuerySyntaxCount()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var this_Db = new Database("hotels") ;

        var query =
          QueryBuilder
            .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount")) // &lt;.&gt;
            .From(DataSource.Database(this_Db));




        var results = query.Execute().AllResults();

        foreach (var result in results)
        {

            var numberOfDocs = result.GetInt("mycount"); // &lt;.&gt;

        }

    }




    private static void ibQueryForID()
    {

        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();


        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID).As("this_ID"))
                .From(DataSource.Database(this_Db));



        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            var thisDocsID = result.GetString("this_ID"); // &lt;.&gt;
            var doc = this_Db.GetDocument(thisDocsID);
        }

    }


    private static void testQueryPagination()
    {
      // For Documentation
      var dbName = "travel-sample";
      // var this_Db = new Database(dbName);

      var this_Db = new Database("hotels") ;

      var thisLimit = 20;
      var thisOffset = 0;

      // get a count of the number of docs matching the query
      var countQuery =
          QueryBuilder
              .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount"))
              .From(DataSource.Database(this_Db));
      var numberOfDocs =
          countQuery.Execute().AllResults().ElementAt(0).GetInt("mycount");

      if (numberOfDocs &lt; thisLimit) {
          thisLimit = numberOfDocs;
      }

      while (thisOffset &lt; numberOfDocs)
      {
          var listQuery =
              QueryBuilder
                  .Select(SelectResult.All())
                  .From(DataSource.Database(this_Db))
                  .Limit(Expression.Int(thisLimit), Expression.Int(thisOffset)); // &lt;.&gt;

          foreach (var result in listQuery.Execute().AllResults())
          {
              // Display and or process query results batch

          }

          thisOffset = thisOffset + thisLimit;

      } // end while

    }

    // JSONAPIMETHODS



        public void JsonApiDocument()
        {

            Database this_DB = new Database("travel-sample");
            Database newDb = new Database("ournewdb");

            // Get a document
            var thisDoc = this_Db.GetDocument("hotel_10025");

            // Get document data as JSON String
            var thisDocAsJsonString = thisDoc?.ToJSON(); // &lt;.&gt;

            // Get Json Object from the Json String
            JObject myJsonObj = JObject.Parse(thisDocAsJsonString);

            // Get Native Object (anhotel) from JSON String
            List&lt;Hotel&gt; thehotels = new List&lt;Hotel&gt;();

            Hotel anhotel = new Hotel();
            anhotel = JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocAsJsonString);
            thehotels.Add(anhotel);

            // Update the retrieved native object
            anhotel.Name = "A Copy of " + anhotel.Name;
            anhotel.Id = "2001";

            // Convert the updated object back to a JSON string
            var newJsonString = JsonConvert.SerializeObject(anhotel);

            // Update new document with JSOn String
            MutableDocument newhotel =
                new MutableDocument(anhotel.Id, newJsonString); // &lt;.&gt;

            foreach (string key in newhotel.ToDictionary().Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}",
                    key, newhotel.GetValue(key));
            }

            newDb.Save(newhotel);

            var thatDoc = newDb.GetDocument("2001").ToJSON(); // &lt;.&gt;
            System.Console.Write(thatDoc);



        //    JSON String = { "description":"Very good and central","id":"1000","country":"France","name":"Hotel Ted","type":"hotel","city":"Paris"}
        //             type = hotel
        //             id = 1000
        //             country = France
        //             city = Paris
        //             description = Very good and central
        //             name = Hotel Ted
        //         */

        } // End JSONAPIDocument


    public void JsonApiArray()
        {
            // Init for docs
            //var this_Db = DataStore.getDbHandle();
            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }


            Database dbNew = new Database(ourdbname);

            // JSON String -- an Array (3 elements. including embedded arrays)
            var thisJSONstring = "[{'id':'1000','type':'hotel','name':'Hotel Ted','city':'Paris','country':'France','description':'Undefined description for Hotel Ted'},{'id':'1001','type':'hotel','name':'Hotel Fred','city':'London','country':'England','description':'Undefined description for Hotel Fred'},                        {'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}]".Replace("'", "\"");

            // Get JSON Array from JSON String
            JArray myJsonObj = JArray.Parse(thisJSONstring);

            // Create mutable array using JSON String Array
            var myArray = new MutableArrayObject();
            myArray.SetJSON(thisJSONstring);  // &lt;.&gt;


            // Create a new documenty for each array element
            for (int i = 0; i &lt; myArray.Count; i)             {                 var dict = myArray.GetDictionary(i);                 var docid = myArray[i].Dictionary.GetString("id");                 var newdoc = new MutableDocument(docid, dict.ToDictionary(; <i class="conum" data-value="2"></i><b>(2)</b>
                dbNew.Save(newdoc);
            }

            // Get one of the created docs and iterate through one of the embedded arrays
            var extendedDoc = dbNew.GetDocument("1002");
            var features = extendedDoc.GetArray("features");
            <i class="conum" data-value="3"></i><b>(3)</b>
            foreach (string feature in features) {
                System.Console.Write(feature);
                //process array item as required
            }
            var featuresJSON = extendedDoc.GetArray("features").ToJSON(); <i class="conum" data-value="4"></i><b>(4)</b>

        }


        public void JsonApiDictionary()
        {

            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }
            Database dbNew = new Database(ourdbname);


            // Get dictionary from JSONstring
            var aJSONstring = "{'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDict = new MutableDictionaryObject(json: aJSONstring); <i class="conum" data-value="5"></i><b>(5)</b>

            // use dictionary to get name value
            var name = myDict.GetString("name");


            // Iterate through keys
            foreach (string key in myDict.Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}", key, myDict.GetValue(key).ToString());

            }

            /</strong>

                mono-stdout: Data -- id = 1002
                mono-stdout: Data -- type = hotel
                mono-stdout: Data -- name = Hotel Ned
                mono-stdout: Data -- city = Balmain
                mono-stdout: Data -- country = Australia
                mono-stdout: Data -- description = Undefined description for Hotel Ned
                mono-stdout: Data -- features = Couchbase.Lite.MutableArrayObject

            <strong>/
        } /</strong> end of func <strong>/


         public void JsonApiBlob()
        {
            // Init
            var ourpath = DataStore.getUserFolder();
            var ourdbname = "ournewdb";
            var userName = "ian";
            //ourpath = Path.Combine(ourpath,userName);

            if (Database.Exists(ourdbname, ourpath))
            {
                Database.Delete(ourdbname, ourpath);
            }
            var dbCfg = new DatabaseConfiguration();
            dbCfg.Directory=ourpath;
            Database dbNew = new Database(ourdbname,dbCfg);


            // Initialize base document for blob from a JSON string
            var docId = "1002";
            var aJSONstring = "{'ref':'hotel_1002','type':'hotel','name':'Hotel Ned'," +
                "'city':'Balmain','country':'Australia'," +
                "'description':'Undefined description for Hotel Ned'," +
                "'features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDoc = new MutableDocument(docId, aJSONstring); <i class="conum" data-value="6"></i><b>(6)</b>


            // Get the content (an image), create blob and add to doc)
            var defaultDirectory =
                Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;()
                            .DefaultDirectory(),
                                userName);
            var myImagePath = Path.Combine(defaultDirectory, "avatarimage.jpg");
            var myImageUri = new Uri(myImagePath.ToString());
            var myBlob = new Blob("image/jpg", myImageUri); <i class="conum" data-value="7"></i><b>(7)</b>
            myDoc.SetBlob("avatar", myBlob); <i class="conum" data-value="8"></i><b>(8)</b>


            // This example generates a 'blob not saved' exception
            try { Console.WriteLine("myBlob (unsaved) as JSON = {0}", myBlob.ToJSON());}
                catch (Exception e)
                    {Console.WriteLine("Exception = {0}", e.Message);}

            dbNew.Save(myDoc);

            // Alternatively -- depending on use case
            dbNew.SaveBlob(new Blob("image/jpg", myImageUri)); <i class="conum" data-value="9"></i><b>(9)</b>


            // Retrieve saved doc, get blob as JSON andheck its still a 'blob'
            var sameDoc = dbNew.GetDocument(docId);
            var reconstitutedBlob = new MutableDictionaryObject().
                SetDictionary("blobCOPY", new MutableDictionaryObject(sameDoc.GetBlob("avatar").ToJSON())); <i class="conum" data-value="10"></i><b>(10)</b>

            if (Blob.IsBlob(
                    reconstitutedBlob.GetDictionary("blobCOPY").ToDictionary()))  <i class="conum" data-value="11"></i><b>(11)</b>
            {
               //... process accordingly
               Console.WriteLine("Its a Blob!!");
            }

            var datavalue = "";
            foreach (string key in myDoc.Keys)
            {
                if (key == "features")
                {
                    datavalue = "features are: ";
                    foreach (string item in myDoc.GetArray(key))
                    {
                        datavalue = datavalue + ", " + item;
                    }
                }
                else if (key == "avatar")
                {
                    datavalue = sameDoc.GetBlob(key).ToJSON();
                }
                else
                {
                    datavalue = sameDoc.GetValue(key).ToString();
                }

                System.Console.WriteLine(" Data -- {0} = {1}", key, datavalue);
            }

            // System.Console.WriteLine(" reconstitutedBlob = {0}", reconstitutedBlob.GetDictionary("blobCOPY").ToJSON());



            //}

            /</strong>


                Exception = Missing Digest Due To Blob Is Not Saved To Database yet.

                Data -- id = 1002
                Data -- type = hotel
                Data -- name = Hotel Ned
                Data -- city = Balmain
                Data -- country = Australia
                Data -- description = Undefined description for Hotel Ned
                Data -- features = features are: , Cable TV, Toaster, Microwave
                Data -- avatar = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

                blobAsJSONstring = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

            <strong>/
        } /</strong> end of func <strong>/




  } // end of class



// p2p sync items


var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="12"></i><b>(12)</b>

thisConfig.Authenticator =
  new ListenerPasswordAuthenticator(
    (sender, username, password) =&gt;
      {
      return username.equals("valid.user")  &amp;&amp; (password == validPassword);
      }
  ); <i class="conum" data-value="13"></i><b>(13)</b>

_thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="14"></i><b>(14)</b>

_thisListener.Start(); <i class="conum" data-value="15"></i><b>(15)</b>




var theListenerEndpoint = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="16"></i><b>(16)</b>

var thisConfig = new ReplicatorConfiguration(thisDB, theListenerEndpoint); <i class="conum" data-value="17"></i><b>(17)</b>

thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="18"></i><b>(18)</b>

thisConfig.Authenticator =
  new BasicAuthenticator("valid.user", "valid.password.string"); <i class="conum" data-value="19"></i><b>(19)</b>

var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="20"></i><b>(20)</b>

thisReplicator.Start(); <i class="conum" data-value="21"></i><b>(21)</b>








// PASSIVE PEER STUFF
// Stuff I adapted
//
//
// p2pSync-websockets.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;
namespace api_walkthrough
{
  class Program
  {
  private static Database _Database;
  private static Replicator _Replicator;
  private static ListenerToken _thisListenerToken;
  private static bool _NeedsExtraDocs;

  #region Private Methods
  private static void GettingStarted()
  {

    // Initialize the listener config
    var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="22"></i><b>(22)</b>

    thisConfig.Port = 55990; <i class="conum" data-value="23"></i><b>(23)</b>

    thisConfig.NetworkInterface = "10.1.1.10"; <i class="conum" data-value="24"></i><b>(24)</b>

    thisConfig.EnableDeltaSync = true; <i class="conum" data-value="25"></i><b>(25)</b>

    thisConfig.DisableTLS = false; <i class="conum" data-value="26"></i><b>(26)</b>

    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="27"></i><b>(27)</b>

    // Configure the client authenticator
    // Here we are using Basic Authentication) <i class="conum" data-value="28"></i><b>(28)</b>
    SecureString validPassword =  new SecureString(); /</strong> example only <strong>/
    // Get SecureString input for validPassword
    var validUser = "valid.username";
    thisConfig.Authenticator = new ListenerPasswordAuthenticator(
      (sender, validUser, validPassword) =&gt;
        {
          return username.equals(validUser)  &amp;&amp; password == validPassword);
        }
      );

    // Initialize the listener
    _thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="29"></i><b>(29)</b>

    // Start the listener
    thisListener.Start(); <i class="conum" data-value="30"></i><b>(30)</b>

  }

  thisConfig.disableTLS = true;


  // Use “anonymous” cert. These are self signed certs created by the system
  thisConfig.TlsIdentity = null;


  thisConfig.EnableDeltaSync = true;


  int connectionCount = thisListener.Status.ConnectionCount; <i class="conum" data-value="31"></i><b>(31)</b>
  int activeConnectionCount = thisListener.Status.ActiveConnectionCount;  <i class="conum" data-value="32"></i><b>(32)</b>



  thisListener.Stop();


// Additional snippets


foreach(NetworkInterface ni in NetworkInterface.GetAllNetworkInterfaces())
{
  if(ni.NetworkInterfaceType == NetworkInterfaceType.Wireless80211 ||
      ni.NetworkInterfaceType == NetworkInterfaceType.Ethernet)
  {
    // do something with the interface(s)
  }
}



var thisConfig = new URLEndpointListenerConfiguration(thisDB);
_thisListener = new URLEndpointListener(thisConfig);

_thisListener.Start();

 Console.WriteLine("URLS are {0} ", thisListener.Urls;


    thisConfig.DisableTLS = true; <i class="conum" data-value="33"></i><b>(33)</b>


    // . . . preceding application logic . . .
    // Get the database (and create it if it doesn't exist)
    var thisDB = new Database("mydb");


    // Use CA Cert
    // Create a TLSIdentity from an imported key-pair
    // . . . previously declared variables include ...
    TLSIdentity thisIdentity;
    X509Store _store =
      new X509Store(StoreName.My); // create and label x509 store

    // Get keys and certificates from PKCS12 data
    byte[] thisIdData =
      File.ReadAllBytes("c:client.p12"); <i class="conum" data-value="34"></i><b>(34)</b>
    // . . . other user code . . .

    thisIdentity = TLSIdentity.ImportIdentity(
      _store,
      thisIdData, <i class="conum" data-value="35"></i><b>(35)</b>
      "123", // Password to access certificate data
      "couchbase-demo-cert",
      null); // Label to get cert in certificate map
        // NOTE: If a null label is supplied then the same
        // default directory for a Couchbase Lite database
        // is used for map.


    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="36"></i><b>(36)</b>

    // Set the TLS Identity
    thisConfig.TlsIdentity = thisIdentity; <i class="conum" data-value="37"></i><b>(37)</b>


    // Configure the client authenticator
    // to validate using ROOT CA

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="38"></i><b>(38)</b>
    var clientData = File.ReadAllBytes("c:client.p12");
    var ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData); <i class="conum" data-value="39"></i><b>(39)</b>

    // Configure the authenticator to use the root certs
    var thisAuth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(thisRootCert));

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="40"></i><b>(40)</b>

    // Initialize the listener using the config
    _listener = new URLEndpointListener(thisConfig);

    // Configure the client authenticator
    // to validate using application logic

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="41"></i><b>(41)</b>
    clientData = File.ReadAllBytes("c:client.p12");
    ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData);

    // Configure the authenticator to pass the root certs
    // To a user supplied code block for authentication
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert) =&gt; {
          // . . . user supplied code block
          // . . . returns boolean value (true=authenticated)
        }); <i class="conum" data-value="42"></i><b>(42)</b>

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="43"></i><b>(43)</b>




// END Additional






// Listener Callouts


  &lt;.&gt; Initialize the listener instance using the configuration settings.
  &lt;.&gt; Start the listener, ready to accept connections and incoming data from active peers.



  &lt;.&gt; <code>connectionCount</code> -- the total number of connections served by the listener
  &lt;.&gt; <code>activeConnectionCount</code> -- the number of active (BUSY) connections currently being served by the listener
  //

  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; PKCS12 data containing private key, public key, and certificates
  &lt;.&gt; The key pair as stored in the byte array
  &lt;.&gt; The password required to access the certificate data
  &lt;.&gt; The key label assigned to the cert in certificate map and used for retrieval
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>


  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; When creating a certificate, the common name attribute is required to create a CSR. If the common name is not present in the certificate an exception is thrown.
  &lt;.&gt; If the expiration date is not specified, the expiration date of the certificate is 365 days after creation
  &lt;.&gt; The key label to get cert in certificate map
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>










  // cert is a pre-populated object of type:SecCertificate representing a certificate
  // Work in progress. Code snippet to be provided.



  // prev content of listener-config-client-auth-self-signed (for ios)
  thisConfig.authenticator = ListenerCertificateAuthenticator.init {
    (cert) -&gt; Bool in
    var cert:SecCertificate
    var certCommonName:CFString?
    let status=SecCertificateCopyCommonName(cert, &amp;certCommonName)
    if (self._allowlistedUsers.contains(["name": certCommonName! as String])) {
      return true
    }
    return false
  }
  // Work in progress. Code snippet to be provided.


public class URLEndpointListener {
    // Properties <i class="conum" data-value="1"></i><b>(1)</b>
    public let config: URLEndpointListenerConfiguration
    public let port UInt16?
    public let tlsIdentity: TLSIdentity?
    public let urls: Array&lt;URL&gt;?
    public let status: ConnectionStatus?
    // Constructors <i class="conum" data-value="2"></i><b>(2)</b>
    public init(config: URLEndpointListenerConfiguration)
    // Methods <i class="conum" data-value="3"></i><b>(3)</b>
    public func start() throws
    public func stop()
}


let config = URLEndpointListenerConfiguration.init(database: self.oDB)
thisConfig.port = tls ? wssPort : wsPort
thisConfig.disableTLS = !tls
thisConfig.authenticator = auth
self.listener = URLEndpointListener.init(config: config) <i class="conum" data-value="1"></i><b>(1)</b>


// ACTIVE PEER STUFF
// Replication code
//
// Copyright (c) 2019 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

public class Examples {
  private static final String TAG = "EXAMPLE ACTIVE PEER";
  private static final String thisDBNAME = "local-database";
  private final Context context;
  // private Database database;
  // private Replicator replicator;

  public Examples(Context context) { this.context = context; }

  String user = "syncuser";
  String password = "sync9455";
  SecCertificate cert=null;
  String passivePeerEndpoint = "10.1.1.12:8920";
  String passivePeerPort = "8920";
  String passiveDbName = "userdb";
  Database thisDB;
  Replicator thisReplicator;
  ListenerToken replicatorListener;

  //@Test
  public void testActPeerSync() throws CouchbaseLiteException, URISyntaxException {
    // . . . preceding code. for example . . .
    private static ListenerToken _thisListenerToken;
    var Database thisDB;
    // . . . other code . . .
    // initialize the replicator configuration

    var thisUrl = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="44"></i><b>(44)</b>
    var config = new ReplicatorConfiguration(thisDB, thisUrl);


    // Set replicator type
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

    // Set autopurge option
    // here we override its default
    thisConfig.EnableAutoPurge = false; <i class="conum" data-value="45"></i><b>(45)</b>

    // Configure Sync Mode
    thisConfig.Continuous = true; // default value

    // Configure Server Security -- only accept self-signed certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="46"></i><b>(46)</b>

    // Configure Client Security <i class="conum" data-value="47"></i><b>(47)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");

    /</strong> Optionally set a conflict resolver call back <strong>/ <i class="conum" data-value="48"></i><b>(48)</b>
    // Use built-in resolver
    thisConfig.ConflictResolver = new LocalWinConflictResolver();  //

    // optionally use custom resolver
    thisConfig.ConflictResolver = new ConflictResolver(
      (conflict) =&gt; {
        /</strong> define resolver function */
      }
    ); //

    // Initialize and start a replicator
    // Initialize replicator with configuration data
    var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="49"></i><b>(49)</b>

    //Optionally add a change listener <i class="conum" data-value="50"></i><b>(50)</b>
    _thisListenerToken =
      thisReplicator.AddChangeListenersender, args) =&gt;         {           if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {               Console.WriteLine("Replication stopped");           }         });      // Start replicator     thisReplicator.Start(); <i class="conum" data-value="51"></i><b>(51)</b>  }  // Additional snippets      // Configure Server Security -- only accept CA certs     thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="52"></i><b>(52)</b>       // Return the remote pinned cert (the listener's cert)     byte returnedCert = new byte(thisConfig.getPinnedCertificate(; // Get listener cert if pinned
    // Configure Client Security <i class="conum" data-value="53"></i><b>(53)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");


    // Only CA Certs accepted
    thisConfig.AcceptOnlySelfSignedServerCertificate =
      false; <i class="conum" data-value="54"></i><b>(54)</b>

    var thisCert =
      new X509Certificate2(caData); <i class="conum" data-value="55"></i><b>(55)</b>

    thisConfig.PinnedServerCertificate =
      thisCert; <i class="conum" data-value="56"></i><b>(56)</b>













    // Code to refactor
    Log.i(TAG, "The Replicator is currently " + thisReplicator.Status().getActivityLevel());

    Log.i(TAG, "The Replicator has processed " + t);

    if (thisReplicator.Status().getActivityLevel() == Replicator.ActivityLevel.BUSY) {
          Log.i(TAG, "Replication Processing");
          Log.i(TAG, "It has completed " + thisReplicator.Status().getProgess().getTotal() + " changes");
      }
    _thisReplicator.Stop();
    while (_thisReplicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
        // Database cannot close until replicators are stopped
        Console.WriteLine($"Waiting for replicator to stop (currently {_thisReplicator.Status.Activity})...");
        Thread.Sleep(200);
    }
    _thisDatabase.Close();

      // Stop replication.
      thisReplicator.Stop(); <i class="conum" data-value="57"></i><b>(57)</b>


  }

{
  CouchbaseLite.init(context);
  Database thisDB = new Database("passivepeerdb");  <i class="conum" data-value="58"></i><b>(58)</b>
  // Initialize the listener config
  final URLEndpointListenerConfiguration thisConfig = new URLEndpointListenerConfiguration(database);
  thisConfig.Port(55990)             // &lt;.&gt; Default- port is selected
  thisConfig.DisableTls(false)       // &lt;.&gt; Optional. Defaults to false. You get TLS encryption out-of-box
  thisConfig.EnableDeltaSync(true)   // &lt;.&gt; Optional. Defaults to false.

  // Configure the client authenticator (if using basic auth)
  ListenerPasswordAuthenticator auth = new ListenerPasswordAuthenticator { "Our Username", "Our Password"}; <i class="conum" data-value="59"></i><b>(59)</b>
  thisConfig.Authenticator(auth); <i class="conum" data-value="60"></i><b>(60)</b>

  // Initialize the listener
  final URLEndpointListener listener = new URLEndpointListener( thisConfig ); <i class="conum" data-value="61"></i><b>(61)</b>

  // Start the listener
  listener.Start(); <i class="conum" data-value="62"></i><b>(62)</b>
    }



Map&lt;String, String&gt; X509_ATTRIBUTES = mapOf(
           TLSIdentity.CERT_ATTRIBUTE_COMMON_NAME to "Couchbase Demo",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION to "Couchbase",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION_UNIT to "Mobile",
           TLSIdentity.CERT_ATTRIBUTE_EMAIL_ADDRESS to "<a href="mailto:noreply@couchbase.com">noreply@couchbase.com</a>"
       )

TLSIdentity thisIdentity = new TLSIdentity.createIdentity(true, X509_ATTRIBUTES, null, "test-alias");



. . . work in progress - GetHashCode snippet to be provided

TLSIdentity.DeleteIdentity(_store, "alias-to-delete", null);


// OPTIONALLY:: Retrieve a stored TLS identity using its alias/label

TLSIdentity thisIdentity = new TLSIdentity.getIdentity("CBL-Demo-Server-Cert")


    // Configure the client authenticator (if using Basic Authentication)
    // String validUser = new String("validUsername"); // an example username
    // String validPassword = new String("validPasswordValue"); // an example password

    // ListenerPasswordAuthenticator thisAuth = new ListenerPasswordAuthenticator( <i class="conum" data-value="63"></i><b>(63)</b>
    //   validUser, validPassword -&gt; validUser == "validUsername" &amp;&amp; validPassword == "validPasswordValue" );

    // if (thisAuth) {
    //   thisConfig.Authenticator(auth);
    // }
    // else {
    //   // . . . authentication failed take appropriate exception action
    //   return
    // };




    ListenerToken thisListener = new thisReplicator.addChangeListener(change -&gt; { <i class="conum" data-value="64"></i><b>(64)</b>
      if (change.Status().getError() != null) {
        Log.i(TAG, "Error code ::  " + change.Status().getError().getCode());
      }
    });




// g u b b i n s


    // Configure TLS Cert CA auth using key-stored cert id alias 'doc-sync-server'

    // TLSIdentity thisIdentity = new TLSIdentity.getIdentity("doc-sync-server"); // Get existing TLS ID from sec storage

    // ClientCertificateAuthenticator thisAuth = new ClientCertificateAuthenticator(thisIdentity);

    // thisConfig.Authenticator(thisAuth);



    // USE KEYCHAIN IDENTITY IF EXISTS
    // Check if Id exists in keychain. If so use that Id

    // STILL NEED TO REFACTOR

    do {
      if let thisIdentity = try TLSIdentity.identity(withLabel: "doco-sync-server") {
          print("An identity with label : doco-sync-server already exists in keychain")
          return thisIdentity
          }
    } catch
    {return nil}
    thisAuthenticator.ClientCertificateAuthenticator(identity: thisIdentity )
    thisConfig.thisAuthenticator




String thisAlias = "alias-to-delete";
KeyStore thisKeystore = KeyStore.getInstance("PKCS12"); <i class="conum" data-value="65"></i><b>(65)</b>
thisKeyStore.load= null;
if (thisAlias != null) {
   thisKeystore.deleteEntry(thisAlias);  <i class="conum" data-value="66"></i><b>(66)</b>
}



// cert auth
let rootCertData = SecCertificateCopyData(cert) as Data
let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])

SecCertificate thisCert = new SecCertificate(); // populated as nec.

Data rootCertData = new Data(SecCertificateCopyData(thisCert));

let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])
// cert auth


// C A L L O U T S

&lt;.&gt; Configure to accept only CA certs
&lt;.&gt; Configure the pinned certificate using data from the byte array <code>cert</code>
&lt;.&gt; Set the certificate to be compared with that provided by the server

&lt;.&gt; PKCS12 data containing private key, public key, and certificates
&lt;.&gt; This is the default value and means that TLS is enabled

&lt;.&gt; Refuse self-signed certificates
&lt;.&gt; Get the identity
&lt;.&gt; Set the Client Certificate Authenticator to require signed certificates with this identity



    // Configure the client authenticator
    // to validate using ROOT CA <i class="conum" data-value="67"></i><b>(67)</b>
    byte[] thisCaData; // byte array for CA data
    using (var thisReader = new BinaryReader(stream)) {
      thisCaData = thisReader.ReadBytes(int stream.Length);
    }; // Get cert data

    var thisRootCert = new X509Certificate(thisCaData); //

    thisConfig.Authenticator = new  ListenerCertificateAuthenticator(
      new X509Certificate2Collection(thisRootCert)
    );




    var db = new Database("other-database");
    _Database = db;
    X509Store _store = new X509Store(StoreName.My);
    TLSIdentity thisIdentity;


    // Configure the expected server-supplied
    // credentials -- only accept CA Certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="68"></i><b>(68)</b>

    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="69"></i><b>(69)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="70"></i><b>(70)</b>






    byte[] thisCaData, thisClientData;
    thisClientData = File.ReadAllBytes("C:\\client.p12"); <i class="conum" data-value="71"></i><b>(71)</b>
    thisCaData = File.ReadAllBytes("C:\\client-ca.der");

    // Root certs
    var thisRootCert = new X509Certificate2(thisCaData);
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert));

    // Create URL Endpoint Listener
    var thisConfig = new URLEndpointListenerConfiguration(_Database);
    thisConfig.DisableTLS = false; <i class="conum" data-value="72"></i><b>(72)</b>
    thisConfig.Authenticator = thisAuth;
    _listener = new URLEndpointListener(thisConfig);
    _listener.Start();

    // Client identity
    thisIdentity = TLSIdentity.ImportIdentity(_store,
        thisClientData,
        "123",
        "CBL-Client-Cert",
        null);

    // Replicator -- Client
    var database = new Database("client-database");
    var builder = new UriBuilder(
        "wss",
        "localhost",
        _listener.Port,
        $"/{_listener.thisConfig.Database.Name}"
    );

    var url = builder.Uri;
    var target = new URLEndpoint(url);
    var thisConfig = new ReplicatorConfiguration(database, target);
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;
    thisConfig.Continuous = false;
    thisConfig.Authenticator = new ClientCertificateAuthenticator(thisIdentity);
    thisConfig.AcceptOnlySelfSignedServerCertificate = true;
    thisConfig.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
    using (var replicator = new Replicator(thisConfig)) {
        replicator.Start();
    }





    // Stop listener after replicator is stopped
    _listener.Stop();



    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="73"></i><b>(73)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="74"></i><b>(74)</b>



  // For replications

  // BEGIN -- snippets --
  //    Purpose -- code samples for use in replication topic

  public class MyClass
  {
      public Database Database { get; set; }
      public Replicator Replicator { get; set; } <i class="conum" data-value="75"></i><b>(75)</b>

      public void StartReplication()
      {
  }

          var url = new Uri("wss://localhost:4984/db"); <i class="conum" data-value="76"></i><b>(76)</b>
          var target = new URLEndpoint(url);
          var config = new ReplicatorConfiguration(Database, target)
          {
              ReplicatorType = ReplicatorType.Pull
          };

          Replicator = new Replicator(config);
          Replicator.Start();
      }

      // &lt;.&gt; A replication is an asynchronous operation.
      // To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
      // &lt;.&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
      // You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.

      public void InitReplication()
      {
        // initialize the replicator configuration

        var thisUrl = new URLEndpoint("wss://l10.0.2.2:4984/anotherDB"); <i class="conum" data-value="77"></i><b>(77)</b>
        var config = new ReplicatorConfiguration(thisDB, thisUrl);

      }
  }
 }



  public class supporting_datatypes
  {
      public void datatype_dictionary()
      {
          var database = new Database(name: "mydb");

          // NOTE: No error handling, for brevity (see getting started)
          var document = database.GetDocument("doc1");

          // Getting a dictionary from the document's properties
          var dict = document.GetDictionary("address");

          // Access a value with a key from the dictionary
          var street = dict.GetString("street");

          // Iterate dictionary
          foreach (var key in dict.Keys)
          {
              Console.WriteLine($"Key {key} = {dict.GetValue(key)}");
          }

          // Create a mutable copy
          var mutDict = dict.ToMutable();
      }

      public void datatype_mutable_dictionary()
      {

          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable dictionary and populate some keys/values
          var mutable_dict = new MutableDictionaryObject();
          mutable_dict.SetString("street", "1 Main st.");
          mutable_dict.SetString("city", "San Francisco");

          // Add the dictionary to a document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetDictionary("address", mutable_dict);
          database.Save(doc);

      }


      public void datatype_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          var document = database.GetDocument("doc1");

          // Getting a phones array from the document's properties
          var array = document.GetArray("phones");

          // Get element count
          var count = array.Count();

          // Access an array element by index
          if (count &gt;= 0) { var phone = array[1]; }

          // Iterate dictionary
          for (int i = 0; i &lt; count; i++)
          {
              Console.WriteLine($"Item {i.ToString()} = {array[i]}");
          }

          // Create a mutable copy
          var mutable_array = array.ToMutable();


      }

        public void datatype_mutable_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable array and populate data into the array
          var mutable_array = new MutableArrayObject();
          mutable_array.AddString("650-000-0000");
          mutable_array.AddString("650-000-0001");

          // Set the array to document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetArray("phones", mutable_array);
          database.Save(doc);
      }

  } // end  class supporting_datatypes</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and populate a mutable array <code>phones</code></p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">//
// Program.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;

namespace api_walkthrough
{
    class Program
    {
        private static Database _Database;
        private static Replicator _Replicator;
        private static URLEndpointListener _listener;
        private static ListenerToken _ListenerToken;
        private static bool _NeedsExtraDocs;

        <mark>region Private Methods

        private static void GettingStarted()
        {

            // using System;
            // using Couchbase.Lite;
            // using Couchbase.Lite.Query;
            // using Couchbase.Lite.Sync;

            // Get the database (and create it if it doesn't exist)
            var database = new Database("mydb");
            // Create a new document (i.e. a record) in the database
            string id = null;
            using (var mutableDoc = new MutableDocument())
            {
                mutableDoc.SetFloat("version", 2.0f)
                    .SetString("type", "SDK");

                // Save it to the database
                database.Save(mutableDoc);
                id = mutableDoc.Id;
            }

            // Update a document
            using (var doc = database.GetDocument(id))
            using (var mutableDoc = doc.ToMutable())
            {
                mutableDoc.SetString("language", "C</mark>");
                database.Save(mutableDoc);

                using (var docAgain = database.GetDocument(id))
                {
                    Console.WriteLine($"Document ID :: {docAgain.Id}");
                    Console.WriteLine($"Learning {docAgain.GetString("language")}");
                }
            }

            // Create a query to fetch documents of type SDK
            // i.e. SELECT * FROM database WHERE type = "SDK"
            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(database))
                .Where(Expression.Property("type").EqualTo(Expression.String("SDK"))))
            {
                // Run the query
                var result = query.Execute();
                Console.WriteLine($"Number of rows :: {result.AllResults().Count}");
            }

            // Create replicator to push and pull changes to and from the cloud
            var targetEndpoint = new URLEndpoint(new Uri("ws://localhost:4984/getting-started-db"));
            var replConfig = new ReplicatorConfiguration(database, targetEndpoint);

            // Add authentication
            replConfig.Authenticator = new BasicAuthenticator("john", "pass");

            // Create replicator (make sure to add an instance or static variable
            // named _Replicator)
            var _Replicator = new Replicator(replConfig);
            _Replicator.AddChangeListenersender, args) =&gt;             {                 if (args.Status.Error != null)                 {                     Console.WriteLine($"Error :: {args.Status.Error}");                 }             });              _Replicator.Start();              // Later, stop and dispose the replicator <strong>before</strong> closing/disposing the         }            private static void TestReplicatorConflictResolver()         {             var target = new URLEndpoint(new Uri("ws://localhost:4984/mydatabase";
            var replConfig = new ReplicatorConfiguration(database, target);
            replConfig.ConflictResolver = new LocalWinConflictResolver();

            var replicator = new Replicator(replConfig);
            replicator.Start();
        }

        private static void TestSaveWithConflictHandler()
        {
            using (var document = database.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                database.Save(mutableDocument, (updated, current) =&gt;
                {
                    var currentDict = current.ToDictionary();
                    var newDict = updated.ToDictionary();
                    var result = newDict.Concat(currentDict)
                        .GroupBy(kv =&gt; kv.Key)
                        .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
                    updated.SetData(result);
                    return true;
                });
            }
        }

        private static bool IsValidCredential(string name, SecureString password) { return true;  } // helper
        private static void TestInitListener()
        {
            var db = new Database("other-database");
            _Database = db;

            var config = new URLEndpointListenerConfiguration(_Database);
            config.TlsIdentity = null; // Use with anonymous self-signed cert
            config.Authenticator = new ListenerPasswordAuthenticatorsender, username, password) =&gt;             {                 if(IsValidCredential(username, password {
                    return true;
                }

                return false;
            });

            _listener = new URLEndpointListener(config);
        }

        private static void TestListenerStart()
        {
            // CouchbaseLiteException will be thrown when the listener cannot be started. The most common error
            // would be that the configured port has already been used.
            _listener.Start();
        }

        private static void TestListenerStop()
        {
            _listener.Stop();
        }

        private static void TestCreateSelfSignedCert()
        {
            TLSIdentity identity;
            X509Store _store =
             new X509Store(StoreName.My);
              // The identity will be stored in the secure
              // storage using the given label.
            DateTimeOffset fiveMinToExpireCert = DateTimeOffset.UtcNow.AddMinutes(5);

            identity = TLSIdentity.CreateIdentity(true, /* isServer <strong>/
                new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "Couchbase Inc" } },
                    // The common name attribute is required
                    // when creating a CSR. If it is not presented
                    // in the cert, an exception is thrown.
                fiveMinToExpireCert,
                    // If the expiration date is not specified,
                    // the certs expiration will be 365 days
                _store,
                "CBL-Server-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.

        }

        private static void TestImportTLSIdentity()
        {
            TLSIdentity identity;
            X509Store _store = new X509Store(StoreName.My); // The identity will be stored in the secure storage using the given label
            byte[] data = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates

            identity = TLSIdentity.ImportIdentity(_store,
                data,
                "123", // The password that is needed to access the certificate data
                "CBL-Client-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.
        }

          private static void TestClientCertAuthenticatorRootCerts()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;

            byte[] caData, clientData;
            clientData = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates
            caData = File.ReadAllBytes("C:\\client-ca.der");

            // Root certs
            var rootCert = new X509Certificate2(caData);
            var auth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(rootCert));

            // Create URL Endpoint Listener
            var listenerConfig = new URLEndpointListenerConfiguration(_Database);
            listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.
            listenerConfig.Authenticator = auth;
            _listener = new URLEndpointListener(listenerConfig);
            _listener.Start();

            // Client identity
            identity = TLSIdentity.ImportIdentity(_store,
                clientData,
                "123",
                "CBL-Client-Cert",
                null);

            // Replicator -- Client
            var database = new Database("client-database");
            var builder = new UriBuilder(
                "wss",
                "localhost",
                _listener.Port,
                $"/{_listener.Config.Database.Name}"
            );

            var url = builder.Uri;
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.ReplicatorType = ReplicatorType.PushAndPull;
            config.Continuous = false;
            config.Authenticator = new ClientCertificateAuthenticator(identity);
            config.AcceptOnlySelfSignedServerCertificate = true;
            config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
            using (var replicator = new Replicator(config)) {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
            // end::client-cert-authenticator-root-cert
        }

        private static void TestClientCertAuthenticator()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;


            // Create Listener Certificate Authenticator
            var auth = new ListenerCertificateAuthenticatorsender, cert) =&gt;             {                 if (cert.Count != 1) {                     return false;                 }                  return cert[0].SubjectName.Name?.Replace("CN=", "") == "couchbase";             });              // Create URL Endpoint Listener             var listenerConfig = new URLEndpointListenerConfiguration(_Database);             listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.             listenerConfig.Authenticator = auth;             _listener = new URLEndpointListener(listenerConfig);             _listener.Start();              // User Identity             identity = TLSIdentity.CreateIdentity(false,                 new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "couchbase" } },                 null,                 _store,                 ClientCertLabel,                 null);              // Replicator -- Client             var database = new Database("client-database");             var builder = new UriBuilder(                 "wss",                 "localhost",                 _listener.Port,                 $"/{_listener.Config.Database.Name}"             );              var url = builder.Uri;             var target = new URLEndpoint(url);             var config = new ReplicatorConfiguration(database, target);             config.ReplicatorType = ReplicatorType.PushAndPull;             config.Continuous = false;             config.Authenticator = new ClientCertificateAuthenticator(identity);             config.AcceptOnlySelfSignedServerCertificate = false;             config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];             using (var replicator = new Replicator(config {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
        }

        private static void UseEncryption()
        {
            // Enterprise edition only

            // Create a new, or open an existing database with encryption enabled
            var config = new DatabaseConfiguration
            {
                // Or, derive a key yourself and pass a byte array of the proper size
                EncryptionKey = new EncryptionKey("password")
            };

            using (var db = new Database("seekrit", config)) {
                // Change the encryption key (or add encryption if the DB is unencrypted)
                db.ChangeEncryptionKey(new EncryptionKey("betterpassw0rd"));

                // Remove encryption
                db.ChangeEncryptionKey(null);
            }
        }

        private static void ResetReplicatorCheckpoint()
        {
            var database = _Database;
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            using (var replicator = new Replicator(config)) {
              // replicator is a Replicator instance
              if (resetCheckpointRequired_Example) {
                  replicator.Start(true); <i class="conum" data-value="1"></i><b>(1)</b>
              else
                replicator.Start(false);
              }




            }
        }

        private static void Read1xAttachment()
        {
            var db = _Database;
            using (var document = new MutableDocument()) {
                var attachments = document.GetDictionary("_attachments");
                var avatar = attachments.GetBlob("avatar");
                var content = avatar?.Content;
            }
        }

        private static void CreateNewDatabase()
        {
            var db = new Database("my-database");

            _Database = db;
        }

        private static void CloseDatabase()
        {
          database.close()

        }

        private static void ChangeLogging()
        {
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Query, LogLevel.Verbose);
        }

        private static void LoadPrebuilt()
        {
            // Note: Getting the path to a database is platform-specific.  For .NET Core / .NET Framework this
            // can be a simple filesystem path.  For UWP, you will need to get the path from your assets.  For
            // iOS you need to get the path from the main bundle.  For Android you need to extract it from your
            // assets to a temporary directory and then pass that path.
            var path = Path.Combine(Environment.CurrentDirectory, "travel-sample.cblite2" + Path.DirectorySeparatorChar);
            if (!Database.Exists("travel-sample", null)) {
                _NeedsExtraDocs = true;
                Database.Copy(path, "travel-sample", null);
            }

            _Database.Close();
            _Database = new Database("travel-sample");
        }

        private static void QueryDeletedDocuments()
        {
            // Query documents that have been deleted
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.IsDeleted);
        }

        private static void CreateDocument()
        {
            var db = _Database;
            using (var newTask = new MutableDocument("xyz")) {
                newTask.SetString("type", "task")
                    .SetString("owner", "todo")
                    .SetDate("createdAt", DateTimeOffset.UtcNow);

                db.Save(newTask);
            }
        }

        private static void UpdateDocument()
        {
            var db = _Database;
            using(var document = db.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                db.Save(mutableDocument);
            }
        }

        private static void UseTypedAccessors()
        {
            using (var newTask = new MutableDocument()) {
                newTask.SetValue("createdAt", DateTimeOffset.UtcNow);
                var date = newTask.GetDate("createdAt");

                Console.WriteLine(date);
            }
        }

        private static void DoBatchOperation()
        {
            var db = _Database;
            db.InBatch) =&gt;             {                 for (var i = 0; i &lt; 10; i) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "user");
                        doc.SetString("name", $"user {i}");
                        doc.SetBoolean("admin", false);
                        db.Save(doc);
                        Console.WriteLine($"Saved user document {doc.GetString("name")}");
                    }
                }
            });
        }

        private static void DatabaseChangeListener()
        {
            var db = _Database;

            db.AddDocumentChangeListener("user.john", (sender, args) =&gt;
            {
                using (var doc = Db.GetDocument(args.DocumentID)) {
                    Console.WriteLine($"Status :: {doc.GetString("verified_account")}");
                }
            });
        }

        private static void DocumentExpiration()
        {
            var db = _Database;

            // Purge the document one day from now
            var ttl = DateTimeOffset.UtcNow.AddDays(1);
            db.SetDocumentExpiration("doc123", ttl);

            // Reset expiration
            db.SetDocumentExpiration("doc1", null);

            // Query documents that will be expired in less than five minutes
            var fiveMinutesFromNow = DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeMilliseconds();
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.Expiration.LessThan(Expression.Double(fiveMinutesFromNow)));
        }

        private static void UseBlob()
        {
            var db = _Database;
            using (var newTask = new MutableDocument()) {
                // Note: Reading the data is implementation dependent, as with prebuilt databases
                var image = File.ReadAllBytes("avatar.jpg"); // &lt;.&gt;
                var blob = new Blob("image/jpeg", image); // &lt;.&gt;
                 newTask.SetBlob("avatar", blob); // &lt;.&gt;
                db.Save(newTask);

                var taskBlob = newTask.GetBlob("avatar");
                using (var bitmap = SKBitmap.Decode(taskBlob.ContentStream)) {
                    Console.WriteLine($"Bitmap dimensions: {bitmap.Width} x {bitmap.Height} ({bitmap.BytesPerPixel} bytes per pixel)");
                }
            }
        }

        public void CreateIndex()
        {
            var db = _database;
            string[] indexProperties = new string[] {"type", "name" };
            var config = new ValueIndexConfiguration(indexProperties);
            db.CreateIndex("TypeNameIndex", config);
        }

        public void CreateIndex_Querybuilder()
        {
            // For value types, this is optional but provides performance enhancements
            var db = _database;
            var index = IndexBuilder.ValueIndex(
                ValueIndexItem.Expression(Expression.Property("type")),
                ValueIndexItem.Expression(Expression.Property("name"))); // &lt;.&gt;
            db.CreateIndex("TypeNameIndex", index);
        }
        private static void SelectMeta()
        {
            Console.WriteLine("Select Meta");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("type"),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document ID :: {result.GetString("id")}");
                    Console.WriteLine($"Document Name :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectAll()
        {
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))) {
                // All user properties will be available here
            }

            var query = QueryBuilder
                .Select(SelectResult.All())
                .From(DataSource.Database(db)); // &lt;.&gt;

            // Adds a query change listener.
            // Changes will be posted on the main queue.
            var token = query.AddChangeListener((sender, args) =&gt; // &lt;.&gt;
            {
                var allResult = args.Results.AllResults();
                foreach (var result in allResult) {
                    Console.WriteLine(result.Keys);
                    /* Update UI */
                }
            });


            query.RemoveChangeListener(token);
            query.Dispose();
        }

        private static void SelectWhere()
        {
            Console.WriteLine("Where");
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    var dict = result.GetDictionary(db.Name);
                    Console.WriteLine($"Document Name :: {dict?.GetString("name")}");
                }
            }
        }

        private static void UseCollectionContains()
        {
            Console.WriteLine("Collection Operator CONTAINS");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"),
                    SelectResult.Property("public_likes"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel"))
                    .And(ArrayFunction.Contains(Expression.Property("public_likes"),
                        Expression.String("Armani Langworth"))))) {
                foreach (var result in query.Execute()) {
                    var publicLikes = result.GetArray("public_likes");
                    var jsonString = JsonConvert.SerializeObject(publicLikes);
                    Console.WriteLine($"Public Likes :: {jsonString}");
                }
            }
        }

        private static void UseCollectionIn()
        {
            Console.WriteLine("Collection Operator IN");
            var db = _Database;

            var values = new IExpression[]
                { Expression.Property("first"), Expression.Property("last"), Expression.Property("username") };

            using (var query = QueryBuilder.Select(
                    SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.String("Armani").In(values))) {
                foreach (var result in query.Execute()) {
                    var body = result.GetDictionary(0);
                    var jsonString = JsonConvert.SerializeObject(body);
                    Console.WriteLine($"In results :: {jsonString}");
                }
            }
        }

        private static void SelectLike()
        {
            Console.WriteLine("Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Royal Engineers Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardLike()
        {
            Console.WriteLine("Wildcard Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Eng%e%"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardCharacterLike()
        {
            Console.WriteLine("Wildchard Characters");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Like(Expression.String("Royal Eng____rs Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectRegex()
        {
            Console.WriteLine("Regex");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Regex(Expression.String("\\bEng.*e\\b"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectJoin()
        {
            Console.WriteLine("Join");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Expression.Property("name").From("airline")),
                    SelectResult.Expression(Expression.Property("callsign").From("airline")),
                    SelectResult.Expression(Expression.Property("destinationairport").From("route")),
                    SelectResult.Expression(Expression.Property("stops").From("route")),
                    SelectResult.Expression(Expression.Property("airline").From("route")))
                .From(DataSource.Database(db).As("airline"))
                .Join(Join.InnerJoin(DataSource.Database(db).As("route"))
                    .On(Meta.ID.From("airline").EqualTo(Expression.Property("airlineid").From("route"))))
                .Where(Expression.Property("type").From("route").EqualTo(Expression.String("route"))
                    .And(Expression.Property("type").From("airline").EqualTo(Expression.String("airline")))
                    .And(Expression.Property("sourceairport").From("route").EqualTo(Expression.String("RIX"))))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void GroupBy()
        {
            Console.WriteLine("GroupBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Function.Count(Expression.All())),
                    SelectResult.Property("country"),
                    SelectResult.Property("tz"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("airport"))
                    .And(Expression.Property("geo.alt").GreaterThanOrEqualTo(Expression.Int(300))))
                .GroupBy(Expression.Property("country"), Expression.Property("tz"))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine(
                        $"There are {result.GetInt("$1")} airports in the {result.GetString("tz")} timezone located in {result.GetString("country")} and above 300 ft");
                }
            }
        }

        private static void OrderBy()
        {
            Console.WriteLine("OrderBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("title"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .OrderBy(Ordering.Property("title").Ascending())
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Title :: {result.GetString("title")}");
                }
            }
        }

      // ### EXPLAIN statement
      private static void TestExplainStatement()
      // For Documentation
      {
        var db = _Database;
        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
            .GroupBy(Expression.Property("country"))
            .OrderBy(Ordering.Property("title").Ascending()) // &lt;.&gt;

          Console.WriteLine(query.Explain()); // &lt;.&gt;

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("%hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;
  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Function.Lower(Expression.Property("type")).EqualTo(Expression.String("hotel"))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type")).EqualTo(Expression.String("hotel")); // &lt;.&gt;

          Console.WriteLine(query.Explain());

      }

      // end query-explain


        public void CreateFullTextIndex()
        {
            string[] indexProperties = new string[] { "overview", "name" };
            var config = new FullTextIndexConfiguration(indexProperties);
            db.CreateIndex("overviewFTSIndex", config);
        }

        public void FullTextSearch()
        {
            Console.WriteLine("Full text search");

            var db = _database;
            var ftsQuery = db.CreateQuery("SELECT * FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)");
            foreach (var result in ftsQuery.Execute())
            {
                Console.WriteLine($"Document id {result.GetString(0)}");
            }
            }
        }


        private static void CreateFullTextIndex_Querybuilder()
        {
            var db = _Database;

            if (_NeedsExtraDocs) {
                var tasks = new[] { "buy groceries", "play chess", "book travels", "buy museum tickets" };
                foreach (var task in tasks) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "task");
                        doc.SetString("name", task);
                        db.Save(doc);
                    }
                }
            }


            var index = IndexBuilder.FullTextIndex(FullTextIndexItem.Property("overview")).IgnoreAccents(false);
            db.CreateIndex("overviewFTSIndex", index);
        }

        private static void FullTextSearch_Querybuilder()
        {
            Console.WriteLine("Full text search");
            var db = _Database;

            var whereClause = FullTextFunction.Match("overviewFTSIndex", "'michigan'");

            using (var query = QueryBuilder.Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(whereClause)) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document id {result.GetString(0)}");
                }
            }
        }
        private static void StartReplication()
        {
            var db = _Database;

            /*
             * This requires Sync Gateway running with the following config, or equivalent:
             *
             * {
             *     "log":["*"],
             *     "databases": {
             *         "db": {
             *             "server":"walrus:",
             *             "users": {
             *                 "GUEST": {"disabled": false, "admin_channels": ["*"] }
             *             }
             *         }
             *     }
             * }
             */

            // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(db, target)
            {
                ReplicatorType = ReplicatorType.Pull
            };

            var replicator = new Replicator(config);
            replicator.Start();

            _Replicator = replicator;
        }

        private static void VerboseReplicatorLogging()
        {
            // deprecated
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Network, LogLevel.Verbose);
        }

        private static void ConsoleLogging()
        {
            Database.Log.Console.Domains = LogDomain.All; // &lt;.&gt;
            Database.Log.Console.LogLevel = LogLevel.Verbose; // &lt;.&gt;


            Database.Log.Console.Domains = LogDomain.Database;

        }

        private static void FileLogging()
        {
            var tempFolder = Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;().DefaultDirectory(), "cbllog");
            var config = new LogFileConfiguration(tempFolder) // &lt;.&gt;
            {
                MaxRotateCount = 5, // &lt;.&gt;
                MaxSize = 10240, // &lt;.&gt;
                UsePlainText = false  // &lt;.&gt;
            };
            Database.Log.File.Config = config; // Apply configuration
            Database.Log.File.Level = LogLevel.Info; // &lt;.&gt;

        }

        private static void EnableCustomLogging()
        {
            Database.Log.Custom = new LogTestLogger(); // &lt;.&gt;
            or
            Database.Log.Custom = new LogTestLogger { Level = LogLevel.Warning };

        }

        private static void WriteConsoleLog()
        {
            Database.Log.Console.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }
        private static void WriteCustomLog()
        {
            Database.Log.Custom?.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }


        private static void WriteFileLog()
        {
            Database.Log.File.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }

        private static void EnableBasicAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new BasicAuthenticator("john", "pass");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void EnableSessionAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void SetupReplicatorListener()
        {
            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
                    Console.WriteLine("Replication stopped");
                }
            });
        }




    //  BEGIN PendingDocuments IB -- 11/Feb/21 --
    private static void ReplicatorPendingDocuments()
    {
        var url = new Uri("ws://localhost:4984/mydatabase");
        var target = new URLEndpoint(url);
        var database = new Database("myDB");
        var config = new ReplicatorConfiguration(database, target);
        config.ReplicatorType  = ReplicatorType.Push;

        var replicator = new Replicator(config);

        var mydocids =
          new HashSet &lt;string&gt; (replicator.GetPendingDocumentIDs()); // &lt;.&gt;


        if (mydocids.Count &gt; 0)
        {
            Console.WriteLine($"There are {mydocids.Count} documents pending");
            replicator.AddChangeListener((sender, change) =&gt;
            {
                Console.WriteLine($"Replicator activity level is " +
                                  change.Status.Activity.ToString());
                // iterate and report-on previously
                // retrieved pending docids 'list'
                foreach (var thisId in mydocids)
                    if (!replicator.IsDocumentPending(thisId)) // &lt;.&gt;
                    {
                        Console.WriteLine($"Doc ID {thisId} now pushed");
                    };
            });

            replicator.Start();
        }
    }


//  END PendingDocuments IB -- 11/Feb/21 --



		private static void ReplicatorDocumentEvent()
        {
            var replicator = _Replicator;

            var token = replicator.AddDocumentReplicationListener((sender, args) =&gt;
            {
                var direction = args.IsPush ? "Push" : "Pull";
                Console.WriteLine($"Replication type :: {direction}");
                foreach (var document in args.Documents) {
                    if (document.Error == null) {
                        Console.WriteLine($"Doc ID :: {document.Id}");
                        if (document.Flags.HasFlag(DocumentFlags.Deleted)) {
                            Console.WriteLine("Successfully replicated a deleted document");
                        }
                    } else {
                        // There was an error
                    }
                }
            });

            replicator.Start();

            replicator.RemoveChangeListener(token);
        }

        private static void SetupReplicatorErrorListener()
        {
            // This can be done in the SetupReplicatorListener method
            // But it is separate so that we can have two documentation entries

            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Error != null) {
                    Console.WriteLine($"Error :: {args.Status.Error}");
                }
            });
        }

        private static void DatabaseReplica()
        {
            var db = _Database;
            using (var database2 = new Database("backup")) {
                // EE feature: This code will not compile on the community edition
                var targetDatabase = new DatabaseEndpoint(database2);
                var config = new ReplicatorConfiguration(db, targetDatabase)
                {
                    ReplicatorType = ReplicatorType.Push
                };

                var replicator = new Replicator(config);
                replicator.Start();

                _Replicator?.Stop();
                _Replicator = replicator;
            }
        }

        private static void PinCertificate()
        {
            // Note: No certificate is included here, so this code is for show only
            var url = new Uri("wss://localhost:4984/db");
            var target = new URLEndpoint(url);
            var db = _Database;

            // Note: `GetCertificate` is a fake method. This would be the platform-specific method
            // to find and load the certificate as an instance of `X509Certificate2`.
            // For .NET Core / .NET Framework this can be loaded from the filesystem path.
            // For UWP, from the assets directory.
            // For iOS, from the main bundle.
            // For Android, from the assets directory.
            var certificate = GetCertificate("cert.cer");
            var config = new ReplicatorConfiguration(db, target)
            {
                PinnedServerCertificate = certificate
            };
        }

        private static void ReplicationCustomHeaders()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target)
            {
                Headers = new Dictionary&lt;string, string&gt;
                {
                    ["CustomHeaderName"] = "Value"
                }
            };
        }

        private static void PushWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PushFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (flags.HasFlag(DocumentFlags.Deleted)) {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void PullWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PullFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (document.GetString("type") == "draft") {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        public void TestCustomRetryConfig()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);

        //  other config as required . . .

            config.Heartbeat = TimeSpan.FromSeconds(120); //  &lt;.&gt;
            config.Maxattempts = 20; //  &lt;.&gt;
            config.MaxAttemptWaitTime = TimeSpan.FromSeconds(600); //  &lt;.&gt;

        //  other config as required . . .

            var repl = new Replicator(config);

        }


        private static void UsePredictiveModel()
        {
            using (var db = new Database("mydb")) {
                var model = new ImageClassifierModel();
                Database.Prediction.RegisterModel("ImageClassifier", model);

                var index = IndexBuilder.ValueIndex(ValueIndexItem.Property("label"));
                db.CreateIndex("value-index-image-classifier", index);

                Database.Prediction.UnregisterModel("ImageClassifier");
            }
        }

        private static void UsePredictiveIndex()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });

                var index = IndexBuilder.PredictiveIndex("ImageClassifier", input);
                db.CreateIndex("predictive-index-image-classifier", index);
            }
        }

        private static void DoPredictiveQuery()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });
                var prediction = PredictiveModel.predict("ImageClassifier", input); // &lt;1&gt;

                using (var q = QueryBuilder.Select(SelectResult.All())
                    .From(DataSource.Database(db))
                    .Where(prediction.Property("label").EqualTo(Expression.String("car"))
                        .And(prediction.Property("probability").GreaterThanOrEqualTo(Expression.Double(0.8))))) {
                    var result = q.Execute();
                    Console.WriteLine($"Number of rows: {result.Count()}");
                }
            }
        }

        static void Main(string[] args)
        {
            // This only needs to be done once for whatever platform the executable is running
            // (UWP, iOS, Android, or desktop)
            Couchbase.Lite.Support.NetDesktop.Activate();

            CreateNewDatabase();
            CreateDocument();
            UpdateDocument();
            UseTypedAccessors();
            DoBatchOperation();
            UseBlob();
            SelectMeta();

            LoadPrebuilt();
            CreateIndex();
            SelectWhere();
            UseCollectionContains();
            SelectLike();
            SelectWildcardLike();
            SelectWildcardCharacterLike();
            SelectRegex();
            SelectJoin();
            GroupBy();
            OrderBy();

            CreateFullTextIndex();
            FullTextSearch();
            StartReplication();
            SetupReplicatorListener();

            _Replicator.Stop();
            while (_Replicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
                // Database cannot close until replicators are stopped
                Console.WriteLine($"Waiting for replicator to stop (currently {_Replicator.Status.Activity})...");
                Thread.Sleep(200);
            }

            _Database.Close();
        }

        #endregion
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  ACTIVE SIDE  ----------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */

    class ActivePeer : IMessageEndpointDelegate
    {
        ActivePeer()
        {
            var id = "";

            var database = new Database("dbname");

            // The delegate must implement the `IMessageEndpointDelegate` protocol.
            var messageEndpointTarget = new MessageEndpoint(uid: "UID:123", target: "",
                protocolType: ProtocolType.MessageStream, delegateObject: this);

            var config = new ReplicatorConfiguration(database, messageEndpointTarget);

            // Create the replicator object
            var replicator = new Replicator(config);
            // Start the replicator
            replicator.Start();
        }

        /* implementation of MessageEndpointDelegate */
        public IMessageEndpointConnection CreateConnection(MessageEndpoint endpoint)
        {
            var connection = new ActivePeerConnection(); /* implements MessageEndpointConnection */
            return connection;
        }
    }

    class ActivePeerConnection : IMessageEndpointConnection
    {
        private IReplicatorConnection _replicatorConnection;

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public async Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // await socket.Open(), etc
            // throw MessagingException if something goes wrong
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  PASSIVE SIDE  ---------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */
    class PassivePeerConnection : IMessageEndpointConnection
    {
        private MessageEndpointListener _messageEndpointListener;
        private IReplicatorConnection _replicatorConnection;

        public void StartListener()
        {
            var database = new Database("mydb");
            var config = new MessageEndpointListenerConfiguration(database, ProtocolType.MessageStream);
            _messageEndpointListener = new MessageEndpointListener(config);
        }

        public void StopListener()
        {
            _messageEndpointListener?.CloseAll();
        }

        public void AcceptConnection()
        {
            var connection = new PassivePeerConnection(); /* implements MessageEndpointConnection */
            _messageEndpointListener?.Accept(connection);
        }

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // socket should already be open on the passive side
            return Task.FromResult(true);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    // tensorFlowModel is a fake implementation
    // this would be the implementation of the ml model you have chosen
    class TensorFlowModel
    {
        public static IDictionary&lt;string, object&gt; PredictImage(byte[] data)
        {
            // Do calculations, etc
            return null;
        }
    }

    class ImageClassifierModel : IPredictiveModel
    {
        public DictionaryObject Predict(DictionaryObject input)
        {
            var blob = input.GetBlob("photo");
            if (blob == null) {
                return null;
            }

            var imageData = blob.Content;
            // tensorFlowModel is a fake implementation
            // this would be the implementation of the ml model you have chosen
            var modelOutput = TensorFlowModel.PredictImage(imageData);
            return new MutableDictionaryObject(modelOutput); // &lt;1&gt;
        }
    }

    private class LogTestLogger : ILogger
    {
        public LogLevel Level { get; set; }

        public void Reset()
        {
            _lines.Clear();
        }

        public void Log(LogLevel level, LogDomain domain, string message)
        {
            // handle the message, for example piping it to
            // a third party framework
        }
    }

    class LocalWinConflictResolver : IConflictResolver
    {
        Document Resolve(Conflict conflict)
        {
            return conflict.LocalDocument;
        }
    }

    class RemoteWinConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            return conflict.RemoteDocument;
        }
    }

    class MergeConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            var localDict = conflict.LocalDocument.ToDictionary();
            var remoteDict = conflict.RemoteDocument.ToDictionary();
            var result = localDict.Concat(remoteDict)
               .GroupBy(kv =&gt; kv.Key)
               .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
            return new MutableDocument(conflict.DocumentID, result);
        }
    }
}

// N1QL QUERY

  public List&lt;Result&gt; docsonly_N1QLQueryString(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = \"hotel\""); // &lt;.&gt;

      return thisQuery.Execute().AllResults();

  }


  public  List&lt;Result&gt; docsonly_N1QLQueryStringParams(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      // Declared elsewhere: Database argDB

      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = $type"); // &lt;.&gt;

      var n1qlParams = new Parameters();
      n1qlParams.SetString("type", "hotel"); // &lt;.&gt;
      thisQuery.Parameters = n1qlParams;

      return thisQuery.Execute().AllResults();

  }


// QUERY RESULT SET HANDLING EXAMPLES

    public static void testQuerySyntaxAll()
    {
        // For Documentation
        var dbName = "travel-sample";

        string thisDocsId;
        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        Dictionary&lt;string,object&gt; hotel = new Dictionary&lt;string,object&gt;();

        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
              .Select(SelectResult.All())
              .From(DataSource.Database(this_Db));


        var results = query.Execute().AllResults();

        if (results?.Count &gt; 0)
        {
            List&lt;Dictionary&lt;string,object&gt;&gt; hotels = new List&lt;Dictionary&lt;string,object&gt;&gt;();
            foreach (var result in results)
            {
                // get the result into our dictionary object
                var thisDocsProps = result.GetDictionary(dbName); // &lt;.&gt;

                if (thisDocsProps != null)
                {
                    thisDocsId = thisDocsProps.GetString("id"); // &lt;.&gt;
                    thisDocsName = thisDocsProps.GetString("name");
                    thisDocsCity = thisDocsProps.GetString("city");
                    thisDocsType = thisDocsProps.GetString("type");
                    hotel = thisDocsProps.ToDictionary();
                    hotels.Add(hotel);
                }

            }
        }


    foreach (var result in query.Execute().AsEnumerable()) {

        // get the result into a JSON String
                var thisDocsJSONString = result.ToJSON();// &lt;.&gt;

        // Get a native dictionary object using the JSON string
        var dictFromJSONstring =
              JsonConvert.
                DeserializeObject&lt;Dictionary&lt;string, object&gt;&gt;
                  (thisDocsJSONString); // &lt;.&gt;

        // use the created dictionary
        if (dictFromJSONstring != null)
        {
            thisDocsId = dictFromJSONstring["id"].ToString();
            thisDocsName = dictFromJSONstring["name"].ToString();
            thisDocsCity = dictFromJSONstring["city"].ToString();
            thisDocsType = dictFromJSONstring["type"].ToString();
        }

        //Get a custom object using the JSON string
        Hotel this_hotel =
            JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocsJSONString); // &lt;.&gt;

        // Store this hotel object in a list of hotels
        hotels.Add(
            this_hotel.Id.ToString(),
                this_hotel);

    } // end foreach result
  }


    private static void testQuerySyntaxProps()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        var this_Db = new Database("hotels") ;

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();

        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var query = QueryBuilder.Select(
                SelectResult.Property("type"),
                SelectResult.Property("name"),
                SelectResult.Property("city")).From(DataSource.Database(this_Db));

        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            // get the returned array of k-v pairs into a dictionary
            hotel = result.ToDictionary();

            // add hotel dictionary to list of hotel dictionaries
            hotels.Add(hotel);

            // use the properties of the returned array of k-v pairs directly
            thisDocsType = result.GetString("type");
            thisDocsName = result.GetString("name");
            thisDocsCity = result.GetString("city");

        }

    } // test-query-access-props



    private static void testQuerySyntaxCount()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var this_Db = new Database("hotels") ;

        var query =
          QueryBuilder
            .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount")) // &lt;.&gt;
            .From(DataSource.Database(this_Db));




        var results = query.Execute().AllResults();

        foreach (var result in results)
        {

            var numberOfDocs = result.GetInt("mycount"); // &lt;.&gt;

        }

    }




    private static void ibQueryForID()
    {

        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();


        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID).As("this_ID"))
                .From(DataSource.Database(this_Db));



        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            var thisDocsID = result.GetString("this_ID"); // &lt;.&gt;
            var doc = this_Db.GetDocument(thisDocsID);
        }

    }


    private static void testQueryPagination()
    {
      // For Documentation
      var dbName = "travel-sample";
      // var this_Db = new Database(dbName);

      var this_Db = new Database("hotels") ;

      var thisLimit = 20;
      var thisOffset = 0;

      // get a count of the number of docs matching the query
      var countQuery =
          QueryBuilder
              .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount"))
              .From(DataSource.Database(this_Db));
      var numberOfDocs =
          countQuery.Execute().AllResults().ElementAt(0).GetInt("mycount");

      if (numberOfDocs &lt; thisLimit) {
          thisLimit = numberOfDocs;
      }

      while (thisOffset &lt; numberOfDocs)
      {
          var listQuery =
              QueryBuilder
                  .Select(SelectResult.All())
                  .From(DataSource.Database(this_Db))
                  .Limit(Expression.Int(thisLimit), Expression.Int(thisOffset)); // &lt;.&gt;

          foreach (var result in listQuery.Execute().AllResults())
          {
              // Display and or process query results batch

          }

          thisOffset = thisOffset + thisLimit;

      } // end while

    }

    // JSONAPIMETHODS



        public void JsonApiDocument()
        {

            Database this_DB = new Database("travel-sample");
            Database newDb = new Database("ournewdb");

            // Get a document
            var thisDoc = this_Db.GetDocument("hotel_10025");

            // Get document data as JSON String
            var thisDocAsJsonString = thisDoc?.ToJSON(); // &lt;.&gt;

            // Get Json Object from the Json String
            JObject myJsonObj = JObject.Parse(thisDocAsJsonString);

            // Get Native Object (anhotel) from JSON String
            List&lt;Hotel&gt; thehotels = new List&lt;Hotel&gt;();

            Hotel anhotel = new Hotel();
            anhotel = JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocAsJsonString);
            thehotels.Add(anhotel);

            // Update the retrieved native object
            anhotel.Name = "A Copy of " + anhotel.Name;
            anhotel.Id = "2001";

            // Convert the updated object back to a JSON string
            var newJsonString = JsonConvert.SerializeObject(anhotel);

            // Update new document with JSOn String
            MutableDocument newhotel =
                new MutableDocument(anhotel.Id, newJsonString); // &lt;.&gt;

            foreach (string key in newhotel.ToDictionary().Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}",
                    key, newhotel.GetValue(key));
            }

            newDb.Save(newhotel);

            var thatDoc = newDb.GetDocument("2001").ToJSON(); // &lt;.&gt;
            System.Console.Write(thatDoc);



        //    JSON String = { "description":"Very good and central","id":"1000","country":"France","name":"Hotel Ted","type":"hotel","city":"Paris"}
        //             type = hotel
        //             id = 1000
        //             country = France
        //             city = Paris
        //             description = Very good and central
        //             name = Hotel Ted
        //         */

        } // End JSONAPIDocument


    public void JsonApiArray()
        {
            // Init for docs
            //var this_Db = DataStore.getDbHandle();
            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }


            Database dbNew = new Database(ourdbname);

            // JSON String -- an Array (3 elements. including embedded arrays)
            var thisJSONstring = "[{'id':'1000','type':'hotel','name':'Hotel Ted','city':'Paris','country':'France','description':'Undefined description for Hotel Ted'},{'id':'1001','type':'hotel','name':'Hotel Fred','city':'London','country':'England','description':'Undefined description for Hotel Fred'},                        {'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}]".Replace("'", "\"");

            // Get JSON Array from JSON String
            JArray myJsonObj = JArray.Parse(thisJSONstring);

            // Create mutable array using JSON String Array
            var myArray = new MutableArrayObject();
            myArray.SetJSON(thisJSONstring);  // &lt;.&gt;


            // Create a new documenty for each array element
            for (int i = 0; i &lt; myArray.Count; i)             {                 var dict = myArray.GetDictionary(i);                 var docid = myArray[i].Dictionary.GetString("id");                 var newdoc = new MutableDocument(docid, dict.ToDictionary(; <i class="conum" data-value="2"></i><b>(2)</b>
                dbNew.Save(newdoc);
            }

            // Get one of the created docs and iterate through one of the embedded arrays
            var extendedDoc = dbNew.GetDocument("1002");
            var features = extendedDoc.GetArray("features");
            <i class="conum" data-value="3"></i><b>(3)</b>
            foreach (string feature in features) {
                System.Console.Write(feature);
                //process array item as required
            }
            var featuresJSON = extendedDoc.GetArray("features").ToJSON(); <i class="conum" data-value="4"></i><b>(4)</b>

        }


        public void JsonApiDictionary()
        {

            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }
            Database dbNew = new Database(ourdbname);


            // Get dictionary from JSONstring
            var aJSONstring = "{'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDict = new MutableDictionaryObject(json: aJSONstring); <i class="conum" data-value="5"></i><b>(5)</b>

            // use dictionary to get name value
            var name = myDict.GetString("name");


            // Iterate through keys
            foreach (string key in myDict.Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}", key, myDict.GetValue(key).ToString());

            }

            /</strong>

                mono-stdout: Data -- id = 1002
                mono-stdout: Data -- type = hotel
                mono-stdout: Data -- name = Hotel Ned
                mono-stdout: Data -- city = Balmain
                mono-stdout: Data -- country = Australia
                mono-stdout: Data -- description = Undefined description for Hotel Ned
                mono-stdout: Data -- features = Couchbase.Lite.MutableArrayObject

            <strong>/
        } /</strong> end of func <strong>/


         public void JsonApiBlob()
        {
            // Init
            var ourpath = DataStore.getUserFolder();
            var ourdbname = "ournewdb";
            var userName = "ian";
            //ourpath = Path.Combine(ourpath,userName);

            if (Database.Exists(ourdbname, ourpath))
            {
                Database.Delete(ourdbname, ourpath);
            }
            var dbCfg = new DatabaseConfiguration();
            dbCfg.Directory=ourpath;
            Database dbNew = new Database(ourdbname,dbCfg);


            // Initialize base document for blob from a JSON string
            var docId = "1002";
            var aJSONstring = "{'ref':'hotel_1002','type':'hotel','name':'Hotel Ned'," +
                "'city':'Balmain','country':'Australia'," +
                "'description':'Undefined description for Hotel Ned'," +
                "'features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDoc = new MutableDocument(docId, aJSONstring); <i class="conum" data-value="6"></i><b>(6)</b>


            // Get the content (an image), create blob and add to doc)
            var defaultDirectory =
                Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;()
                            .DefaultDirectory(),
                                userName);
            var myImagePath = Path.Combine(defaultDirectory, "avatarimage.jpg");
            var myImageUri = new Uri(myImagePath.ToString());
            var myBlob = new Blob("image/jpg", myImageUri); <i class="conum" data-value="7"></i><b>(7)</b>
            myDoc.SetBlob("avatar", myBlob); <i class="conum" data-value="8"></i><b>(8)</b>


            // This example generates a 'blob not saved' exception
            try { Console.WriteLine("myBlob (unsaved) as JSON = {0}", myBlob.ToJSON());}
                catch (Exception e)
                    {Console.WriteLine("Exception = {0}", e.Message);}

            dbNew.Save(myDoc);

            // Alternatively -- depending on use case
            dbNew.SaveBlob(new Blob("image/jpg", myImageUri)); <i class="conum" data-value="9"></i><b>(9)</b>


            // Retrieve saved doc, get blob as JSON andheck its still a 'blob'
            var sameDoc = dbNew.GetDocument(docId);
            var reconstitutedBlob = new MutableDictionaryObject().
                SetDictionary("blobCOPY", new MutableDictionaryObject(sameDoc.GetBlob("avatar").ToJSON())); <i class="conum" data-value="10"></i><b>(10)</b>

            if (Blob.IsBlob(
                    reconstitutedBlob.GetDictionary("blobCOPY").ToDictionary()))  <i class="conum" data-value="11"></i><b>(11)</b>
            {
               //... process accordingly
               Console.WriteLine("Its a Blob!!");
            }

            var datavalue = "";
            foreach (string key in myDoc.Keys)
            {
                if (key == "features")
                {
                    datavalue = "features are: ";
                    foreach (string item in myDoc.GetArray(key))
                    {
                        datavalue = datavalue + ", " + item;
                    }
                }
                else if (key == "avatar")
                {
                    datavalue = sameDoc.GetBlob(key).ToJSON();
                }
                else
                {
                    datavalue = sameDoc.GetValue(key).ToString();
                }

                System.Console.WriteLine(" Data -- {0} = {1}", key, datavalue);
            }

            // System.Console.WriteLine(" reconstitutedBlob = {0}", reconstitutedBlob.GetDictionary("blobCOPY").ToJSON());



            //}

            /</strong>


                Exception = Missing Digest Due To Blob Is Not Saved To Database yet.

                Data -- id = 1002
                Data -- type = hotel
                Data -- name = Hotel Ned
                Data -- city = Balmain
                Data -- country = Australia
                Data -- description = Undefined description for Hotel Ned
                Data -- features = features are: , Cable TV, Toaster, Microwave
                Data -- avatar = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

                blobAsJSONstring = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

            <strong>/
        } /</strong> end of func <strong>/




  } // end of class



// p2p sync items


var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="12"></i><b>(12)</b>

thisConfig.Authenticator =
  new ListenerPasswordAuthenticator(
    (sender, username, password) =&gt;
      {
      return username.equals("valid.user")  &amp;&amp; (password == validPassword);
      }
  ); <i class="conum" data-value="13"></i><b>(13)</b>

_thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="14"></i><b>(14)</b>

_thisListener.Start(); <i class="conum" data-value="15"></i><b>(15)</b>




var theListenerEndpoint = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="16"></i><b>(16)</b>

var thisConfig = new ReplicatorConfiguration(thisDB, theListenerEndpoint); <i class="conum" data-value="17"></i><b>(17)</b>

thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="18"></i><b>(18)</b>

thisConfig.Authenticator =
  new BasicAuthenticator("valid.user", "valid.password.string"); <i class="conum" data-value="19"></i><b>(19)</b>

var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="20"></i><b>(20)</b>

thisReplicator.Start(); <i class="conum" data-value="21"></i><b>(21)</b>








// PASSIVE PEER STUFF
// Stuff I adapted
//
//
// p2pSync-websockets.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;
namespace api_walkthrough
{
  class Program
  {
  private static Database _Database;
  private static Replicator _Replicator;
  private static ListenerToken _thisListenerToken;
  private static bool _NeedsExtraDocs;

  #region Private Methods
  private static void GettingStarted()
  {

    // Initialize the listener config
    var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="22"></i><b>(22)</b>

    thisConfig.Port = 55990; <i class="conum" data-value="23"></i><b>(23)</b>

    thisConfig.NetworkInterface = "10.1.1.10"; <i class="conum" data-value="24"></i><b>(24)</b>

    thisConfig.EnableDeltaSync = true; <i class="conum" data-value="25"></i><b>(25)</b>

    thisConfig.DisableTLS = false; <i class="conum" data-value="26"></i><b>(26)</b>

    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="27"></i><b>(27)</b>

    // Configure the client authenticator
    // Here we are using Basic Authentication) <i class="conum" data-value="28"></i><b>(28)</b>
    SecureString validPassword =  new SecureString(); /</strong> example only <strong>/
    // Get SecureString input for validPassword
    var validUser = "valid.username";
    thisConfig.Authenticator = new ListenerPasswordAuthenticator(
      (sender, validUser, validPassword) =&gt;
        {
          return username.equals(validUser)  &amp;&amp; password == validPassword);
        }
      );

    // Initialize the listener
    _thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="29"></i><b>(29)</b>

    // Start the listener
    thisListener.Start(); <i class="conum" data-value="30"></i><b>(30)</b>

  }

  thisConfig.disableTLS = true;


  // Use “anonymous” cert. These are self signed certs created by the system
  thisConfig.TlsIdentity = null;


  thisConfig.EnableDeltaSync = true;


  int connectionCount = thisListener.Status.ConnectionCount; <i class="conum" data-value="31"></i><b>(31)</b>
  int activeConnectionCount = thisListener.Status.ActiveConnectionCount;  <i class="conum" data-value="32"></i><b>(32)</b>



  thisListener.Stop();


// Additional snippets


foreach(NetworkInterface ni in NetworkInterface.GetAllNetworkInterfaces())
{
  if(ni.NetworkInterfaceType == NetworkInterfaceType.Wireless80211 ||
      ni.NetworkInterfaceType == NetworkInterfaceType.Ethernet)
  {
    // do something with the interface(s)
  }
}



var thisConfig = new URLEndpointListenerConfiguration(thisDB);
_thisListener = new URLEndpointListener(thisConfig);

_thisListener.Start();

 Console.WriteLine("URLS are {0} ", thisListener.Urls;


    thisConfig.DisableTLS = true; <i class="conum" data-value="33"></i><b>(33)</b>


    // . . . preceding application logic . . .
    // Get the database (and create it if it doesn't exist)
    var thisDB = new Database("mydb");


    // Use CA Cert
    // Create a TLSIdentity from an imported key-pair
    // . . . previously declared variables include ...
    TLSIdentity thisIdentity;
    X509Store _store =
      new X509Store(StoreName.My); // create and label x509 store

    // Get keys and certificates from PKCS12 data
    byte[] thisIdData =
      File.ReadAllBytes("c:client.p12"); <i class="conum" data-value="34"></i><b>(34)</b>
    // . . . other user code . . .

    thisIdentity = TLSIdentity.ImportIdentity(
      _store,
      thisIdData, <i class="conum" data-value="35"></i><b>(35)</b>
      "123", // Password to access certificate data
      "couchbase-demo-cert",
      null); // Label to get cert in certificate map
        // NOTE: If a null label is supplied then the same
        // default directory for a Couchbase Lite database
        // is used for map.


    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="36"></i><b>(36)</b>

    // Set the TLS Identity
    thisConfig.TlsIdentity = thisIdentity; <i class="conum" data-value="37"></i><b>(37)</b>


    // Configure the client authenticator
    // to validate using ROOT CA

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="38"></i><b>(38)</b>
    var clientData = File.ReadAllBytes("c:client.p12");
    var ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData); <i class="conum" data-value="39"></i><b>(39)</b>

    // Configure the authenticator to use the root certs
    var thisAuth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(thisRootCert));

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="40"></i><b>(40)</b>

    // Initialize the listener using the config
    _listener = new URLEndpointListener(thisConfig);

    // Configure the client authenticator
    // to validate using application logic

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="41"></i><b>(41)</b>
    clientData = File.ReadAllBytes("c:client.p12");
    ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData);

    // Configure the authenticator to pass the root certs
    // To a user supplied code block for authentication
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert) =&gt; {
          // . . . user supplied code block
          // . . . returns boolean value (true=authenticated)
        }); <i class="conum" data-value="42"></i><b>(42)</b>

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="43"></i><b>(43)</b>




// END Additional






// Listener Callouts


  &lt;.&gt; Initialize the listener instance using the configuration settings.
  &lt;.&gt; Start the listener, ready to accept connections and incoming data from active peers.



  &lt;.&gt; <code>connectionCount</code> -- the total number of connections served by the listener
  &lt;.&gt; <code>activeConnectionCount</code> -- the number of active (BUSY) connections currently being served by the listener
  //

  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; PKCS12 data containing private key, public key, and certificates
  &lt;.&gt; The key pair as stored in the byte array
  &lt;.&gt; The password required to access the certificate data
  &lt;.&gt; The key label assigned to the cert in certificate map and used for retrieval
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>


  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; When creating a certificate, the common name attribute is required to create a CSR. If the common name is not present in the certificate an exception is thrown.
  &lt;.&gt; If the expiration date is not specified, the expiration date of the certificate is 365 days after creation
  &lt;.&gt; The key label to get cert in certificate map
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>










  // cert is a pre-populated object of type:SecCertificate representing a certificate
  // Work in progress. Code snippet to be provided.



  // prev content of listener-config-client-auth-self-signed (for ios)
  thisConfig.authenticator = ListenerCertificateAuthenticator.init {
    (cert) -&gt; Bool in
    var cert:SecCertificate
    var certCommonName:CFString?
    let status=SecCertificateCopyCommonName(cert, &amp;certCommonName)
    if (self._allowlistedUsers.contains(["name": certCommonName! as String])) {
      return true
    }
    return false
  }
  // Work in progress. Code snippet to be provided.


public class URLEndpointListener {
    // Properties <i class="conum" data-value="1"></i><b>(1)</b>
    public let config: URLEndpointListenerConfiguration
    public let port UInt16?
    public let tlsIdentity: TLSIdentity?
    public let urls: Array&lt;URL&gt;?
    public let status: ConnectionStatus?
    // Constructors <i class="conum" data-value="2"></i><b>(2)</b>
    public init(config: URLEndpointListenerConfiguration)
    // Methods <i class="conum" data-value="3"></i><b>(3)</b>
    public func start() throws
    public func stop()
}


let config = URLEndpointListenerConfiguration.init(database: self.oDB)
thisConfig.port = tls ? wssPort : wsPort
thisConfig.disableTLS = !tls
thisConfig.authenticator = auth
self.listener = URLEndpointListener.init(config: config) <i class="conum" data-value="1"></i><b>(1)</b>


// ACTIVE PEER STUFF
// Replication code
//
// Copyright (c) 2019 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

public class Examples {
  private static final String TAG = "EXAMPLE ACTIVE PEER";
  private static final String thisDBNAME = "local-database";
  private final Context context;
  // private Database database;
  // private Replicator replicator;

  public Examples(Context context) { this.context = context; }

  String user = "syncuser";
  String password = "sync9455";
  SecCertificate cert=null;
  String passivePeerEndpoint = "10.1.1.12:8920";
  String passivePeerPort = "8920";
  String passiveDbName = "userdb";
  Database thisDB;
  Replicator thisReplicator;
  ListenerToken replicatorListener;

  //@Test
  public void testActPeerSync() throws CouchbaseLiteException, URISyntaxException {
    // . . . preceding code. for example . . .
    private static ListenerToken _thisListenerToken;
    var Database thisDB;
    // . . . other code . . .
    // initialize the replicator configuration

    var thisUrl = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="44"></i><b>(44)</b>
    var config = new ReplicatorConfiguration(thisDB, thisUrl);


    // Set replicator type
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

    // Set autopurge option
    // here we override its default
    thisConfig.EnableAutoPurge = false; <i class="conum" data-value="45"></i><b>(45)</b>

    // Configure Sync Mode
    thisConfig.Continuous = true; // default value

    // Configure Server Security -- only accept self-signed certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="46"></i><b>(46)</b>

    // Configure Client Security <i class="conum" data-value="47"></i><b>(47)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");

    /</strong> Optionally set a conflict resolver call back <strong>/ <i class="conum" data-value="48"></i><b>(48)</b>
    // Use built-in resolver
    thisConfig.ConflictResolver = new LocalWinConflictResolver();  //

    // optionally use custom resolver
    thisConfig.ConflictResolver = new ConflictResolver(
      (conflict) =&gt; {
        /</strong> define resolver function */
      }
    ); //

    // Initialize and start a replicator
    // Initialize replicator with configuration data
    var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="49"></i><b>(49)</b>

    //Optionally add a change listener <i class="conum" data-value="50"></i><b>(50)</b>
    _thisListenerToken =
      thisReplicator.AddChangeListenersender, args) =&gt;         {           if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {               Console.WriteLine("Replication stopped");           }         });      // Start replicator     thisReplicator.Start(); <i class="conum" data-value="51"></i><b>(51)</b>  }  // Additional snippets      // Configure Server Security -- only accept CA certs     thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="52"></i><b>(52)</b>       // Return the remote pinned cert (the listener's cert)     byte returnedCert = new byte(thisConfig.getPinnedCertificate(; // Get listener cert if pinned
    // Configure Client Security <i class="conum" data-value="53"></i><b>(53)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");


    // Only CA Certs accepted
    thisConfig.AcceptOnlySelfSignedServerCertificate =
      false; <i class="conum" data-value="54"></i><b>(54)</b>

    var thisCert =
      new X509Certificate2(caData); <i class="conum" data-value="55"></i><b>(55)</b>

    thisConfig.PinnedServerCertificate =
      thisCert; <i class="conum" data-value="56"></i><b>(56)</b>













    // Code to refactor
    Log.i(TAG, "The Replicator is currently " + thisReplicator.Status().getActivityLevel());

    Log.i(TAG, "The Replicator has processed " + t);

    if (thisReplicator.Status().getActivityLevel() == Replicator.ActivityLevel.BUSY) {
          Log.i(TAG, "Replication Processing");
          Log.i(TAG, "It has completed " + thisReplicator.Status().getProgess().getTotal() + " changes");
      }
    _thisReplicator.Stop();
    while (_thisReplicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
        // Database cannot close until replicators are stopped
        Console.WriteLine($"Waiting for replicator to stop (currently {_thisReplicator.Status.Activity})...");
        Thread.Sleep(200);
    }
    _thisDatabase.Close();

      // Stop replication.
      thisReplicator.Stop(); <i class="conum" data-value="57"></i><b>(57)</b>


  }

{
  CouchbaseLite.init(context);
  Database thisDB = new Database("passivepeerdb");  <i class="conum" data-value="58"></i><b>(58)</b>
  // Initialize the listener config
  final URLEndpointListenerConfiguration thisConfig = new URLEndpointListenerConfiguration(database);
  thisConfig.Port(55990)             // &lt;.&gt; Default- port is selected
  thisConfig.DisableTls(false)       // &lt;.&gt; Optional. Defaults to false. You get TLS encryption out-of-box
  thisConfig.EnableDeltaSync(true)   // &lt;.&gt; Optional. Defaults to false.

  // Configure the client authenticator (if using basic auth)
  ListenerPasswordAuthenticator auth = new ListenerPasswordAuthenticator { "Our Username", "Our Password"}; <i class="conum" data-value="59"></i><b>(59)</b>
  thisConfig.Authenticator(auth); <i class="conum" data-value="60"></i><b>(60)</b>

  // Initialize the listener
  final URLEndpointListener listener = new URLEndpointListener( thisConfig ); <i class="conum" data-value="61"></i><b>(61)</b>

  // Start the listener
  listener.Start(); <i class="conum" data-value="62"></i><b>(62)</b>
    }



Map&lt;String, String&gt; X509_ATTRIBUTES = mapOf(
           TLSIdentity.CERT_ATTRIBUTE_COMMON_NAME to "Couchbase Demo",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION to "Couchbase",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION_UNIT to "Mobile",
           TLSIdentity.CERT_ATTRIBUTE_EMAIL_ADDRESS to "<a href="mailto:noreply@couchbase.com">noreply@couchbase.com</a>"
       )

TLSIdentity thisIdentity = new TLSIdentity.createIdentity(true, X509_ATTRIBUTES, null, "test-alias");



. . . work in progress - GetHashCode snippet to be provided

TLSIdentity.DeleteIdentity(_store, "alias-to-delete", null);


// OPTIONALLY:: Retrieve a stored TLS identity using its alias/label

TLSIdentity thisIdentity = new TLSIdentity.getIdentity("CBL-Demo-Server-Cert")


    // Configure the client authenticator (if using Basic Authentication)
    // String validUser = new String("validUsername"); // an example username
    // String validPassword = new String("validPasswordValue"); // an example password

    // ListenerPasswordAuthenticator thisAuth = new ListenerPasswordAuthenticator( <i class="conum" data-value="63"></i><b>(63)</b>
    //   validUser, validPassword -&gt; validUser == "validUsername" &amp;&amp; validPassword == "validPasswordValue" );

    // if (thisAuth) {
    //   thisConfig.Authenticator(auth);
    // }
    // else {
    //   // . . . authentication failed take appropriate exception action
    //   return
    // };




    ListenerToken thisListener = new thisReplicator.addChangeListener(change -&gt; { <i class="conum" data-value="64"></i><b>(64)</b>
      if (change.Status().getError() != null) {
        Log.i(TAG, "Error code ::  " + change.Status().getError().getCode());
      }
    });




// g u b b i n s


    // Configure TLS Cert CA auth using key-stored cert id alias 'doc-sync-server'

    // TLSIdentity thisIdentity = new TLSIdentity.getIdentity("doc-sync-server"); // Get existing TLS ID from sec storage

    // ClientCertificateAuthenticator thisAuth = new ClientCertificateAuthenticator(thisIdentity);

    // thisConfig.Authenticator(thisAuth);



    // USE KEYCHAIN IDENTITY IF EXISTS
    // Check if Id exists in keychain. If so use that Id

    // STILL NEED TO REFACTOR

    do {
      if let thisIdentity = try TLSIdentity.identity(withLabel: "doco-sync-server") {
          print("An identity with label : doco-sync-server already exists in keychain")
          return thisIdentity
          }
    } catch
    {return nil}
    thisAuthenticator.ClientCertificateAuthenticator(identity: thisIdentity )
    thisConfig.thisAuthenticator




String thisAlias = "alias-to-delete";
KeyStore thisKeystore = KeyStore.getInstance("PKCS12"); <i class="conum" data-value="65"></i><b>(65)</b>
thisKeyStore.load= null;
if (thisAlias != null) {
   thisKeystore.deleteEntry(thisAlias);  <i class="conum" data-value="66"></i><b>(66)</b>
}



// cert auth
let rootCertData = SecCertificateCopyData(cert) as Data
let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])

SecCertificate thisCert = new SecCertificate(); // populated as nec.

Data rootCertData = new Data(SecCertificateCopyData(thisCert));

let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])
// cert auth


// C A L L O U T S

&lt;.&gt; Configure to accept only CA certs
&lt;.&gt; Configure the pinned certificate using data from the byte array <code>cert</code>
&lt;.&gt; Set the certificate to be compared with that provided by the server

&lt;.&gt; PKCS12 data containing private key, public key, and certificates
&lt;.&gt; This is the default value and means that TLS is enabled

&lt;.&gt; Refuse self-signed certificates
&lt;.&gt; Get the identity
&lt;.&gt; Set the Client Certificate Authenticator to require signed certificates with this identity



    // Configure the client authenticator
    // to validate using ROOT CA <i class="conum" data-value="67"></i><b>(67)</b>
    byte[] thisCaData; // byte array for CA data
    using (var thisReader = new BinaryReader(stream)) {
      thisCaData = thisReader.ReadBytes(int stream.Length);
    }; // Get cert data

    var thisRootCert = new X509Certificate(thisCaData); //

    thisConfig.Authenticator = new  ListenerCertificateAuthenticator(
      new X509Certificate2Collection(thisRootCert)
    );




    var db = new Database("other-database");
    _Database = db;
    X509Store _store = new X509Store(StoreName.My);
    TLSIdentity thisIdentity;


    // Configure the expected server-supplied
    // credentials -- only accept CA Certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="68"></i><b>(68)</b>

    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="69"></i><b>(69)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="70"></i><b>(70)</b>






    byte[] thisCaData, thisClientData;
    thisClientData = File.ReadAllBytes("C:\\client.p12"); <i class="conum" data-value="71"></i><b>(71)</b>
    thisCaData = File.ReadAllBytes("C:\\client-ca.der");

    // Root certs
    var thisRootCert = new X509Certificate2(thisCaData);
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert));

    // Create URL Endpoint Listener
    var thisConfig = new URLEndpointListenerConfiguration(_Database);
    thisConfig.DisableTLS = false; <i class="conum" data-value="72"></i><b>(72)</b>
    thisConfig.Authenticator = thisAuth;
    _listener = new URLEndpointListener(thisConfig);
    _listener.Start();

    // Client identity
    thisIdentity = TLSIdentity.ImportIdentity(_store,
        thisClientData,
        "123",
        "CBL-Client-Cert",
        null);

    // Replicator -- Client
    var database = new Database("client-database");
    var builder = new UriBuilder(
        "wss",
        "localhost",
        _listener.Port,
        $"/{_listener.thisConfig.Database.Name}"
    );

    var url = builder.Uri;
    var target = new URLEndpoint(url);
    var thisConfig = new ReplicatorConfiguration(database, target);
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;
    thisConfig.Continuous = false;
    thisConfig.Authenticator = new ClientCertificateAuthenticator(thisIdentity);
    thisConfig.AcceptOnlySelfSignedServerCertificate = true;
    thisConfig.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
    using (var replicator = new Replicator(thisConfig)) {
        replicator.Start();
    }





    // Stop listener after replicator is stopped
    _listener.Stop();



    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="73"></i><b>(73)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="74"></i><b>(74)</b>



  // For replications

  // BEGIN -- snippets --
  //    Purpose -- code samples for use in replication topic

  public class MyClass
  {
      public Database Database { get; set; }
      public Replicator Replicator { get; set; } <i class="conum" data-value="75"></i><b>(75)</b>

      public void StartReplication()
      {
  }

          var url = new Uri("wss://localhost:4984/db"); <i class="conum" data-value="76"></i><b>(76)</b>
          var target = new URLEndpoint(url);
          var config = new ReplicatorConfiguration(Database, target)
          {
              ReplicatorType = ReplicatorType.Pull
          };

          Replicator = new Replicator(config);
          Replicator.Start();
      }

      // &lt;.&gt; A replication is an asynchronous operation.
      // To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
      // &lt;.&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
      // You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.

      public void InitReplication()
      {
        // initialize the replicator configuration

        var thisUrl = new URLEndpoint("wss://l10.0.2.2:4984/anotherDB"); <i class="conum" data-value="77"></i><b>(77)</b>
        var config = new ReplicatorConfiguration(thisDB, thisUrl);

      }
  }
 }



  public class supporting_datatypes
  {
      public void datatype_dictionary()
      {
          var database = new Database(name: "mydb");

          // NOTE: No error handling, for brevity (see getting started)
          var document = database.GetDocument("doc1");

          // Getting a dictionary from the document's properties
          var dict = document.GetDictionary("address");

          // Access a value with a key from the dictionary
          var street = dict.GetString("street");

          // Iterate dictionary
          foreach (var key in dict.Keys)
          {
              Console.WriteLine($"Key {key} = {dict.GetValue(key)}");
          }

          // Create a mutable copy
          var mutDict = dict.ToMutable();
      }

      public void datatype_mutable_dictionary()
      {

          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable dictionary and populate some keys/values
          var mutable_dict = new MutableDictionaryObject();
          mutable_dict.SetString("street", "1 Main st.");
          mutable_dict.SetString("city", "San Francisco");

          // Add the dictionary to a document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetDictionary("address", mutable_dict);
          database.Save(doc);

      }


      public void datatype_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          var document = database.GetDocument("doc1");

          // Getting a phones array from the document's properties
          var array = document.GetArray("phones");

          // Get element count
          var count = array.Count();

          // Access an array element by index
          if (count &gt;= 0) { var phone = array[1]; }

          // Iterate dictionary
          for (int i = 0; i &lt; count; i++)
          {
              Console.WriteLine($"Item {i.ToString()} = {array[i]}");
          }

          // Create a mutable copy
          var mutable_array = array.ToMutable();


      }

        public void datatype_mutable_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable array and populate data into the array
          var mutable_array = new MutableArrayObject();
          mutable_array.AddString("650-000-0000");
          mutable_array.AddString("650-000-0001");

          // Set the array to document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetArray("phones", mutable_array);
          database.Save(doc);
      }

  } // end  class supporting_datatypes</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Populate your hotel document</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">//
// Program.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;

namespace api_walkthrough
{
    class Program
    {
        private static Database _Database;
        private static Replicator _Replicator;
        private static URLEndpointListener _listener;
        private static ListenerToken _ListenerToken;
        private static bool _NeedsExtraDocs;

        <mark>region Private Methods

        private static void GettingStarted()
        {

            // using System;
            // using Couchbase.Lite;
            // using Couchbase.Lite.Query;
            // using Couchbase.Lite.Sync;

            // Get the database (and create it if it doesn't exist)
            var database = new Database("mydb");
            // Create a new document (i.e. a record) in the database
            string id = null;
            using (var mutableDoc = new MutableDocument())
            {
                mutableDoc.SetFloat("version", 2.0f)
                    .SetString("type", "SDK");

                // Save it to the database
                database.Save(mutableDoc);
                id = mutableDoc.Id;
            }

            // Update a document
            using (var doc = database.GetDocument(id))
            using (var mutableDoc = doc.ToMutable())
            {
                mutableDoc.SetString("language", "C</mark>");
                database.Save(mutableDoc);

                using (var docAgain = database.GetDocument(id))
                {
                    Console.WriteLine($"Document ID :: {docAgain.Id}");
                    Console.WriteLine($"Learning {docAgain.GetString("language")}");
                }
            }

            // Create a query to fetch documents of type SDK
            // i.e. SELECT * FROM database WHERE type = "SDK"
            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(database))
                .Where(Expression.Property("type").EqualTo(Expression.String("SDK"))))
            {
                // Run the query
                var result = query.Execute();
                Console.WriteLine($"Number of rows :: {result.AllResults().Count}");
            }

            // Create replicator to push and pull changes to and from the cloud
            var targetEndpoint = new URLEndpoint(new Uri("ws://localhost:4984/getting-started-db"));
            var replConfig = new ReplicatorConfiguration(database, targetEndpoint);

            // Add authentication
            replConfig.Authenticator = new BasicAuthenticator("john", "pass");

            // Create replicator (make sure to add an instance or static variable
            // named _Replicator)
            var _Replicator = new Replicator(replConfig);
            _Replicator.AddChangeListenersender, args) =&gt;             {                 if (args.Status.Error != null)                 {                     Console.WriteLine($"Error :: {args.Status.Error}");                 }             });              _Replicator.Start();              // Later, stop and dispose the replicator <strong>before</strong> closing/disposing the         }            private static void TestReplicatorConflictResolver()         {             var target = new URLEndpoint(new Uri("ws://localhost:4984/mydatabase";
            var replConfig = new ReplicatorConfiguration(database, target);
            replConfig.ConflictResolver = new LocalWinConflictResolver();

            var replicator = new Replicator(replConfig);
            replicator.Start();
        }

        private static void TestSaveWithConflictHandler()
        {
            using (var document = database.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                database.Save(mutableDocument, (updated, current) =&gt;
                {
                    var currentDict = current.ToDictionary();
                    var newDict = updated.ToDictionary();
                    var result = newDict.Concat(currentDict)
                        .GroupBy(kv =&gt; kv.Key)
                        .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
                    updated.SetData(result);
                    return true;
                });
            }
        }

        private static bool IsValidCredential(string name, SecureString password) { return true;  } // helper
        private static void TestInitListener()
        {
            var db = new Database("other-database");
            _Database = db;

            var config = new URLEndpointListenerConfiguration(_Database);
            config.TlsIdentity = null; // Use with anonymous self-signed cert
            config.Authenticator = new ListenerPasswordAuthenticatorsender, username, password) =&gt;             {                 if(IsValidCredential(username, password {
                    return true;
                }

                return false;
            });

            _listener = new URLEndpointListener(config);
        }

        private static void TestListenerStart()
        {
            // CouchbaseLiteException will be thrown when the listener cannot be started. The most common error
            // would be that the configured port has already been used.
            _listener.Start();
        }

        private static void TestListenerStop()
        {
            _listener.Stop();
        }

        private static void TestCreateSelfSignedCert()
        {
            TLSIdentity identity;
            X509Store _store =
             new X509Store(StoreName.My);
              // The identity will be stored in the secure
              // storage using the given label.
            DateTimeOffset fiveMinToExpireCert = DateTimeOffset.UtcNow.AddMinutes(5);

            identity = TLSIdentity.CreateIdentity(true, /* isServer <strong>/
                new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "Couchbase Inc" } },
                    // The common name attribute is required
                    // when creating a CSR. If it is not presented
                    // in the cert, an exception is thrown.
                fiveMinToExpireCert,
                    // If the expiration date is not specified,
                    // the certs expiration will be 365 days
                _store,
                "CBL-Server-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.

        }

        private static void TestImportTLSIdentity()
        {
            TLSIdentity identity;
            X509Store _store = new X509Store(StoreName.My); // The identity will be stored in the secure storage using the given label
            byte[] data = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates

            identity = TLSIdentity.ImportIdentity(_store,
                data,
                "123", // The password that is needed to access the certificate data
                "CBL-Client-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.
        }

          private static void TestClientCertAuthenticatorRootCerts()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;

            byte[] caData, clientData;
            clientData = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates
            caData = File.ReadAllBytes("C:\\client-ca.der");

            // Root certs
            var rootCert = new X509Certificate2(caData);
            var auth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(rootCert));

            // Create URL Endpoint Listener
            var listenerConfig = new URLEndpointListenerConfiguration(_Database);
            listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.
            listenerConfig.Authenticator = auth;
            _listener = new URLEndpointListener(listenerConfig);
            _listener.Start();

            // Client identity
            identity = TLSIdentity.ImportIdentity(_store,
                clientData,
                "123",
                "CBL-Client-Cert",
                null);

            // Replicator -- Client
            var database = new Database("client-database");
            var builder = new UriBuilder(
                "wss",
                "localhost",
                _listener.Port,
                $"/{_listener.Config.Database.Name}"
            );

            var url = builder.Uri;
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.ReplicatorType = ReplicatorType.PushAndPull;
            config.Continuous = false;
            config.Authenticator = new ClientCertificateAuthenticator(identity);
            config.AcceptOnlySelfSignedServerCertificate = true;
            config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
            using (var replicator = new Replicator(config)) {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
            // end::client-cert-authenticator-root-cert
        }

        private static void TestClientCertAuthenticator()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;


            // Create Listener Certificate Authenticator
            var auth = new ListenerCertificateAuthenticatorsender, cert) =&gt;             {                 if (cert.Count != 1) {                     return false;                 }                  return cert[0].SubjectName.Name?.Replace("CN=", "") == "couchbase";             });              // Create URL Endpoint Listener             var listenerConfig = new URLEndpointListenerConfiguration(_Database);             listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.             listenerConfig.Authenticator = auth;             _listener = new URLEndpointListener(listenerConfig);             _listener.Start();              // User Identity             identity = TLSIdentity.CreateIdentity(false,                 new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "couchbase" } },                 null,                 _store,                 ClientCertLabel,                 null);              // Replicator -- Client             var database = new Database("client-database");             var builder = new UriBuilder(                 "wss",                 "localhost",                 _listener.Port,                 $"/{_listener.Config.Database.Name}"             );              var url = builder.Uri;             var target = new URLEndpoint(url);             var config = new ReplicatorConfiguration(database, target);             config.ReplicatorType = ReplicatorType.PushAndPull;             config.Continuous = false;             config.Authenticator = new ClientCertificateAuthenticator(identity);             config.AcceptOnlySelfSignedServerCertificate = false;             config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];             using (var replicator = new Replicator(config {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
        }

        private static void UseEncryption()
        {
            // Enterprise edition only

            // Create a new, or open an existing database with encryption enabled
            var config = new DatabaseConfiguration
            {
                // Or, derive a key yourself and pass a byte array of the proper size
                EncryptionKey = new EncryptionKey("password")
            };

            using (var db = new Database("seekrit", config)) {
                // Change the encryption key (or add encryption if the DB is unencrypted)
                db.ChangeEncryptionKey(new EncryptionKey("betterpassw0rd"));

                // Remove encryption
                db.ChangeEncryptionKey(null);
            }
        }

        private static void ResetReplicatorCheckpoint()
        {
            var database = _Database;
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            using (var replicator = new Replicator(config)) {
              // replicator is a Replicator instance
              if (resetCheckpointRequired_Example) {
                  replicator.Start(true); <i class="conum" data-value="1"></i><b>(1)</b>
              else
                replicator.Start(false);
              }




            }
        }

        private static void Read1xAttachment()
        {
            var db = _Database;
            using (var document = new MutableDocument()) {
                var attachments = document.GetDictionary("_attachments");
                var avatar = attachments.GetBlob("avatar");
                var content = avatar?.Content;
            }
        }

        private static void CreateNewDatabase()
        {
            var db = new Database("my-database");

            _Database = db;
        }

        private static void CloseDatabase()
        {
          database.close()

        }

        private static void ChangeLogging()
        {
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Query, LogLevel.Verbose);
        }

        private static void LoadPrebuilt()
        {
            // Note: Getting the path to a database is platform-specific.  For .NET Core / .NET Framework this
            // can be a simple filesystem path.  For UWP, you will need to get the path from your assets.  For
            // iOS you need to get the path from the main bundle.  For Android you need to extract it from your
            // assets to a temporary directory and then pass that path.
            var path = Path.Combine(Environment.CurrentDirectory, "travel-sample.cblite2" + Path.DirectorySeparatorChar);
            if (!Database.Exists("travel-sample", null)) {
                _NeedsExtraDocs = true;
                Database.Copy(path, "travel-sample", null);
            }

            _Database.Close();
            _Database = new Database("travel-sample");
        }

        private static void QueryDeletedDocuments()
        {
            // Query documents that have been deleted
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.IsDeleted);
        }

        private static void CreateDocument()
        {
            var db = _Database;
            using (var newTask = new MutableDocument("xyz")) {
                newTask.SetString("type", "task")
                    .SetString("owner", "todo")
                    .SetDate("createdAt", DateTimeOffset.UtcNow);

                db.Save(newTask);
            }
        }

        private static void UpdateDocument()
        {
            var db = _Database;
            using(var document = db.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                db.Save(mutableDocument);
            }
        }

        private static void UseTypedAccessors()
        {
            using (var newTask = new MutableDocument()) {
                newTask.SetValue("createdAt", DateTimeOffset.UtcNow);
                var date = newTask.GetDate("createdAt");

                Console.WriteLine(date);
            }
        }

        private static void DoBatchOperation()
        {
            var db = _Database;
            db.InBatch) =&gt;             {                 for (var i = 0; i &lt; 10; i) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "user");
                        doc.SetString("name", $"user {i}");
                        doc.SetBoolean("admin", false);
                        db.Save(doc);
                        Console.WriteLine($"Saved user document {doc.GetString("name")}");
                    }
                }
            });
        }

        private static void DatabaseChangeListener()
        {
            var db = _Database;

            db.AddDocumentChangeListener("user.john", (sender, args) =&gt;
            {
                using (var doc = Db.GetDocument(args.DocumentID)) {
                    Console.WriteLine($"Status :: {doc.GetString("verified_account")}");
                }
            });
        }

        private static void DocumentExpiration()
        {
            var db = _Database;

            // Purge the document one day from now
            var ttl = DateTimeOffset.UtcNow.AddDays(1);
            db.SetDocumentExpiration("doc123", ttl);

            // Reset expiration
            db.SetDocumentExpiration("doc1", null);

            // Query documents that will be expired in less than five minutes
            var fiveMinutesFromNow = DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeMilliseconds();
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.Expiration.LessThan(Expression.Double(fiveMinutesFromNow)));
        }

        private static void UseBlob()
        {
            var db = _Database;
            using (var newTask = new MutableDocument()) {
                // Note: Reading the data is implementation dependent, as with prebuilt databases
                var image = File.ReadAllBytes("avatar.jpg"); // &lt;.&gt;
                var blob = new Blob("image/jpeg", image); // &lt;.&gt;
                 newTask.SetBlob("avatar", blob); // &lt;.&gt;
                db.Save(newTask);

                var taskBlob = newTask.GetBlob("avatar");
                using (var bitmap = SKBitmap.Decode(taskBlob.ContentStream)) {
                    Console.WriteLine($"Bitmap dimensions: {bitmap.Width} x {bitmap.Height} ({bitmap.BytesPerPixel} bytes per pixel)");
                }
            }
        }

        public void CreateIndex()
        {
            var db = _database;
            string[] indexProperties = new string[] {"type", "name" };
            var config = new ValueIndexConfiguration(indexProperties);
            db.CreateIndex("TypeNameIndex", config);
        }

        public void CreateIndex_Querybuilder()
        {
            // For value types, this is optional but provides performance enhancements
            var db = _database;
            var index = IndexBuilder.ValueIndex(
                ValueIndexItem.Expression(Expression.Property("type")),
                ValueIndexItem.Expression(Expression.Property("name"))); // &lt;.&gt;
            db.CreateIndex("TypeNameIndex", index);
        }
        private static void SelectMeta()
        {
            Console.WriteLine("Select Meta");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("type"),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document ID :: {result.GetString("id")}");
                    Console.WriteLine($"Document Name :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectAll()
        {
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))) {
                // All user properties will be available here
            }

            var query = QueryBuilder
                .Select(SelectResult.All())
                .From(DataSource.Database(db)); // &lt;.&gt;

            // Adds a query change listener.
            // Changes will be posted on the main queue.
            var token = query.AddChangeListener((sender, args) =&gt; // &lt;.&gt;
            {
                var allResult = args.Results.AllResults();
                foreach (var result in allResult) {
                    Console.WriteLine(result.Keys);
                    /* Update UI */
                }
            });


            query.RemoveChangeListener(token);
            query.Dispose();
        }

        private static void SelectWhere()
        {
            Console.WriteLine("Where");
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    var dict = result.GetDictionary(db.Name);
                    Console.WriteLine($"Document Name :: {dict?.GetString("name")}");
                }
            }
        }

        private static void UseCollectionContains()
        {
            Console.WriteLine("Collection Operator CONTAINS");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"),
                    SelectResult.Property("public_likes"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel"))
                    .And(ArrayFunction.Contains(Expression.Property("public_likes"),
                        Expression.String("Armani Langworth"))))) {
                foreach (var result in query.Execute()) {
                    var publicLikes = result.GetArray("public_likes");
                    var jsonString = JsonConvert.SerializeObject(publicLikes);
                    Console.WriteLine($"Public Likes :: {jsonString}");
                }
            }
        }

        private static void UseCollectionIn()
        {
            Console.WriteLine("Collection Operator IN");
            var db = _Database;

            var values = new IExpression[]
                { Expression.Property("first"), Expression.Property("last"), Expression.Property("username") };

            using (var query = QueryBuilder.Select(
                    SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.String("Armani").In(values))) {
                foreach (var result in query.Execute()) {
                    var body = result.GetDictionary(0);
                    var jsonString = JsonConvert.SerializeObject(body);
                    Console.WriteLine($"In results :: {jsonString}");
                }
            }
        }

        private static void SelectLike()
        {
            Console.WriteLine("Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Royal Engineers Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardLike()
        {
            Console.WriteLine("Wildcard Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Eng%e%"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardCharacterLike()
        {
            Console.WriteLine("Wildchard Characters");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Like(Expression.String("Royal Eng____rs Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectRegex()
        {
            Console.WriteLine("Regex");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Regex(Expression.String("\\bEng.*e\\b"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectJoin()
        {
            Console.WriteLine("Join");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Expression.Property("name").From("airline")),
                    SelectResult.Expression(Expression.Property("callsign").From("airline")),
                    SelectResult.Expression(Expression.Property("destinationairport").From("route")),
                    SelectResult.Expression(Expression.Property("stops").From("route")),
                    SelectResult.Expression(Expression.Property("airline").From("route")))
                .From(DataSource.Database(db).As("airline"))
                .Join(Join.InnerJoin(DataSource.Database(db).As("route"))
                    .On(Meta.ID.From("airline").EqualTo(Expression.Property("airlineid").From("route"))))
                .Where(Expression.Property("type").From("route").EqualTo(Expression.String("route"))
                    .And(Expression.Property("type").From("airline").EqualTo(Expression.String("airline")))
                    .And(Expression.Property("sourceairport").From("route").EqualTo(Expression.String("RIX"))))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void GroupBy()
        {
            Console.WriteLine("GroupBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Function.Count(Expression.All())),
                    SelectResult.Property("country"),
                    SelectResult.Property("tz"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("airport"))
                    .And(Expression.Property("geo.alt").GreaterThanOrEqualTo(Expression.Int(300))))
                .GroupBy(Expression.Property("country"), Expression.Property("tz"))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine(
                        $"There are {result.GetInt("$1")} airports in the {result.GetString("tz")} timezone located in {result.GetString("country")} and above 300 ft");
                }
            }
        }

        private static void OrderBy()
        {
            Console.WriteLine("OrderBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("title"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .OrderBy(Ordering.Property("title").Ascending())
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Title :: {result.GetString("title")}");
                }
            }
        }

      // ### EXPLAIN statement
      private static void TestExplainStatement()
      // For Documentation
      {
        var db = _Database;
        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
            .GroupBy(Expression.Property("country"))
            .OrderBy(Ordering.Property("title").Ascending()) // &lt;.&gt;

          Console.WriteLine(query.Explain()); // &lt;.&gt;

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("%hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;
  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Function.Lower(Expression.Property("type")).EqualTo(Expression.String("hotel"))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type")).EqualTo(Expression.String("hotel")); // &lt;.&gt;

          Console.WriteLine(query.Explain());

      }

      // end query-explain


        public void CreateFullTextIndex()
        {
            string[] indexProperties = new string[] { "overview", "name" };
            var config = new FullTextIndexConfiguration(indexProperties);
            db.CreateIndex("overviewFTSIndex", config);
        }

        public void FullTextSearch()
        {
            Console.WriteLine("Full text search");

            var db = _database;
            var ftsQuery = db.CreateQuery("SELECT * FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)");
            foreach (var result in ftsQuery.Execute())
            {
                Console.WriteLine($"Document id {result.GetString(0)}");
            }
            }
        }


        private static void CreateFullTextIndex_Querybuilder()
        {
            var db = _Database;

            if (_NeedsExtraDocs) {
                var tasks = new[] { "buy groceries", "play chess", "book travels", "buy museum tickets" };
                foreach (var task in tasks) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "task");
                        doc.SetString("name", task);
                        db.Save(doc);
                    }
                }
            }


            var index = IndexBuilder.FullTextIndex(FullTextIndexItem.Property("overview")).IgnoreAccents(false);
            db.CreateIndex("overviewFTSIndex", index);
        }

        private static void FullTextSearch_Querybuilder()
        {
            Console.WriteLine("Full text search");
            var db = _Database;

            var whereClause = FullTextFunction.Match("overviewFTSIndex", "'michigan'");

            using (var query = QueryBuilder.Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(whereClause)) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document id {result.GetString(0)}");
                }
            }
        }
        private static void StartReplication()
        {
            var db = _Database;

            /*
             * This requires Sync Gateway running with the following config, or equivalent:
             *
             * {
             *     "log":["*"],
             *     "databases": {
             *         "db": {
             *             "server":"walrus:",
             *             "users": {
             *                 "GUEST": {"disabled": false, "admin_channels": ["*"] }
             *             }
             *         }
             *     }
             * }
             */

            // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(db, target)
            {
                ReplicatorType = ReplicatorType.Pull
            };

            var replicator = new Replicator(config);
            replicator.Start();

            _Replicator = replicator;
        }

        private static void VerboseReplicatorLogging()
        {
            // deprecated
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Network, LogLevel.Verbose);
        }

        private static void ConsoleLogging()
        {
            Database.Log.Console.Domains = LogDomain.All; // &lt;.&gt;
            Database.Log.Console.LogLevel = LogLevel.Verbose; // &lt;.&gt;


            Database.Log.Console.Domains = LogDomain.Database;

        }

        private static void FileLogging()
        {
            var tempFolder = Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;().DefaultDirectory(), "cbllog");
            var config = new LogFileConfiguration(tempFolder) // &lt;.&gt;
            {
                MaxRotateCount = 5, // &lt;.&gt;
                MaxSize = 10240, // &lt;.&gt;
                UsePlainText = false  // &lt;.&gt;
            };
            Database.Log.File.Config = config; // Apply configuration
            Database.Log.File.Level = LogLevel.Info; // &lt;.&gt;

        }

        private static void EnableCustomLogging()
        {
            Database.Log.Custom = new LogTestLogger(); // &lt;.&gt;
            or
            Database.Log.Custom = new LogTestLogger { Level = LogLevel.Warning };

        }

        private static void WriteConsoleLog()
        {
            Database.Log.Console.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }
        private static void WriteCustomLog()
        {
            Database.Log.Custom?.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }


        private static void WriteFileLog()
        {
            Database.Log.File.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }

        private static void EnableBasicAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new BasicAuthenticator("john", "pass");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void EnableSessionAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void SetupReplicatorListener()
        {
            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
                    Console.WriteLine("Replication stopped");
                }
            });
        }




    //  BEGIN PendingDocuments IB -- 11/Feb/21 --
    private static void ReplicatorPendingDocuments()
    {
        var url = new Uri("ws://localhost:4984/mydatabase");
        var target = new URLEndpoint(url);
        var database = new Database("myDB");
        var config = new ReplicatorConfiguration(database, target);
        config.ReplicatorType  = ReplicatorType.Push;

        var replicator = new Replicator(config);

        var mydocids =
          new HashSet &lt;string&gt; (replicator.GetPendingDocumentIDs()); // &lt;.&gt;


        if (mydocids.Count &gt; 0)
        {
            Console.WriteLine($"There are {mydocids.Count} documents pending");
            replicator.AddChangeListener((sender, change) =&gt;
            {
                Console.WriteLine($"Replicator activity level is " +
                                  change.Status.Activity.ToString());
                // iterate and report-on previously
                // retrieved pending docids 'list'
                foreach (var thisId in mydocids)
                    if (!replicator.IsDocumentPending(thisId)) // &lt;.&gt;
                    {
                        Console.WriteLine($"Doc ID {thisId} now pushed");
                    };
            });

            replicator.Start();
        }
    }


//  END PendingDocuments IB -- 11/Feb/21 --



		private static void ReplicatorDocumentEvent()
        {
            var replicator = _Replicator;

            var token = replicator.AddDocumentReplicationListener((sender, args) =&gt;
            {
                var direction = args.IsPush ? "Push" : "Pull";
                Console.WriteLine($"Replication type :: {direction}");
                foreach (var document in args.Documents) {
                    if (document.Error == null) {
                        Console.WriteLine($"Doc ID :: {document.Id}");
                        if (document.Flags.HasFlag(DocumentFlags.Deleted)) {
                            Console.WriteLine("Successfully replicated a deleted document");
                        }
                    } else {
                        // There was an error
                    }
                }
            });

            replicator.Start();

            replicator.RemoveChangeListener(token);
        }

        private static void SetupReplicatorErrorListener()
        {
            // This can be done in the SetupReplicatorListener method
            // But it is separate so that we can have two documentation entries

            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Error != null) {
                    Console.WriteLine($"Error :: {args.Status.Error}");
                }
            });
        }

        private static void DatabaseReplica()
        {
            var db = _Database;
            using (var database2 = new Database("backup")) {
                // EE feature: This code will not compile on the community edition
                var targetDatabase = new DatabaseEndpoint(database2);
                var config = new ReplicatorConfiguration(db, targetDatabase)
                {
                    ReplicatorType = ReplicatorType.Push
                };

                var replicator = new Replicator(config);
                replicator.Start();

                _Replicator?.Stop();
                _Replicator = replicator;
            }
        }

        private static void PinCertificate()
        {
            // Note: No certificate is included here, so this code is for show only
            var url = new Uri("wss://localhost:4984/db");
            var target = new URLEndpoint(url);
            var db = _Database;

            // Note: `GetCertificate` is a fake method. This would be the platform-specific method
            // to find and load the certificate as an instance of `X509Certificate2`.
            // For .NET Core / .NET Framework this can be loaded from the filesystem path.
            // For UWP, from the assets directory.
            // For iOS, from the main bundle.
            // For Android, from the assets directory.
            var certificate = GetCertificate("cert.cer");
            var config = new ReplicatorConfiguration(db, target)
            {
                PinnedServerCertificate = certificate
            };
        }

        private static void ReplicationCustomHeaders()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target)
            {
                Headers = new Dictionary&lt;string, string&gt;
                {
                    ["CustomHeaderName"] = "Value"
                }
            };
        }

        private static void PushWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PushFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (flags.HasFlag(DocumentFlags.Deleted)) {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void PullWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PullFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (document.GetString("type") == "draft") {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        public void TestCustomRetryConfig()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);

        //  other config as required . . .

            config.Heartbeat = TimeSpan.FromSeconds(120); //  &lt;.&gt;
            config.Maxattempts = 20; //  &lt;.&gt;
            config.MaxAttemptWaitTime = TimeSpan.FromSeconds(600); //  &lt;.&gt;

        //  other config as required . . .

            var repl = new Replicator(config);

        }


        private static void UsePredictiveModel()
        {
            using (var db = new Database("mydb")) {
                var model = new ImageClassifierModel();
                Database.Prediction.RegisterModel("ImageClassifier", model);

                var index = IndexBuilder.ValueIndex(ValueIndexItem.Property("label"));
                db.CreateIndex("value-index-image-classifier", index);

                Database.Prediction.UnregisterModel("ImageClassifier");
            }
        }

        private static void UsePredictiveIndex()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });

                var index = IndexBuilder.PredictiveIndex("ImageClassifier", input);
                db.CreateIndex("predictive-index-image-classifier", index);
            }
        }

        private static void DoPredictiveQuery()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });
                var prediction = PredictiveModel.predict("ImageClassifier", input); // &lt;1&gt;

                using (var q = QueryBuilder.Select(SelectResult.All())
                    .From(DataSource.Database(db))
                    .Where(prediction.Property("label").EqualTo(Expression.String("car"))
                        .And(prediction.Property("probability").GreaterThanOrEqualTo(Expression.Double(0.8))))) {
                    var result = q.Execute();
                    Console.WriteLine($"Number of rows: {result.Count()}");
                }
            }
        }

        static void Main(string[] args)
        {
            // This only needs to be done once for whatever platform the executable is running
            // (UWP, iOS, Android, or desktop)
            Couchbase.Lite.Support.NetDesktop.Activate();

            CreateNewDatabase();
            CreateDocument();
            UpdateDocument();
            UseTypedAccessors();
            DoBatchOperation();
            UseBlob();
            SelectMeta();

            LoadPrebuilt();
            CreateIndex();
            SelectWhere();
            UseCollectionContains();
            SelectLike();
            SelectWildcardLike();
            SelectWildcardCharacterLike();
            SelectRegex();
            SelectJoin();
            GroupBy();
            OrderBy();

            CreateFullTextIndex();
            FullTextSearch();
            StartReplication();
            SetupReplicatorListener();

            _Replicator.Stop();
            while (_Replicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
                // Database cannot close until replicators are stopped
                Console.WriteLine($"Waiting for replicator to stop (currently {_Replicator.Status.Activity})...");
                Thread.Sleep(200);
            }

            _Database.Close();
        }

        #endregion
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  ACTIVE SIDE  ----------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */

    class ActivePeer : IMessageEndpointDelegate
    {
        ActivePeer()
        {
            var id = "";

            var database = new Database("dbname");

            // The delegate must implement the `IMessageEndpointDelegate` protocol.
            var messageEndpointTarget = new MessageEndpoint(uid: "UID:123", target: "",
                protocolType: ProtocolType.MessageStream, delegateObject: this);

            var config = new ReplicatorConfiguration(database, messageEndpointTarget);

            // Create the replicator object
            var replicator = new Replicator(config);
            // Start the replicator
            replicator.Start();
        }

        /* implementation of MessageEndpointDelegate */
        public IMessageEndpointConnection CreateConnection(MessageEndpoint endpoint)
        {
            var connection = new ActivePeerConnection(); /* implements MessageEndpointConnection */
            return connection;
        }
    }

    class ActivePeerConnection : IMessageEndpointConnection
    {
        private IReplicatorConnection _replicatorConnection;

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public async Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // await socket.Open(), etc
            // throw MessagingException if something goes wrong
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  PASSIVE SIDE  ---------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */
    class PassivePeerConnection : IMessageEndpointConnection
    {
        private MessageEndpointListener _messageEndpointListener;
        private IReplicatorConnection _replicatorConnection;

        public void StartListener()
        {
            var database = new Database("mydb");
            var config = new MessageEndpointListenerConfiguration(database, ProtocolType.MessageStream);
            _messageEndpointListener = new MessageEndpointListener(config);
        }

        public void StopListener()
        {
            _messageEndpointListener?.CloseAll();
        }

        public void AcceptConnection()
        {
            var connection = new PassivePeerConnection(); /* implements MessageEndpointConnection */
            _messageEndpointListener?.Accept(connection);
        }

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // socket should already be open on the passive side
            return Task.FromResult(true);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    // tensorFlowModel is a fake implementation
    // this would be the implementation of the ml model you have chosen
    class TensorFlowModel
    {
        public static IDictionary&lt;string, object&gt; PredictImage(byte[] data)
        {
            // Do calculations, etc
            return null;
        }
    }

    class ImageClassifierModel : IPredictiveModel
    {
        public DictionaryObject Predict(DictionaryObject input)
        {
            var blob = input.GetBlob("photo");
            if (blob == null) {
                return null;
            }

            var imageData = blob.Content;
            // tensorFlowModel is a fake implementation
            // this would be the implementation of the ml model you have chosen
            var modelOutput = TensorFlowModel.PredictImage(imageData);
            return new MutableDictionaryObject(modelOutput); // &lt;1&gt;
        }
    }

    private class LogTestLogger : ILogger
    {
        public LogLevel Level { get; set; }

        public void Reset()
        {
            _lines.Clear();
        }

        public void Log(LogLevel level, LogDomain domain, string message)
        {
            // handle the message, for example piping it to
            // a third party framework
        }
    }

    class LocalWinConflictResolver : IConflictResolver
    {
        Document Resolve(Conflict conflict)
        {
            return conflict.LocalDocument;
        }
    }

    class RemoteWinConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            return conflict.RemoteDocument;
        }
    }

    class MergeConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            var localDict = conflict.LocalDocument.ToDictionary();
            var remoteDict = conflict.RemoteDocument.ToDictionary();
            var result = localDict.Concat(remoteDict)
               .GroupBy(kv =&gt; kv.Key)
               .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
            return new MutableDocument(conflict.DocumentID, result);
        }
    }
}

// N1QL QUERY

  public List&lt;Result&gt; docsonly_N1QLQueryString(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = \"hotel\""); // &lt;.&gt;

      return thisQuery.Execute().AllResults();

  }


  public  List&lt;Result&gt; docsonly_N1QLQueryStringParams(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      // Declared elsewhere: Database argDB

      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = $type"); // &lt;.&gt;

      var n1qlParams = new Parameters();
      n1qlParams.SetString("type", "hotel"); // &lt;.&gt;
      thisQuery.Parameters = n1qlParams;

      return thisQuery.Execute().AllResults();

  }


// QUERY RESULT SET HANDLING EXAMPLES

    public static void testQuerySyntaxAll()
    {
        // For Documentation
        var dbName = "travel-sample";

        string thisDocsId;
        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        Dictionary&lt;string,object&gt; hotel = new Dictionary&lt;string,object&gt;();

        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
              .Select(SelectResult.All())
              .From(DataSource.Database(this_Db));


        var results = query.Execute().AllResults();

        if (results?.Count &gt; 0)
        {
            List&lt;Dictionary&lt;string,object&gt;&gt; hotels = new List&lt;Dictionary&lt;string,object&gt;&gt;();
            foreach (var result in results)
            {
                // get the result into our dictionary object
                var thisDocsProps = result.GetDictionary(dbName); // &lt;.&gt;

                if (thisDocsProps != null)
                {
                    thisDocsId = thisDocsProps.GetString("id"); // &lt;.&gt;
                    thisDocsName = thisDocsProps.GetString("name");
                    thisDocsCity = thisDocsProps.GetString("city");
                    thisDocsType = thisDocsProps.GetString("type");
                    hotel = thisDocsProps.ToDictionary();
                    hotels.Add(hotel);
                }

            }
        }


    foreach (var result in query.Execute().AsEnumerable()) {

        // get the result into a JSON String
                var thisDocsJSONString = result.ToJSON();// &lt;.&gt;

        // Get a native dictionary object using the JSON string
        var dictFromJSONstring =
              JsonConvert.
                DeserializeObject&lt;Dictionary&lt;string, object&gt;&gt;
                  (thisDocsJSONString); // &lt;.&gt;

        // use the created dictionary
        if (dictFromJSONstring != null)
        {
            thisDocsId = dictFromJSONstring["id"].ToString();
            thisDocsName = dictFromJSONstring["name"].ToString();
            thisDocsCity = dictFromJSONstring["city"].ToString();
            thisDocsType = dictFromJSONstring["type"].ToString();
        }

        //Get a custom object using the JSON string
        Hotel this_hotel =
            JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocsJSONString); // &lt;.&gt;

        // Store this hotel object in a list of hotels
        hotels.Add(
            this_hotel.Id.ToString(),
                this_hotel);

    } // end foreach result
  }


    private static void testQuerySyntaxProps()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        var this_Db = new Database("hotels") ;

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();

        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var query = QueryBuilder.Select(
                SelectResult.Property("type"),
                SelectResult.Property("name"),
                SelectResult.Property("city")).From(DataSource.Database(this_Db));

        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            // get the returned array of k-v pairs into a dictionary
            hotel = result.ToDictionary();

            // add hotel dictionary to list of hotel dictionaries
            hotels.Add(hotel);

            // use the properties of the returned array of k-v pairs directly
            thisDocsType = result.GetString("type");
            thisDocsName = result.GetString("name");
            thisDocsCity = result.GetString("city");

        }

    } // test-query-access-props



    private static void testQuerySyntaxCount()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var this_Db = new Database("hotels") ;

        var query =
          QueryBuilder
            .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount")) // &lt;.&gt;
            .From(DataSource.Database(this_Db));




        var results = query.Execute().AllResults();

        foreach (var result in results)
        {

            var numberOfDocs = result.GetInt("mycount"); // &lt;.&gt;

        }

    }




    private static void ibQueryForID()
    {

        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();


        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID).As("this_ID"))
                .From(DataSource.Database(this_Db));



        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            var thisDocsID = result.GetString("this_ID"); // &lt;.&gt;
            var doc = this_Db.GetDocument(thisDocsID);
        }

    }


    private static void testQueryPagination()
    {
      // For Documentation
      var dbName = "travel-sample";
      // var this_Db = new Database(dbName);

      var this_Db = new Database("hotels") ;

      var thisLimit = 20;
      var thisOffset = 0;

      // get a count of the number of docs matching the query
      var countQuery =
          QueryBuilder
              .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount"))
              .From(DataSource.Database(this_Db));
      var numberOfDocs =
          countQuery.Execute().AllResults().ElementAt(0).GetInt("mycount");

      if (numberOfDocs &lt; thisLimit) {
          thisLimit = numberOfDocs;
      }

      while (thisOffset &lt; numberOfDocs)
      {
          var listQuery =
              QueryBuilder
                  .Select(SelectResult.All())
                  .From(DataSource.Database(this_Db))
                  .Limit(Expression.Int(thisLimit), Expression.Int(thisOffset)); // &lt;.&gt;

          foreach (var result in listQuery.Execute().AllResults())
          {
              // Display and or process query results batch

          }

          thisOffset = thisOffset + thisLimit;

      } // end while

    }

    // JSONAPIMETHODS



        public void JsonApiDocument()
        {

            Database this_DB = new Database("travel-sample");
            Database newDb = new Database("ournewdb");

            // Get a document
            var thisDoc = this_Db.GetDocument("hotel_10025");

            // Get document data as JSON String
            var thisDocAsJsonString = thisDoc?.ToJSON(); // &lt;.&gt;

            // Get Json Object from the Json String
            JObject myJsonObj = JObject.Parse(thisDocAsJsonString);

            // Get Native Object (anhotel) from JSON String
            List&lt;Hotel&gt; thehotels = new List&lt;Hotel&gt;();

            Hotel anhotel = new Hotel();
            anhotel = JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocAsJsonString);
            thehotels.Add(anhotel);

            // Update the retrieved native object
            anhotel.Name = "A Copy of " + anhotel.Name;
            anhotel.Id = "2001";

            // Convert the updated object back to a JSON string
            var newJsonString = JsonConvert.SerializeObject(anhotel);

            // Update new document with JSOn String
            MutableDocument newhotel =
                new MutableDocument(anhotel.Id, newJsonString); // &lt;.&gt;

            foreach (string key in newhotel.ToDictionary().Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}",
                    key, newhotel.GetValue(key));
            }

            newDb.Save(newhotel);

            var thatDoc = newDb.GetDocument("2001").ToJSON(); // &lt;.&gt;
            System.Console.Write(thatDoc);



        //    JSON String = { "description":"Very good and central","id":"1000","country":"France","name":"Hotel Ted","type":"hotel","city":"Paris"}
        //             type = hotel
        //             id = 1000
        //             country = France
        //             city = Paris
        //             description = Very good and central
        //             name = Hotel Ted
        //         */

        } // End JSONAPIDocument


    public void JsonApiArray()
        {
            // Init for docs
            //var this_Db = DataStore.getDbHandle();
            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }


            Database dbNew = new Database(ourdbname);

            // JSON String -- an Array (3 elements. including embedded arrays)
            var thisJSONstring = "[{'id':'1000','type':'hotel','name':'Hotel Ted','city':'Paris','country':'France','description':'Undefined description for Hotel Ted'},{'id':'1001','type':'hotel','name':'Hotel Fred','city':'London','country':'England','description':'Undefined description for Hotel Fred'},                        {'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}]".Replace("'", "\"");

            // Get JSON Array from JSON String
            JArray myJsonObj = JArray.Parse(thisJSONstring);

            // Create mutable array using JSON String Array
            var myArray = new MutableArrayObject();
            myArray.SetJSON(thisJSONstring);  // &lt;.&gt;


            // Create a new documenty for each array element
            for (int i = 0; i &lt; myArray.Count; i)             {                 var dict = myArray.GetDictionary(i);                 var docid = myArray[i].Dictionary.GetString("id");                 var newdoc = new MutableDocument(docid, dict.ToDictionary(; <i class="conum" data-value="2"></i><b>(2)</b>
                dbNew.Save(newdoc);
            }

            // Get one of the created docs and iterate through one of the embedded arrays
            var extendedDoc = dbNew.GetDocument("1002");
            var features = extendedDoc.GetArray("features");
            <i class="conum" data-value="3"></i><b>(3)</b>
            foreach (string feature in features) {
                System.Console.Write(feature);
                //process array item as required
            }
            var featuresJSON = extendedDoc.GetArray("features").ToJSON(); <i class="conum" data-value="4"></i><b>(4)</b>

        }


        public void JsonApiDictionary()
        {

            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }
            Database dbNew = new Database(ourdbname);


            // Get dictionary from JSONstring
            var aJSONstring = "{'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDict = new MutableDictionaryObject(json: aJSONstring); <i class="conum" data-value="5"></i><b>(5)</b>

            // use dictionary to get name value
            var name = myDict.GetString("name");


            // Iterate through keys
            foreach (string key in myDict.Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}", key, myDict.GetValue(key).ToString());

            }

            /</strong>

                mono-stdout: Data -- id = 1002
                mono-stdout: Data -- type = hotel
                mono-stdout: Data -- name = Hotel Ned
                mono-stdout: Data -- city = Balmain
                mono-stdout: Data -- country = Australia
                mono-stdout: Data -- description = Undefined description for Hotel Ned
                mono-stdout: Data -- features = Couchbase.Lite.MutableArrayObject

            <strong>/
        } /</strong> end of func <strong>/


         public void JsonApiBlob()
        {
            // Init
            var ourpath = DataStore.getUserFolder();
            var ourdbname = "ournewdb";
            var userName = "ian";
            //ourpath = Path.Combine(ourpath,userName);

            if (Database.Exists(ourdbname, ourpath))
            {
                Database.Delete(ourdbname, ourpath);
            }
            var dbCfg = new DatabaseConfiguration();
            dbCfg.Directory=ourpath;
            Database dbNew = new Database(ourdbname,dbCfg);


            // Initialize base document for blob from a JSON string
            var docId = "1002";
            var aJSONstring = "{'ref':'hotel_1002','type':'hotel','name':'Hotel Ned'," +
                "'city':'Balmain','country':'Australia'," +
                "'description':'Undefined description for Hotel Ned'," +
                "'features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDoc = new MutableDocument(docId, aJSONstring); <i class="conum" data-value="6"></i><b>(6)</b>


            // Get the content (an image), create blob and add to doc)
            var defaultDirectory =
                Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;()
                            .DefaultDirectory(),
                                userName);
            var myImagePath = Path.Combine(defaultDirectory, "avatarimage.jpg");
            var myImageUri = new Uri(myImagePath.ToString());
            var myBlob = new Blob("image/jpg", myImageUri); <i class="conum" data-value="7"></i><b>(7)</b>
            myDoc.SetBlob("avatar", myBlob); <i class="conum" data-value="8"></i><b>(8)</b>


            // This example generates a 'blob not saved' exception
            try { Console.WriteLine("myBlob (unsaved) as JSON = {0}", myBlob.ToJSON());}
                catch (Exception e)
                    {Console.WriteLine("Exception = {0}", e.Message);}

            dbNew.Save(myDoc);

            // Alternatively -- depending on use case
            dbNew.SaveBlob(new Blob("image/jpg", myImageUri)); <i class="conum" data-value="9"></i><b>(9)</b>


            // Retrieve saved doc, get blob as JSON andheck its still a 'blob'
            var sameDoc = dbNew.GetDocument(docId);
            var reconstitutedBlob = new MutableDictionaryObject().
                SetDictionary("blobCOPY", new MutableDictionaryObject(sameDoc.GetBlob("avatar").ToJSON())); <i class="conum" data-value="10"></i><b>(10)</b>

            if (Blob.IsBlob(
                    reconstitutedBlob.GetDictionary("blobCOPY").ToDictionary()))  <i class="conum" data-value="11"></i><b>(11)</b>
            {
               //... process accordingly
               Console.WriteLine("Its a Blob!!");
            }

            var datavalue = "";
            foreach (string key in myDoc.Keys)
            {
                if (key == "features")
                {
                    datavalue = "features are: ";
                    foreach (string item in myDoc.GetArray(key))
                    {
                        datavalue = datavalue + ", " + item;
                    }
                }
                else if (key == "avatar")
                {
                    datavalue = sameDoc.GetBlob(key).ToJSON();
                }
                else
                {
                    datavalue = sameDoc.GetValue(key).ToString();
                }

                System.Console.WriteLine(" Data -- {0} = {1}", key, datavalue);
            }

            // System.Console.WriteLine(" reconstitutedBlob = {0}", reconstitutedBlob.GetDictionary("blobCOPY").ToJSON());



            //}

            /</strong>


                Exception = Missing Digest Due To Blob Is Not Saved To Database yet.

                Data -- id = 1002
                Data -- type = hotel
                Data -- name = Hotel Ned
                Data -- city = Balmain
                Data -- country = Australia
                Data -- description = Undefined description for Hotel Ned
                Data -- features = features are: , Cable TV, Toaster, Microwave
                Data -- avatar = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

                blobAsJSONstring = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

            <strong>/
        } /</strong> end of func <strong>/




  } // end of class



// p2p sync items


var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="12"></i><b>(12)</b>

thisConfig.Authenticator =
  new ListenerPasswordAuthenticator(
    (sender, username, password) =&gt;
      {
      return username.equals("valid.user")  &amp;&amp; (password == validPassword);
      }
  ); <i class="conum" data-value="13"></i><b>(13)</b>

_thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="14"></i><b>(14)</b>

_thisListener.Start(); <i class="conum" data-value="15"></i><b>(15)</b>




var theListenerEndpoint = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="16"></i><b>(16)</b>

var thisConfig = new ReplicatorConfiguration(thisDB, theListenerEndpoint); <i class="conum" data-value="17"></i><b>(17)</b>

thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="18"></i><b>(18)</b>

thisConfig.Authenticator =
  new BasicAuthenticator("valid.user", "valid.password.string"); <i class="conum" data-value="19"></i><b>(19)</b>

var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="20"></i><b>(20)</b>

thisReplicator.Start(); <i class="conum" data-value="21"></i><b>(21)</b>








// PASSIVE PEER STUFF
// Stuff I adapted
//
//
// p2pSync-websockets.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;
namespace api_walkthrough
{
  class Program
  {
  private static Database _Database;
  private static Replicator _Replicator;
  private static ListenerToken _thisListenerToken;
  private static bool _NeedsExtraDocs;

  #region Private Methods
  private static void GettingStarted()
  {

    // Initialize the listener config
    var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="22"></i><b>(22)</b>

    thisConfig.Port = 55990; <i class="conum" data-value="23"></i><b>(23)</b>

    thisConfig.NetworkInterface = "10.1.1.10"; <i class="conum" data-value="24"></i><b>(24)</b>

    thisConfig.EnableDeltaSync = true; <i class="conum" data-value="25"></i><b>(25)</b>

    thisConfig.DisableTLS = false; <i class="conum" data-value="26"></i><b>(26)</b>

    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="27"></i><b>(27)</b>

    // Configure the client authenticator
    // Here we are using Basic Authentication) <i class="conum" data-value="28"></i><b>(28)</b>
    SecureString validPassword =  new SecureString(); /</strong> example only <strong>/
    // Get SecureString input for validPassword
    var validUser = "valid.username";
    thisConfig.Authenticator = new ListenerPasswordAuthenticator(
      (sender, validUser, validPassword) =&gt;
        {
          return username.equals(validUser)  &amp;&amp; password == validPassword);
        }
      );

    // Initialize the listener
    _thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="29"></i><b>(29)</b>

    // Start the listener
    thisListener.Start(); <i class="conum" data-value="30"></i><b>(30)</b>

  }

  thisConfig.disableTLS = true;


  // Use “anonymous” cert. These are self signed certs created by the system
  thisConfig.TlsIdentity = null;


  thisConfig.EnableDeltaSync = true;


  int connectionCount = thisListener.Status.ConnectionCount; <i class="conum" data-value="31"></i><b>(31)</b>
  int activeConnectionCount = thisListener.Status.ActiveConnectionCount;  <i class="conum" data-value="32"></i><b>(32)</b>



  thisListener.Stop();


// Additional snippets


foreach(NetworkInterface ni in NetworkInterface.GetAllNetworkInterfaces())
{
  if(ni.NetworkInterfaceType == NetworkInterfaceType.Wireless80211 ||
      ni.NetworkInterfaceType == NetworkInterfaceType.Ethernet)
  {
    // do something with the interface(s)
  }
}



var thisConfig = new URLEndpointListenerConfiguration(thisDB);
_thisListener = new URLEndpointListener(thisConfig);

_thisListener.Start();

 Console.WriteLine("URLS are {0} ", thisListener.Urls;


    thisConfig.DisableTLS = true; <i class="conum" data-value="33"></i><b>(33)</b>


    // . . . preceding application logic . . .
    // Get the database (and create it if it doesn't exist)
    var thisDB = new Database("mydb");


    // Use CA Cert
    // Create a TLSIdentity from an imported key-pair
    // . . . previously declared variables include ...
    TLSIdentity thisIdentity;
    X509Store _store =
      new X509Store(StoreName.My); // create and label x509 store

    // Get keys and certificates from PKCS12 data
    byte[] thisIdData =
      File.ReadAllBytes("c:client.p12"); <i class="conum" data-value="34"></i><b>(34)</b>
    // . . . other user code . . .

    thisIdentity = TLSIdentity.ImportIdentity(
      _store,
      thisIdData, <i class="conum" data-value="35"></i><b>(35)</b>
      "123", // Password to access certificate data
      "couchbase-demo-cert",
      null); // Label to get cert in certificate map
        // NOTE: If a null label is supplied then the same
        // default directory for a Couchbase Lite database
        // is used for map.


    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="36"></i><b>(36)</b>

    // Set the TLS Identity
    thisConfig.TlsIdentity = thisIdentity; <i class="conum" data-value="37"></i><b>(37)</b>


    // Configure the client authenticator
    // to validate using ROOT CA

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="38"></i><b>(38)</b>
    var clientData = File.ReadAllBytes("c:client.p12");
    var ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData); <i class="conum" data-value="39"></i><b>(39)</b>

    // Configure the authenticator to use the root certs
    var thisAuth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(thisRootCert));

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="40"></i><b>(40)</b>

    // Initialize the listener using the config
    _listener = new URLEndpointListener(thisConfig);

    // Configure the client authenticator
    // to validate using application logic

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="41"></i><b>(41)</b>
    clientData = File.ReadAllBytes("c:client.p12");
    ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData);

    // Configure the authenticator to pass the root certs
    // To a user supplied code block for authentication
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert) =&gt; {
          // . . . user supplied code block
          // . . . returns boolean value (true=authenticated)
        }); <i class="conum" data-value="42"></i><b>(42)</b>

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="43"></i><b>(43)</b>




// END Additional






// Listener Callouts


  &lt;.&gt; Initialize the listener instance using the configuration settings.
  &lt;.&gt; Start the listener, ready to accept connections and incoming data from active peers.



  &lt;.&gt; <code>connectionCount</code> -- the total number of connections served by the listener
  &lt;.&gt; <code>activeConnectionCount</code> -- the number of active (BUSY) connections currently being served by the listener
  //

  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; PKCS12 data containing private key, public key, and certificates
  &lt;.&gt; The key pair as stored in the byte array
  &lt;.&gt; The password required to access the certificate data
  &lt;.&gt; The key label assigned to the cert in certificate map and used for retrieval
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>


  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; When creating a certificate, the common name attribute is required to create a CSR. If the common name is not present in the certificate an exception is thrown.
  &lt;.&gt; If the expiration date is not specified, the expiration date of the certificate is 365 days after creation
  &lt;.&gt; The key label to get cert in certificate map
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>










  // cert is a pre-populated object of type:SecCertificate representing a certificate
  // Work in progress. Code snippet to be provided.



  // prev content of listener-config-client-auth-self-signed (for ios)
  thisConfig.authenticator = ListenerCertificateAuthenticator.init {
    (cert) -&gt; Bool in
    var cert:SecCertificate
    var certCommonName:CFString?
    let status=SecCertificateCopyCommonName(cert, &amp;certCommonName)
    if (self._allowlistedUsers.contains(["name": certCommonName! as String])) {
      return true
    }
    return false
  }
  // Work in progress. Code snippet to be provided.


public class URLEndpointListener {
    // Properties <i class="conum" data-value="1"></i><b>(1)</b>
    public let config: URLEndpointListenerConfiguration
    public let port UInt16?
    public let tlsIdentity: TLSIdentity?
    public let urls: Array&lt;URL&gt;?
    public let status: ConnectionStatus?
    // Constructors <i class="conum" data-value="2"></i><b>(2)</b>
    public init(config: URLEndpointListenerConfiguration)
    // Methods <i class="conum" data-value="3"></i><b>(3)</b>
    public func start() throws
    public func stop()
}


let config = URLEndpointListenerConfiguration.init(database: self.oDB)
thisConfig.port = tls ? wssPort : wsPort
thisConfig.disableTLS = !tls
thisConfig.authenticator = auth
self.listener = URLEndpointListener.init(config: config) <i class="conum" data-value="1"></i><b>(1)</b>


// ACTIVE PEER STUFF
// Replication code
//
// Copyright (c) 2019 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

public class Examples {
  private static final String TAG = "EXAMPLE ACTIVE PEER";
  private static final String thisDBNAME = "local-database";
  private final Context context;
  // private Database database;
  // private Replicator replicator;

  public Examples(Context context) { this.context = context; }

  String user = "syncuser";
  String password = "sync9455";
  SecCertificate cert=null;
  String passivePeerEndpoint = "10.1.1.12:8920";
  String passivePeerPort = "8920";
  String passiveDbName = "userdb";
  Database thisDB;
  Replicator thisReplicator;
  ListenerToken replicatorListener;

  //@Test
  public void testActPeerSync() throws CouchbaseLiteException, URISyntaxException {
    // . . . preceding code. for example . . .
    private static ListenerToken _thisListenerToken;
    var Database thisDB;
    // . . . other code . . .
    // initialize the replicator configuration

    var thisUrl = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="44"></i><b>(44)</b>
    var config = new ReplicatorConfiguration(thisDB, thisUrl);


    // Set replicator type
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

    // Set autopurge option
    // here we override its default
    thisConfig.EnableAutoPurge = false; <i class="conum" data-value="45"></i><b>(45)</b>

    // Configure Sync Mode
    thisConfig.Continuous = true; // default value

    // Configure Server Security -- only accept self-signed certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="46"></i><b>(46)</b>

    // Configure Client Security <i class="conum" data-value="47"></i><b>(47)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");

    /</strong> Optionally set a conflict resolver call back <strong>/ <i class="conum" data-value="48"></i><b>(48)</b>
    // Use built-in resolver
    thisConfig.ConflictResolver = new LocalWinConflictResolver();  //

    // optionally use custom resolver
    thisConfig.ConflictResolver = new ConflictResolver(
      (conflict) =&gt; {
        /</strong> define resolver function */
      }
    ); //

    // Initialize and start a replicator
    // Initialize replicator with configuration data
    var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="49"></i><b>(49)</b>

    //Optionally add a change listener <i class="conum" data-value="50"></i><b>(50)</b>
    _thisListenerToken =
      thisReplicator.AddChangeListenersender, args) =&gt;         {           if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {               Console.WriteLine("Replication stopped");           }         });      // Start replicator     thisReplicator.Start(); <i class="conum" data-value="51"></i><b>(51)</b>  }  // Additional snippets      // Configure Server Security -- only accept CA certs     thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="52"></i><b>(52)</b>       // Return the remote pinned cert (the listener's cert)     byte returnedCert = new byte(thisConfig.getPinnedCertificate(; // Get listener cert if pinned
    // Configure Client Security <i class="conum" data-value="53"></i><b>(53)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");


    // Only CA Certs accepted
    thisConfig.AcceptOnlySelfSignedServerCertificate =
      false; <i class="conum" data-value="54"></i><b>(54)</b>

    var thisCert =
      new X509Certificate2(caData); <i class="conum" data-value="55"></i><b>(55)</b>

    thisConfig.PinnedServerCertificate =
      thisCert; <i class="conum" data-value="56"></i><b>(56)</b>













    // Code to refactor
    Log.i(TAG, "The Replicator is currently " + thisReplicator.Status().getActivityLevel());

    Log.i(TAG, "The Replicator has processed " + t);

    if (thisReplicator.Status().getActivityLevel() == Replicator.ActivityLevel.BUSY) {
          Log.i(TAG, "Replication Processing");
          Log.i(TAG, "It has completed " + thisReplicator.Status().getProgess().getTotal() + " changes");
      }
    _thisReplicator.Stop();
    while (_thisReplicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
        // Database cannot close until replicators are stopped
        Console.WriteLine($"Waiting for replicator to stop (currently {_thisReplicator.Status.Activity})...");
        Thread.Sleep(200);
    }
    _thisDatabase.Close();

      // Stop replication.
      thisReplicator.Stop(); <i class="conum" data-value="57"></i><b>(57)</b>


  }

{
  CouchbaseLite.init(context);
  Database thisDB = new Database("passivepeerdb");  <i class="conum" data-value="58"></i><b>(58)</b>
  // Initialize the listener config
  final URLEndpointListenerConfiguration thisConfig = new URLEndpointListenerConfiguration(database);
  thisConfig.Port(55990)             // &lt;.&gt; Default- port is selected
  thisConfig.DisableTls(false)       // &lt;.&gt; Optional. Defaults to false. You get TLS encryption out-of-box
  thisConfig.EnableDeltaSync(true)   // &lt;.&gt; Optional. Defaults to false.

  // Configure the client authenticator (if using basic auth)
  ListenerPasswordAuthenticator auth = new ListenerPasswordAuthenticator { "Our Username", "Our Password"}; <i class="conum" data-value="59"></i><b>(59)</b>
  thisConfig.Authenticator(auth); <i class="conum" data-value="60"></i><b>(60)</b>

  // Initialize the listener
  final URLEndpointListener listener = new URLEndpointListener( thisConfig ); <i class="conum" data-value="61"></i><b>(61)</b>

  // Start the listener
  listener.Start(); <i class="conum" data-value="62"></i><b>(62)</b>
    }



Map&lt;String, String&gt; X509_ATTRIBUTES = mapOf(
           TLSIdentity.CERT_ATTRIBUTE_COMMON_NAME to "Couchbase Demo",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION to "Couchbase",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION_UNIT to "Mobile",
           TLSIdentity.CERT_ATTRIBUTE_EMAIL_ADDRESS to "<a href="mailto:noreply@couchbase.com">noreply@couchbase.com</a>"
       )

TLSIdentity thisIdentity = new TLSIdentity.createIdentity(true, X509_ATTRIBUTES, null, "test-alias");



. . . work in progress - GetHashCode snippet to be provided

TLSIdentity.DeleteIdentity(_store, "alias-to-delete", null);


// OPTIONALLY:: Retrieve a stored TLS identity using its alias/label

TLSIdentity thisIdentity = new TLSIdentity.getIdentity("CBL-Demo-Server-Cert")


    // Configure the client authenticator (if using Basic Authentication)
    // String validUser = new String("validUsername"); // an example username
    // String validPassword = new String("validPasswordValue"); // an example password

    // ListenerPasswordAuthenticator thisAuth = new ListenerPasswordAuthenticator( <i class="conum" data-value="63"></i><b>(63)</b>
    //   validUser, validPassword -&gt; validUser == "validUsername" &amp;&amp; validPassword == "validPasswordValue" );

    // if (thisAuth) {
    //   thisConfig.Authenticator(auth);
    // }
    // else {
    //   // . . . authentication failed take appropriate exception action
    //   return
    // };




    ListenerToken thisListener = new thisReplicator.addChangeListener(change -&gt; { <i class="conum" data-value="64"></i><b>(64)</b>
      if (change.Status().getError() != null) {
        Log.i(TAG, "Error code ::  " + change.Status().getError().getCode());
      }
    });




// g u b b i n s


    // Configure TLS Cert CA auth using key-stored cert id alias 'doc-sync-server'

    // TLSIdentity thisIdentity = new TLSIdentity.getIdentity("doc-sync-server"); // Get existing TLS ID from sec storage

    // ClientCertificateAuthenticator thisAuth = new ClientCertificateAuthenticator(thisIdentity);

    // thisConfig.Authenticator(thisAuth);



    // USE KEYCHAIN IDENTITY IF EXISTS
    // Check if Id exists in keychain. If so use that Id

    // STILL NEED TO REFACTOR

    do {
      if let thisIdentity = try TLSIdentity.identity(withLabel: "doco-sync-server") {
          print("An identity with label : doco-sync-server already exists in keychain")
          return thisIdentity
          }
    } catch
    {return nil}
    thisAuthenticator.ClientCertificateAuthenticator(identity: thisIdentity )
    thisConfig.thisAuthenticator




String thisAlias = "alias-to-delete";
KeyStore thisKeystore = KeyStore.getInstance("PKCS12"); <i class="conum" data-value="65"></i><b>(65)</b>
thisKeyStore.load= null;
if (thisAlias != null) {
   thisKeystore.deleteEntry(thisAlias);  <i class="conum" data-value="66"></i><b>(66)</b>
}



// cert auth
let rootCertData = SecCertificateCopyData(cert) as Data
let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])

SecCertificate thisCert = new SecCertificate(); // populated as nec.

Data rootCertData = new Data(SecCertificateCopyData(thisCert));

let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])
// cert auth


// C A L L O U T S

&lt;.&gt; Configure to accept only CA certs
&lt;.&gt; Configure the pinned certificate using data from the byte array <code>cert</code>
&lt;.&gt; Set the certificate to be compared with that provided by the server

&lt;.&gt; PKCS12 data containing private key, public key, and certificates
&lt;.&gt; This is the default value and means that TLS is enabled

&lt;.&gt; Refuse self-signed certificates
&lt;.&gt; Get the identity
&lt;.&gt; Set the Client Certificate Authenticator to require signed certificates with this identity



    // Configure the client authenticator
    // to validate using ROOT CA <i class="conum" data-value="67"></i><b>(67)</b>
    byte[] thisCaData; // byte array for CA data
    using (var thisReader = new BinaryReader(stream)) {
      thisCaData = thisReader.ReadBytes(int stream.Length);
    }; // Get cert data

    var thisRootCert = new X509Certificate(thisCaData); //

    thisConfig.Authenticator = new  ListenerCertificateAuthenticator(
      new X509Certificate2Collection(thisRootCert)
    );




    var db = new Database("other-database");
    _Database = db;
    X509Store _store = new X509Store(StoreName.My);
    TLSIdentity thisIdentity;


    // Configure the expected server-supplied
    // credentials -- only accept CA Certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="68"></i><b>(68)</b>

    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="69"></i><b>(69)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="70"></i><b>(70)</b>






    byte[] thisCaData, thisClientData;
    thisClientData = File.ReadAllBytes("C:\\client.p12"); <i class="conum" data-value="71"></i><b>(71)</b>
    thisCaData = File.ReadAllBytes("C:\\client-ca.der");

    // Root certs
    var thisRootCert = new X509Certificate2(thisCaData);
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert));

    // Create URL Endpoint Listener
    var thisConfig = new URLEndpointListenerConfiguration(_Database);
    thisConfig.DisableTLS = false; <i class="conum" data-value="72"></i><b>(72)</b>
    thisConfig.Authenticator = thisAuth;
    _listener = new URLEndpointListener(thisConfig);
    _listener.Start();

    // Client identity
    thisIdentity = TLSIdentity.ImportIdentity(_store,
        thisClientData,
        "123",
        "CBL-Client-Cert",
        null);

    // Replicator -- Client
    var database = new Database("client-database");
    var builder = new UriBuilder(
        "wss",
        "localhost",
        _listener.Port,
        $"/{_listener.thisConfig.Database.Name}"
    );

    var url = builder.Uri;
    var target = new URLEndpoint(url);
    var thisConfig = new ReplicatorConfiguration(database, target);
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;
    thisConfig.Continuous = false;
    thisConfig.Authenticator = new ClientCertificateAuthenticator(thisIdentity);
    thisConfig.AcceptOnlySelfSignedServerCertificate = true;
    thisConfig.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
    using (var replicator = new Replicator(thisConfig)) {
        replicator.Start();
    }





    // Stop listener after replicator is stopped
    _listener.Stop();



    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="73"></i><b>(73)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="74"></i><b>(74)</b>



  // For replications

  // BEGIN -- snippets --
  //    Purpose -- code samples for use in replication topic

  public class MyClass
  {
      public Database Database { get; set; }
      public Replicator Replicator { get; set; } <i class="conum" data-value="75"></i><b>(75)</b>

      public void StartReplication()
      {
  }

          var url = new Uri("wss://localhost:4984/db"); <i class="conum" data-value="76"></i><b>(76)</b>
          var target = new URLEndpoint(url);
          var config = new ReplicatorConfiguration(Database, target)
          {
              ReplicatorType = ReplicatorType.Pull
          };

          Replicator = new Replicator(config);
          Replicator.Start();
      }

      // &lt;.&gt; A replication is an asynchronous operation.
      // To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
      // &lt;.&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
      // You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.

      public void InitReplication()
      {
        // initialize the replicator configuration

        var thisUrl = new URLEndpoint("wss://l10.0.2.2:4984/anotherDB"); <i class="conum" data-value="77"></i><b>(77)</b>
        var config = new ReplicatorConfiguration(thisDB, thisUrl);

      }
  }
 }



  public class supporting_datatypes
  {
      public void datatype_dictionary()
      {
          var database = new Database(name: "mydb");

          // NOTE: No error handling, for brevity (see getting started)
          var document = database.GetDocument("doc1");

          // Getting a dictionary from the document's properties
          var dict = document.GetDictionary("address");

          // Access a value with a key from the dictionary
          var street = dict.GetString("street");

          // Iterate dictionary
          foreach (var key in dict.Keys)
          {
              Console.WriteLine($"Key {key} = {dict.GetValue(key)}");
          }

          // Create a mutable copy
          var mutDict = dict.ToMutable();
      }

      public void datatype_mutable_dictionary()
      {

          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable dictionary and populate some keys/values
          var mutable_dict = new MutableDictionaryObject();
          mutable_dict.SetString("street", "1 Main st.");
          mutable_dict.SetString("city", "San Francisco");

          // Add the dictionary to a document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetDictionary("address", mutable_dict);
          database.Save(doc);

      }


      public void datatype_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          var document = database.GetDocument("doc1");

          // Getting a phones array from the document's properties
          var array = document.GetArray("phones");

          // Get element count
          var count = array.Count();

          // Access an array element by index
          if (count &gt;= 0) { var phone = array[1]; }

          // Iterate dictionary
          for (int i = 0; i &lt; count; i++)
          {
              Console.WriteLine($"Item {i.ToString()} = {array[i]}");
          }

          // Create a mutable copy
          var mutable_array = array.ToMutable();


      }

        public void datatype_mutable_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable array and populate data into the array
          var mutable_array = new MutableArrayObject();
          mutable_array.AddString("650-000-0000");
          mutable_array.AddString("650-000-0001");

          // Set the array to document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetArray("phones", mutable_array);
          database.Save(doc);
      }

  } // end  class supporting_datatypes</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="openblock">
<div class="content">
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add hotel name (string)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add average room rate (float)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add document type (string)<br>
Couchbase recommend using a <code>type</code> attribute to define each logical document type.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add address (dictionary)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add phone numbers (array)</td>
</tr>
</table>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save the new document to database</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">//
// Program.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;

namespace api_walkthrough
{
    class Program
    {
        private static Database _Database;
        private static Replicator _Replicator;
        private static URLEndpointListener _listener;
        private static ListenerToken _ListenerToken;
        private static bool _NeedsExtraDocs;

        <mark>region Private Methods

        private static void GettingStarted()
        {

            // using System;
            // using Couchbase.Lite;
            // using Couchbase.Lite.Query;
            // using Couchbase.Lite.Sync;

            // Get the database (and create it if it doesn't exist)
            var database = new Database("mydb");
            // Create a new document (i.e. a record) in the database
            string id = null;
            using (var mutableDoc = new MutableDocument())
            {
                mutableDoc.SetFloat("version", 2.0f)
                    .SetString("type", "SDK");

                // Save it to the database
                database.Save(mutableDoc);
                id = mutableDoc.Id;
            }

            // Update a document
            using (var doc = database.GetDocument(id))
            using (var mutableDoc = doc.ToMutable())
            {
                mutableDoc.SetString("language", "C</mark>");
                database.Save(mutableDoc);

                using (var docAgain = database.GetDocument(id))
                {
                    Console.WriteLine($"Document ID :: {docAgain.Id}");
                    Console.WriteLine($"Learning {docAgain.GetString("language")}");
                }
            }

            // Create a query to fetch documents of type SDK
            // i.e. SELECT * FROM database WHERE type = "SDK"
            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(database))
                .Where(Expression.Property("type").EqualTo(Expression.String("SDK"))))
            {
                // Run the query
                var result = query.Execute();
                Console.WriteLine($"Number of rows :: {result.AllResults().Count}");
            }

            // Create replicator to push and pull changes to and from the cloud
            var targetEndpoint = new URLEndpoint(new Uri("ws://localhost:4984/getting-started-db"));
            var replConfig = new ReplicatorConfiguration(database, targetEndpoint);

            // Add authentication
            replConfig.Authenticator = new BasicAuthenticator("john", "pass");

            // Create replicator (make sure to add an instance or static variable
            // named _Replicator)
            var _Replicator = new Replicator(replConfig);
            _Replicator.AddChangeListenersender, args) =&gt;             {                 if (args.Status.Error != null)                 {                     Console.WriteLine($"Error :: {args.Status.Error}");                 }             });              _Replicator.Start();              // Later, stop and dispose the replicator <strong>before</strong> closing/disposing the         }            private static void TestReplicatorConflictResolver()         {             var target = new URLEndpoint(new Uri("ws://localhost:4984/mydatabase";
            var replConfig = new ReplicatorConfiguration(database, target);
            replConfig.ConflictResolver = new LocalWinConflictResolver();

            var replicator = new Replicator(replConfig);
            replicator.Start();
        }

        private static void TestSaveWithConflictHandler()
        {
            using (var document = database.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                database.Save(mutableDocument, (updated, current) =&gt;
                {
                    var currentDict = current.ToDictionary();
                    var newDict = updated.ToDictionary();
                    var result = newDict.Concat(currentDict)
                        .GroupBy(kv =&gt; kv.Key)
                        .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
                    updated.SetData(result);
                    return true;
                });
            }
        }

        private static bool IsValidCredential(string name, SecureString password) { return true;  } // helper
        private static void TestInitListener()
        {
            var db = new Database("other-database");
            _Database = db;

            var config = new URLEndpointListenerConfiguration(_Database);
            config.TlsIdentity = null; // Use with anonymous self-signed cert
            config.Authenticator = new ListenerPasswordAuthenticatorsender, username, password) =&gt;             {                 if(IsValidCredential(username, password {
                    return true;
                }

                return false;
            });

            _listener = new URLEndpointListener(config);
        }

        private static void TestListenerStart()
        {
            // CouchbaseLiteException will be thrown when the listener cannot be started. The most common error
            // would be that the configured port has already been used.
            _listener.Start();
        }

        private static void TestListenerStop()
        {
            _listener.Stop();
        }

        private static void TestCreateSelfSignedCert()
        {
            TLSIdentity identity;
            X509Store _store =
             new X509Store(StoreName.My);
              // The identity will be stored in the secure
              // storage using the given label.
            DateTimeOffset fiveMinToExpireCert = DateTimeOffset.UtcNow.AddMinutes(5);

            identity = TLSIdentity.CreateIdentity(true, /* isServer <strong>/
                new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "Couchbase Inc" } },
                    // The common name attribute is required
                    // when creating a CSR. If it is not presented
                    // in the cert, an exception is thrown.
                fiveMinToExpireCert,
                    // If the expiration date is not specified,
                    // the certs expiration will be 365 days
                _store,
                "CBL-Server-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.

        }

        private static void TestImportTLSIdentity()
        {
            TLSIdentity identity;
            X509Store _store = new X509Store(StoreName.My); // The identity will be stored in the secure storage using the given label
            byte[] data = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates

            identity = TLSIdentity.ImportIdentity(_store,
                data,
                "123", // The password that is needed to access the certificate data
                "CBL-Client-Cert",
                null);  // The key label to get cert in certificate map.
                        // If null, the same default directory
                        // for a Couchbase Lite db is used for map.
        }

          private static void TestClientCertAuthenticatorRootCerts()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;

            byte[] caData, clientData;
            clientData = File.ReadAllBytes("C:\\client.p12"); // PKCS12 data containing private key, public key, and certificates
            caData = File.ReadAllBytes("C:\\client-ca.der");

            // Root certs
            var rootCert = new X509Certificate2(caData);
            var auth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(rootCert));

            // Create URL Endpoint Listener
            var listenerConfig = new URLEndpointListenerConfiguration(_Database);
            listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.
            listenerConfig.Authenticator = auth;
            _listener = new URLEndpointListener(listenerConfig);
            _listener.Start();

            // Client identity
            identity = TLSIdentity.ImportIdentity(_store,
                clientData,
                "123",
                "CBL-Client-Cert",
                null);

            // Replicator -- Client
            var database = new Database("client-database");
            var builder = new UriBuilder(
                "wss",
                "localhost",
                _listener.Port,
                $"/{_listener.Config.Database.Name}"
            );

            var url = builder.Uri;
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.ReplicatorType = ReplicatorType.PushAndPull;
            config.Continuous = false;
            config.Authenticator = new ClientCertificateAuthenticator(identity);
            config.AcceptOnlySelfSignedServerCertificate = true;
            config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
            using (var replicator = new Replicator(config)) {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
            // end::client-cert-authenticator-root-cert
        }

        private static void TestClientCertAuthenticator()
        {
            var db = new Database("other-database");
            _Database = db;

            X509Store _store = new X509Store(StoreName.My);
            TLSIdentity identity;


            // Create Listener Certificate Authenticator
            var auth = new ListenerCertificateAuthenticatorsender, cert) =&gt;             {                 if (cert.Count != 1) {                     return false;                 }                  return cert[0].SubjectName.Name?.Replace("CN=", "") == "couchbase";             });              // Create URL Endpoint Listener             var listenerConfig = new URLEndpointListenerConfiguration(_Database);             listenerConfig.DisableTLS = false; //The default value is false which means that the TLS will be enabled by default.             listenerConfig.Authenticator = auth;             _listener = new URLEndpointListener(listenerConfig);             _listener.Start();              // User Identity             identity = TLSIdentity.CreateIdentity(false,                 new Dictionary&lt;string, string&gt;() { { Certificate.CommonNameAttribute, "couchbase" } },                 null,                 _store,                 ClientCertLabel,                 null);              // Replicator -- Client             var database = new Database("client-database");             var builder = new UriBuilder(                 "wss",                 "localhost",                 _listener.Port,                 $"/{_listener.Config.Database.Name}"             );              var url = builder.Uri;             var target = new URLEndpoint(url);             var config = new ReplicatorConfiguration(database, target);             config.ReplicatorType = ReplicatorType.PushAndPull;             config.Continuous = false;             config.Authenticator = new ClientCertificateAuthenticator(identity);             config.AcceptOnlySelfSignedServerCertificate = false;             config.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];             using (var replicator = new Replicator(config {
                replicator.Start();
            }

            // Stop listener after replicator is stopped
            _listener.Stop();
        }

        private static void UseEncryption()
        {
            // Enterprise edition only

            // Create a new, or open an existing database with encryption enabled
            var config = new DatabaseConfiguration
            {
                // Or, derive a key yourself and pass a byte array of the proper size
                EncryptionKey = new EncryptionKey("password")
            };

            using (var db = new Database("seekrit", config)) {
                // Change the encryption key (or add encryption if the DB is unencrypted)
                db.ChangeEncryptionKey(new EncryptionKey("betterpassw0rd"));

                // Remove encryption
                db.ChangeEncryptionKey(null);
            }
        }

        private static void ResetReplicatorCheckpoint()
        {
            var database = _Database;
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            using (var replicator = new Replicator(config)) {
              // replicator is a Replicator instance
              if (resetCheckpointRequired_Example) {
                  replicator.Start(true); <i class="conum" data-value="1"></i><b>(1)</b>
              else
                replicator.Start(false);
              }




            }
        }

        private static void Read1xAttachment()
        {
            var db = _Database;
            using (var document = new MutableDocument()) {
                var attachments = document.GetDictionary("_attachments");
                var avatar = attachments.GetBlob("avatar");
                var content = avatar?.Content;
            }
        }

        private static void CreateNewDatabase()
        {
            var db = new Database("my-database");

            _Database = db;
        }

        private static void CloseDatabase()
        {
          database.close()

        }

        private static void ChangeLogging()
        {
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Query, LogLevel.Verbose);
        }

        private static void LoadPrebuilt()
        {
            // Note: Getting the path to a database is platform-specific.  For .NET Core / .NET Framework this
            // can be a simple filesystem path.  For UWP, you will need to get the path from your assets.  For
            // iOS you need to get the path from the main bundle.  For Android you need to extract it from your
            // assets to a temporary directory and then pass that path.
            var path = Path.Combine(Environment.CurrentDirectory, "travel-sample.cblite2" + Path.DirectorySeparatorChar);
            if (!Database.Exists("travel-sample", null)) {
                _NeedsExtraDocs = true;
                Database.Copy(path, "travel-sample", null);
            }

            _Database.Close();
            _Database = new Database("travel-sample");
        }

        private static void QueryDeletedDocuments()
        {
            // Query documents that have been deleted
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.IsDeleted);
        }

        private static void CreateDocument()
        {
            var db = _Database;
            using (var newTask = new MutableDocument("xyz")) {
                newTask.SetString("type", "task")
                    .SetString("owner", "todo")
                    .SetDate("createdAt", DateTimeOffset.UtcNow);

                db.Save(newTask);
            }
        }

        private static void UpdateDocument()
        {
            var db = _Database;
            using(var document = db.GetDocument("xyz"))
            using (var mutableDocument = document.ToMutable()) {
                mutableDocument.SetString("name", "apples");
                db.Save(mutableDocument);
            }
        }

        private static void UseTypedAccessors()
        {
            using (var newTask = new MutableDocument()) {
                newTask.SetValue("createdAt", DateTimeOffset.UtcNow);
                var date = newTask.GetDate("createdAt");

                Console.WriteLine(date);
            }
        }

        private static void DoBatchOperation()
        {
            var db = _Database;
            db.InBatch) =&gt;             {                 for (var i = 0; i &lt; 10; i) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "user");
                        doc.SetString("name", $"user {i}");
                        doc.SetBoolean("admin", false);
                        db.Save(doc);
                        Console.WriteLine($"Saved user document {doc.GetString("name")}");
                    }
                }
            });
        }

        private static void DatabaseChangeListener()
        {
            var db = _Database;

            db.AddDocumentChangeListener("user.john", (sender, args) =&gt;
            {
                using (var doc = Db.GetDocument(args.DocumentID)) {
                    Console.WriteLine($"Status :: {doc.GetString("verified_account")}");
                }
            });
        }

        private static void DocumentExpiration()
        {
            var db = _Database;

            // Purge the document one day from now
            var ttl = DateTimeOffset.UtcNow.AddDays(1);
            db.SetDocumentExpiration("doc123", ttl);

            // Reset expiration
            db.SetDocumentExpiration("doc1", null);

            // Query documents that will be expired in less than five minutes
            var fiveMinutesFromNow = DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeMilliseconds();
            var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(Meta.Expiration.LessThan(Expression.Double(fiveMinutesFromNow)));
        }

        private static void UseBlob()
        {
            var db = _Database;
            using (var newTask = new MutableDocument()) {
                // Note: Reading the data is implementation dependent, as with prebuilt databases
                var image = File.ReadAllBytes("avatar.jpg"); // &lt;.&gt;
                var blob = new Blob("image/jpeg", image); // &lt;.&gt;
                 newTask.SetBlob("avatar", blob); // &lt;.&gt;
                db.Save(newTask);

                var taskBlob = newTask.GetBlob("avatar");
                using (var bitmap = SKBitmap.Decode(taskBlob.ContentStream)) {
                    Console.WriteLine($"Bitmap dimensions: {bitmap.Width} x {bitmap.Height} ({bitmap.BytesPerPixel} bytes per pixel)");
                }
            }
        }

        public void CreateIndex()
        {
            var db = _database;
            string[] indexProperties = new string[] {"type", "name" };
            var config = new ValueIndexConfiguration(indexProperties);
            db.CreateIndex("TypeNameIndex", config);
        }

        public void CreateIndex_Querybuilder()
        {
            // For value types, this is optional but provides performance enhancements
            var db = _database;
            var index = IndexBuilder.ValueIndex(
                ValueIndexItem.Expression(Expression.Property("type")),
                ValueIndexItem.Expression(Expression.Property("name"))); // &lt;.&gt;
            db.CreateIndex("TypeNameIndex", index);
        }
        private static void SelectMeta()
        {
            Console.WriteLine("Select Meta");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("type"),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document ID :: {result.GetString("id")}");
                    Console.WriteLine($"Document Name :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectAll()
        {
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))) {
                // All user properties will be available here
            }

            var query = QueryBuilder
                .Select(SelectResult.All())
                .From(DataSource.Database(db)); // &lt;.&gt;

            // Adds a query change listener.
            // Changes will be posted on the main queue.
            var token = query.AddChangeListener((sender, args) =&gt; // &lt;.&gt;
            {
                var allResult = args.Results.AllResults();
                foreach (var result in allResult) {
                    Console.WriteLine(result.Keys);
                    /* Update UI */
                }
            });


            query.RemoveChangeListener(token);
            query.Dispose();
        }

        private static void SelectWhere()
        {
            Console.WriteLine("Where");
            var db = _Database;

            using (var query = QueryBuilder.Select(SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    var dict = result.GetDictionary(db.Name);
                    Console.WriteLine($"Document Name :: {dict?.GetString("name")}");
                }
            }
        }

        private static void UseCollectionContains()
        {
            Console.WriteLine("Collection Operator CONTAINS");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"),
                    SelectResult.Property("public_likes"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel"))
                    .And(ArrayFunction.Contains(Expression.Property("public_likes"),
                        Expression.String("Armani Langworth"))))) {
                foreach (var result in query.Execute()) {
                    var publicLikes = result.GetArray("public_likes");
                    var jsonString = JsonConvert.SerializeObject(publicLikes);
                    Console.WriteLine($"Public Likes :: {jsonString}");
                }
            }
        }

        private static void UseCollectionIn()
        {
            Console.WriteLine("Collection Operator IN");
            var db = _Database;

            var values = new IExpression[]
                { Expression.Property("first"), Expression.Property("last"), Expression.Property("username") };

            using (var query = QueryBuilder.Select(
                    SelectResult.All())
                .From(DataSource.Database(db))
                .Where(Expression.String("Armani").In(values))) {
                foreach (var result in query.Execute()) {
                    var body = result.GetDictionary(0);
                    var jsonString = JsonConvert.SerializeObject(body);
                    Console.WriteLine($"In results :: {jsonString}");
                }
            }
        }

        private static void SelectLike()
        {
            Console.WriteLine("Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Royal Engineers Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardLike()
        {
            Console.WriteLine("Wildcard Like");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Function.Lower(Expression.Property("name")).Like(Expression.String("Eng%e%"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectWildcardCharacterLike()
        {
            Console.WriteLine("Wildchard Characters");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Like(Expression.String("Royal Eng____rs Museum"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectRegex()
        {
            Console.WriteLine("Regex");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("name"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("landmark"))
                    .And(Expression.Property("name").Regex(Expression.String("\\bEng.*e\\b"))))
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void SelectJoin()
        {
            Console.WriteLine("Join");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Expression.Property("name").From("airline")),
                    SelectResult.Expression(Expression.Property("callsign").From("airline")),
                    SelectResult.Expression(Expression.Property("destinationairport").From("route")),
                    SelectResult.Expression(Expression.Property("stops").From("route")),
                    SelectResult.Expression(Expression.Property("airline").From("route")))
                .From(DataSource.Database(db).As("airline"))
                .Join(Join.InnerJoin(DataSource.Database(db).As("route"))
                    .On(Meta.ID.From("airline").EqualTo(Expression.Property("airlineid").From("route"))))
                .Where(Expression.Property("type").From("route").EqualTo(Expression.String("route"))
                    .And(Expression.Property("type").From("airline").EqualTo(Expression.String("airline")))
                    .And(Expression.Property("sourceairport").From("route").EqualTo(Expression.String("RIX"))))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Name Property :: {result.GetString("name")}");
                }
            }
        }

        private static void GroupBy()
        {
            Console.WriteLine("GroupBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Function.Count(Expression.All())),
                    SelectResult.Property("country"),
                    SelectResult.Property("tz"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("airport"))
                    .And(Expression.Property("geo.alt").GreaterThanOrEqualTo(Expression.Int(300))))
                .GroupBy(Expression.Property("country"), Expression.Property("tz"))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine(
                        $"There are {result.GetInt("$1")} airports in the {result.GetString("tz")} timezone located in {result.GetString("country")} and above 300 ft");
                }
            }
        }

        private static void OrderBy()
        {
            Console.WriteLine("OrderBy");
            var db = _Database;

            using (var query = QueryBuilder.Select(
                    SelectResult.Expression(Meta.ID),
                    SelectResult.Property("title"))
                .From(DataSource.Database(db))
                .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
                .OrderBy(Ordering.Property("title").Ascending())
                .Limit(Expression.Int(10))) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Title :: {result.GetString("title")}");
                }
            }
        }

      // ### EXPLAIN statement
      private static void TestExplainStatement()
      // For Documentation
      {
        var db = _Database;
        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type").EqualTo(Expression.String("hotel")))
            .GroupBy(Expression.Property("country"))
            .OrderBy(Ordering.Property("title").Ascending()) // &lt;.&gt;

          Console.WriteLine(query.Explain()); // &lt;.&gt;

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("%hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;
  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Expression.Property("type").Like(Expression.String("hotel%"))
      .And(Function.Lower(Expression.Property("name")).Like(Expression.String("%royal%")))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

var query =
  QueryBuilder
    .Select(SelectResult.All())
    .From(DataSource.Database(db))
    .Where(Function.Lower(Expression.Property("type")).EqualTo(Expression.String("hotel"))); // &lt;.&gt;

  Console.WriteLine(query.Explain());

        var query =
          QueryBuilder
            .Select(SelectResult.All())
            .From(DataSource.Database(db))
            .Where(Expression.Property("type")).EqualTo(Expression.String("hotel")); // &lt;.&gt;

          Console.WriteLine(query.Explain());

      }

      // end query-explain


        public void CreateFullTextIndex()
        {
            string[] indexProperties = new string[] { "overview", "name" };
            var config = new FullTextIndexConfiguration(indexProperties);
            db.CreateIndex("overviewFTSIndex", config);
        }

        public void FullTextSearch()
        {
            Console.WriteLine("Full text search");

            var db = _database;
            var ftsQuery = db.CreateQuery("SELECT * FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)");
            foreach (var result in ftsQuery.Execute())
            {
                Console.WriteLine($"Document id {result.GetString(0)}");
            }
            }
        }


        private static void CreateFullTextIndex_Querybuilder()
        {
            var db = _Database;

            if (_NeedsExtraDocs) {
                var tasks = new[] { "buy groceries", "play chess", "book travels", "buy museum tickets" };
                foreach (var task in tasks) {
                    using (var doc = new MutableDocument()) {
                        doc.SetString("type", "task");
                        doc.SetString("name", task);
                        db.Save(doc);
                    }
                }
            }


            var index = IndexBuilder.FullTextIndex(FullTextIndexItem.Property("overview")).IgnoreAccents(false);
            db.CreateIndex("overviewFTSIndex", index);
        }

        private static void FullTextSearch_Querybuilder()
        {
            Console.WriteLine("Full text search");
            var db = _Database;

            var whereClause = FullTextFunction.Match("overviewFTSIndex", "'michigan'");

            using (var query = QueryBuilder.Select(SelectResult.Expression(Meta.ID))
                .From(DataSource.Database(db))
                .Where(whereClause)) {
                foreach (var result in query.Execute()) {
                    Console.WriteLine($"Document id {result.GetString(0)}");
                }
            }
        }
        private static void StartReplication()
        {
            var db = _Database;

            /*
             * This requires Sync Gateway running with the following config, or equivalent:
             *
             * {
             *     "log":["*"],
             *     "databases": {
             *         "db": {
             *             "server":"walrus:",
             *             "users": {
             *                 "GUEST": {"disabled": false, "admin_channels": ["*"] }
             *             }
             *         }
             *     }
             * }
             */

            // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)
            var url = new Uri("ws://localhost:4984/db");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(db, target)
            {
                ReplicatorType = ReplicatorType.Pull
            };

            var replicator = new Replicator(config);
            replicator.Start();

            _Replicator = replicator;
        }

        private static void VerboseReplicatorLogging()
        {
            // deprecated
            Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
            Database.SetLogLevel(LogDomain.Network, LogLevel.Verbose);
        }

        private static void ConsoleLogging()
        {
            Database.Log.Console.Domains = LogDomain.All; // &lt;.&gt;
            Database.Log.Console.LogLevel = LogLevel.Verbose; // &lt;.&gt;


            Database.Log.Console.Domains = LogDomain.Database;

        }

        private static void FileLogging()
        {
            var tempFolder = Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;().DefaultDirectory(), "cbllog");
            var config = new LogFileConfiguration(tempFolder) // &lt;.&gt;
            {
                MaxRotateCount = 5, // &lt;.&gt;
                MaxSize = 10240, // &lt;.&gt;
                UsePlainText = false  // &lt;.&gt;
            };
            Database.Log.File.Config = config; // Apply configuration
            Database.Log.File.Level = LogLevel.Info; // &lt;.&gt;

        }

        private static void EnableCustomLogging()
        {
            Database.Log.Custom = new LogTestLogger(); // &lt;.&gt;
            or
            Database.Log.Custom = new LogTestLogger { Level = LogLevel.Warning };

        }

        private static void WriteConsoleLog()
        {
            Database.Log.Console.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }
        private static void WriteCustomLog()
        {
            Database.Log.Custom?.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }


        private static void WriteFileLog()
        {
            Database.Log.File.Log(LogLevel.Warning, LogDomain.Replicator, "Any old log message");
        }

        private static void EnableBasicAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new BasicAuthenticator("john", "pass");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void EnableSessionAuth()
        {
            var database = _Database;

            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);
            var config = new ReplicatorConfiguration(database, target);
            config.Authenticator = new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447");

            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void SetupReplicatorListener()
        {
            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
                    Console.WriteLine("Replication stopped");
                }
            });
        }




    //  BEGIN PendingDocuments IB -- 11/Feb/21 --
    private static void ReplicatorPendingDocuments()
    {
        var url = new Uri("ws://localhost:4984/mydatabase");
        var target = new URLEndpoint(url);
        var database = new Database("myDB");
        var config = new ReplicatorConfiguration(database, target);
        config.ReplicatorType  = ReplicatorType.Push;

        var replicator = new Replicator(config);

        var mydocids =
          new HashSet &lt;string&gt; (replicator.GetPendingDocumentIDs()); // &lt;.&gt;


        if (mydocids.Count &gt; 0)
        {
            Console.WriteLine($"There are {mydocids.Count} documents pending");
            replicator.AddChangeListener((sender, change) =&gt;
            {
                Console.WriteLine($"Replicator activity level is " +
                                  change.Status.Activity.ToString());
                // iterate and report-on previously
                // retrieved pending docids 'list'
                foreach (var thisId in mydocids)
                    if (!replicator.IsDocumentPending(thisId)) // &lt;.&gt;
                    {
                        Console.WriteLine($"Doc ID {thisId} now pushed");
                    };
            });

            replicator.Start();
        }
    }


//  END PendingDocuments IB -- 11/Feb/21 --



		private static void ReplicatorDocumentEvent()
        {
            var replicator = _Replicator;

            var token = replicator.AddDocumentReplicationListener((sender, args) =&gt;
            {
                var direction = args.IsPush ? "Push" : "Pull";
                Console.WriteLine($"Replication type :: {direction}");
                foreach (var document in args.Documents) {
                    if (document.Error == null) {
                        Console.WriteLine($"Doc ID :: {document.Id}");
                        if (document.Flags.HasFlag(DocumentFlags.Deleted)) {
                            Console.WriteLine("Successfully replicated a deleted document");
                        }
                    } else {
                        // There was an error
                    }
                }
            });

            replicator.Start();

            replicator.RemoveChangeListener(token);
        }

        private static void SetupReplicatorErrorListener()
        {
            // This can be done in the SetupReplicatorListener method
            // But it is separate so that we can have two documentation entries

            var replicator = _Replicator;

            replicator.AddChangeListener((sender, args) =&gt;
            {
                if (args.Status.Error != null) {
                    Console.WriteLine($"Error :: {args.Status.Error}");
                }
            });
        }

        private static void DatabaseReplica()
        {
            var db = _Database;
            using (var database2 = new Database("backup")) {
                // EE feature: This code will not compile on the community edition
                var targetDatabase = new DatabaseEndpoint(database2);
                var config = new ReplicatorConfiguration(db, targetDatabase)
                {
                    ReplicatorType = ReplicatorType.Push
                };

                var replicator = new Replicator(config);
                replicator.Start();

                _Replicator?.Stop();
                _Replicator = replicator;
            }
        }

        private static void PinCertificate()
        {
            // Note: No certificate is included here, so this code is for show only
            var url = new Uri("wss://localhost:4984/db");
            var target = new URLEndpoint(url);
            var db = _Database;

            // Note: `GetCertificate` is a fake method. This would be the platform-specific method
            // to find and load the certificate as an instance of `X509Certificate2`.
            // For .NET Core / .NET Framework this can be loaded from the filesystem path.
            // For UWP, from the assets directory.
            // For iOS, from the main bundle.
            // For Android, from the assets directory.
            var certificate = GetCertificate("cert.cer");
            var config = new ReplicatorConfiguration(db, target)
            {
                PinnedServerCertificate = certificate
            };
        }

        private static void ReplicationCustomHeaders()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target)
            {
                Headers = new Dictionary&lt;string, string&gt;
                {
                    ["CustomHeaderName"] = "Value"
                }
            };
        }

        private static void PushWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PushFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (flags.HasFlag(DocumentFlags.Deleted)) {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        private static void PullWithFilter(Database database)
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);
            config.PullFilter = (document, flags) =&gt; // &lt;1&gt;
            {
                if (document.GetString("type") == "draft") {
                    return false;
                }

                return true;
            };

            // Dispose() later
            var replicator = new Replicator(config);
            replicator.Start();
        }

        public void TestCustomRetryConfig()
        {
            var url = new Uri("ws://localhost:4984/mydatabase");
            var target = new URLEndpoint(url);

            var config = new ReplicatorConfiguration(database, target);

        //  other config as required . . .

            config.Heartbeat = TimeSpan.FromSeconds(120); //  &lt;.&gt;
            config.Maxattempts = 20; //  &lt;.&gt;
            config.MaxAttemptWaitTime = TimeSpan.FromSeconds(600); //  &lt;.&gt;

        //  other config as required . . .

            var repl = new Replicator(config);

        }


        private static void UsePredictiveModel()
        {
            using (var db = new Database("mydb")) {
                var model = new ImageClassifierModel();
                Database.Prediction.RegisterModel("ImageClassifier", model);

                var index = IndexBuilder.ValueIndex(ValueIndexItem.Property("label"));
                db.CreateIndex("value-index-image-classifier", index);

                Database.Prediction.UnregisterModel("ImageClassifier");
            }
        }

        private static void UsePredictiveIndex()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });

                var index = IndexBuilder.PredictiveIndex("ImageClassifier", input);
                db.CreateIndex("predictive-index-image-classifier", index);
            }
        }

        private static void DoPredictiveQuery()
        {
            using (var db = new Database("mydb")) {
                var input = Expression.Dictionary(new Dictionary&lt;string, object&gt;
                {
                    ["photo"] = Expression.Property("photo")
                });
                var prediction = PredictiveModel.predict("ImageClassifier", input); // &lt;1&gt;

                using (var q = QueryBuilder.Select(SelectResult.All())
                    .From(DataSource.Database(db))
                    .Where(prediction.Property("label").EqualTo(Expression.String("car"))
                        .And(prediction.Property("probability").GreaterThanOrEqualTo(Expression.Double(0.8))))) {
                    var result = q.Execute();
                    Console.WriteLine($"Number of rows: {result.Count()}");
                }
            }
        }

        static void Main(string[] args)
        {
            // This only needs to be done once for whatever platform the executable is running
            // (UWP, iOS, Android, or desktop)
            Couchbase.Lite.Support.NetDesktop.Activate();

            CreateNewDatabase();
            CreateDocument();
            UpdateDocument();
            UseTypedAccessors();
            DoBatchOperation();
            UseBlob();
            SelectMeta();

            LoadPrebuilt();
            CreateIndex();
            SelectWhere();
            UseCollectionContains();
            SelectLike();
            SelectWildcardLike();
            SelectWildcardCharacterLike();
            SelectRegex();
            SelectJoin();
            GroupBy();
            OrderBy();

            CreateFullTextIndex();
            FullTextSearch();
            StartReplication();
            SetupReplicatorListener();

            _Replicator.Stop();
            while (_Replicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
                // Database cannot close until replicators are stopped
                Console.WriteLine($"Waiting for replicator to stop (currently {_Replicator.Status.Activity})...");
                Thread.Sleep(200);
            }

            _Database.Close();
        }

        #endregion
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  ACTIVE SIDE  ----------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */

    class ActivePeer : IMessageEndpointDelegate
    {
        ActivePeer()
        {
            var id = "";

            var database = new Database("dbname");

            // The delegate must implement the `IMessageEndpointDelegate` protocol.
            var messageEndpointTarget = new MessageEndpoint(uid: "UID:123", target: "",
                protocolType: ProtocolType.MessageStream, delegateObject: this);

            var config = new ReplicatorConfiguration(database, messageEndpointTarget);

            // Create the replicator object
            var replicator = new Replicator(config);
            // Start the replicator
            replicator.Start();
        }

        /* implementation of MessageEndpointDelegate */
        public IMessageEndpointConnection CreateConnection(MessageEndpoint endpoint)
        {
            var connection = new ActivePeerConnection(); /* implements MessageEndpointConnection */
            return connection;
        }
    }

    class ActivePeerConnection : IMessageEndpointConnection
    {
        private IReplicatorConnection _replicatorConnection;

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public async Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // await socket.Open(), etc
            // throw MessagingException if something goes wrong
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    /* ----------------------------------------------------------- */
    /* ---------------------  PASSIVE SIDE  ---------------------- */
    /* ---------------  stubs for documentation  ----------------- */
    /* ----------------------------------------------------------- */
    class PassivePeerConnection : IMessageEndpointConnection
    {
        private MessageEndpointListener _messageEndpointListener;
        private IReplicatorConnection _replicatorConnection;

        public void StartListener()
        {
            var database = new Database("mydb");
            var config = new MessageEndpointListenerConfiguration(database, ProtocolType.MessageStream);
            _messageEndpointListener = new MessageEndpointListener(config);
        }

        public void StopListener()
        {
            _messageEndpointListener?.CloseAll();
        }

        public void AcceptConnection()
        {
            var connection = new PassivePeerConnection(); /* implements MessageEndpointConnection */
            _messageEndpointListener?.Accept(connection);
        }

        public void Disconnect()
        {
            _replicatorConnection?.Close(null);
        }

        public void Receive(byte[] data)
        {
            var message = Message.FromBytes(data);
            _replicatorConnection?.Receive(message);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Close(Exception error)
        {
            // await socket.Close, etc (or do nothing if already closed)
            // throw MessagingException if something goes wrong (though
            // since it is "close" nothing special will happen)
        }

        /* implementation of MessageEndpointConnection */
        public Task Open(IReplicatorConnection connection)
        {
            _replicatorConnection = connection;
            // socket should already be open on the passive side
            return Task.FromResult(true);
        }

        /* implementation of MessageEndpointConnection */
        public async Task Send(Message message)
        {
            var data = message.ToByteArray();
            // await Socket.Send(), etc
            // throw MessagingException if something goes wrong
        }
    }

    // tensorFlowModel is a fake implementation
    // this would be the implementation of the ml model you have chosen
    class TensorFlowModel
    {
        public static IDictionary&lt;string, object&gt; PredictImage(byte[] data)
        {
            // Do calculations, etc
            return null;
        }
    }

    class ImageClassifierModel : IPredictiveModel
    {
        public DictionaryObject Predict(DictionaryObject input)
        {
            var blob = input.GetBlob("photo");
            if (blob == null) {
                return null;
            }

            var imageData = blob.Content;
            // tensorFlowModel is a fake implementation
            // this would be the implementation of the ml model you have chosen
            var modelOutput = TensorFlowModel.PredictImage(imageData);
            return new MutableDictionaryObject(modelOutput); // &lt;1&gt;
        }
    }

    private class LogTestLogger : ILogger
    {
        public LogLevel Level { get; set; }

        public void Reset()
        {
            _lines.Clear();
        }

        public void Log(LogLevel level, LogDomain domain, string message)
        {
            // handle the message, for example piping it to
            // a third party framework
        }
    }

    class LocalWinConflictResolver : IConflictResolver
    {
        Document Resolve(Conflict conflict)
        {
            return conflict.LocalDocument;
        }
    }

    class RemoteWinConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            return conflict.RemoteDocument;
        }
    }

    class MergeConflictResolver : IConflictResolver
    {
        public Document Resolve(Conflict conflict)
        {
            var localDict = conflict.LocalDocument.ToDictionary();
            var remoteDict = conflict.RemoteDocument.ToDictionary();
            var result = localDict.Concat(remoteDict)
               .GroupBy(kv =&gt; kv.Key)
               .ToDictionary(g =&gt; g.Key, g =&gt; g.First().Value);
            return new MutableDocument(conflict.DocumentID, result);
        }
    }
}

// N1QL QUERY

  public List&lt;Result&gt; docsonly_N1QLQueryString(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = \"hotel\""); // &lt;.&gt;

      return thisQuery.Execute().AllResults();

  }


  public  List&lt;Result&gt; docsonly_N1QLQueryStringParams(Database argDB)
  {
      DatabaseConfiguration dbCfg = new DatabaseConfiguration();

      Database thisDb = new Database(dbName, dbCfg);

      // For Documentation -- N1QL Query
      // Declared elsewhere: Database argDB

      var thisQuery =
          thisDb.CreateQuery("SELECT META().id AS thisId FROM _ WHERE type = $type"); // &lt;.&gt;

      var n1qlParams = new Parameters();
      n1qlParams.SetString("type", "hotel"); // &lt;.&gt;
      thisQuery.Parameters = n1qlParams;

      return thisQuery.Execute().AllResults();

  }


// QUERY RESULT SET HANDLING EXAMPLES

    public static void testQuerySyntaxAll()
    {
        // For Documentation
        var dbName = "travel-sample";

        string thisDocsId;
        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        Dictionary&lt;string,object&gt; hotel = new Dictionary&lt;string,object&gt;();

        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
              .Select(SelectResult.All())
              .From(DataSource.Database(this_Db));


        var results = query.Execute().AllResults();

        if (results?.Count &gt; 0)
        {
            List&lt;Dictionary&lt;string,object&gt;&gt; hotels = new List&lt;Dictionary&lt;string,object&gt;&gt;();
            foreach (var result in results)
            {
                // get the result into our dictionary object
                var thisDocsProps = result.GetDictionary(dbName); // &lt;.&gt;

                if (thisDocsProps != null)
                {
                    thisDocsId = thisDocsProps.GetString("id"); // &lt;.&gt;
                    thisDocsName = thisDocsProps.GetString("name");
                    thisDocsCity = thisDocsProps.GetString("city");
                    thisDocsType = thisDocsProps.GetString("type");
                    hotel = thisDocsProps.ToDictionary();
                    hotels.Add(hotel);
                }

            }
        }


    foreach (var result in query.Execute().AsEnumerable()) {

        // get the result into a JSON String
                var thisDocsJSONString = result.ToJSON();// &lt;.&gt;

        // Get a native dictionary object using the JSON string
        var dictFromJSONstring =
              JsonConvert.
                DeserializeObject&lt;Dictionary&lt;string, object&gt;&gt;
                  (thisDocsJSONString); // &lt;.&gt;

        // use the created dictionary
        if (dictFromJSONstring != null)
        {
            thisDocsId = dictFromJSONstring["id"].ToString();
            thisDocsName = dictFromJSONstring["name"].ToString();
            thisDocsCity = dictFromJSONstring["city"].ToString();
            thisDocsType = dictFromJSONstring["type"].ToString();
        }

        //Get a custom object using the JSON string
        Hotel this_hotel =
            JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocsJSONString); // &lt;.&gt;

        // Store this hotel object in a list of hotels
        hotels.Add(
            this_hotel.Id.ToString(),
                this_hotel);

    } // end foreach result
  }


    private static void testQuerySyntaxProps()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        string thisDocsName;
        string thisDocsType;
        string thisDocsCity;
        var this_Db = new Database("hotels") ;

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();

        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var query = QueryBuilder.Select(
                SelectResult.Property("type"),
                SelectResult.Property("name"),
                SelectResult.Property("city")).From(DataSource.Database(this_Db));

        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            // get the returned array of k-v pairs into a dictionary
            hotel = result.ToDictionary();

            // add hotel dictionary to list of hotel dictionaries
            hotels.Add(hotel);

            // use the properties of the returned array of k-v pairs directly
            thisDocsType = result.GetString("type");
            thisDocsName = result.GetString("name");
            thisDocsCity = result.GetString("city");

        }

    } // test-query-access-props



    private static void testQuerySyntaxCount()
    {
        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();

        var this_Db = new Database("hotels") ;

        var query =
          QueryBuilder
            .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount")) // &lt;.&gt;
            .From(DataSource.Database(this_Db));




        var results = query.Execute().AllResults();

        foreach (var result in results)
        {

            var numberOfDocs = result.GetInt("mycount"); // &lt;.&gt;

        }

    }




    private static void ibQueryForID()
    {

        // For Documentation
        var dbName = "travel-sample";
        // var this_Db = new Database(dbName);

        Dictionary&lt;string, object&gt; hotel = new Dictionary&lt;string, object&gt;();
        List&lt;Dictionary&lt;string, object&gt;&gt; hotels = new List&lt;Dictionary&lt;string, object&gt;&gt;();


        var this_Db = new Database("hotels") ;

        var query = QueryBuilder
                .Select(SelectResult.Expression(Meta.ID).As("this_ID"))
                .From(DataSource.Database(this_Db));



        var results = query.Execute().AllResults();
        foreach (var result in results)
        {

            var thisDocsID = result.GetString("this_ID"); // &lt;.&gt;
            var doc = this_Db.GetDocument(thisDocsID);
        }

    }


    private static void testQueryPagination()
    {
      // For Documentation
      var dbName = "travel-sample";
      // var this_Db = new Database(dbName);

      var this_Db = new Database("hotels") ;

      var thisLimit = 20;
      var thisOffset = 0;

      // get a count of the number of docs matching the query
      var countQuery =
          QueryBuilder
              .Select(SelectResult.Expression(Function.Count(Expression.All())).As("mycount"))
              .From(DataSource.Database(this_Db));
      var numberOfDocs =
          countQuery.Execute().AllResults().ElementAt(0).GetInt("mycount");

      if (numberOfDocs &lt; thisLimit) {
          thisLimit = numberOfDocs;
      }

      while (thisOffset &lt; numberOfDocs)
      {
          var listQuery =
              QueryBuilder
                  .Select(SelectResult.All())
                  .From(DataSource.Database(this_Db))
                  .Limit(Expression.Int(thisLimit), Expression.Int(thisOffset)); // &lt;.&gt;

          foreach (var result in listQuery.Execute().AllResults())
          {
              // Display and or process query results batch

          }

          thisOffset = thisOffset + thisLimit;

      } // end while

    }

    // JSONAPIMETHODS



        public void JsonApiDocument()
        {

            Database this_DB = new Database("travel-sample");
            Database newDb = new Database("ournewdb");

            // Get a document
            var thisDoc = this_Db.GetDocument("hotel_10025");

            // Get document data as JSON String
            var thisDocAsJsonString = thisDoc?.ToJSON(); // &lt;.&gt;

            // Get Json Object from the Json String
            JObject myJsonObj = JObject.Parse(thisDocAsJsonString);

            // Get Native Object (anhotel) from JSON String
            List&lt;Hotel&gt; thehotels = new List&lt;Hotel&gt;();

            Hotel anhotel = new Hotel();
            anhotel = JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocAsJsonString);
            thehotels.Add(anhotel);

            // Update the retrieved native object
            anhotel.Name = "A Copy of " + anhotel.Name;
            anhotel.Id = "2001";

            // Convert the updated object back to a JSON string
            var newJsonString = JsonConvert.SerializeObject(anhotel);

            // Update new document with JSOn String
            MutableDocument newhotel =
                new MutableDocument(anhotel.Id, newJsonString); // &lt;.&gt;

            foreach (string key in newhotel.ToDictionary().Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}",
                    key, newhotel.GetValue(key));
            }

            newDb.Save(newhotel);

            var thatDoc = newDb.GetDocument("2001").ToJSON(); // &lt;.&gt;
            System.Console.Write(thatDoc);



        //    JSON String = { "description":"Very good and central","id":"1000","country":"France","name":"Hotel Ted","type":"hotel","city":"Paris"}
        //             type = hotel
        //             id = 1000
        //             country = France
        //             city = Paris
        //             description = Very good and central
        //             name = Hotel Ted
        //         */

        } // End JSONAPIDocument


    public void JsonApiArray()
        {
            // Init for docs
            //var this_Db = DataStore.getDbHandle();
            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }


            Database dbNew = new Database(ourdbname);

            // JSON String -- an Array (3 elements. including embedded arrays)
            var thisJSONstring = "[{'id':'1000','type':'hotel','name':'Hotel Ted','city':'Paris','country':'France','description':'Undefined description for Hotel Ted'},{'id':'1001','type':'hotel','name':'Hotel Fred','city':'London','country':'England','description':'Undefined description for Hotel Fred'},                        {'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}]".Replace("'", "\"");

            // Get JSON Array from JSON String
            JArray myJsonObj = JArray.Parse(thisJSONstring);

            // Create mutable array using JSON String Array
            var myArray = new MutableArrayObject();
            myArray.SetJSON(thisJSONstring);  // &lt;.&gt;


            // Create a new documenty for each array element
            for (int i = 0; i &lt; myArray.Count; i)             {                 var dict = myArray.GetDictionary(i);                 var docid = myArray[i].Dictionary.GetString("id");                 var newdoc = new MutableDocument(docid, dict.ToDictionary(; <i class="conum" data-value="2"></i><b>(2)</b>
                dbNew.Save(newdoc);
            }

            // Get one of the created docs and iterate through one of the embedded arrays
            var extendedDoc = dbNew.GetDocument("1002");
            var features = extendedDoc.GetArray("features");
            <i class="conum" data-value="3"></i><b>(3)</b>
            foreach (string feature in features) {
                System.Console.Write(feature);
                //process array item as required
            }
            var featuresJSON = extendedDoc.GetArray("features").ToJSON(); <i class="conum" data-value="4"></i><b>(4)</b>

        }


        public void JsonApiDictionary()
        {

            var ourdbname = "ournewdb";

            if (Database.Exists(ourdbname, "/"))
            {
                Database.Delete(ourdbname, "/");
            }
            Database dbNew = new Database(ourdbname);


            // Get dictionary from JSONstring
            var aJSONstring = "{'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDict = new MutableDictionaryObject(json: aJSONstring); <i class="conum" data-value="5"></i><b>(5)</b>

            // use dictionary to get name value
            var name = myDict.GetString("name");


            // Iterate through keys
            foreach (string key in myDict.Keys)
            {
                System.Console.WriteLine("Data -- {0} = {1}", key, myDict.GetValue(key).ToString());

            }

            /</strong>

                mono-stdout: Data -- id = 1002
                mono-stdout: Data -- type = hotel
                mono-stdout: Data -- name = Hotel Ned
                mono-stdout: Data -- city = Balmain
                mono-stdout: Data -- country = Australia
                mono-stdout: Data -- description = Undefined description for Hotel Ned
                mono-stdout: Data -- features = Couchbase.Lite.MutableArrayObject

            <strong>/
        } /</strong> end of func <strong>/


         public void JsonApiBlob()
        {
            // Init
            var ourpath = DataStore.getUserFolder();
            var ourdbname = "ournewdb";
            var userName = "ian";
            //ourpath = Path.Combine(ourpath,userName);

            if (Database.Exists(ourdbname, ourpath))
            {
                Database.Delete(ourdbname, ourpath);
            }
            var dbCfg = new DatabaseConfiguration();
            dbCfg.Directory=ourpath;
            Database dbNew = new Database(ourdbname,dbCfg);


            // Initialize base document for blob from a JSON string
            var docId = "1002";
            var aJSONstring = "{'ref':'hotel_1002','type':'hotel','name':'Hotel Ned'," +
                "'city':'Balmain','country':'Australia'," +
                "'description':'Undefined description for Hotel Ned'," +
                "'features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
            var myDoc = new MutableDocument(docId, aJSONstring); <i class="conum" data-value="6"></i><b>(6)</b>


            // Get the content (an image), create blob and add to doc)
            var defaultDirectory =
                Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;()
                            .DefaultDirectory(),
                                userName);
            var myImagePath = Path.Combine(defaultDirectory, "avatarimage.jpg");
            var myImageUri = new Uri(myImagePath.ToString());
            var myBlob = new Blob("image/jpg", myImageUri); <i class="conum" data-value="7"></i><b>(7)</b>
            myDoc.SetBlob("avatar", myBlob); <i class="conum" data-value="8"></i><b>(8)</b>


            // This example generates a 'blob not saved' exception
            try { Console.WriteLine("myBlob (unsaved) as JSON = {0}", myBlob.ToJSON());}
                catch (Exception e)
                    {Console.WriteLine("Exception = {0}", e.Message);}

            dbNew.Save(myDoc);

            // Alternatively -- depending on use case
            dbNew.SaveBlob(new Blob("image/jpg", myImageUri)); <i class="conum" data-value="9"></i><b>(9)</b>


            // Retrieve saved doc, get blob as JSON andheck its still a 'blob'
            var sameDoc = dbNew.GetDocument(docId);
            var reconstitutedBlob = new MutableDictionaryObject().
                SetDictionary("blobCOPY", new MutableDictionaryObject(sameDoc.GetBlob("avatar").ToJSON())); <i class="conum" data-value="10"></i><b>(10)</b>

            if (Blob.IsBlob(
                    reconstitutedBlob.GetDictionary("blobCOPY").ToDictionary()))  <i class="conum" data-value="11"></i><b>(11)</b>
            {
               //... process accordingly
               Console.WriteLine("Its a Blob!!");
            }

            var datavalue = "";
            foreach (string key in myDoc.Keys)
            {
                if (key == "features")
                {
                    datavalue = "features are: ";
                    foreach (string item in myDoc.GetArray(key))
                    {
                        datavalue = datavalue + ", " + item;
                    }
                }
                else if (key == "avatar")
                {
                    datavalue = sameDoc.GetBlob(key).ToJSON();
                }
                else
                {
                    datavalue = sameDoc.GetValue(key).ToString();
                }

                System.Console.WriteLine(" Data -- {0} = {1}", key, datavalue);
            }

            // System.Console.WriteLine(" reconstitutedBlob = {0}", reconstitutedBlob.GetDictionary("blobCOPY").ToJSON());



            //}

            /</strong>


                Exception = Missing Digest Due To Blob Is Not Saved To Database yet.

                Data -- id = 1002
                Data -- type = hotel
                Data -- name = Hotel Ned
                Data -- city = Balmain
                Data -- country = Australia
                Data -- description = Undefined description for Hotel Ned
                Data -- features = features are: , Cable TV, Toaster, Microwave
                Data -- avatar = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

                blobAsJSONstring = {"digest":"sha1-sdCxeOeP3IZV4FEvVVlvtulpWA8=","length":2975,"content_type":"image/jpg","@type":"blob"}

            <strong>/
        } /</strong> end of func <strong>/




  } // end of class



// p2p sync items


var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="12"></i><b>(12)</b>

thisConfig.Authenticator =
  new ListenerPasswordAuthenticator(
    (sender, username, password) =&gt;
      {
      return username.equals("valid.user")  &amp;&amp; (password == validPassword);
      }
  ); <i class="conum" data-value="13"></i><b>(13)</b>

_thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="14"></i><b>(14)</b>

_thisListener.Start(); <i class="conum" data-value="15"></i><b>(15)</b>




var theListenerEndpoint = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="16"></i><b>(16)</b>

var thisConfig = new ReplicatorConfiguration(thisDB, theListenerEndpoint); <i class="conum" data-value="17"></i><b>(17)</b>

thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="18"></i><b>(18)</b>

thisConfig.Authenticator =
  new BasicAuthenticator("valid.user", "valid.password.string"); <i class="conum" data-value="19"></i><b>(19)</b>

var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="20"></i><b>(20)</b>

thisReplicator.Start(); <i class="conum" data-value="21"></i><b>(21)</b>








// PASSIVE PEER STUFF
// Stuff I adapted
//
//
// p2pSync-websockets.cs
//
// Copyright (c) 2017 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using System.Threading.Tasks;

using Couchbase.Lite;
using Couchbase.Lite.Enterprise.Query;
using Couchbase.Lite.Logging;
using Couchbase.Lite.P2P;
using Couchbase.Lite.Query;
using Couchbase.Lite.Sync;
using Newtonsoft.Json;

using SkiaSharp;
namespace api_walkthrough
{
  class Program
  {
  private static Database _Database;
  private static Replicator _Replicator;
  private static ListenerToken _thisListenerToken;
  private static bool _NeedsExtraDocs;

  #region Private Methods
  private static void GettingStarted()
  {

    // Initialize the listener config
    var thisConfig = new URLEndpointListenerConfiguration(thisDB); <i class="conum" data-value="22"></i><b>(22)</b>

    thisConfig.Port = 55990; <i class="conum" data-value="23"></i><b>(23)</b>

    thisConfig.NetworkInterface = "10.1.1.10"; <i class="conum" data-value="24"></i><b>(24)</b>

    thisConfig.EnableDeltaSync = true; <i class="conum" data-value="25"></i><b>(25)</b>

    thisConfig.DisableTLS = false; <i class="conum" data-value="26"></i><b>(26)</b>

    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="27"></i><b>(27)</b>

    // Configure the client authenticator
    // Here we are using Basic Authentication) <i class="conum" data-value="28"></i><b>(28)</b>
    SecureString validPassword =  new SecureString(); /</strong> example only <strong>/
    // Get SecureString input for validPassword
    var validUser = "valid.username";
    thisConfig.Authenticator = new ListenerPasswordAuthenticator(
      (sender, validUser, validPassword) =&gt;
        {
          return username.equals(validUser)  &amp;&amp; password == validPassword);
        }
      );

    // Initialize the listener
    _thisListener = new URLEndpointListener(thisConfig); <i class="conum" data-value="29"></i><b>(29)</b>

    // Start the listener
    thisListener.Start(); <i class="conum" data-value="30"></i><b>(30)</b>

  }

  thisConfig.disableTLS = true;


  // Use “anonymous” cert. These are self signed certs created by the system
  thisConfig.TlsIdentity = null;


  thisConfig.EnableDeltaSync = true;


  int connectionCount = thisListener.Status.ConnectionCount; <i class="conum" data-value="31"></i><b>(31)</b>
  int activeConnectionCount = thisListener.Status.ActiveConnectionCount;  <i class="conum" data-value="32"></i><b>(32)</b>



  thisListener.Stop();


// Additional snippets


foreach(NetworkInterface ni in NetworkInterface.GetAllNetworkInterfaces())
{
  if(ni.NetworkInterfaceType == NetworkInterfaceType.Wireless80211 ||
      ni.NetworkInterfaceType == NetworkInterfaceType.Ethernet)
  {
    // do something with the interface(s)
  }
}



var thisConfig = new URLEndpointListenerConfiguration(thisDB);
_thisListener = new URLEndpointListener(thisConfig);

_thisListener.Start();

 Console.WriteLine("URLS are {0} ", thisListener.Urls;


    thisConfig.DisableTLS = true; <i class="conum" data-value="33"></i><b>(33)</b>


    // . . . preceding application logic . . .
    // Get the database (and create it if it doesn't exist)
    var thisDB = new Database("mydb");


    // Use CA Cert
    // Create a TLSIdentity from an imported key-pair
    // . . . previously declared variables include ...
    TLSIdentity thisIdentity;
    X509Store _store =
      new X509Store(StoreName.My); // create and label x509 store

    // Get keys and certificates from PKCS12 data
    byte[] thisIdData =
      File.ReadAllBytes("c:client.p12"); <i class="conum" data-value="34"></i><b>(34)</b>
    // . . . other user code . . .

    thisIdentity = TLSIdentity.ImportIdentity(
      _store,
      thisIdData, <i class="conum" data-value="35"></i><b>(35)</b>
      "123", // Password to access certificate data
      "couchbase-demo-cert",
      null); // Label to get cert in certificate map
        // NOTE: If a null label is supplied then the same
        // default directory for a Couchbase Lite database
        // is used for map.


    // Use an Anonymous Self-Signed Cert
    thisConfig.TlsIdentity = null; <i class="conum" data-value="36"></i><b>(36)</b>

    // Set the TLS Identity
    thisConfig.TlsIdentity = thisIdentity; <i class="conum" data-value="37"></i><b>(37)</b>


    // Configure the client authenticator
    // to validate using ROOT CA

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="38"></i><b>(38)</b>
    var clientData = File.ReadAllBytes("c:client.p12");
    var ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData); <i class="conum" data-value="39"></i><b>(39)</b>

    // Configure the authenticator to use the root certs
    var thisAuth = new ListenerCertificateAuthenticator(new X509Certificate2Collection(thisRootCert));

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="40"></i><b>(40)</b>

    // Initialize the listener using the config
    _listener = new URLEndpointListener(thisConfig);

    // Configure the client authenticator
    // to validate using application logic

    // Get the valid cert chain, in this instance from
    // PKCS12 data containing private key, public key
    // and certificates <i class="conum" data-value="41"></i><b>(41)</b>
    clientData = File.ReadAllBytes("c:client.p12");
    ourCaData = File.ReadAllBytes("c:client-ca.der");

    // Get the root certs from the data
    var thisRootCert = new X509Certificate2(ourCaData);

    // Configure the authenticator to pass the root certs
    // To a user supplied code block for authentication
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert) =&gt; {
          // . . . user supplied code block
          // . . . returns boolean value (true=authenticated)
        }); <i class="conum" data-value="42"></i><b>(42)</b>

    thisConfig.Authenticator = thisAuth; <i class="conum" data-value="43"></i><b>(43)</b>




// END Additional






// Listener Callouts


  &lt;.&gt; Initialize the listener instance using the configuration settings.
  &lt;.&gt; Start the listener, ready to accept connections and incoming data from active peers.



  &lt;.&gt; <code>connectionCount</code> -- the total number of connections served by the listener
  &lt;.&gt; <code>activeConnectionCount</code> -- the number of active (BUSY) connections currently being served by the listener
  //

  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; PKCS12 data containing private key, public key, and certificates
  &lt;.&gt; The key pair as stored in the byte array
  &lt;.&gt; The password required to access the certificate data
  &lt;.&gt; The key label assigned to the cert in certificate map and used for retrieval
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>


  &lt;.&gt; Ensure TLS is enabled.
  &lt;.&gt; The identity will be stored in the secure storage using the given label
  &lt;.&gt; When creating a certificate, the common name attribute is required to create a CSR. If the common name is not present in the certificate an exception is thrown.
  &lt;.&gt; If the expiration date is not specified, the expiration date of the certificate is 365 days after creation
  &lt;.&gt; The key label to get cert in certificate map
  &lt;.&gt; If null, the same default directory for a Couchbase Lite database is used for map
  &lt;.&gt; Use the TLSIdentity <code>thisIdentity.</code>










  // cert is a pre-populated object of type:SecCertificate representing a certificate
  // Work in progress. Code snippet to be provided.



  // prev content of listener-config-client-auth-self-signed (for ios)
  thisConfig.authenticator = ListenerCertificateAuthenticator.init {
    (cert) -&gt; Bool in
    var cert:SecCertificate
    var certCommonName:CFString?
    let status=SecCertificateCopyCommonName(cert, &amp;certCommonName)
    if (self._allowlistedUsers.contains(["name": certCommonName! as String])) {
      return true
    }
    return false
  }
  // Work in progress. Code snippet to be provided.


public class URLEndpointListener {
    // Properties <i class="conum" data-value="1"></i><b>(1)</b>
    public let config: URLEndpointListenerConfiguration
    public let port UInt16?
    public let tlsIdentity: TLSIdentity?
    public let urls: Array&lt;URL&gt;?
    public let status: ConnectionStatus?
    // Constructors <i class="conum" data-value="2"></i><b>(2)</b>
    public init(config: URLEndpointListenerConfiguration)
    // Methods <i class="conum" data-value="3"></i><b>(3)</b>
    public func start() throws
    public func stop()
}


let config = URLEndpointListenerConfiguration.init(database: self.oDB)
thisConfig.port = tls ? wssPort : wsPort
thisConfig.disableTLS = !tls
thisConfig.authenticator = auth
self.listener = URLEndpointListener.init(config: config) <i class="conum" data-value="1"></i><b>(1)</b>


// ACTIVE PEER STUFF
// Replication code
//
// Copyright (c) 2019 Couchbase, Inc All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

public class Examples {
  private static final String TAG = "EXAMPLE ACTIVE PEER";
  private static final String thisDBNAME = "local-database";
  private final Context context;
  // private Database database;
  // private Replicator replicator;

  public Examples(Context context) { this.context = context; }

  String user = "syncuser";
  String password = "sync9455";
  SecCertificate cert=null;
  String passivePeerEndpoint = "10.1.1.12:8920";
  String passivePeerPort = "8920";
  String passiveDbName = "userdb";
  Database thisDB;
  Replicator thisReplicator;
  ListenerToken replicatorListener;

  //@Test
  public void testActPeerSync() throws CouchbaseLiteException, URISyntaxException {
    // . . . preceding code. for example . . .
    private static ListenerToken _thisListenerToken;
    var Database thisDB;
    // . . . other code . . .
    // initialize the replicator configuration

    var thisUrl = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="44"></i><b>(44)</b>
    var config = new ReplicatorConfiguration(thisDB, thisUrl);


    // Set replicator type
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

    // Set autopurge option
    // here we override its default
    thisConfig.EnableAutoPurge = false; <i class="conum" data-value="45"></i><b>(45)</b>

    // Configure Sync Mode
    thisConfig.Continuous = true; // default value

    // Configure Server Security -- only accept self-signed certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="46"></i><b>(46)</b>

    // Configure Client Security <i class="conum" data-value="47"></i><b>(47)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");

    /</strong> Optionally set a conflict resolver call back <strong>/ <i class="conum" data-value="48"></i><b>(48)</b>
    // Use built-in resolver
    thisConfig.ConflictResolver = new LocalWinConflictResolver();  //

    // optionally use custom resolver
    thisConfig.ConflictResolver = new ConflictResolver(
      (conflict) =&gt; {
        /</strong> define resolver function */
      }
    ); //

    // Initialize and start a replicator
    // Initialize replicator with configuration data
    var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="49"></i><b>(49)</b>

    //Optionally add a change listener <i class="conum" data-value="50"></i><b>(50)</b>
    _thisListenerToken =
      thisReplicator.AddChangeListenersender, args) =&gt;         {           if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {               Console.WriteLine("Replication stopped");           }         });      // Start replicator     thisReplicator.Start(); <i class="conum" data-value="51"></i><b>(51)</b>  }  // Additional snippets      // Configure Server Security -- only accept CA certs     thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="52"></i><b>(52)</b>       // Return the remote pinned cert (the listener's cert)     byte returnedCert = new byte(thisConfig.getPinnedCertificate(; // Get listener cert if pinned
    // Configure Client Security <i class="conum" data-value="53"></i><b>(53)</b>
    // Configure basic auth using user credentials
    thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");


    // Only CA Certs accepted
    thisConfig.AcceptOnlySelfSignedServerCertificate =
      false; <i class="conum" data-value="54"></i><b>(54)</b>

    var thisCert =
      new X509Certificate2(caData); <i class="conum" data-value="55"></i><b>(55)</b>

    thisConfig.PinnedServerCertificate =
      thisCert; <i class="conum" data-value="56"></i><b>(56)</b>













    // Code to refactor
    Log.i(TAG, "The Replicator is currently " + thisReplicator.Status().getActivityLevel());

    Log.i(TAG, "The Replicator has processed " + t);

    if (thisReplicator.Status().getActivityLevel() == Replicator.ActivityLevel.BUSY) {
          Log.i(TAG, "Replication Processing");
          Log.i(TAG, "It has completed " + thisReplicator.Status().getProgess().getTotal() + " changes");
      }
    _thisReplicator.Stop();
    while (_thisReplicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
        // Database cannot close until replicators are stopped
        Console.WriteLine($"Waiting for replicator to stop (currently {_thisReplicator.Status.Activity})...");
        Thread.Sleep(200);
    }
    _thisDatabase.Close();

      // Stop replication.
      thisReplicator.Stop(); <i class="conum" data-value="57"></i><b>(57)</b>


  }

{
  CouchbaseLite.init(context);
  Database thisDB = new Database("passivepeerdb");  <i class="conum" data-value="58"></i><b>(58)</b>
  // Initialize the listener config
  final URLEndpointListenerConfiguration thisConfig = new URLEndpointListenerConfiguration(database);
  thisConfig.Port(55990)             // &lt;.&gt; Default- port is selected
  thisConfig.DisableTls(false)       // &lt;.&gt; Optional. Defaults to false. You get TLS encryption out-of-box
  thisConfig.EnableDeltaSync(true)   // &lt;.&gt; Optional. Defaults to false.

  // Configure the client authenticator (if using basic auth)
  ListenerPasswordAuthenticator auth = new ListenerPasswordAuthenticator { "Our Username", "Our Password"}; <i class="conum" data-value="59"></i><b>(59)</b>
  thisConfig.Authenticator(auth); <i class="conum" data-value="60"></i><b>(60)</b>

  // Initialize the listener
  final URLEndpointListener listener = new URLEndpointListener( thisConfig ); <i class="conum" data-value="61"></i><b>(61)</b>

  // Start the listener
  listener.Start(); <i class="conum" data-value="62"></i><b>(62)</b>
    }



Map&lt;String, String&gt; X509_ATTRIBUTES = mapOf(
           TLSIdentity.CERT_ATTRIBUTE_COMMON_NAME to "Couchbase Demo",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION to "Couchbase",
           TLSIdentity.CERT_ATTRIBUTE_ORGANIZATION_UNIT to "Mobile",
           TLSIdentity.CERT_ATTRIBUTE_EMAIL_ADDRESS to "<a href="mailto:noreply@couchbase.com">noreply@couchbase.com</a>"
       )

TLSIdentity thisIdentity = new TLSIdentity.createIdentity(true, X509_ATTRIBUTES, null, "test-alias");



. . . work in progress - GetHashCode snippet to be provided

TLSIdentity.DeleteIdentity(_store, "alias-to-delete", null);


// OPTIONALLY:: Retrieve a stored TLS identity using its alias/label

TLSIdentity thisIdentity = new TLSIdentity.getIdentity("CBL-Demo-Server-Cert")


    // Configure the client authenticator (if using Basic Authentication)
    // String validUser = new String("validUsername"); // an example username
    // String validPassword = new String("validPasswordValue"); // an example password

    // ListenerPasswordAuthenticator thisAuth = new ListenerPasswordAuthenticator( <i class="conum" data-value="63"></i><b>(63)</b>
    //   validUser, validPassword -&gt; validUser == "validUsername" &amp;&amp; validPassword == "validPasswordValue" );

    // if (thisAuth) {
    //   thisConfig.Authenticator(auth);
    // }
    // else {
    //   // . . . authentication failed take appropriate exception action
    //   return
    // };




    ListenerToken thisListener = new thisReplicator.addChangeListener(change -&gt; { <i class="conum" data-value="64"></i><b>(64)</b>
      if (change.Status().getError() != null) {
        Log.i(TAG, "Error code ::  " + change.Status().getError().getCode());
      }
    });




// g u b b i n s


    // Configure TLS Cert CA auth using key-stored cert id alias 'doc-sync-server'

    // TLSIdentity thisIdentity = new TLSIdentity.getIdentity("doc-sync-server"); // Get existing TLS ID from sec storage

    // ClientCertificateAuthenticator thisAuth = new ClientCertificateAuthenticator(thisIdentity);

    // thisConfig.Authenticator(thisAuth);



    // USE KEYCHAIN IDENTITY IF EXISTS
    // Check if Id exists in keychain. If so use that Id

    // STILL NEED TO REFACTOR

    do {
      if let thisIdentity = try TLSIdentity.identity(withLabel: "doco-sync-server") {
          print("An identity with label : doco-sync-server already exists in keychain")
          return thisIdentity
          }
    } catch
    {return nil}
    thisAuthenticator.ClientCertificateAuthenticator(identity: thisIdentity )
    thisConfig.thisAuthenticator




String thisAlias = "alias-to-delete";
KeyStore thisKeystore = KeyStore.getInstance("PKCS12"); <i class="conum" data-value="65"></i><b>(65)</b>
thisKeyStore.load= null;
if (thisAlias != null) {
   thisKeystore.deleteEntry(thisAlias);  <i class="conum" data-value="66"></i><b>(66)</b>
}



// cert auth
let rootCertData = SecCertificateCopyData(cert) as Data
let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])

SecCertificate thisCert = new SecCertificate(); // populated as nec.

Data rootCertData = new Data(SecCertificateCopyData(thisCert));

let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
thisConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])
// cert auth


// C A L L O U T S

&lt;.&gt; Configure to accept only CA certs
&lt;.&gt; Configure the pinned certificate using data from the byte array <code>cert</code>
&lt;.&gt; Set the certificate to be compared with that provided by the server

&lt;.&gt; PKCS12 data containing private key, public key, and certificates
&lt;.&gt; This is the default value and means that TLS is enabled

&lt;.&gt; Refuse self-signed certificates
&lt;.&gt; Get the identity
&lt;.&gt; Set the Client Certificate Authenticator to require signed certificates with this identity



    // Configure the client authenticator
    // to validate using ROOT CA <i class="conum" data-value="67"></i><b>(67)</b>
    byte[] thisCaData; // byte array for CA data
    using (var thisReader = new BinaryReader(stream)) {
      thisCaData = thisReader.ReadBytes(int stream.Length);
    }; // Get cert data

    var thisRootCert = new X509Certificate(thisCaData); //

    thisConfig.Authenticator = new  ListenerCertificateAuthenticator(
      new X509Certificate2Collection(thisRootCert)
    );




    var db = new Database("other-database");
    _Database = db;
    X509Store _store = new X509Store(StoreName.My);
    TLSIdentity thisIdentity;


    // Configure the expected server-supplied
    // credentials -- only accept CA Certs
    thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="68"></i><b>(68)</b>

    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="69"></i><b>(69)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="70"></i><b>(70)</b>






    byte[] thisCaData, thisClientData;
    thisClientData = File.ReadAllBytes("C:\\client.p12"); <i class="conum" data-value="71"></i><b>(71)</b>
    thisCaData = File.ReadAllBytes("C:\\client-ca.der");

    // Root certs
    var thisRootCert = new X509Certificate2(thisCaData);
    var thisAuth =
      new ListenerCertificateAuthenticator(
        new X509Certificate2Collection(thisRootCert));

    // Create URL Endpoint Listener
    var thisConfig = new URLEndpointListenerConfiguration(_Database);
    thisConfig.DisableTLS = false; <i class="conum" data-value="72"></i><b>(72)</b>
    thisConfig.Authenticator = thisAuth;
    _listener = new URLEndpointListener(thisConfig);
    _listener.Start();

    // Client identity
    thisIdentity = TLSIdentity.ImportIdentity(_store,
        thisClientData,
        "123",
        "CBL-Client-Cert",
        null);

    // Replicator -- Client
    var database = new Database("client-database");
    var builder = new UriBuilder(
        "wss",
        "localhost",
        _listener.Port,
        $"/{_listener.thisConfig.Database.Name}"
    );

    var url = builder.Uri;
    var target = new URLEndpoint(url);
    var thisConfig = new ReplicatorConfiguration(database, target);
    thisConfig.ReplicatorType = ReplicatorType.PushAndPull;
    thisConfig.Continuous = false;
    thisConfig.Authenticator = new ClientCertificateAuthenticator(thisIdentity);
    thisConfig.AcceptOnlySelfSignedServerCertificate = true;
    thisConfig.PinnedServerCertificate = _listener.TlsIdentity.Certs[0];
    using (var replicator = new Replicator(thisConfig)) {
        replicator.Start();
    }





    // Stop listener after replicator is stopped
    _listener.Stop();



    // Client identity
    thisIdentity =
      TLSIdentity.ImportIdentity(_store,
        clientData,
        "123",
        "CBL-Client-Cert",
        null); <i class="conum" data-value="73"></i><b>(73)</b>

    thisConfig.Authenticator =
      new ClientCertificateAuthenticator(thisIdentity); <i class="conum" data-value="74"></i><b>(74)</b>



  // For replications

  // BEGIN -- snippets --
  //    Purpose -- code samples for use in replication topic

  public class MyClass
  {
      public Database Database { get; set; }
      public Replicator Replicator { get; set; } <i class="conum" data-value="75"></i><b>(75)</b>

      public void StartReplication()
      {
  }

          var url = new Uri("wss://localhost:4984/db"); <i class="conum" data-value="76"></i><b>(76)</b>
          var target = new URLEndpoint(url);
          var config = new ReplicatorConfiguration(Database, target)
          {
              ReplicatorType = ReplicatorType.Pull
          };

          Replicator = new Replicator(config);
          Replicator.Start();
      }

      // &lt;.&gt; A replication is an asynchronous operation.
      // To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
      // &lt;.&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
      // You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.

      public void InitReplication()
      {
        // initialize the replicator configuration

        var thisUrl = new URLEndpoint("wss://l10.0.2.2:4984/anotherDB"); <i class="conum" data-value="77"></i><b>(77)</b>
        var config = new ReplicatorConfiguration(thisDB, thisUrl);

      }
  }
 }



  public class supporting_datatypes
  {
      public void datatype_dictionary()
      {
          var database = new Database(name: "mydb");

          // NOTE: No error handling, for brevity (see getting started)
          var document = database.GetDocument("doc1");

          // Getting a dictionary from the document's properties
          var dict = document.GetDictionary("address");

          // Access a value with a key from the dictionary
          var street = dict.GetString("street");

          // Iterate dictionary
          foreach (var key in dict.Keys)
          {
              Console.WriteLine($"Key {key} = {dict.GetValue(key)}");
          }

          // Create a mutable copy
          var mutDict = dict.ToMutable();
      }

      public void datatype_mutable_dictionary()
      {

          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable dictionary and populate some keys/values
          var mutable_dict = new MutableDictionaryObject();
          mutable_dict.SetString("street", "1 Main st.");
          mutable_dict.SetString("city", "San Francisco");

          // Add the dictionary to a document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetDictionary("address", mutable_dict);
          database.Save(doc);

      }


      public void datatype_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          var document = database.GetDocument("doc1");

          // Getting a phones array from the document's properties
          var array = document.GetArray("phones");

          // Get element count
          var count = array.Count();

          // Access an array element by index
          if (count &gt;= 0) { var phone = array[1]; }

          // Iterate dictionary
          for (int i = 0; i &lt; count; i++)
          {
              Console.WriteLine($"Item {i.ToString()} = {array[i]}");
          }

          // Create a mutable copy
          var mutable_array = array.ToMutable();


      }

        public void datatype_mutable_array()
      {
          var database = new Database("mydb");

          // NOTE: No error handling, for brevity (see getting started)

          // Create a new mutable array and populate data into the array
          var mutable_array = new MutableArrayObject();
          mutable_array.AddString("650-000-0000");
          mutable_array.AddString("650-000-0001");

          // Set the array to document's properties and save the document
          var doc = new MutableDocument("doc1");
          doc.SetArray("phones", mutable_array);
          database.Save(doc);
      }

  } // end  class supporting_datatypes</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-types"><a class="anchor" href="#data-types"></a>Data Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="scalars"><a class="anchor" href="#scalars"></a>Scalars</h3>
<div class="paragraph">
<p>The <code>Document</code> class offers a set of property accessors for various scalar types, including boolean, integers, floating-point and strings.
These accessors take care of converting to/from JSON encoding, and make sure you get the type you&#8217;re expecting.</p>
</div>
<div class="paragraph">
<p>So your document content may well comprise one or more supporting data types such as:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Double</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerator</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HashCode</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dictionary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a read-only key-value pair collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MutableDictionary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a writeable key-value pair collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a readonly ordered collection of objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MutableArray</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a writeable collection of objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an arbitrary piece of binary data</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="date-accessors"><a class="anchor" href="#date-accessors"></a>Date accessors</h3>
<div class="paragraph">
<p>As a convenience Couchbase Lite offers <em>Date</em> accessors.
Dates are a common data type, but JSON doesn&#8217;t natively support them, so the convention is to store them as strings in ISO-8601 format.</p>
</div>
<div id="ex-date-getter" class="exampleblock">
<div class="title">Example 1. Date Getter</div>
<div class="content">
<div class="paragraph">
<p>This example sets the date on the <code>createdAt</code> property and reads it back using the <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.Document.html#Couchbase_Lite_Document_GetDate_System_String_">Document.GetDate()</a> accessor method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">newTask.SetValue("createdAt", DateTimeOffset.UtcNow);
var date = newTask.GetDate("createdAt");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-dictionaries"><a class="anchor" href="#using-dictionaries"></a>Using Dictionaries</h3>
<div class="ulist">
<div class="title">API References</div>
<ul>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.DictionaryObject.html">DictionaryObject</a></p>
</li>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.MutableDictionaryObject.html">MutableDictionaryObject</a></p>
</li>
</ul>
</div>
<div id="ex-dict" class="exampleblock">
<div class="title">Example 2. Read Only</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">// NOTE: No error handling, for brevity (see getting started)
var document = database.GetDocument("doc1");

// Getting a dictionary from the document's properties
var dict = document.GetDictionary("address");

// Access a value with a key from the dictionary
var street = dict.GetString("street");

// Iterate dictionary
foreach (var key in dict.Keys)
{
    Console.WriteLine($"Key {key} = {dict.GetValue(key)}");
}

// Create a mutable copy
var mutDict = dict.ToMutable();</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-mutdict" class="exampleblock">
<div class="title">Example 3. Mutable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">// NOTE: No error handling, for brevity (see getting started)

// Create a new mutable dictionary and populate some keys/values
var mutable_dict = new MutableDictionaryObject();
mutable_dict.SetString("street", "1 Main st.");
mutable_dict.SetString("city", "San Francisco");

// Add the dictionary to a document's properties and save the document
var doc = new MutableDocument("doc1");
doc.SetDictionary("address", mutable_dict);
database.Save(doc);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-arrays"><a class="anchor" href="#using-arrays"></a>Using Arrays</h3>
<div class="ulist">
<div class="title">API References</div>
<ul>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.ArrayObject.html">ArrayObject</a></p>
</li>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.MutableArrayObject.html">MutableArrayObject</a></p>
</li>
</ul>
</div>
<div id="ex-array" class="exampleblock">
<div class="title">Example 4. Read Only</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">// NOTE: No error handling, for brevity (see getting started)

var document = database.GetDocument("doc1");

// Getting a phones array from the document's properties
var array = document.GetArray("phones");

// Get element count
var count = array.Count();

// Access an array element by index
if (count &gt;= 0) { var phone = array[1]; }

// Iterate dictionary
for (int i = 0; i &lt; count; i++)
{
    Console.WriteLine($"Item {i.ToString()} = {array[i]}");
}

// Create a mutable copy
var mutable_array = array.ToMutable();</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-mutarray" class="exampleblock">
<div class="title">Example 5. Mutable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">// NOTE: No error handling, for brevity (see getting started)

// Create a new mutable array and populate data into the array
var mutable_array = new MutableArrayObject();
mutable_array.AddString("650-000-0000");
mutable_array.AddString("650-000-0001");

// Set the array to document's properties and save the document
var doc = new MutableDocument("doc1");
doc.SetArray("phones", mutable_array);
database.Save(doc);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-blobs"><a class="anchor" href="#using-blobs"></a>Using Blobs</h3>
<div class="paragraph">
<p>For more on working with blobs&#8201;&#8212;&#8201;see <a href="blob.html" class="page">Blobs</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-initializers"><a class="anchor" href="#document-initializers"></a>Document Initializers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following methods/initializers can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.MutableDocument.html#Couchbase_Lite_MutableDocument__ctor">MutableDocument()</a> initializer can be used to create a new document where the document ID is randomly generated by the database.</p>
</li>
<li>
<p>The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.MutableDocument.html#Couchbase_Lite_MutableDocument_Item_System_String_">MutableDocument(String id)</a> initializer can be used to create a new document with a specific ID.</p>
</li>
<li>
<p>The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.Database.htmlMutableDictionaryObject#Couchbase_Lite_Database_GetDocument_System_String_">Database.GetDocument()</a> method can be used to get a document.
If it doesn&#8217;t exist in the database, it will return <code>null</code>.
This method can be used to check if a document with a given ID already exists in the database.</p>
</li>
</ul>
</div>
<div id="ex-persists-doc" class="exampleblock">
<div class="title">Example 6. Persist a document</div>
<div class="content">
<div class="paragraph">
<p>The following code example creates a document and persists it to the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">using (var newTask = new MutableDocument("xyz")) {
    newTask.SetString("type", "task")
        .SetString("owner", "todo")
        .SetDate("createdAt", DateTimeOffset.UtcNow);

    db.Save(newTask);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mutability"><a class="anchor" href="#mutability"></a>Mutability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, when a document is read from the database it is immutable.
The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.Document.html#Couchbase_Lite_Document_ToMutable">Document.ToMutable()</a> method should be used to create an instance of the document which can be updated.</p>
</div>
<div id="ex-update-doc" class="exampleblock">
<div class="title">Example 7. Make a mutable document</div>
<div class="content">
<div class="paragraph">
<p>Changes to the document are persisted to the database when the <code>save</code> method is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">using(var document = db.GetDocument("xyz"))
using (var mutableDocument = document.ToMutable()) {
    mutableDocument.SetString("name", "apples");
    db.Save(mutableDocument);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any user change to the value of reserved keys (<code>_id</code>, <code>_rev</code> or <code>_deleted</code>) will be detected when a document is saved and will result in an exception (Error Code 5&#8201;&#8212;&#8201;<code>CorruptRevisionData</code>)&#8201;&#8212;&#8201;see also <a href="#lbl-doc-constraints">Document Constraints</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="checking-a-document-for-properties"><a class="anchor" href="#checking-a-document-for-properties"></a>Checking a Document for properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To check whether a given pro
perty exists in the document, you should use the <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.Document.html#Couchbase_Lite_Document_Contains_System_String_">Document.Contains(String key)</a> method.</p>
</div>
<div class="paragraph">
<p>If the property doesn&#8217;t exist in the document it will return the default value for that getter method (0 for <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.Document.html#Couchbase_Lite_Document_GetInt_System_String_">Document.GetInt()</a> 0.0 for <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.Document.html#Couchbase_Lite_Document_GetFloat_System_String_">Document.GetFloat()</a> etc.).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-operations"><a class="anchor" href="#batch-operations"></a>Batch operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re making multiple changes to a database at once, it&#8217;s faster to group them together.
The following example persists a few documents in batch.</p>
</div>
<div id="ex-batch-ops" class="exampleblock">
<div class="title">Example 8. Batch operations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">db.InBatch) =&gt; {     for (var i = 0; i &lt; 10; i++) {         using (var doc = new MutableDocument( {
            doc.SetString("type", "user");
            doc.SetString("name", $"user {i}");
            doc.SetBoolean("admin", false);
            db.Save(doc);
            Console.WriteLine($"Saved user document {doc.GetString("name")}");
        }
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At the <strong>local</strong> level this operation is still transactional: no other <code>Database</code> instances, including ones managed by the replicator can make changes during the execution of the block, and other instances will not see partial changes.
But Couchbase Mobile is a distributed system, and due to the way replication works, there&#8217;s no guarantee that Sync Gateway or other devices will receive your changes all at once.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-change-events"><a class="anchor" href="#document-change-events"></a>Document change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s also possible to register for document changes.
The following example registers for changes to the document with ID <code>user.john</code> and prints the <code>verified_account</code> property.</p>
</div>
<div id="ex-doc-events" class="exampleblock">
<div class="title">Example 9. Document change events</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">db.AddDocumentChangeListener("user.john", (sender, args) =&gt;
{
    using (var doc = Db.GetDocument(args.DocumentID)) {
        Console.WriteLine($"Status :: {doc.GetString("verified_account")}");
    }
});</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-expiration"><a class="anchor" href="#document-expiration"></a>Document Expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Document expiration allows users to set the expiration date to a document.
When the document is expired, the document will be purged from the database.
The purge will not be replicated to Sync Gateway.</p>
</div>
<div id="ex-set-doc-exp" class="exampleblock">
<div class="title">Example 10. Set document expiration</div>
<div class="content">
<div class="paragraph">
<p>This example sets the TTL for a document to 5 minutes from the current time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">// Purge the document one day from now
var ttl = DateTimeOffset.UtcNow.AddDays(1);
db.SetDocumentExpiration("doc123", ttl);

// Reset expiration
db.SetDocumentExpiration("doc1", null);

// Query documents that will be expired in less than five minutes
var fiveMinutesFromNow = DateTimeOffset.UtcNow.AddMinutes(5).ToUnixTimeMilliseconds();
var query = QueryBuilder
    .Select(SelectResult.Expression(Meta.ID))
    .From(DataSource.Database(db))
    .Where(Meta.Expiration.LessThan(Expression.Double(fiveMinutesFromNow)));</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-doc-constraints"><a class="anchor" href="#lbl-doc-constraints"></a>Document Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite APIs do not explicitly disallow the use of attributes with the underscore prefix at the top level of document.
This is to facilitate the creation of documents for use either in <em>local only</em> mode where documents are not synced, or when used exclusively in peer-to-peer sync.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
"_id", :"_rev" and "_sequence" are reserved keywords and must not be used as top-level attributes&#8201;&#8212;&#8201;see <a href="#res-keys">Example 11</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Users are cautioned that any attempt to sync such documents to Sync Gateway will result in an error.
To be future proof, you are advised to avoid creating such documents.
Use of these attributes for user-level data may result in undefined system behavior.</p>
</div>
<div class="paragraph">
<p>For more guidance&#8201;&#8212;&#8201;see: <a href="../../../sync-gateway/current/data-modeling.html" class="page">Sync Gateway - data modeling guidelines</a></p>
</div>
<div id="res-keys" class="exampleblock">
<div class="title">Example 11. Reserved Keys List</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>_attachments</p>
</li>
<li>
<p>_deleted <sup class="footnote" id="_footnote_fn1">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_id <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_removed</p>
</li>
<li>
<p>_rev <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_sequence</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-json-data"><a class="anchor" href="#lbl-json-data"></a>Working with JSON Data</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-array">Arrays</a>
| <a href="#lbl-blob">Blobs</a>
| <a href="#lbl-dictionary">Dictionaries</a>
| <a href="#lbl-document">Documents</a>
| <a href="#lbl-result">Query Results as JSON</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>ToJSON()</code> typed-accessor means you can easily work with JSON data, native and Couchbase Lite objects.</p>
</div>
<div class="sect2">
<h3 id="lbl-array"><a class="anchor" href="#lbl-array"></a>Arrays</h3>
<div class="paragraph">
<p>Convert an <code>ArrayObject</code> to and from JSON using the <code>ToJSON()</code> and <code>toArray</code> methods&#8201;&#8212;&#8201;see: <a href="#ex-array">Example 4</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableArrayObject' using data supplied as a JSON string.
This is done using the <code>init(json)</code> constructor-- see: <a href="#ex-array">Example 4</a></p>
</li>
<li>
<p>Convert an <code>ArrayFragment</code> object to a JSON String</p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-array" class="exampleblock">
<div class="title">Example 12. Arrays as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">
Database dbNew = new Database(ourdbname);

// JSON String -- an Array (3 elements. including embedded arrays)
var thisJSONstring = "[{'id':'1000','type':'hotel','name':'Hotel Ted','city':'Paris','country':'France','description':'Undefined description for Hotel Ted'},{'id':'1001','type':'hotel','name':'Hotel Fred','city':'London','country':'England','description':'Undefined description for Hotel Fred'},                        {'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}]".Replace("'", "\"");

// Get JSON Array from JSON String
JArray myJsonObj = JArray.Parse(thisJSONstring);

// Create mutable array using JSON String Array
var myArray = new MutableArrayObject();
myArray.SetJSON(thisJSONstring);  <i class="conum" data-value="1"></i><b>(1)</b>


// Create a new documenty for each array element
for (int i = 0; i &lt; myArray.Count; i++)
{
    var dict = myArray.GetDictionary(i);
    var docid = myArray[i].Dictionary.GetString("id");
    var newdoc = new MutableDocument(docid, dict.ToDictionary()); <i class="conum" data-value="2"></i><b>(2)</b>
    dbNew.Save(newdoc);
}

// Get one of the created docs and iterate through one of the embedded arrays
var extendedDoc = dbNew.GetDocument("1002");
var features = extendedDoc.GetArray("features");
<i class="conum" data-value="3"></i><b>(3)</b>
foreach (string feature in features) {
    System.Console.Write(feature);
    //process array item as required
}
var featuresJSON = extendedDoc.GetArray("features").ToJSON(); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize array with JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create and save new document using the array</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get native array object from new doc and print its elements</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get an array from the document as a JSON string</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-blob"><a class="anchor" href="#lbl-blob"></a>Blobs</h3>
<div class="paragraph">
<p>Convert a <code>Blob</code> to JSON using the <code>toJSON</code> method&#8201;&#8212;&#8201;see <a href="#ex-blob">Example 13</a>.</p>
</div>
<div class="paragraph">
<p>You can also check whether a given dictionary object is a blob, or not, using <code>isBlob()</code>&#8201;&#8212;&#8201;again, see <a href="#ex-blob">Example 13</a>.</p>
</div>
<div class="paragraph">
<p>Note that the blob object must first be saved to the database (generating required metadata) before you can use the <code>toJSON</code> method.</p>
</div>
<div id="ex-blob" class="exampleblock">
<div class="title">Example 13. Blobs as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">
// Initialize base document for blob from a JSON string
var docId = "1002";
var aJSONstring = "{'ref':'hotel_1002','type':'hotel','name':'Hotel Ned'," +
    "'city':'Balmain','country':'Australia'," +
    "'description':'Undefined description for Hotel Ned'," +
    "'features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
var myDoc = new MutableDocument(docId, aJSONstring); <i class="conum" data-value="1"></i><b>(1)</b>


// Get the content (an image), create blob and add to doc)
var defaultDirectory =
    Path.Combine(Service.GetInstance&lt;IDefaultDirectoryResolver&gt;()
                .DefaultDirectory(),
                    userName);
var myImagePath = Path.Combine(defaultDirectory, "avatarimage.jpg");
var myImageUri = new Uri(myImagePath.ToString());
var myBlob = new Blob("image/jpg", myImageUri); <i class="conum" data-value="2"></i><b>(2)</b>
myDoc.SetBlob("avatar", myBlob); <i class="conum" data-value="3"></i><b>(3)</b>


// This example generates a 'blob not saved' exception
try { Console.WriteLine("myBlob (unsaved) as JSON = {0}", myBlob.ToJSON());}
    catch (Exception e)
        {Console.WriteLine("Exception = {0}", e.Message);}

dbNew.Save(myDoc);

// Alternatively -- depending on use case
dbNew.SaveBlob(new Blob("image/jpg", myImageUri)); <i class="conum" data-value="4"></i><b>(4)</b>


// Retrieve saved doc, get blob as JSON andheck its still a 'blob'
var sameDoc = dbNew.GetDocument(docId);
var reconstitutedBlob = new MutableDictionaryObject().
    SetDictionary("blobCOPY", new MutableDictionaryObject(sameDoc.GetBlob("avatar").ToJSON())); <i class="conum" data-value="5"></i><b>(5)</b>

if (Blob.IsBlob(
        reconstitutedBlob.GetDictionary("blobCOPY").ToDictionary()))  <i class="conum" data-value="6"></i><b>(6)</b>
{
   //... process accordingly
   Console.WriteLine("Its a Blob!!");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also: <a href="blob.html" class="page">Blobs</a></p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-dictionary"><a class="anchor" href="#lbl-dictionary"></a>Dictionaries</h3>
<div class="paragraph">
<p>Convert a <code>DictionaryObject</code> to and from JSON using the <code>toJSON</code> and <code>toDictionary</code> methods&#8201;&#8212;&#8201;see <a href="#ex-dictionary">Example 14</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableDictionaryObject' using data supplied as a JSON string.
This is done using the <code>init(json)</code> constructor-- see: <a href="#ex-dictionary">Example 14</a></p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-dictionary" class="exampleblock">
<div class="title">Example 14. Dictionaries as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">
// Get dictionary from JSONstring
var aJSONstring = "{'id':'1002','type':'hotel','name':'Hotel Ned','city':'Balmain','country':'Australia','description':'Undefined description for Hotel Ned','features':['Cable TV','Toaster','Microwave']}".Replace("'", "\"");
var myDict = new MutableDictionaryObject(json: aJSONstring); <i class="conum" data-value="1"></i><b>(1)</b>

// use dictionary to get name value
var name = myDict.GetString("name");


// Iterate through keys
foreach (string key in myDict.Keys)
{
    System.Console.WriteLine("Data -- {0} = {1}", key, myDict.GetValue(key).ToString());

}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the dictionary using a JSON string</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-document"><a class="anchor" href="#lbl-document"></a>Documents</h3>
<div class="paragraph">
<p>Convert a <code>Document</code> to and from JSON strings using the <code>ToJSON()</code> and <code>SetJSON()</code> methods&#8201;&#8212;&#8201;see <a href="#ex-document">Example 15</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableDocument' using data supplied as a JSON string.
This is done using the <code>init(json)</code> and-or <code>init(id: json:)</code> constructor-- see: <a href="#ex-document">Example 15</a></p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-document" class="exampleblock">
<div class="title">Example 15. Documents as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">Database this_DB = new Database("travel-sample");
Database newDb = new Database("ournewdb");

// Get a document
var thisDoc = this_Db.GetDocument("hotel_10025");

// Get document data as JSON String
var thisDocAsJsonString = thisDoc?.ToJSON(); <i class="conum" data-value="1"></i><b>(1)</b>

// Get Json Object from the Json String
JObject myJsonObj = JObject.Parse(thisDocAsJsonString);

// Get Native Object (anhotel) from JSON String
List&lt;Hotel&gt; thehotels = new List&lt;Hotel&gt;();

Hotel anhotel = new Hotel();
anhotel = JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocAsJsonString);
thehotels.Add(anhotel);

// Update the retrieved native object
anhotel.Name = "A Copy of " + anhotel.Name;
anhotel.Id = "2001";

// Convert the updated object back to a JSON string
var newJsonString = JsonConvert.SerializeObject(anhotel);

// Update new document with JSOn String
MutableDocument newhotel =
    new MutableDocument(anhotel.Id, newJsonString); <i class="conum" data-value="2"></i><b>(2)</b>

foreach (string key in newhotel.ToDictionary().Keys)
{
    System.Console.WriteLine("Data -- {0} = {1}",
        key, newhotel.GetValue(key));
}

newDb.Save(newhotel);

var thatDoc = newDb.GetDocument("2001").ToJSON(); <i class="conum" data-value="3"></i><b>(3)</b>
System.Console.Write(thatDoc);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get a document as a JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize a MutableDocument using the JSON string and save to a separate database</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Retrieve the document created from JSON and print values</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-result"><a class="anchor" href="#lbl-result"></a>Query Results as JSON</h3>
<div class="paragraph">
<p>Convert a <code>Query Result</code> to JSON using its <code>ToJSON()</code> accessor method.</p>
</div>
<div id="ex-json" class="exampleblock">
<div class="title">Example 16. Using JSON Results</div>
<div class="content">
<div class="paragraph">
<p>Use <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-net/api/Couchbase.Lite.Query.Result.html#Couchbase_Lite_Query_Result_ToJson">Result.ToJson()</a> to transform your result string into a JSON string, which can easily be serialized or used as required in your application. See <<ex-json>> for a working example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/examples/code_snippets/Program.cs">
foreach (var result in query.Execute().AsEnumerable()) {

    // get the result into a JSON String
            var thisDocsJSONString = result.ToJSON();<i class="conum" data-value="1"></i><b>(1)</b>

    // Get a native dictionary object using the JSON string
    var dictFromJSONstring =
          JsonConvert.
            DeserializeObject&lt;Dictionary&lt;string, object&gt;&gt;
              (thisDocsJSONString); <i class="conum" data-value="2"></i><b>(2)</b>

    // use the created dictionary
    if (dictFromJSONstring != null)
    {
        thisDocsId = dictFromJSONstring["id"].ToString();
        thisDocsName = dictFromJSONstring["name"].ToString();
        thisDocsCity = dictFromJSONstring["city"].ToString();
        thisDocsType = dictFromJSONstring["type"].ToString();
    }

    //Get a custom object using the JSON string
    Hotel this_hotel =
        JsonConvert.DeserializeObject&lt;Hotel&gt;(thisDocsJSONString); <i class="conum" data-value="3"></i><b>(3)</b>

    // Store this hotel object in a list of hotels
    hotels.Add(
        this_hotel.Id.ToString(),
            this_hotel);

} // end foreach result</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the Query result as a JSON string&#8201;&#8212;&#8201;see <a href="#ex-json-format">JSON String Format</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get a native object from the JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Populate your custom object from the dictionary created from JSON data</td>
</tr>
</table>
</div>
<div id="ex-json-format" class="paragraph">
<div class="title">JSON String Format</div>
<p>If your query selects ALL then the JSON format will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  database-name: {
    key1: "value1",
    keyx: "valuex"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your query selects a sub-set of available properties then the JSON format will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  key1: "value1",
  keyx: "valuex"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to . . .</div>
<ul>
<li>
<p><a href="#csharp:gs-prereqs.adoc" class="page unresolved">Prerequisites</a></p>
</li>
<li>
<p><a href="gs-install.html" class="page">Install</a></p>
</li>
<li>
<p><a href="gs-build.html" class="page">Build and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Learn more . . .</div>
<ul>
<li>
<p><a href="database.html" class="page">Databases</a></p>
</li>
<li>
<p><a href="document.html" class="page">Documents</a></p>
</li>
<li>
<p><a href="blob.html" class="page">Blobs</a></p>
</li>
<li>
<p><a href="replication.html" class="page">Remote Sync Gateway</a></p>
</li>
<li>
<p><a href="conflict.html" class="page">Handling Data Conflicts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="paragraph">
<div class="title">Dive Deeper . . .</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/category/couchbase-mobile/?ref=blog-menu">Blog</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Any change to this reserved key will be detected when it is saved and will result in a Couchbase exception (Error Code 5&#8201;&#8212;&#8201;`CorruptRevisionData`)
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
