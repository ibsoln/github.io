<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Access Control Concepts | Couchbase Docs</title>
<link rel="canonical" href="localhost::/5000/sync-gateway/3.0/access-control-concepts.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<meta name="description" content="An introduction to the key concepts behind the provision of effective access control in Sync Gateway">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="sync-gateway">
<meta name="dcterms.identifier" content="3.0">
<meta name="generator" content="Antora 2.3.3">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="localhost::/5000/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Sync Gateway</span></h4>
<a class="frame-link component" href="index.html"> <span class="version">3.0</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="index.html">Sync Gateway</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="whatsnew.html">What&#8217;s New</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Start Here!</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="introduction.html">Introduction</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="get-started-prepare.html">Prepare</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="get-started-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="get-started-verify-install.html">Verify</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="data-modeling.html">Data Modeling</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Configuration</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="configuration-overview.html">Configuration Overview</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Static</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="configuration-schema-static.html">Static Configuration Schema</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="configuration-javascript-functions.html">Configuration Javascript Functions</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="configuration-environment-variables.html">Configuration Environment Variables</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Dynamic Persistent</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="configuration-schema-bootstrap.html">Bootstrap Configuration Schema</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="configuration-schema-database.html">Database Configuration Schema</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="configuration-rest-api.html">Configuration REST API</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="rest-api-admin-database.html">Database Configuration API</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="rest-api-admin-access-control.html">User Configuration API</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#sync-gateway::rest-api-admin-isgr.adoc">Inter-Sync Gateway Configuration API</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">REST API</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api-access.html">REST API Access</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api.html">Public REST API</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api-admin.html">Admin REST API</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api-metrics.html">Metrics REST API</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api-client-app.html">Use the REST API?</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Security</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="authentication-users.html">User Authentication</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="authentication-certs.html">TLS Certificate Authentication</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Data Access</span>
</span>
<ul class="nav-list">
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="access-control-concepts.html">Concepts</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access.html">Access</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access-model.html">Access Model</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="channels.html">Channels</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="roles.html">Roles</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function.html">Sync Function</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="users.html">Users</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="access-control-how.html">How-To</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access-control-how-create-users.html">Create a User</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access-control-how-create-roles.html">Create a Role</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access-control-how-add-roles-to-users.html">Add a Role to a User</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access-control-how-allow-access.html">Allow Access</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access-control-how-inspect-access.html">Inspect Access</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="access-control-how-write-access.html">Write Access</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="sync-function-api.html">Sync Function API</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-access-cmd.html">access()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-channel-cmd.html">channel()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-expiry-cmd.html">expiry()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-require-access-cmd.html">requireAccess()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-require-admin-cmd.html">requireAdmin()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-require-role-cmd.html">requireRole()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-require-user-cmd.html">requireUser()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-role-cmd.html">role()</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function-api-throw-cmd.html">throw()</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Sync</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="sync-with-couchbase-server.html">Sync with Couchbase Server</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="sync-using-app.html">Sync Using App</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Inter-Sync Gateway Replication</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-overview.html">Overview</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-run.html">Initialize</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-manage.html">Manage</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-monitor.html">Monitor</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="nav-text ">{sgw-xref}sync-inter-syncgateway-conflict-resolution.adoc[Conflict Resolution]</span>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="sync-function-from-sync-nav.html">Sync Function</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="revisions.html">Revisions</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="what-are-tombstones.html">Tombstones</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="managing-tombstones.html">Managing Tombstones</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="delta-sync.html">Delta Sync</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resync.html">Resync</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="import-filter.html">Import filter</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Manage</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="stats-monitoring.html">Stats Monitoring</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Logging and Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="logging.html">Logging</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sgcollect-info.html">SGCollect Info</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="database-offline.html">Database Offline</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Deploy</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="deployment.html">Overview</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="command-line-options.html">Command Line Options</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="load-balancer.html">Load Balancer</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#3.0@sync-gateway:os-level-tuning.adoc">OS-level Tuning</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#3.0@sync-gateway:webhooks.adoc">Webhooks</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="changes-feed.html">Changes Feed</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#3.0@sync-gateway:integrating-external-stores.adoc">External Stores</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#3.0@sync-gateway:stats-prometheus.adoc">Prometheus Feed</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="indexing.html">Indexing versus Views</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="setting-up-dr-cluster.html">Disaster Recovery</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="upgrading.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Use Kubernetes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="deploy-cluster-to-kubernetes.html">Deploy</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Server Compatibility</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="server-compatibility-collections.html">Collections</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="server-compatibility-eventing.html">Eventing</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="server-compatibility-transactions.html">Transactions</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="server-compatibility-xdcr.html">XDCR</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="release-notes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="supported-environments.html">Supported Environments</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="compatibility.html">Compatibility Matrix</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Legacy Features</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="legacy-sgreplicate-resolving-conflicts.html">SG-Replicate - Resolving Conflicts (depr)</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="legacy-sg-replicate.html">SG-Replicate</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="legacy-logging-pre2-1.html">Legacy Logging Pre2 1</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../couchbase-lite/3.0/index.html">Couchbase Lite</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/3.0/android/quickstart.html">Android (Java)</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/3.0/csharp/quickstart.html">C#</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/3.0/java/quickstart.html">Java</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/3.0/objc/quickstart.html">Objective-C</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/3.0/swift/quickstart.html">Swift</a>
</span>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/sgw/modules/ROOT/pages/access-control-concepts.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="index.html">Sync Gateway</a></li>
<li class="crumb">Data Access</li>
<li class="crumb"><a href="access-control-concepts.html">Concepts</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Access Control Concepts</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>An introduction to the key concepts behind the provision of effective access control in Sync Gateway<br>
The sync function API provides several methods that you can use to validate and control user access to databases and documents.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Related  Topics</em>:  <strong>Concepts</strong>  |
<a href="access-control-how.html" class="page">How-to</a>  |
<a href="sync-function-api.html" class="page">Sync Function API</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the Couchbase Mobile ecosystem access to documents is governed by three key entities (<em>users</em>, <em>roles</em> and <em>channels</em>) and controlled by configuration, Rest API or customer logic provisioned in the <em>Sync Function</em>.</p>
</div>
<div id="img-access-control-model" class="paragraph right text-center">
<div class="title">Access Control Model</div>
<p><span class="image"><img src="_images/access-control-triangle.png" alt="Access" width="400"></span></p>
</div>
<div class="paragraph">
<p>Every <a href="users.html" class="page">User</a> and <a href="roles.html" class="page">Role</a> is granted access to zero, one or more <a href="channels.html" class="page">Channels</a>.
It is this channels list that determines the documents users can access&#8201;&#8212;&#8201;as illustrated in <a href="#img-access-control-model">Access Control Model</a></p>
</div>
<div class="paragraph">
<p>A user can only read documents that are in at least one of their assigned channels; whether directly or as part of an assigned role.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All users can implicitly access any document in the <a href="channels.html#lbl-public-channel" class="page">Public Channel</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-access"><a class="anchor" href="#lbl-access"></a>Access</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You control document access by routing it to a channel and by making that channel accessible to the users or roles you want to be able to access documents of that type.</p>
</div>
<div class="sect2">
<h3 id="context"><a class="anchor" href="#context"></a>Context</h3>
<div class="sect3">
<h4 id="sync-gateway"><a class="anchor" href="#sync-gateway"></a>Sync Gateway</h4>
<div class="paragraph">
<p>A user can only read documents that are in at least one of their assigned channels; whether directly or as part of an assigned role.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All users can implicitly access any document in the <a href="channels.html#lbl-public-channel" class="page">Public Channel</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once a user is granted access to a new channel, the <a href="changes-feed.html" class="page">Changes Feed</a> will include all existing documents in that channel, even those from earlier sequences than the current request&#8217;s <code>since</code> parameter.
So, the next replication pull request, will retrieve all documents to which the user now has access.</p>
</div>
<div class="paragraph">
<p>Revoking access to a channel means users who previously used the channel to get replicated documents will no longer see any synced updates.
However, documents already synced to the user&#8217;s device are not deleted.</p>
</div>
<div class="paragraph">
<p>Note that access grants neither confer, nor constrain, the <strong>type</strong> of access.
Instead you can explicitly implement write access controls within the Sync Function; perhaps restricting updates to specific users or roles&#8201;&#8212;&#8201;for more on this see <a href="access-control-how.html#lbl-control-write-access" class="page">Write Access</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="couchbase-lite"><a class="anchor" href="#couchbase-lite"></a>Couchbase Lite</h4>
<div class="paragraph">
<p>By default, Couchbase Lite gets all the channels to which the configured user account has access.
This behavior is suitable for most apps that rely on <a href="authentication-users.html" class="page">User Authentication</a> and the <a href="sync-function.html" class="page">Sync Function</a> to specify which data to pull for each user.</p>
</div>
<div class="paragraph">
<p>Optionally, a Couchbase Lite "pull" replication can also specify a comma-separated list of channel names to receive documents from.
In this case, the replication from Sync Gateway will only pull documents tagged with those channels.
Client apps can use this ability to intelligently sync with a subset of the available documents from the database.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use"><a class="anchor" href="#use"></a>Use</h3>
<div class="paragraph">
<p>There are a number of ways in which you can control access to documents, as illustrated in <a href="#img-channel-access">Example 1</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration&#8201;&#8212;&#8201;You can do it in the <a href="configuration-schema-static.html" class="page">Static Configuration Schema</a> by adding the appropriate channel to the user&#8217;s <code>admin_channels</code> property in the  see <a href="configuration-schema-static.html#databases-this_db-users-this_user-admin_channels" class="page">user admin_channels</a></p>
</li>
<li>
<p>Admin REST API&#8201;&#8212;&#8201;You can provide that same <code>admin_channels</code> property using the <strong>Admin REST API</strong> endpoint (<a href="rest-api-admin.html#/user/post\__db___user_name_" class="page">/{tkn-db}/_user/{name}</a>).</p>
</li>
<li>
<p>Programmatically&#8201;&#8212;&#8201;The <a href="sync-function.html" class="page">Sync Function</a> provides a flexible and secure method for controlling document access and routing.</p>
<div class="paragraph">
<p>It can be programmed to derive appropriate access and routing information from document properties or, more securely, from a designated extended attribute (XATTR)&#8201;&#8212;&#8201;see: <a href="using-xattr-access-grants.html" class="page">Using XATTR Access Grants</a> for how to define the XATTR.</p>
</div>
</li>
</ul>
</div>
<div id="img-channel-access" class="exampleblock">
<div class="title">Example 1. Access Control Points</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="_images/channel-access-grant-all.png" alt="Channel access" width="300">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Documents are assigned to channel using the Sync Function&#8217;s <a href="sync-function-api-channel-cmd.html" class="page">channel()</a> API.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>User can be granted access to channels by any one of the means defined here.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a>Example</h3>
<div class="paragraph">
<p>Consider the situation where two roles require, and are allowed, access to two distinct information flows and one shared flow&#8201;&#8212;&#8201;see <a href="#img-channels-example">Example 2</a>.</p>
</div>
<div class="paragraph">
<p>This can be achieved by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creating two roles (Edge1 and Edge2) for the two groups of users.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Do this either by using the Admin Rest API endpoint  <a href="rest-api-admin.html#/role/post__db___role" class="page">/{tkn-db}/_role/</a> or statically by adding the role to the database in the <a href="configuration-schema-static.html" class="page">Static Configuration Schema</a>.
In either case specify that role Edge1 can access <code>Channel1</code>, Edge2 can access <code>Channel2</code>, and both roles can access &amp; <code>Channel3</code>&#8201;&#8212;&#8201;see: <a href="access-control-how-create-roles.html" class="page">Create a Role</a></p>
</div>
</div>
</div>
</li>
<li>
<p>Adding the roles to the appropriate users, again using either the configuration file or API&#8201;&#8212;&#8201;see <a href="access-control-how-add-roles-to-users.html" class="page">Add a Role to a User</a></p>
</li>
<li>
<p>Creating a Sync Function that</p>
<div class="ulist">
<ul>
<li>
<p>Identifies and assigns appropriate documents to the right channel (or channels)</p>
</li>
<li>
<p>Requires that any user accessing those channels has the right to do so; either directly or as in this case through a role assigned to them(Edge1 or Edge2).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="img-channels-example" class="exampleblock">
<div class="title">Example 2. Access Control Example</div>
<div class="content">
<div class="paragraph">
<p>This example shows three channels; one shared and two private.
Here <em>Edge #1</em> and <em>Edge #2</em> represent two groups of Sync Gateway users with the assigned roles Edge1 and Edge2 respectively.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/channels-example-all.png" alt="Channels" width="400">
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Documents are routed to the appropriate channels by Sync Function logic</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Sync Function requires users (or one of their roles) has access to the channel</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-channels"><a class="anchor" href="#lbl-channels"></a>Channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sync Gateway uses <em>Channels</em> to make it easy to share a database&#8217;s documents across a large user base whilst retaining effective access control.
They serve as a security conduit between the document and a user:</p>
</div>
<div class="sect2">
<h3 id="context-2"><a class="anchor" href="#context-2"></a>Context</h3>
<div class="paragraph">
<p>Every user is granted access to a list of channels.
Every document in the database is assigned a list of channels it is distributed to.</p>
</div>
<div class="paragraph">
<p>This dual-purpose is reflected in the way you use channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By granting a user access to a channel, you are imposing access control</p>
</li>
<li>
<p>By assigning a document to a channel you are imposing document routing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You typically will use channels to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Control who can access what</p>
</li>
<li>
<p>Partition your data set</p>
</li>
<li>
<p>Enable users to access just the documents they need</p>
</li>
<li>
<p>Minimize the amount of data synced to mobile devices</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sync Gateway provides two special channels and a channel wildcard character.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-public-channel"><a class="anchor" href="#lbl-public-channel"></a>Public Channel</h3>
<div class="paragraph">
<p>The <a href="#lbl-public-channel">Public Channel</a> ('<strong>!</strong>')&#8201;&#8212;&#8201;is a channel for publicly available documents.
It is ideal for use in making information available across the user community.</p>
</div>
<div class="paragraph">
<p>You assign a document to the <em>public</em> (<strong>!</strong>) channel using the <a href="sync-function-api-channel-cmd.html" class="page">channel()</a> function.</p>
</div>
<div class="paragraph">
<p>Documents assigned to this channel can be accessed by all users; even users assigned no specific channel access.</p>
</div>
<div class="paragraph">
<p>New users are automatically granted access to the channel.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-alldocs-channel"><a class="anchor" href="#lbl-alldocs-channel"></a>All Documents Channel</h3>
<div class="paragraph">
<p>The <a href="#lbl-alldocs-channel">All Documents Channel</a> ('<strong>*</strong>') <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>&#8201;&#8212;&#8201;is a single, internal channel, comprising all documents from all channels.</p>
</div>
<div class="paragraph">
<p>Assignment to this channel is automatic and implicit.
You cannot explicitly assign documents to the channel or remove documents from it.</p>
</div>
<div class="paragraph">
<p>This channel should not be confused with the use of the <a href="#lbl-all-channels">All Channels Wildcard</a> in access grants.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-all-channels"><a class="anchor" href="#lbl-all-channels"></a>All Channels Wildcard</h3>
<div class="paragraph">
<p>The <a href="#lbl-all-channels">All Channels Wildcard</a> ('<strong>*</strong>')&#8201;&#8212;&#8201;used when granting user access, this wildcard grants access to any document in any channel.</p>
</div>
<div class="paragraph">
<p>You make dynamic user access grants in the sync function using the <a href="sync-function-api-access-cmd.html" class="page">access()</a> method.</p>
</div>
<div class="paragraph">
<p>Granting a user access with the <em>all channels</em> wildcard gives them access to any channel, and any document in any channel, including those from private channels.</p>
</div>
<div class="paragraph">
<p>Replications by users with <em>all channels</em> wildcard access will pull <strong>all</strong> documents.
Because of this potential for syncing large volumes of data (sync pulls all documents in the bucket), users with <em>all channels</em> wildcard access should use a channel filter to explicitly name the channel(s) to be sync&#8217;d.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Users granted access using the <em>all channels</em> wildcard <strong>do not</strong> inherit <a href="sync-function-api-require-access-cmd.html" class="page">requireAccess()</a> rights to any specific channel.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Always use a filter in conjunction with the <em>all channels</em> wildcard, to avoid sync unnecessarily pulling large numbers of documents to mobile devices.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You assign documents to channels in the <a href="sync-function.html" class="page">Sync Function</a>.</p>
</div>
<div class="paragraph">
<p>Channels are created as documents are assigned to them.</p>
</div>
<div class="paragraph">
<p>Valid channel names consist of text letters <code>[A–Z, a–z]</code>, digits <code>[0–9]</code>, and a few special characters <code>[= + / . , _ @]</code>.
Channel names are case-sensitive.
Channels with no documents assigned to them are empty.</p>
</div>
</div>
<div class="sect2">
<h3 id="channel-limits"><a class="anchor" href="#channel-limits"></a>Channel Limits</h3>
<table id="tbl-limits" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Guidance on Channel Assignment Limits</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 44.4444%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Limiting factor</th>
<th class="tableblock halign-center valign-top">Guidance Limit (Channels)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channels per document</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of memory consumed by the combined number of channels and access grants must fit within the maximum 1Mb xattr size limit&#8201;&#8212;&#8201;see: <a href="#tbl-metadata-size">Table 2</a>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channels per user</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The amount of memory consumed by channels must fit within the 20 MB available on Couchbase Server docs for storing metadata&#8201;&#8212;&#8201;see: <a href="#tbl-metadata-size">Table 2</a><br>
Note that the memory is retained for as long as the replication remains active.</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1,000</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sync-metadata-limits"><a class="anchor" href="#sync-metadata-limits"></a>Sync Metadata Limits</h3>
<div class="paragraph">
<p>Every time a document is assigned to a new channel, the channel name is appended to that document&#8217;s sync metadata.</p>
</div>
<div class="paragraph">
<p>Therefore, a document&#8217;s set of channels is limited by the allowed sync metadata size described in <a href="#tbl-metadata-size">Table 2</a>.</p>
</div>
<table id="tbl-metadata-size" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Size Limits for Sync Metadata</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Value of <code>enable_shared_bucket_access</code></th>
<th class="tableblock halign-center valign-top">Size (Mb per Document)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Sync Gateway will assign a document to a new channel as long as the sync metadata remains under the allowed limit.</p>
</div>
<div class="paragraph">
<p><strong>What to do when your channel count exceeds the usable space for sync metadata?</strong></p>
</div>
<div class="paragraph">
<p>In order to lower the sync metadata size per document, you can do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lower the number of channels per document.</p>
</li>
<li>
<p>Shorten the channel names.
A shorter channel name will occupy less space ("customer==0030169303" vs "cs==0030169303").</p>
</li>
<li>
<p>Lower the <a href="configuration-schema-static.html#databases-this_db-revs_limit" class="page">revs_limit</a> value.
Indeed, a copy of channel metadata is retained for each revision of a document.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-users"><a class="anchor" href="#lbl-users"></a>Users</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Users are one of the cornerstone concepts of access control.
You can restrict document access to specific users and-or to users with specific roles.</p>
</div>
<div class="paragraph">
<p>As an entity a <em>user</em> comprises a name, password, list of <a href="roles.html" class="page">Roles</a>} and a list of <a href="channels.html" class="page">Channels</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sync Gateway users and roles have no relationship to Couchbase Server&#8217;s <a href="#server:learn:security/authorization-overview.adoc" class="page unresolved">RBAC (Role-base Access Control) users</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Users granted access to a channel are able to access the documents assigned to that channel.</p>
</div>
<div class="paragraph">
<p>Users can also be assigned to zero or more roles.
A user inherits the channel access of all roles it belongs to.
This is very much like Unix groups, except that roles do not form a hierarchy.</p>
</div>
<div class="paragraph">
<p>Each user must be created on Sync Gateway before it can be used for access control.</p>
</div>
<div class="paragraph">
<p>You create and-or manage users using the <a href="configuration-schema-static.html" class="page">Static Configuration Schema</a> or the <a href="rest-api-admin.html" class="page">Admin REST API</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="roles"><a class="anchor" href="#roles"></a>Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Roles are named collections of <a href="channels.html" class="page">Channels</a>.
They enable the grouping togethers of <a href="users.html" class="page">Users</a> with similar characteristics, which makes the management of large user populations easier.</p>
</div>
<div class="paragraph">
<p>Roles are granted access to channels.
Any user assigned a role can access any channels (and documents within those channels) the role has been granted access to.</p>
</div>
<div class="paragraph">
<p>As an entity roles comprises a name and a list of channels.</p>
</div>
<div class="paragraph">
<p>Any user associated with a role inherits the right to access any of the channels in the role&#8217;s list.
This provides a convenient way to associate multiple channels with multiple users.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Roles have a separate namespace from users, so it&#8217;s possible to have a user and a role with the same name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can add and remove roles from users using either the <a href="rest-api-admin.html" class="page">Admin REST API</a> or <a href="configuration-schema-static.html" class="page">Static Configuration Schema</a>.</p>
</div>
<div class="paragraph">
<p>Note that removing a role effectively revokes access to the channel that role is associated with and may mean users will lose access to required documents.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-sync-function"><a class="anchor" href="#lbl-sync-function"></a>Sync Function</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>The sync function is crucial to the security of your application.</strong>
It is in charge of data validation, access control and routing.
The function executes every time a new revision/update is made to a document.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The sync function should be a focus of any security review of your application.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="context-3"><a class="anchor" href="#context-3"></a>Context</h3>
<div class="paragraph">
<p>Any changes to <a href="channels.html" class="page">Channels</a> and <a href="access.html" class="page">Access</a> made by the sync function are <em>tied to that revision</em>.
If the document is later updated, the sync function is called again on the new revision, and the new channel assignments and user/channel access <em>replace</em> those from the first call.</p>
</div>
<div class="sect3">
<h4 id="lbl-document-conflicts"><a class="anchor" href="#lbl-document-conflicts"></a>Conflicts</h4>
<div class="paragraph">
<p>If a document is in conflict there will be multiple current revisions.
The default, "winning" one is the one whose channel assignments and access grants take effect.</p>
</div>
</div>
<div class="sect3">
<h4 id="lbl-handling-deletions"><a class="anchor" href="#lbl-handling-deletions"></a>Deletions</h4>
<div class="paragraph">
<p>Validation checks often need to treat deletions specially, because a deletion is just a revision with a <code>"_deleted": true</code> property and usually nothing else.
Many types of validations won&#8217;t work on a deletion because of the missing properties&#8201;&#8212;&#8201;for example, a check for a required property, or a check that a property value doesn&#8217;t change.
You&#8217;ll need to skip such checks if <code>doc._deleted</code> is true.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use-2"><a class="anchor" href="#use-2"></a>Use</h3>
<div class="paragraph">
<p>The Sync Function exposes a number of helper functions to control access&#8201;&#8212;&#8201;see reference information in <a href="sync-function-api.html" class="page">Sync Function API</a>.
For example, to grant a user access to a channel use the <a href="sync-function-api-access-cmd.html" class="page">access()</a> helper function in the Sync Function.</p>
</div>
<div class="paragraph">
<p>The <code>access()</code> function can also operate on roles.
If a user name string begins with <code>role:</code> then the remainder of the string is interpreted as a role name.
There&#8217;s no ambiguity here, because ":" is an illegal character in a user or role name.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Because anonymous requests are authenticated as the user "GUEST", you can make a channel and its documents public by calling <code>access</code> with a username of <code>GUEST</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="get-started"><a class="anchor" href="#get-started"></a>Get Started</h3>
<div class="paragraph">
<p>When you come to build your Sync Function you will need to decide the access control and document distribution requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The document types it will process</p>
</li>
<li>
<p>The users it will serve</p>
</li>
<li>
<p>Which users need to access which document types</p>
</li>
<li>
<p>What constraints are to be be placed on creating, updating and-or deleting documents</p>
</li>
</ul>
</div>
<div id="lbl-practical-example" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In this example we will build a complete Sync Function that validates and authorizes both new and updated documents.</p>
</div>
<div class="paragraph">
<p>Our requirements for this purpose are:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>That all documents have the following properties:<br>
<em>creator</em>, <em>writers</em>, <em>title</em>  <em>channels</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>That we allow only create and-or delete access to users with the role <code>editor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>That we only allow changes, including deletions, to be made by users identified in the document&#8217;s <em>writers</em> property</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>That the <em>creator</em> is immutable</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>That we will assign the document to the channel(s) identified in its <em>channels</em> property</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>That we provide the Sync Function Javascript code embedded in our Configuration file&#8201;&#8212;&#8201;see <a href="configuration-schema-static.html#databases-this_db-sync" class="page">sync</a>.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>NOTE&#8201;&#8212;&#8201;The sync function is enclosed in backticks.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  //  ... may be preceded by additional configuration data as required by the user ...
  "databases": { <i class="conum" data-value="6"></i><b>(6)</b>
    "getting-started-db": {
      "server": "http://localhost:8091",
      "bucket": "getting-started-bucket",
      "username": "sync_gateway",
      "password": "password",
      "enable_shared_bucket_access": true,
      "import_docs": true,
      "num_index_replicas": 0,
      "users": {
        "GUEST": { "disabled": false, "admin_channels": ["*"] },
      },
      "sync": ' <i class="conum" data-value="6"></i><b>(6)</b> <i class="conum" data-value="7"></i><b>(7)</b>
         function (doc, oldDoc) { <i class="conum" data-value="5"></i><b>(5)</b>
            if (doc._deleted) {
              // Only editors with write access can delete documents:
              requireRole("role:editor"); <i class="conum" data-value="2"></i><b>(2)</b>
              requireUser(oldDoc.writers); <i class="conum" data-value="3"></i><b>(3)</b>
              // Skip other validation because a deletion has no other properties:
              return;
            }
            // Required properties:
            if (!doc.title || !doc.creator ||
                  !doc.channels || !doc.writers) { <i class="conum" data-value="1"></i><b>(1)</b>
              throw({forbidden: "Missing required properties"});
            } else if (doc.writers.length == 0) {
              throw({forbidden: "No writers"});
            }
            if (oldDoc == null) {
              // Only editors can create documents:
              requireRole("role:editor"); <i class="conum" data-value="2"></i><b>(2)</b>
              // The 'creator' property must match the user creating the document:
              requireUser(doc.creator)
            } else {
              // Only users in the existing doc's writers list can change a document:
              requireUser(oldDoc.writers); <i class="conum" data-value="3"></i><b>(3)</b>
              // The "creator" property is immutable:
              if (doc.creator != oldDoc.creator) {
                      throw({forbidden: "Can't change creator"}); <i class="conum" data-value="4"></i><b>(4)</b>
              }
            }
            // Finally, assign the document to the channels in the list:
            channel(doc.channels); <i class="conum" data-value="5"></i><b>(5)</b>

        }`, <i class="conum" data-value="7"></i><b>(7)</b>
        //  ... may be followed by additional configuration data as required by the user ...
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example used a number of helper functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="sync-function-api-channel-cmd.html" class="page">channel()</a></p>
</li>
<li>
<p><a href="sync-function-api-require-user-cmd.html" class="page">requireUser()</a></p>
</li>
<li>
<p><a href="sync-function-api-require-role-cmd.html" class="page">requireRole()</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>You could also supply the same Sync Function using the <a href="rest-api-admin.html" class="page">Admin REST API</a> using the _db/_config endpoint</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t supply a sync function, Sync Gateway uses the <a href="configuration-schema-static.html#databases-this_db-sync" class="page">default Sync Function</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">Learn more ...</div>
<ul>
<li>
<p><a href="sync-function.html" class="page">Sync Function</a></p>
</li>
<li>
<p><a href="import-filter.html" class="page">Import filter</a></p>
</li>
<li>
<p><a href="sync-inter-syncgateway-overview.html" class="page">Inter-Sync Gateway Replication</a></p>
</li>
<li>
<p><a href="sync-with-couchbase-server.html" class="page">Sync with Couchbase Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Reference material ...</div>
<ul>
<li>
<p><a href="rest-api.html" class="page">Public REST API</a></p>
</li>
<li>
<p><a href="rest-api-admin.html" class="page">Admin REST API</a></p>
</li>
<li>
<p><a href="rest-api-metrics.html" class="page">Metrics REST API</a></p>
</li>
<li>
<p><a href="rest-api-client-app.html" class="page">Use the REST API?</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="ulist">
<div class="title">Community</div>
<ul>
<li>
<p><a href="https://forums.couchbase.com/c/mobile/14">Forum</a>  <strong>|</strong>  <a href="https://blog.couchbase.com/">Blog</a>   <strong>|</strong>  <a href="https://docs.couchbase.com/tutorials/index.html">Tutorials</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Sync Function Blogs</div>
<ul>
<li>
<p><a href="https://blog.couchbase.com/augment-your-sync-function-with-roles-in-couchbase-sync-gateway/">Using roles in sync functions</a></p>
</li>
<li>
<p><a href="https://blog.couchbase.com/data-synchronization-offline-first-apps-couchbase/">Tutorial: Getting Started with Data Synchronization using Couchbase Mobile for Offline-First Apps</a></p>
</li>
<li>
<p><a href="https://blog.couchbase.com/tag/sync-function/">Sync Function (category)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Sometimes referred to as the <strong>star</strong> channel
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../_/js/vendor/fontawesome.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
