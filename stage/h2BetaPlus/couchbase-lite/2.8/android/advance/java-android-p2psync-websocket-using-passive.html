<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Set-up the Passive Peer&#8201;&#8212;&#8201;Working with Peer-to-Peer Syncs | Couchbase Docs</title>
<link rel="canonical" href="https://ibsoln.github.io/stage/h2BetaPlus/couchbase-lite/2.8/android/advance/java-android-p2psync-websocket-using-passive.html">
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite - this content covers how to set up a passive peer ready to replicate CBL database changes using peer-to-peer sync over websockets">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="2.8">
<meta name="generator" content="Antora 2.3.3">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">

              <a class="navbar-brand" href="../../../..">
                <img src="../../../../_/img/couchbase-documentation-logo.svg" alt="Couchbase" />
              </a>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <div class="parent-site">
                  <a href="https://www.couchbase.com">
                    Couchbase.com
                  </a>
                </div>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Try Free
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Couchbase Lite (h2Beta-19JUN20)</span></h4>
<a class="navbar-item component" href="../../index.html"> <span class="version">2.8</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Couchbase Mobile</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../../shared-mobile/2.8/cbmintro.html">About Mobile</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../index.html">Couchbase Lite</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="#2.8@sync-gateway::index.adoc">Sync Gateway</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Couchbase Lite</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../introduction.html">About CBL</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="#couchbase-lite:{param-module}:product/cbl-whatsnew.adoc">What&#8217;s New</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<div class="main-nav-parent new " data-depth="1">
<span class="back-to-menu"><i class="fas fa-chevron-left"></i> Main Menu </span>
</div>
<ul class="nav-list">
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../quickstart-index.html">Android (Java)</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Start</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../start/java-android-gs-prereqs.html">Prerequisites</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../start/java-android-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../start/java-android-gs-build.html">Test Build</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Next</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../next/java-android-dbo-crud.html">Using CRUD Operations</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../next/java-android-dbo-query.html">Using Query Operations</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Advance</span>
</span>
<ul class="nav-list">
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<span class="nav-text ">Peer-to-Peer Sync How-to</span>
</span>
<ul class="nav-list">
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="java-android-p2psync-websocket-using-passive.html">Deploy Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="java-android-p2psync-websocket-using-active.html">Deploy Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="java-android-p2p-managing-tls-id.html">Manage TLS Identities</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="java-android-dep-upgrade.html">Upgrading</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="java-android-troubleshooting.html">Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Learn</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../learn/java-android-database.html">Working with Databases</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-document.html">Working with Documents</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-blob.html">Working with Blobs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../learn/java-android-query.html">Working with Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-query-live.html">Live Queries</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-query-predictive.html">Predictive Queries</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-fts.html">Running Full-text Searches</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="#couchbase-lite:android:learn/java-android-date-time.adoc">Date and Time Functions</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../learn/java-android-replication.html">Working with Replications</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-dbreplica.html">Local Replicaton</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-conflict.html">Handling Conflicts</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-thread-safety.html">Thread-safety</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-cert-pinning.html">Certificate Pinning</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../learn/java-android-p2psync.html">Working with Peer-to-peer Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-p2psync-websocket.html">Peer-to-peer sync over web sockets</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../learn/java-android-p2psync-custom.html">Peer-to-peer sync (custom)</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Refer</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android">API References</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#couchbase-lite::{cbl-pg-glossary}">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../product/java-android-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../product/java-android-pn-supportnotes.html">Support Notices</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#couchbase-lite:android:product/java-android-changelog.adoc">Change Log</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../objc/quickstart-index.html">Objective C</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Start</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/start/objc-gs-prereqs.html">Prerequisites</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/start/objc-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/start/objc-gs-build.html">Test Build</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Next</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/next/objc-dbo-crud.html">Using CRUD Operations</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/next/objc-dbo-query.html">Using Query Operations</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Advance</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<span class="nav-text ">Peer-to-Peer Sync How-to</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/advance/objc-p2psync-websocket-using-passive.html">Deploy Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/advance/objc-p2psync-websocket-using-active.html">Deploy Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/advance/objc-p2p-managing-tls-id.html">Manage TLS Identities</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/advance/objc-dep-upgrade.html">Upgrading</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/advance/objc-troubleshooting.html">Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Learn</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../objc/learn/objc-database.html">Working with Databases</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-document.html">Working with Documents</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-blob.html">Working with Blobs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../objc/learn/objc-query.html">Working with Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-query-live.html">Live Queries</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-query-predictive.html">Predictive Queries</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-fts.html">Running Full-text Searches</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="#couchbase-lite:objc:learn/objc-date-time.adoc">Date and Time Functions</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../objc/learn/objc-replication.html">Working with Replications</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-dbreplica.html">Local Replicaton</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-conflict.html">Handling Conflicts</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-thread-safety.html">Thread-safety</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-cert-pinning.html">Certificate Pinning</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../objc/learn/objc-p2psync.html">Working with Peer-to-peer Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-p2psync-websocket.html">Peer-to-peer sync over web sockets</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../objc/learn/objc-p2psync-custom.html">Peer-to-peer sync (custom)</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Refer</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-objc">API References</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#couchbase-lite::{cbl-pg-glossary}">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/product/objc-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#couchbase-lite:objc:product/objc-pn-supportnotes.adoc">Support Notices</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#couchbase-lite:objc:product/objc-changelog.adoc">Change Log</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../swift/quickstart-index.html">Swift</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Start</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/start/swift-gs-prereqs.html">Prerequisites</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/start/swift-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/start/swift-gs-build.html">Test Build</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Next</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/next/swift-dbo-crud.html">Using CRUD Operations</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/next/swift-dbo-query.html">Using Query Operations</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Advance</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<span class="nav-text ">Peer-to-Peer Sync How-to</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/advance/swift-p2psync-websocket-using-passive.html">Deploy Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/advance/swift-p2psync-websocket-using-active.html">Deploy Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/advance/swift-p2p-managing-tls-id.html">Manage TLS Identities</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/advance/swift-dep-upgrade.html">Upgrading</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/advance/swift-troubleshooting.html">Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Learn</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../swift/learn/swift-database.html">Working with Databases</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-document.html">Working with Documents</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-blob.html">Working with Blobs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../swift/learn/swift-query.html">Working with Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-query-live.html">Live Queries</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-query-predictive.html">Predictive Queries</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-fts.html">Running Full-text Searches</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="#couchbase-lite:swift:learn/swift-date-time.adoc">Date and Time Functions</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../swift/learn/swift-replication.html">Working with Replications</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-dbreplica.html">Local Replicaton</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-conflict.html">Handling Conflicts</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-thread-safety.html">Thread-safety</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-cert-pinning.html">Certificate Pinning</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="in-toggle" data-depth="3"></span>
<a class="nav-link" href="../../swift/learn/swift-p2psync.html">Working with Peer-to-peer Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-p2psync-websocket.html">Peer-to-peer sync over web sockets</a>
</span>
</li>
<li class="nav-item " data-depth="4">

<span class="nav-line "  data-depth="4">
<a class="nav-link" href="../../swift/learn/swift-p2psync-custom.html">Peer-to-peer sync (custom)</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Refer</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-swift">API References</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#couchbase-lite::{cbl-pg-glossary}">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/product/swift-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="#couchbase-lite:swift:product/swift-pn-supportnotes.adoc">Support Notices</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/product/swift-changelog.html">Change Log</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
      <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/android/pages/advance/java-android-p2psync-websocket-using-passive.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
      <div class="toc-menu"></div>
        <div class="is-this-helpful-box">
          <h4> Is this page helpful?</h4>
            <div class="btn-row">
              <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                     <i class="far fa-thumbs-up"></i>
                 Yes

                 </a>
              <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
            </div>
            <div class="any-feedback">
              <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
            </div>
            <div class="dialog-box" id="dialogBox">
              <form>
                  <div class="form-group " id="additionalFeedbackBox">
                    <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

                    <div class="action-btn-row ">
                      <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                       <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                       <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
                    </div>


                  </div>

              </form>

            </div>
      </div>
   </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../index.html">Couchbase Lite (h2Beta-19JUN20)</a></li>
<li class="crumb"><a href="../quickstart-index.html">Android (Java)</a></li>
<li class="crumb">Advance</li>
<li class="crumb">Peer-to-Peer Sync How-to</li>
<li class="crumb"><a href="java-android-p2psync-websocket-using-passive.html">Deploy Passive Peer</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Set-up the Passive Peer&#8201;&#8212;&#8201;Working with Peer-to-Peer Syncs</h1>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise</a></li>
<li class="status"><span>beta -- H2-CBL as at 29Jun20</span></li>
</ul>
</div>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Couchbase Lite - this content covers how to set up a passive peer ready to replicate CBL database changes using peer-to-peer sync over websockets</p>
</div>
<div class="paragraph">
<p>Related Concepts: <a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android">API Reference</a> | <a href="../learn/java-android-p2psync-websocket.html" class="page">Peer-to-peer sync over web sockets</a> | <a href="../learn/java-android-p2psync-custom.html" class="page">Peer-to-peer sync (custom)</a></p>
</div>
<div class="paragraph">
<p>Topic Group: Working with Peer-to-Peer Sync (web sockets)</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This content provides sample code covering the implementation of <a href="../../refer-glossary.html#peer-to-peer-sync" class="page">Peer-to-Peer Sync</a> over websockets.
Specifically it covers the implementation of a <a href="../../refer-glossary.html#passive-peer" class="page">Passive Peer</a> listener, that will accept and apply database changes replicated by a connected <a href="../../refer-glossary.html#passive-peer" class="page">Passive Peer</a>. In this context the term <em>client</em> refers to the <em>active peer</em> and the term <em>server</em> to the <em>passive peer</em></p>
</div>
<div class="paragraph">
<p>You will need to initialize and configure a listener for each Couchbase Lite database instance that you want to sync with other peers.</p>
</div>
<div class="paragraph">
<p><a href="#simple-listener-initialization">Example 1</a> shows a simple initialization and configuration process.</p>
</div>
<div class="paragraph">
<p>The subsequent sections show additional details on the configuration options with examples.
You do not need to provide configuration values for all properties, only those necessary to meet the requirements of your sync process.</p>
</div>
<div id="simple-listener-initialization" class="exampleblock">
<div class="title">Example 1. Simple Listener Initialization</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">// fileprivate var _allowlistedUsers:[[String:String]] = []
// fileprivate var _websocketListener:URLEndpointListener?
// fileprivate var _userDb:Database?
  // Include websockets listener initializer code

  // func fMyPassListener() {
  CouchbaseLite.init(context);
  Database passDb = new Database("passivepeerdb");  <i class="conum" data-value="1"></i><b>(1)</b>
  URLEndpointListenerConfiguration listenerConfig = new URLEndpointListenerConfiguration(passDB);
  /* optionally */ Integer wsPort = 4984;
  /* optionally */ Integer wssPort = 4985;
  listenerConfig.setPort(wssPort);

  listenerConfig.setNetworkInterface = "10.1.1.10";

  // This combination will set
  // -- TLS on
  //    optionally switch it off .disableTLS  = true
  listenerConfig.setDisableTLS  = false; <i class="conum" data-value="2"></i><b>(2)</b>
  // -- Use anonymous self-cert
  listenerConfig.tlsIdentity = nil;
  // -- Use id and certs from keychain
  listenerConfig.tlsIdentity = TLSIdentity("CBL-Android-Server-Cert");
  // optionally  listenerConfig.tlsIdentity = TLSIdentity(withIdentity:serverSelfCert-id)

  listenerConfig.authenticator = ListenerPasswordAuthenticator.init { <i class="conum" data-value="3"></i><b>(3)</b>
      (username, password) -&gt; Bool in
          if (self._allowlistedUsers.contains(
            ["password" : password, "name":username])) {
              return true
          }
      return false
  };

  listenerConfig.enableDeltaSync = true; <i class="conum" data-value="4"></i><b>(4)</b>

  URLEndpointListener websocketListener = new URLEndpointListener(config: listenerConfig); <i class="conum" data-value="5"></i><b>(5)</b>

  // websocketListener = _websocketListener else {
  //   throw print("WebsocketsListenerNotInitialized")
  //   // ... take appropriate actions
  // }
  try websocketListener.start() <i class="conum" data-value="6"></i><b>(6)</b> <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#configure-listener-endpoint">Configure Listener Endpoint</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#configure-server-security">Configure Server Security</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="#configure-client-security">Configure Client Security</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="#configure-delta-sync">Configure Delta Sync</a></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Initialize the listener using the configuration settings</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><a href="#start-listening">Start Listening</a></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>On-going listener <a href="#monitor-the-listener">monitoring</a>, including <a href="#conflict-resolution">Conflict Resolution</a></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api-references"><a class="anchor" href="#api-references"></a>API References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find <a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android">Android (Java) API References</a> here.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discovery"><a class="anchor" href="#discovery"></a>Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An optional, but typical step.</p>
</div>
<div class="paragraph">
<p>Prior to initiating the listener you may execute the peer discovery phase or use a pre-configured endpoint.</p>
</div>
<div class="paragraph">
<p>For the passive peer discovery involves advertising the service using, for example <em>Bonjour</em>, and waiting for an invite from the <a href="../../refer-glossary.html#active-peer" class="page">Active Peer</a>.
The connection is established once the passive peer has authenticated and accepted an active peer&#8217;s invitation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-listener-endpoint"><a class="anchor" href="#configure-listener-endpoint"></a>Configure Listener Endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set the listener endpoint.
As a minimum this must include the local database name.
You can also over-ride the auto-seleted default port number and-or configure a specific network-interface.</p>
</div>
<div class="paragraph">
<p>All other configuration values will take their default setting.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Database name</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The database name is set using the <a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)database">database</a> property.
It is a mandatory, read-only property that is set only by using the <code><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a></code> constructor
<a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(im)initWithDatabase:">-initWithDatabase:</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Port number</dt>
<dd>
<p>The listener will auto-select an available port.
Use the <a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)port">port</a> property to configure use of a specific port.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Network Interface</dt>
<dd>
<p>The listener will listen on all network interfaces.
Use the
<a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)networkInterface">networkInterface</a> property
to configure a specific the network interface.
This must be either an IP Address or network interface name such as <code>en0</code>.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="title">Example 2. Configure Endpoint</div>
<div class="content">
<div class="paragraph">
<p>In this example <code>_userDb</code> has previously been declared as an object of type Database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">CouchbaseLite.init(context);
Database passDb = new Database("passivepeerdb");  <i class="conum" data-value="1"></i><b>(1)</b>
URLEndpointListenerConfiguration listenerConfig = new URLEndpointListenerConfiguration(passDB);
/* optionally */ Integer wsPort = 4984;
/* optionally */ Integer wssPort = 4985;
listenerConfig.setPort(wssPort);

listenerConfig.setNetworkInterface = "10.1.1.10";</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-server-security"><a class="anchor" href="#configure-server-security"></a>Configure Server Security</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">Enable or Disable TLS</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>TLS is enabled by default.
Use the <code><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)disableTLS">disableTLS</a></code>  property of <code><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a></code> to disable TLS communication if necessary</p>
</div>
<div class="paragraph">
<p>This property works in conjunction with <code>TLSidentity</code>, which enables developers to define the key and-or certificate to be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>disableTLS</code> is true&#8201;&#8212;&#8201;TLS communication is disabled and the <code><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)tlsIdentity">tlsIdentity</a></code> property is ignored.</p>
</li>
<li>
<p>If <code>disableTLS</code> is false or not specified&#8201;&#8212;&#8201;TLS communication is enabled.
Set the required <code><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)tlsIdentity">tlsIdentity</a></code> property.
Use the <code>wss://</code> URL scheme used to connect to the listener.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Set TLS Server Id</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use the
<a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)tlsIdentity">tlsIdentity</a> property of
<a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a> to configure the TLS Identity used in TLS communication.</p>
</div>
<div class="paragraph">
<p>If <code>TLSIdentity</code> is not set when TLS is enabled (default), the listener uses an auto-generated anonymous self-signed identity.
This doesn&#8217;t authenticate or verify trust (on the client side) but it does encrypt communication, giving a more secure option than Non-TLS communication.</p>
</div>
<div class="paragraph">
<p><strong>Resuable Id</strong>&#8201;&#8212;&#8201;If the platform supports secure storage, you can save and re-use the auto-generated identity. This avoids the need to generate new identities every time.</p>
</div>
<div class="paragraph">
<p>Typically, you will configure the TLS Server identity once during initial launch.
Subsequent starts of the listener will then reuse the identity from the keychain, or (re)create it if it doesn&#8217;t exist&#8201;&#8212;&#8201;see: <a href="java-android-p2p-managing-tls-id.html" class="page">Manage TLS Identities</a></p>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_use-nil-id"></a>Use nil id</p>
</li>
<li>
<p><a id="tabset1_use-id-from-keychain"></a>Use id from keychain</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_use-nil-id">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">    // -- Use anonymous self-cert
    listenerConfig.tlsIdentity = nil;
listenerConfig.tlsIdentity = nil</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_use-id-from-keychain">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">// -- Use id and certs from keychain
listenerConfig.tlsIdentity = TLSIdentity("CBL-Android-Server-Cert");
// optionally  listenerConfig.tlsIdentity = TLSIdentity(withIdentity:serverSelfCert-id)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-client-security"><a class="anchor" href="#configure-client-security"></a>Configure Client Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ve to top level security section.</p>
</div>
<div class="paragraph">
<p>Use the
<a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a> class&#8217;s <a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)authenticator">authenticator</a> property to specify how client credentials are to be authenticated.</p>
</div>
<div class="paragraph">
<p>Valid options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ListenerPasswordAuthenticator&#8201;&#8212;&#8201;which authenticates using a client&#8217;s username and password</p>
</li>
<li>
<p>ListenerCertificateAuthenticator&#8201;&#8212;&#8201;which authenticates using  a clients certificate.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="authenticate-using-the-client-username-and-password"><a class="anchor" href="#authenticate-using-the-client-username-and-password"></a>Authenticate Using the Client Username and Password</h3>
<div class="paragraph">
<p>This content shows how to authenticate using the client username and password. For how authenticate using client certs see: <a href="#authenticating-with-certificate">[authenticating-with-certificate]</a></p>
</div>
<div class="paragraph">
<p>Use the <code>ListenerPasswordAuthenticator</code> class to provide password type authentication such as the Basic Authentication.</p>
</div>
<div class="paragraph">
<p>The actual authentication logic is provided through a <code>ListenerPasswordAuthenticatorDelegate</code> object provided by the application code.
Often in the form of a closure where the platform permits.</p>
</div>
<div class="paragraph">
<p>Use the <code>ListenerPasswordAuthenticatorDelegate</code> type to provide the application logic to be used to authenticate user credentials such as name and password.</p>
</div>
<div class="paragraph">
<p>Your <code>ListenerPasswordAuthenticatorDelegate</code> should be a function or block (such as a closure expression) if the platform allows.</p>
</div>
<div class="paragraph">
<p>The parameters are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User Name&#8201;&#8212;&#8201;type String</p>
</li>
<li>
<p>Password&#8201;&#8212;&#8201;type will depend on the platform, for example SecureString for .NET or byte[] for Java.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 3. Password authentication</div>
<div class="content">
<div class="paragraph">
<p>In this example, <code>allowlistedUsers</code> is a dictionary comprising the usernames and passwords of valid users. Credentials not in <code>allowlistedUsers</code> are denied access.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">listenerConfig.authenticator = ListenerPasswordAuthenticator.init { <i class="conum" data-value="1"></i><b>(1)</b>
    (username, password) -&gt; Bool in
        if (self._allowlistedUsers.contains(
          ["password" : password, "name":username])) {
            return true
        }
    return false
};</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authenticate-using-the-client-certificate"><a class="anchor" href="#authenticate-using-the-client-certificate"></a>Authenticate using the Client Certificate</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use the <code>ListenerCertificateAuthenticator</code> class to authenticate  clients certificates.
This requires you have TLS enabled.
You can verify the certificate using either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Root CA certificate chains&#8201;&#8212;&#8201;any client cert signed by the given root CA cert chains is authenticated</p>
</li>
<li>
<p>Application logic&#8201;&#8212;&#8201;an option used mainly for authenticating self-signed certificates</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Initialize the <code>ListenerCertificateAuthenticator</code> using the <code>rootCert</code> interface. This identifies the Root CA Chain to be used to verify a certificate chain received from the client.</p>
</div>
<div class="paragraph">
<p>Initialize the <code>ListenerCertificateAuthenticator</code> using the <code>ListenerCertificateAuthenticatorDelegate</code> interface. This identifies the application logic to be used to verify a certificate chain received from the client.</p>
</div>
<div class="paragraph">
<p>The logic should take the form of function or block (such as, a closure expression) if the platform allows.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_using-root-ca-certificate-chains"></a>Using Root CA Certificate Chains</p>
</li>
<li>
<p><a id="tabset2_using-application-logic"></a>Using Application Logic</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_using-root-ca-certificate-chains">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">// cert is a pre-populated object of type:SecCertificate representing a certificate
let rootCertData = SecCertificateCopyData(cert) as Data
let rootCert = SecCertificateCreateWithData(kCFAllocatorDefault, rootCertData as CFData)!
// Listener:
listenerConfig.authenticator = ListenerCertificateAuthenticator.init (rootCerts: [rootCert])</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_using-application-logic">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">listenerConfig.authenticator = ListenerCertificateAuthenticator.init {
  (cert) -&gt; Bool in
    var cert:SecCertificate
    var certCommonName:CFString?
    let status=SecCertificateCopyCommonName(cert, &amp;certCommonName)
    if (self._allowlistedUsers.contains(["name": certCommonName! as String])) {
        return true
    }
    return false
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-impact-of-tls-settings"><a class="anchor" href="#the-impact-of-tls-settings"></a>The Impact of TLS Settings</h3>
<div class="paragraph">
<p>The table in this section shows the expected system behavior (in regards to security ) depending on the TLS configuration settings deployed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Expected system behavior</caption>
<colgroup>
<col style="width: 12%;">
<col style="width: 44%;">
<col style="width: 44%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>disableTLS</code></th>
<th class="tableblock halign-left valign-top"><code>tlsIdentity</code> (corresponding to server)</th>
<th class="tableblock halign-left valign-top">Expected system behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignored</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="olist arabic">
<ol class="arabic">
<li>
<p>TLS is disabled.</p>
</li>
<li>
<p>Communication is plain text.</p>
</li>
</ol>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to <code>nil</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="olist arabic">
<ol class="arabic">
<li>
<p>The system will auto generate an <em>anonymous</em> self signed cert.</p>
</li>
<li>
<p>Active peers will skip validation of the server cert.</p>
</li>
<li>
<p>Communication is encrypted</p>
</li>
</ol>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set to server identity generated from a self- or CA-signed certificate</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On first use&#8201;&#8212;&#8201;Bring your own cert and private key (use <code>importIdentity</code>).</p>
</li>
<li>
<p>Each time&#8201;&#8212;&#8201;Use the server identity from the cert stored in the keychain; for example, use <code>TSLIdentity.identity(withIdentity:)</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See: <a href="java-android-p2p-managing-tls-id.html" class="page">Manage TLS Identities</a> for more on how to store and use identities.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="olist arabic">
<ol class="arabic">
<li>
<p>System will use the provided self- or CA-signed cert.</p>
</li>
<li>
<p>Active peers will validate the cert.</p>
</li>
<li>
<p>Communication is encrypted.</p>
</li>
</ol>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-delta-sync"><a class="anchor" href="#configure-delta-sync"></a>Configure Delta Sync</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Delta sync replication is not enabled by default.</p>
</div>
<div class="paragraph">
<p>Use the <code><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html#/c:android(cs)URLEndpointListenerConfiguration(py)enableDeltaSync">enableDeltaSync</a></code> property of <code><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android/Classes/URLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a></code> to activate or deactivate delta sync mode when replicating.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Enable delta sync</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">listenerConfig.enableDeltaSync = true</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="start-listening"><a class="anchor" href="#start-listening"></a>Start Listening</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have completed the listener&#8217;s configuration settings you can initialize the listener instance and start listening&#8201;&#8212;&#8201;see: <a href="#initialize-and-start-listener">Example 5</a></p>
</div>
<div id="initialize-and-start-listener" class="exampleblock">
<div class="title">Example 5. Initialize and start listener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">URLEndpointListener websocketListener = new URLEndpointListener(config: listenerConfig); <i class="conum" data-value="1"></i><b>(1)</b>

// websocketListener = _websocketListener else {
//   throw print("WebsocketsListenerNotInitialized")
//   // ... take appropriate actions
// }
try websocketListener.start() <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize the listener instance using the configuration settings.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start the listener, ready to accept connections and incoming data from active peers.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Start and required on-going listener <a href="#monitor-the-listener">Monitoring</a>, including <a href="#conflict-resolution">Conflict Resolution</a></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitor-the-listener"><a class="anchor" href="#monitor-the-listener"></a>Monitor the Listener</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the <code>status</code> property of the listener to check on the number of total and active connections.
The object returned is of type <code>ConnectionStatus</code> and comprises:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ConnectionCount&#8201;&#8212;&#8201;the total number of connections served by the listener</p>
</li>
<li>
<p>activeConnectionCount&#8201;&#8212;&#8201;the number of active (BUSY) connections currently being served by the listener</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 6. Using status to monitor listener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">var totalConnections = websocketListener.status.connectionCount
var activeConnections = websocketListener.status.activeConnectionCount</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conflict-resolution"><a class="anchor" href="#conflict-resolution"></a>Conflict Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All conflicts are resolved on the active peer, which supports both automatic and custom conflict resolution.
The listener returns a 409 response on detecting a conflict.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stop-the-listener"><a class="anchor" href="#stop-the-listener"></a>Stop the Listener</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Stop listening using <code>stop</code> method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">websocketListener.stop()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 pane__frames cols-3">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">How-to &#8230;&#8203;</div>
<ul>
<li>
<p>Peer-to-peer (websocket) sync</p>
<div class="ulist">
<ul>
<li>
<p><a href="java-android-p2psync-websocket-using-passive.html" class="page">Deploy Passive Peer</a> listener</p>
</li>
<li>
<p><a href="java-android-p2psync-websocket-using-active.html" class="page">Deploy Active Peer</a> listener</p>
</li>
<li>
<p><a href="java-android-p2p-managing-tls-id.html" class="page">Manage TLS Identities</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Learn more &#8230;&#8203;</div>
<ul>
<li>
<p>Peer-to-peer  sync</p>
<div class="ulist">
<ul>
<li>
<p><a href="../learn/java-android-p2psync-websocket.html" class="page">Peer-to-peer sync over web sockets</a></p>
</li>
<li>
<p><a href="../learn/java-android-p2psync-custom.html" class="page">Peer-to-peer sync (custom)</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Related replication topics</p>
<div class="ulist">
<ul>
<li>
<p><a href="../learn/java-android-replication.html" class="page">Working with Replications</a></p>
</li>
<li>
<p><a href="../learn/java-android-conflict.html" class="page">Handling Conflicts</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Dive Deeper &#8230;&#8203;</div>
<ul>
<li>
<p>Reference content</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://ibsoln.github.io/stage/api/mobile/2.8.0/couchbase-lite-java-android">API References</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Community</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://forums.couchbase.com/c/mobile/14">Forum</a></p>
</li>
<li>
<p><a href="https://blog.couchbase.com/">Blog</a></p>
</li>
<li>
<p><a href="https://docs.couchbase.com/tutorials/index.html">Tutorials</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Enterprise Edition only</div>
This an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.
Purchase the <em>Enterprise License</em>, which includes official <a href="https://www.couchbase.com/support-policy">Couchbase Support</a>, to use it in production (see the license and support <a href="https://www.couchbase.com/licensing-and-support-faq">Licensing</a>).
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2020 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
