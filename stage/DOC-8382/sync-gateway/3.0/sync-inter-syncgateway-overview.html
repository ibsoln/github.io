<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Inter-Sync Gateway Replication | Couchbase Docs</title>
<link rel="canonical" href="https://ibsoln.github.io/stage/DOC-8382/sync-gateway/3.0/sync-inter-syncgateway-overview.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Use inter-Sync Gateway replication to keep clusters in different mobile data centers in sync.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="sync-gateway">
<meta name="dcterms.identifier" content="3.0">
<meta name="generator" content="Antora 2.3.3">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://ibsoln.github.io/stage/DOC-8382/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container conceptual">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Sync Gateway</span></h4>
<a class="frame-link component" href="index.html"> <span class="version">3.0</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="index.html">Sync Gateway</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="whatsnew.html">What&#8217;s New</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Start Here!</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="introduction.html">Introduction</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="get-started-prepare.html">Prepare</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="get-started-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="get-started-verify-install.html">Verify</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="data-modeling.html">Data Modeling</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Concepts</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="users.html">Users</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="roles.html">Roles</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="channels.html">Channels</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="what-are-tombstones.html">Tombstones</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="revisions.html">Revisions</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Configuration</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="configuration-overview.html">Overview</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="configuration-schema.html">Schema</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="configuration-javascript-functions.html">Javascript Functions</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="configuration-environment-variables.html">Environment Variables</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="configuration-rest-api.html">REST API</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">REST API</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api-access.html">Access</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api.html">Public API</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="rest-api-admin.html">Admin API</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="rest-api-admin-access-control.html">Access Controls</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="rest-api-admin-database.html">Database</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="rest-api-admin-sync.html">Inter-Sync-Gateway Replication</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="rest-api-metrics.html">Metrics API</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Security</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="authentication-users.html">User Authentication</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="authentication-certs.html">TLS Certificate Authentication</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Access Control</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-function.html">Sync Function</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="import-filter.html">Import filter</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="read-access.html">Read Access</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="write-access.html">Write Access</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Sync</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="sync-with-couchbase-server.html">Sync with Couchbase Server</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="sync-using-app.html">Sync Using App</a>
</span>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Inter-Sync Gateway Replication</span>
</span>
<ul class="nav-list">
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-overview.html">Overview</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-run.html">Initialize</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-manage.html">Manage</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sync-inter-syncgateway-monitor.html">Monitor</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<span class="nav-text ">{sgw-xref}sync-inter-syncgateway-conflict-resolution.adoc[Conflict Resolution]</span>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="managing-tombstones.html">Managing Tombstones</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="delta-sync.html">Delta Sync</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resync.html">Resync</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Manage</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="stats-monitoring.html">Stats Monitoring</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Logging and Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="logging.html">Logging</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="sgcollect-info.html">SGCollect Info</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="database-offline.html">Database Offline</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Deploy</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="deployment.html">Overview</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="command-line-options.html">Command Line Options</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="load-balancer.html">Load Balancer</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="os-level-tuning.html">OS-Level Tuning</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="webhooks.html">Webhooks</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="server-integration.html">Server Integration</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="integrating-external-stores.html">Integrating External Stores</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="stats-prometheus.html">Stats Prometheus</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="indexing.html">Indexing</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="upgrading.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Use Kubernetes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#3.0@sync-gateway::{deploy-cluster&amp;#8212;&amp;#8203;page}">Deploy</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="release-notes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="supported-environments.html">Supported Environments</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="compatibility.html">Compatibility Matrix</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Legacy Features</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="legacy-configuration-properties.html">Configuration Properties (depr)</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="legacy-sgreplicate-resolving-conflicts.html">SG-Replicate - Resolving Conflicts (depr)</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="legacy-sg-replicate.html">SG-Replicate</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="legacy-logging-pre2-1.html">Legacy Logging Pre2 1</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../couchbase-lite/2.8/index.html">Couchbase Lite</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/2.8/android/quickstart.html">Android (Java)</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/2.8/csharp/quickstart.html">C#</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/2.8/java/quickstart.html">Java</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/2.8/objc/quickstart.html">Objective-C</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../couchbase-lite/2.8/swift/quickstart.html">Swift</a>
</span>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/sgw/modules/ROOT/pages/sync-inter-syncgateway-overview.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="index.html">Sync Gateway</a></li>
<li class="crumb">Sync</li>
<li class="crumb">Inter-Sync Gateway Replication</li>
<li class="crumb"><a href="sync-inter-syncgateway-overview.html">Overview</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Inter-Sync Gateway Replication</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Use inter-Sync Gateway replication to keep clusters in different mobile data centers in sync.</em><br>
<em>Abstract&#8201;&#8212;&#8201;Inter-Sync Gateway replication supports resilient, secure, scalable bidirectional synchronization of data between cloud and edge data centers. It incorporates content presented under Manage&gt;Replicate&gt;Inter-Sync Gateway to give an integrated view.</em><br>
Related Content&#8201;&#8212;&#8201;<a href="legacy-configuration-properties.html" class="page">Configuration Properties (depr)</a> | <a href="rest-api-admin.html" class="page">Admin REST API</a> | <a href="sync-inter-syncgateway-run.html" class="page">Initialize Inter-Sync Gateway Replications</a></p>
</div>
</blockquote>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Context Clarification</div>
<div class="paragraph">
<p>This content relates only to inter-Sync Gateway replication in Sync Gateway 2.8+.
For documentation on pre-2.8 inter-Sync Gateway replication (also known as SG Replicate)&#8201;&#8212;&#8201;see <a href="legacy-sg-replicate.html" class="page">SG-Replicate</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Sync Gateway&#8217;s <em>{_glos-pfx}inter-sync-gateway-replication[Inter-Sync Gateway Replication<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>]</em> feature supports <em>{_glos-pfx}cloud-to-edge[cloud-to-edge<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] synchronization</em> use cases, where data changes must be synchronized between a centralized cloud cluster and a large number of edge clusters whilst still enforcing fine grained access control.
This is an increasingly important enterprise-level requirement.</p>
</div>
<div class="paragraph">
<p>In the architecture diagram (<a href="#icr-architecture">Figure 1</a>), the replicator on the active Sync Gateway node ensures that any database changes made to documents in either {_glos-pfx}sync-gateway-database[Sync Gateway database<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] instance are replicated to the other Sync Gateway instance, in accordance with the replication&#8217;s configuration&#8201;&#8212;&#8201;see <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep" class="page">replications</a> for configuration details.</p>
</div>
<div id="icr-architecture" class="imageblock">
<div class="content">
<img src="_images/icr-replication-overview.svg" alt="icr replication overview">
</div>
<div class="title">Figure 1. Inter-Sync Gateway Replication architecture</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-cases"><a class="anchor" href="#use-cases"></a>Use Cases</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cloud-to-edge-synchronization"><a class="anchor" href="#cloud-to-edge-synchronization"></a>Cloud-to-edge synchronization</h3>
<div class="paragraph">
<p>In this multi-cloud deployment mode large numbers of multiple edge clusters sync with one or more clusters in cloud data centers. Each edge can operate autonomously without network connectivity to the cloud data centers <sup class="footnote" id="_footnote_arch">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>A typical architecture for this use cases is shown in <a href="#icr-cloud-to-edge">Figure 2</a></p>
</div>
<div id="icr-cloud-to-edge" class="imageblock">
<div class="content">
<img src="_images/icr-cloud-to-edge200712.svg" alt="icr cloud to edge200712" width="600">
</div>
<div class="title">Figure 2. Cloud-to-edge synchronization</div>
</div>
</div>
<div class="sect2">
<h3 id="active-to-active-mobile-synchronization"><a class="anchor" href="#active-to-active-mobile-synchronization"></a>Active-to-active Mobile Synchronization</h3>
<div class="paragraph">
<p>Here edge clusters containing active Sync&#160;Gateway nodes are replicated between geographically separate cloud-based Sync Gateway deployments.
An ideal use-case for inter-Sync&#160;Gateway replication, which was designed to keep clusters in different data centers in sync.</p>
</div>
<div class="paragraph">
<p>The Couchbase Server Cross Data Center Replication API (<a href="#server:manage:manage-xdcr/xdcr-management-overview.adoc" class="page unresolved">XDCR</a>) is similarly used to replicate between Couchbase Server clusters.
<strong>However, the inter-Sync&#160;Gateway replication feature is specifically designed for Sync Gateway deployments and it must be used for replication between mobile clusters.</strong> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="paragraph">
<p>A typical architecture for this use case is shown in <a href="#icr-active-mobile">Figure 3</a></p>
</div>
<div id="icr-active-mobile" class="imageblock">
<div class="content">
<img src="_images/icr-active-mobile-sync200713.svg" alt="icr active mobile sync200713" width="600">
</div>
<div class="title">Figure 3. Active-to-active mobile synchronization</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication-characteristics"><a class="anchor" href="#replication-characteristics"></a>Replication Characteristics</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>In this section</em>:  <a href="#context">Context</a>  |  <a href="#protocol">Protocol</a>  |  <a href="#types-of-replication">Types of Replication</a>  |  <a href="#delta-sync">Delta Sync</a>  |  <a href="#directionality">Directionality</a>  |  <a href="#security">Security</a></p>
</div>
<div class="sect2">
<h3 id="context"><a class="anchor" href="#context"></a>Context</h3>
<div class="paragraph">
<p>Sync Gateway supports the ability to run replications between Sync Gateway clusters using a new websockets based protocol, with the {_glos-pfx}active-replicator[active replicator<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] {_glos-pfx}sync-function[synchronizing<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] changes between two {_glos-pfx}sync-gateway-database[Sync Gateway databases<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>].</p>
</div>
<div class="paragraph">
<p>All replications are based on a {_glos-pfx}replication-definition[replication definition<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] provided either to the Admin REST API or in Sync Gateway&#8217;s configuration file (JSON).</p>
</div>
<div class="paragraph">
<p>Replications always involve at least one local database.
Sync Gateway does not enable replication between two <em>remote</em> nodes, because replications are defined at database level and so at least one database will be local.</p>
</div>
<div class="paragraph">
<p>All replications take place at the document level (but see also, <a href="#delta-sync">Delta Sync</a>).</p>
</div>
<div class="paragraph">
<p>Sync Gateway nodes can opt-out of participating in the replication process using the database-level parameter <a href="legacy-configuration-properties.html#databases-this_db-sgreplicate_enabled" class="page">sgreplicate_enabled</a>.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="legacy-configuration-properties.html#databases" class="page">databases</a>  |  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-remote" class="page">remote</a> |  <a href="legacy-configuration-properties.html#databases-this_db-sgreplicate_enabled" class="page">sgreplicate_enabled</a></p>
</div>
</div>
<div class="sect2">
<h3 id="protocol"><a class="anchor" href="#protocol"></a>Protocol</h3>
<div class="paragraph">
<p>Inter-Sync&#160;Gateway replications are based on websockets. This is the exact same protocol that is used for replication with Couchbase Lite 2.x clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For users on releases prior to 2.8, SG Replicate provides a HTTP-based replication&#8201;&#8212;&#8201;see the appropriate documentation here&#8201;&#8212;&#8201;<a href="legacy-sg-replicate.html" class="page">SG-Replicate</a> (deprecated).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The bi-directional, persistent, nature of websocket connections is ideal for applications such as a <em>continuous</em> Sync Gateway replication, which is constantly waiting-for and synchronizing change events.</p>
</div>
</div>
<div class="sect2">
<h3 id="types-of-replication"><a class="anchor" href="#types-of-replication"></a>Types of Replication</h3>
<div class="paragraph">
<p>Replications are either: {_glos-pfx}adhoc-replication[adhoc replication<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] (REST API only) or {_glos-pfx}persistent-replication[persistent replication<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>].
They can also be configured to run in one of two-modes:
{_glos-pfx}rep-continuous[continuous<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] or {_glos-pfx}rep-oneshot[one-shot<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>].</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Persistent replications survive Sync Gateway node restarts and continue running automatically unless configured not to.
They can be configured to run in either {_glos-pfx}rep-continuous[continuous<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] or {_glos-pfx}rep-oneshot[one-shot<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] mode.</p>
</div>
</div>
</div>
</li>
<li>
<p>Ad hoc</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Ad hoc replications are transient, existing only for the period of the replication.
They provide a convenient way to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run one off replications (for example, when troubleshooting)</p>
</li>
<li>
<p>Run on-demand replications after Sync Gateway is started.
For instance a replication that needs to be to be run only periodically can be configured as an ad hoc replication by an automated script scheduled to run when needed.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-continuous" class="page">continuous</a> |  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-adhoc" class="page">adhoc</a></p>
</div>
</div>
<div class="sect2">
<h3 id="delta-sync"><a class="anchor" href="#delta-sync"></a>Delta Sync</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This content relates only to <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With delta-sync enabled on the replication and both databases involved, only the changed data items are transferred.</p>
</div>
<div class="paragraph">
<p>You can configure replications to use delta-sync by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting <code>"enable_delta_sync": true</code> in the <em>replication definition</em></p>
</li>
<li>
<p>Setting <code>"delta-sync": { "enabled": true}</code> on both databases in their respective <em>database definitions</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Push replications to pre-2.8 targets do not use Delta Sync
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="legacy-configuration-properties.html#databases" class="page">databases</a>  |  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |
<a href="legacy-configuration-properties.html#databases-this_db-delta_sync" class="page">this_db.delta_sync</a>  |  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-enable_delta_sync" class="page">enable_delta_sync</a></p>
</div>
</div>
<div class="sect2">
<h3 id="directionality"><a class="anchor" href="#directionality"></a>Directionality</h3>
<div class="paragraph">
<p>Replications are bi-directional.
You can <em>push</em>, <em>pull</em> or <em>push and pull</em> between the two database endpoints.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-direction" class="page">direction</a></p>
</div>
</div>
<div class="sect2">
<h3 id="security"><a class="anchor" href="#security"></a>Security</h3>
<div class="paragraph">
<p>Transport level security is provided for. Use the appropriate prefix in URL (WSS for websockets).</p>
</div>
<div class="sect3">
<h4 id="authentication"><a class="anchor" href="#authentication"></a>Authentication</h4>
<div class="paragraph">
<p>Support for Basic Authentication using username and password credentials is provided</p>
</div>
</div>
<div class="sect3">
<h4 id="access-control"><a class="anchor" href="#access-control"></a>Access Control</h4>
<div class="paragraph">
<p>Data access control is provided by Sync Gateway&#8217;s {_glos-pfx}sync-function[sync function<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] and the username/password credentials.
All replicated documents pass through this function ensuring that access permissions are adhered to.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="legacy-configuration-properties.html#databases" class="page">databases</a>  |  <a href="legacy-configuration-properties.html#databases-this_db-sync" class="page">sync</a><br>
<em>Related how-to</em>: <a href="sync-function.html" class="page">Sync Function</a>  |  {xref-sgw-pg-adv-sgw-cfg-sync-function}</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="network-resilience"><a class="anchor" href="#network-resilience"></a>Network Resilience</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inter-Sync Gateway replications will automatically attempt to restart whenever the node restarts.</p>
</div>
<div class="paragraph">
<p>Network resiliency is built-in for <em>continuous</em> replications.
They respond to network issues such as lost connections, by applying a {_glos-pfx}persistent-exponential-backoff[persistent exponential backoff<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>] policy to attempt reconnection.</p>
</div>
<div class="paragraph">
<p>The <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-max_backoff_time" class="page">max_backoff_time</a> determines the maximum wait time between retries.
When the limit is reached retries are made every <code>max_backoff_time</code> minutes.
Set <code>"max_backoff_time": 0</code> to prevent indefinite retries. Exponential backoff retries will be attempted for up to 5 minutes and then stop if the connection has not been re-established</p>
</div>
<div class="paragraph">
<p><br>
<em>Related replication definition elements</em>:  <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-max_backoff_time" class="page">max_backoff_time</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="high-availability"><a class="anchor" href="#high-availability"></a>High Availability</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>In this section</em></strong>: <a href="#node-distribution">Node Distribution</a>  | <a href="#configuration-requirements">Configuration Requirements</a>  |  <a href="#expected-failure-behavior">Expected Failure Behavior</a>  |  <a href="#examples-of-expected-behavior">Examples of Expected behavior</a>  |  <a href="#monitoring-node-distribution">Monitoring Node Distribution</a></p>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a>Overview</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This content relates only to <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a>
</td>
</tr>
</table>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_enterprise"></a>Enterprise</p>
</li>
<li>
<p><a id="tabset1_community"></a>Community</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_enterprise">
<div class="paragraph">
<p>Inter-Sync Gateway Replication provides built-in High Availability (HA) support.
It uses <em>node distribution</em> to ensure all running replications are uniformly distributed across all available nodes, regardless of their originating node.</p>
</div>
<div class="paragraph">
<p>A replication runs on only one node at any given time.
When a node fails, the system automatically distributes that node&#8217;s replications across any available alternative nodes (providing the replication has been configured on multiple nodes).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To use high-availability, configure the same replication on at least two Sync Gateway nodes.
</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_community">
<div class="paragraph">
<p>Even though automatic node-distribution is not available in <a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a>, you can make your replications more highly-available.</p>
</div>
<div class="paragraph">
<p>Simply define the same replication on multiple nodes. They will then run on each of those nodes.</p>
</div>
<div class="paragraph">
<p>This redundancy provides some resiliency if a node fails.
As, although no automatic distribution of replications is done,if the replication is running on multiple nodes then it will continue running on any surviving nodes.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#examples-of-expected-behavior">Examples of Expected behavior</a> below.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="node-distribution"><a class="anchor" href="#node-distribution"></a>Node Distribution</h3>
<div class="paragraph">
<p>The goal of node distribution is to maintain an optimal balance of replications across the cluster.,with any given replication runs on only one node at any give time.</p>
</div>
<div class="paragraph">
<p>To achieve this Sync Gateway automatically balances, as equally as possible, the number of replications running on each node.</p>
</div>
<div class="paragraph">
<p>Where multiple replications are configured on multiple nodes, Sync Gateway automatically distributes these replications across all the available nodes for which the replications are configured.
It continually monitors and redistributes replications as the number of available nodes and the number of running replications in a cluster changes.</p>
</div>
<div class="paragraph">
<p>The nodes' processing load and bandwidth usage is minimized by ensuring that a replicator runs on only one node at any given time&#8201;&#8212;&#8201;even where it has been configured to run on multiple nodes.
This avoids the redundant exchange of data arising from duplicate replication.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-requirements"><a class="anchor" href="#configuration-requirements"></a>Configuration Requirements</h3>
<div class="paragraph">
<p>To configure a replication to be highly available, include its database and replication definition in the sync gateway configuration on each node in the cluster that you want to be able to run it.
<em>At least two nodes are required.</em></p>
</div>
<div class="paragraph">
<p>Node distribution will automatically elect an appropriate node to run them on and take care of redistributing them if a node fails.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>`:  <a href="legacy-configuration-properties.html" class="page">Configuration Properties (depr)</a>  |  <a href="rest-api-admin.html" class="page">Admin REST API</a></p>
</div>
</div>
<div class="sect2">
<h3 id="expected-failure-behavior"><a class="anchor" href="#expected-failure-behavior"></a>Expected Failure Behavior</h3>
<div class="paragraph">
<p>If a node fails, then Sync Gateway will take any replications configured on multiple nodes, redistribute them across all available remaining nodes and restart them.
Node distribution will continually seek to maintain an optimal distribution of replications across available nodes.</p>
</div>
<div class="sect3">
<h4 id="examples-of-expected-behavior"><a class="anchor" href="#examples-of-expected-behavior"></a>Examples of Expected behavior</h4>
<div class="paragraph">
<p>This section provides examples of expected behavior in differing scenarios.
It provides a comparison of how behavior differs between <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a> and <a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a>.</p>
</div>
<div class="paragraph">
<p>The following scenarios are covered, each involves a sync gateway cluster with multiple nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Homogenous configuration&#8201;&#8212;&#8201;see <a href="#homogenous-config">Example 1</a></p>
</li>
<li>
<p>Homogenous configuration with non-replicating node&#8201;&#8212;&#8201;see <a href="#homogenous-non-rep-node">Example 2</a></p>
</li>
<li>
<p>Heterogenous configuration&#8201;&#8212;&#8201;see <a href="#hetero-config">Example 3</a></p>
</li>
<li>
<p>Adding more nodes&#8201;&#8212;&#8201;see <a href="#adding-more-nodes">Example 4</a></p>
</li>
<li>
<p>Failing node&#8201;&#8212;&#8201;see <a href="#failing-node">Example 5</a></p>
</li>
</ul>
</div>
<div id="homogenous-config" class="exampleblock">
<div class="title">Example 1. Homogenous configuration</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes</p>
</li>
<li>
<p>The same sync gateway configuration is applied across all nodes</p>
</li>
<li>
<p>All nodes are configured to run <em>Replication Id 1</em></p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset2_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway automatically designates one of the three nodes to run <em>Replication Id 1</em>.</p>
</li>
<li>
<p>If a node goes down, Sync Gateway elects one of the remaining nodes to continue <em>Replication Id 1</em>.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="paragraph">
<p>Sync Gateway runs <em>Replication  Id 1</em> on all nodes in the cluster.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="homogenous-non-rep-node" class="exampleblock">
<div class="title">Example 2. Homogenous configuration with non-replicating node</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes.</p>
</li>
<li>
<p>Each node has the same sync gateway configuration, with one exception. The configuration on <em>Node 3</em> has opted out of replication (<code>sgreplicate_enabled=false</code>)</p>
</li>
<li>
<p>All Three nodes are configured to run <em>Replication Id 1</em>.</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset3_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway automatically designates either <em>Node 1</em> or <em>Node 2</em> to run the <em>Replication Id 1</em>.</p>
</li>
<li>
<p>If either <em>Node 1</em> or <em>Node 2</em> fails, Sync Gateway elects the non-failing node.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway runs <em>Replication Id 1</em> on all nodes in cluster.</p>
</li>
<li>
<p>The system ignores the opt-out flag (<code>sgreplicate_enabled</code>).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="hetero-config" class="exampleblock">
<div class="title">Example 3. Heterogenous configuration</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes</p>
</li>
<li>
<p>Both <em>Node 1</em> and <em>Node 2</em> are configured to run <em>Replication Id 1</em></p>
</li>
<li>
<p><em>Node 3</em> is configured to run <em>Replication Id 2</em> but <strong>not</strong> <em>Replication Id 1</em></p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset4_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway automatically distributes <em>Replication Id 1</em> and <em>Replication Id 2</em> so that each runs on <strong>one</strong> of <em>Node 1</em>, <em>Node 2</em> or <em>Node 3</em>, with no node running both replications simultaneously.</p>
</li>
<li>
<p>If any node fails whilst running either replication, Sync Gateway elects a non-failing node to continue that replication on.
Where two nodes remain the node not running a replication will be chosen.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway runs <em>Replication  Id1</em> on <em>Node 1</em> and <em>Node 2</em>  in the cluster</p>
</li>
<li>
<p>Sync Gateway runs <em>Replication Id 2</em> on <em>Node 3</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <em>Node 3</em> fails, then <em>Replication Id 2</em> will not be continued on either of the remaining nodes as it is not configured on them</p>
</li>
<li>
<p>Similarly, if either or both of the other nodes (<em>Node 1</em> and <em>Node 2</em>) fails, <em>Node 3</em> will not be a candidate to run the corresponding replication.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="adding-more-nodes" class="exampleblock">
<div class="title">Example 4. Adding more nodes</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises a single Sync Gateway node</p>
</li>
<li>
<p><em>Node 1</em> is configured to run <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
<li>
<p>LATER . . . <em>Node 2</em> is added to the cluster to run <em>Replication Id 1</em> and <em>Replication Id 2</em>.</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset5_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway designates <em>Node 1</em> run both <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
<li>
<p>LATER . . . when <em>Node 2</em> is added . . .</p>
<div class="ulist">
<ul>
<li>
<p>Sync Gateway select one of the <em>Node 1</em> replications to run on <em>Node 2</em>; let&#8217;s say it chooses <em>Replication Id 2</em></p>
</li>
<li>
<p>Sync Gateway stops <em>Replication Id 2</em> on <em>Node 1</em></p>
</li>
<li>
<p>Sync Gateway starts <em>Replication Id 2</em> on <em>Node 2</em>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset5_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway designates <em>Node 1</em> to run both <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
<li>
<p>WHEN . . . <em>Node 2</em> is added . . . Sync Gateway  designates it to run both <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="failing-node" class="exampleblock">
<div class="title">Example 5. Failing node</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes with a homogeneous configuration</p>
</li>
<li>
<p>All three nodes are configured to run <em>Replication Id 1</em>, <em>Replication Id 2</em> and <em>Replication Id 3</em></p>
</li>
<li>
<p>LATER . . . <em>Node 3</em> goes down</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset6_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="paragraph">
<p>Sync Gateway automatically distributes the replications, one to each of the nodes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lets assume the following distribution:</p>
<div class="ulist">
<ul>
<li>
<p><em>Node 1</em> runs <em>Replication Id 1</em></p>
</li>
<li>
<p><em>Node 2</em> runs <em>Replication Id 2</em></p>
</li>
<li>
<p><em>Node 3</em> runs <em>Replication Id 3</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>WHEN . . . <em>Node 3</em>  goes down . . . Sync Gateway elects either <em>Node 1</em> or <em>Node 2</em> to continue running <em>Replication Id 3</em></p>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset6_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="paragraph">
<p>Sync Gateway runs all three replications (<em>Replication Id 1</em> , <em>Replication Id 2</em> and <em>Replication Id 3</em>) on all three nodes in the cluster (<em>Node 1</em>, <em>Node 2</em> and <em>Node 3</em>)</p>
</div>
<div class="paragraph">
<p>WHEN . . . <em>Node 3</em> goes down . . . <em>Node 1</em> and <em>Node 2</em> continue to run <em>Replication Id 1</em>, <em>Replication Id 2</em> and <em>Replication Id 3</em></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-node-distribution"><a class="anchor" href="#monitoring-node-distribution"></a>Monitoring Node Distribution</h3>
<div class="paragraph">
<p>Use the <em>_replicationStatus</em> endpoint to access information about which replications are running on which nodes&#8201;&#8212;&#8201;see: <a href="rest-api-admin.html#/replication/get__db___replicationStatus__replicationID_" class="page">_replicationStatus(replicationID)</a>
  |  <a href="rest-api-admin.html#/replication/put__db___replicationStatus__replicationID__action__action_" class="page">_replicationStatus(replicationID)?action=&#123;action&#125;</a></p>
</div>
<div class="paragraph">
<p>This information is also collected and available in the log files.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conflict-resolution"><a class="anchor" href="#conflict-resolution"></a>Conflict Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inter-Sync Gateway replication supports automatic conflict resolution to resolve conflicting document changes.
It delivers this by applying one of its built-in {_glos-pfx}conflict-resolver-policies[conflict resolver policies<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>], which can be easily included in your own replications.</p>
</div>
<div class="paragraph">
<p>The goal of automatic conflict resoluton is to return a winning revision based on the consistent application of the configured  {_glos-pfx}conflict-resolver-policies[conflict resolver policy<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>].</p>
</div>
<div class="paragraph">
<p>The default <em>conflict resolver policy</em> is to always returns a winner determined by the {_glos-pfx}auto-conflict-resolution-policy[automatic conflict resolution policy<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span>].</p>
</div>
<div class="paragraph">
<p>For <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a>, a custom conflict resolver policy is available, providing additional flexibility by allowing users to provide their own conflict resolution logic&#8201;&#8212;&#8201;see: <a href="sync-inter-syncgateway-conflict-resolution.html#custom-conflict-resolution-ee" class="page">Custom Conflict Resolution Policy</a>.</p>
</div>
<div class="sect2">
<h3 id="how-resolution-works"><a class="anchor" href="#how-resolution-works"></a>How Resolution Works</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Conflict Response on Active Replicator</dt>
<dd>
<p>As soon as the <em>active</em> Sync Gateway database detects a conflict in a replicated document revision, it initiates its configured <em>conflict resolver policy</em> to determine a <em>winning</em> revision.
This policy assesses the conflicting revisions and either determines the winning revision or returns an error if it fails while doing so.</p>
</dd>
<dt class="hdlist1">Conflict Response by Passive Replicator</dt>
<dd>
<p>When a passive Sync Gateway database detects a conflict it responds to the active with a <code>409</code> response and rejects the revision.
It is expected that the active Sync Gateway will pull the conflicting revision from the passive, resolve it on the active, and then subsequently push the resolved conflict back up.</p>
</dd>
<dt class="hdlist1">Pull Replications</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For <em>Pull</em> replications the <em>active</em> Sync Gateway is responsible for detecting and resolving conflicts based on the configured <em>conflict_resolution_type</em> &#8201;&#8212;&#8201;see configuration item: <a href="legacy-configuration-properties.html#databases-this_db-replications-this_rep-conflict_resolution_type" class="page">conflict_resolution_type</a>.</p>
</div>
<div class="paragraph">
<p>This is also how conflicts are handled when Couchbase Lite clients pull down documents to Sync Gateway.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Resolved conflicts are only transferred from active to passive Sync Gateways if a replication is setup between them.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Push Replications</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Passive Sync Gateway</dt>
<dd>
<p>The <em>passive</em> Sync Gateway will automatically detect and reject conflicting revisions being <em>pushed</em> to it.</p>
<div class="paragraph">
<p>Note that conflicts are not resolved.
The revision is rejected and the document returned&#8201;&#8212;&#8201;with a <code>409 Conflict</code>&#8201;&#8212;&#8201;response to the active Sync Gateway.</p>
</div>
</dd>
<dt class="hdlist1">Active Sync Gateway</dt>
<dd>
<p>It is  the responsibility of the active sync Gateway to address rejected revisions in accordance with its specified <em>conflict_resolution_type</em>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>This approach is the same as that adopted when Couchbase Lite clients push documents to Sync Gateway.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For more on conflict resolution&#8201;&#8212;&#8201;see: <a href="sync-inter-syncgateway-conflict-resolution.html" class="page">Conflict Resolution</a></p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. This architecture is also known as ship-to-shore or hub-and-spoke.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. If one-directional XDCR is used alongside Sync Gateway, then Sync Gateway cluster must be in read-only mode.
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../_/js/vendor/fontawesome.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
