<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Data Sync using Sync Gateway | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite for C -- Synchronizing data changes between local and remote databases using Sync Gateway">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="3.0">
<meta name="page-url" content="/couchbase-lite/current/c/replication.html">
<meta name="generator" content="Antora 3.0.0-alpha.6">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://ibsoln.github.io/stage/stage300/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://ibsoln.github.io/stage/stage300/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a href="https://cloud.couchbase.com/sign-up" class="free-trial-link" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  <i class="fas fa-cloud"></i>
                  Free Trial
                </a>
                <a class="btn btn-primary try-btn"  onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    <a href="../../../home/mobile.html">Mobile</a>
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Couchbase Lite</span>
        <select class="version_list" data-component="couchbase-lite">
          <option value="3.0" data-url="../index.html" selected>3.0 BETA01</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../index.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../cbl-whatsnew.html">New in 3.0 BETA</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../android/quickstart.html">Android</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/api-changes.html">API Changes (3.0 BETA)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/kotlin.html">Kotlin</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/querybuilder-n1ql.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-n1ql-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#android:p2p-websocket.adoc">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#android:p2p-websocket-using-passive.adoc">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#android:p2p-websocket-using-active.adoc">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0/couchbase-lite-android">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0/couchbase-lite-kt-android">Kotlin Specific API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#android:release-notes.adoc">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="quickstart.html">C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-downloads.html">BETA Downloads</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="field-level-encryption.html">Field Level Encryption</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="querybuilder-n1ql.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-n1ql-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-current-page" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="replication.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c">API&#160;References</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../csharp/quickstart.html">.Net</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/api-changes.html">API Changes (3.0 BETA)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/querybuilder-n1ql.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-n1ql-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#csharp:p2p-websocket.adoc">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#csharp:p2p-websocket-using-passive.adoc">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#csharp:p2p-websocket-using-active.adoc">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-net">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#csharp:release-notes.adoc">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../java/quickstart.html">Java</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/api-changes.html">API Changes (3.0 BETA)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/querybuilder-n1ql.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-n1ql-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#java:p2p-websocket.adoc">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#java:p2p-websocket-using-passive.adoc">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#java:p2p-websocket-using-active.adoc">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-java">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#java:release-notes.adoc">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../objc/quickstart.html">Objective-C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/api-changes.html">API Changes (3.0 BETA)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/querybuilder-n1ql.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-n1ql-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../objc/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#objc:p2p-websocket.adoc">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#objc:p2p-websocket-using-passive.adoc">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#objc:p2p-websocket-using-active.adoc">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.{minor/couchbase-lite-objc">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#objc:release-notes.adoc">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../objc/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/quickstart.html">Swift</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/api-changes.html">API Changes (3.0 BETA)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/querybuilder-n1ql.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-n1ql-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#swift:p2p-websocket.adoc">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#swift:p2p-websocket-using-passive.adoc">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#swift:p2p-websocket-using-active.adoc">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.{minor/couchbase-lite-swift">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#swift:release-notes.adoc">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#swift:compatibility.adoc">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#swift:supported-os.adoc">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../javascript.html">JavaScript</a>
  </span>
</li>
</ul>
      </div>
    </li>
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Sync Gateway</span>
        <select class="version_list" data-component="sync-gateway">
          <option value="3.0" data-url="../../../sync-gateway/current/index.html" selected>3.0 BETA01</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/introduction.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/whatsnew.html"><strong><em>New in 3.0 BETA</em></strong></a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-prepare.html">Prepare</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-verify-install.html">Verify</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Configuration</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-bootstrap.html">Bootstrap</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-database.html">Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-db-security.html">Database Security</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-access-control.html">Access Control</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-import-filter.html">Import Filter</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-isgr.html">Inter-Sync&#160;Gateway Replication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-properties.html">Legacy Pre-3.0 BETA Configuration</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-javascript-functions.html">Javascript Functions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-environment-variables.html">Environment Variables</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Security</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/secure-sgw-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-users.html">User Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-certs.html">TLS Cert Authetnication</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Access Control</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-concepts.html">Concepts</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-model.html">Access Control Model</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/channels.html">Channels</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/roles.html">Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/users.html">Users</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function.html">Sync Function</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api.html">API Reference</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-access-cmd.html">access()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-channel-cmd.html">channel()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-expiry-cmd.html">expiry()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-access-cmd.html">requireAccess()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-admin-cmd.html">requireAdmin()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-role-cmd.html">requireRole()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-user-cmd.html">requireUser()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-role-cmd.html">role()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-throw-cmd.html">throw()</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how.html">How-to</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-create-users.html">Create Users</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-create-roles.html">Create Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-assign-users-to-roles.html">Assign User to Role</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-control-document-access.html">Control Document Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-verify-access.html">Verify Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-use-xattrs-for-access-grants.html">Use XATTRS for Access Grants</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/auto-purge-channel-access-revocation.html">Auto-Purge Channel Access Revocation</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">REST API</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-admin.html">Admin REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-metrics.html">Metrics REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api.html">Public REST API</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-with-couchbase-server.html">Sync with Server</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-using-app.html">Sync with Application</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Inter-Sync Gateway Replication</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-run.html">Initialize</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-manage.html">Manage</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-monitor.html">Monitor</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-conflict-resolution.html">Inter Syncgateway Conflict Resolution</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/revisions.html">Revisions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/what-are-tombstones.html">Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/managing-tombstones.html">Managing Tomstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/delta-sync.html">Delta Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/resync.html">Resync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/import-filter.html">Import Filter</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-monitoring.html">Stats Monitoring</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging and Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sgcollect-info.html">SG Collect Info</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/database-offline.html">Database Offline</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Deploy</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deployment.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/command-line-options.html">Command Line Options</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/load-balancer.html">Load Balancer</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/os-level-tuning.html">OS Level Tuning</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/webhooks.html">Webhooks</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/changes-feed.html">Changes Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/integrating-external-stores.html">External Stores</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-prometheus.html">Prometheus Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/setting-up-dr-cluster.html">Disaster Recovery</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Use Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deploy-cluster-to-kubernetes.html">Deploy</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::{cao-pg-manage-sgw&amp;.adoc#8212;&amp;#8203;page">Manage a Sync Gateway Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::{cao-pg-clients-sgw&amp;.adoc#8212;&amp;#8203;page">Expose Sync Gateway to Couchbase Lite clients</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Server Compatibility</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-collections.html">Collections</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-eventing.html">Eventing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-transactions.html">Transactions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-xdcr.html">XDCR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/supported-environments.html">Supported Environments</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/compatibility.html">Compatibility Matrix</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Legacy Features</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sg-replicate.html">SG Replicate</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sgreplicate-resolving-conflicts.html">SG Replicate - Resolving Conflicts (depr)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-logging-pre2-1.html">Legacy Pre-2.1 Logging</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/glossary.html">Glossary</a>
  </span>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/c/pages/replication.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="quickstart.html">C</a></li>
<li class="crumb"><a href="replication.html">Sync</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Data Sync using Sync Gateway</h1>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">3.0</a></li>
<li class="status"><span>BETA</span></li>
</ul>
</div>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Couchbase Lite for C&#8201;&#8212;&#8201;Synchronizing data changes between local and remote databases using Sync Gateway</em><br>
Related Content&#8201;&#8212;&#8201;<a href="conflict.html" class="page">Handling Data Conflicts</a> | <a href="dbreplica.html" class="page">Intra-device Data Sync</a> | <a href="p2psync-websocket.html" class="page">Peer-to-Peer</a></p>
</div>
</blockquote>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Code Snippets</div>
All code examples are indicative only.
They demonstrate the basic concepts and approaches to using a feature.
Use them as inspiration and adapt these examples to best practice when developing applications for your platform.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite for C provides API support for secure, bi-directional, synchronization of data changes between mobile applications and a central server database.
It does so by using a <em>replicator</em> to interact with Sync Gateway.</p>
</div>
<div class="paragraph">
<p>The <em>replicator</em> is designed to manage replication of documents and-or document changes between a source and a target database.
For example, between a local Couchbase Lite database and remote Sync Gateway database, which is ultimately mapped to a bucket in a Couchbase Server instance in the cloud or on a server.</p>
</div>
<div class="paragraph">
<p>This page shows sample code and configuration examples covering the implementation of a replication using Sync Gateway.</p>
</div>
<div class="paragraph">
<p>Your application runs a replicator (also referred to here as a client), which  will initiate connection with a Sync Gateway (also referred to here as a server) and participate in the replication of database changes to bring both local and remote databases into sync.</p>
</div>
<div class="paragraph">
<p>Subsequent sections provide additional details and examples for the main configuration options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication-protocol"><a class="anchor" href="#replication-protocol"></a>Replication Protocol</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="scheme"><a class="anchor" href="#scheme"></a>Scheme</h3>
<div class="paragraph">
<p>Couchbase Mobile uses a replication protocol based on WebSockets for replication.
To use this protocol the replication URL should specify WebSockets as the URL scheme (see the <a href="#lbl-cfg-tgt">Configure Target</a> section below).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Incompatibilities</dt>
<dd>
<p>Couchbase Lite&#8217;s replication protocol is <strong>incompatible</strong> with CouchDB-based databases.
And since Couchbase Lite 2.x+ only supports the new protocol, you will need to run a version of Sync Gateway that supports it&#8201;&#8212;&#8201;see: <a href="compatibility.html" class="page">Compatibility</a>.</p>
</dd>
<dt class="hdlist1">Legacy Compatibility</dt>
<dd>
<p>Clients using Couchbase Lite 1.x can continue to use <code>http</code> as the URL scheme.
Sync Gateway 2.x+ will automatically use:</p>
<div class="ulist">
<ul>
<li>
<p>The 1.x replication protocol when a Couchbase Lite 1.x client connects through <code>http://localhost:4984/db</code></p>
</li>
<li>
<p>The 2.0 replication protocol when a Couchbase Lite 2.0 client connects through <code>ws://localhost:4984/db</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can find further information in our blog: <a href="https://blog.couchbase.com/data-replication-couchbase-mobile/" target="_blank" rel="noopener">Introducing the Data Replication Protocol</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-ord"><a class="anchor" href="#lbl-repl-ord"></a>Ordering</h3>
<div class="paragraph">
<p>To optimize for speed, the replication protocol doesn&#8217;t guarantee that documents will be received in a particular order.
So we don&#8217;t recommend to rely on that when using the replication or database change listeners for example.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-summary"><a class="anchor" href="#configuration-summary"></a>Configuration Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should configure and initialize a replicator for each Couchbase Lite database instance you want to sync.
<a href="#ex-simple-repl">Example 1</a> shows the configuration and initialization process.</p>
</div>
<div id="ex-simple-repl" class="exampleblock">
<div class="title">Example 1. Replication configuration and initialization</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Purpose -- illustrate a simple change listener
static void simpleChangeListener(void* context,
                                 CBLReplicator* repl,
                                 const CBLReplicatorStatus* status)
{
     if(status-&gt;error.code != 0) {
         printf("Error %d / %d\n",
                status-&gt;error.domain,
                status-&gt;error.code);
     }
}
// end::replication-error-handling
    // Purpose -- Show configuration , initialization and running of a replicator

    // NOTE: No error handling, for brevity (see getting started)
    // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)

    CBLError err;
    FLString url = FLSTR("ws://localhost:4984/db");
    CBLEndpoint* target = CBLEndpoint_CreateWithURL(url, &amp;err); <i class="conum" data-value="1"></i><b>(1)</b>

    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
    config.database = database;
    config.endpoint = target; <i class="conum" data-value="2"></i><b>(2)</b>

    // Set replication direction and mode
    config.replicatorType = kCBLReplicatorTypePull; <i class="conum" data-value="3"></i><b>(3)</b>
    config.continuous = true;


    // Optionally, set auto-purge behavior (here we override default)
    config.disableAutoPurge = true; <i class="conum" data-value="4"></i><b>(4)</b>

    // Optionally, configure Client Authentication
    // Here we are using to Basic Authentication,
    // Providing username and password credentials
    CBLAuthenticator* basicAuth =
        CBLAuth_CreatePassword(FLSTR("username"),
                               FLSTR("passwd")); <i class="conum" data-value="5"></i><b>(5)</b>
    config.authenticator = basicAuth;

    // Optionally, configure how we handle conflicts
    config.conflictResolver = simpleConflictResolver_localWins; <i class="conum" data-value="6"></i><b>(6)</b>

    // Initialize replicator with created config
    CBLReplicator* replicator =
        CBLReplicator_Create(&amp;config, &amp;err); <i class="conum" data-value="7"></i><b>(7)</b>

    CBLEndpoint_Free(target);

    // Optionally, add change listener
    CBLListenerToken* token =
            CBLReplicator_AddChangeListener(replicator,
                                            simpleChangeListener,
                                            NULL); <i class="conum" data-value="8"></i><b>(8)</b>

    // Start replication
    CBLReplicator_Start(replicator, false); <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on Example</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>get endpoint for target DB</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set local database and target endpoint</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The default is to auto-purge documents that this user no longer has access to&#8201;&#8212;&#8201;see: <a href="#anchor-auto-purge-on-revoke">Auto-purge on Channel Access Revocation</a>.
Here we over-ride this behavior by setting its flag false.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configure how the client will authenticate the server.
Here we say connect only to servers presenting a self-signed certificate.
By default, clients accept only servers presenting certificates that can be verified using the OS bundled Root CA Certificates&#8201;&#8212;&#8201;see: <a href="#lbl-svr-auth">[lbl-svr-auth]</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Configure the client-authentication credentials (if required).
These are the credential the client will present to sync&#160;gateway if requested to do so.<br>
Here we configure to provide <em>Basic Authentication</em> credentials.
Other options are available&#8201;&#8212;&#8201;see: <a href="#lbl-client-auth">Client Authentication</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Configure how the replication should handle conflict resolution&#8201;&#8212;&#8201;see: <a href="conflict.html" class="page">Handling Data Conflicts</a> topic for mor on conflict resolution.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Initialize the replicator using your configuration&#8201;&#8212;&#8201;see: <a href="#lbl-init-repl">Initialize</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Optionally, register an observer, which will notify you of changes to the replication status&#8201;&#8212;&#8201;see: <a href="#lbl-repl-mon">Monitor</a></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Start the replicator &#8201;&#8212;&#8201;see: <a href="#lbl-repl-start">Start Replicator</a>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-cfg-repl"><a class="anchor" href="#lbl-cfg-repl"></a>Configure</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><a href="#lbl-cfg-tgt">Configure Target</a>
|  <a href="#lbl-cfg-sync">Sync Mode</a>
|  <a href="#lbl-cfg-keep-alive">Retry Configuration</a>
|  <a href="#lbl-user-auth">User Authorization</a>
|  <a href="#lbl-client-auth">Client Authentication</a>
|  <a href="#lbl-repl-evnts">Monitor Document Changes</a>
|  <a href="#lbl-repl-hdrs">Custom&#160;Headers</a>
|  <a href="#lbl-repl-ckpt">Checkpoint Starts</a>
|  <a href="#lbl-repl-fltrs">Replication Filters</a>
|  <a href="#lbl-repl-chan">Channels</a>
|  <a href="#anchor-auto-purge-on-revoke">Auto-purge on Channel Access Revocation</a>
|  <a href="#lbl-repl-delta">Delta Sync</a></p>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="lbl-cfg-tgt"><a class="anchor" href="#lbl-cfg-tgt"></a>Configure Target</h3>
<div class="paragraph">
<p>Use the
Initialize and define the replication configuration with local and remote database locations using the <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html">CBLReplicatorConfiguration</a> object.</p>
</div>
<div class="paragraph">
<p>The constructor provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the name of the local database to be sync&#8217;d</p>
</li>
<li>
<p>the server&#8217;s URL (including the port number and the name of the remote database to sync with)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>It is expected that the app will identify the IP address and URL and append the remote database name to the URL endpoint, producing for example: <code>wss://10.0.2.2:4984/travel-sample</code></p>
</div>
<div class="paragraph">
<p>The URL scheme for web socket URLs uses <code>ws:</code> (non-TLS) or <code>wss:</code> (SSL/TLS) prefixes.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 2. Add Target to Configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Initialize the configuration object and set db target
CBLError err;
FLString url = FLSTR("ws://localhost:4984/db");
CBLEndpoint* target =
    CBLEndpoint_CreateWithURL(url, &amp;err); <i class="conum" data-value="1"></i><b>(1)</b>

CBLReplicatorConfiguration config;
memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
config.database = db;
config.endpoint = target; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note use of the scheme prefix (<code>wss://</code>
to ensure TLS encryption&#8201;&#8212;&#8201;strongly recommended in production&#8201;&#8212;&#8201;or <code>ws://</code>)</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-cfg-sync"><a class="anchor" href="#lbl-cfg-sync"></a>Sync Mode</h3>
<div class="paragraph">
<p>Here we define the direction and type of replication we want to initiate.</p>
</div>
<div class="paragraph">
<p>We use <code><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html">CBLReplicatorConfiguration</a></code> class&#8217;s <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a40f3195389ab0578aa17e63dd832a390">replicatorType</a> and
<code><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a3d17159fc65a7491c2cde2f56a5016df">continuous</a></code> parameters, to tell the replicator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type (or direction) of the replication:
<code><strong>pushAndPull</strong></code>; <code>pull</code>; <code>push</code></p>
</li>
<li>
<p>The replication mode, that is:</p>
<div class="ulist">
<ul>
<li>
<p>Continuous&#8201;&#8212;&#8201;remaining active indefinitely to replicate changed documents (<code>continuous=true</code>).</p>
</li>
<li>
<p>Ad-hoc&#8201;&#8212;&#8201;a one-shot replication of changed documents (<code>continuous=false</code>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="ex-repl-sync" class="exampleblock">
<div class="title">Example 3. Configure replicator type and mode</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Set replication direction and mode
config.replicatorType = kCBLReplicatorTypePull; <i class="conum" data-value="1"></i><b>(1)</b>
config.continuous = true;

config.replicatorType = kCBLReplicatorTypePull;

config.continuous = true;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-cfg-keep-alive"><a class="anchor" href="#lbl-cfg-keep-alive"></a>Retry Configuration</h3>
<div class="paragraph">
<p>Couchbase Lite for C&#8217;s replication retry logic assures a resilient connection.</p>
</div>
<div class="paragraph">
<p>The replicator minimizes the chance and impact of dropped connections by maintaining a heartbeat; essentially pinging the Sync Gateway at a configurable interval to ensure the connection remains alive.</p>
</div>
<div class="paragraph">
<p>In the event it detects a transient error, the replicator will attempt to reconnect, stopping only when the connection is re-established, or the number of retries exceeds the retry limit (9 times for a single-shot replication and unlimited for a continuous replication).</p>
</div>
<div class="paragraph">
<p>On each retry the interval between attempts is increased exponentially (exponential backoff) up to the maximum wait time limit (5 minutes).</p>
</div>
<div class="paragraph">
<p>The REST API provides configurable control over this replication retry logic using a set of configiurable properties&#8201;&#8212;&#8201;see: <a href="#tbl-repl-retry">Table 1</a>.</p>
</div>
<table id="tbl-repl-retry" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Replication Retry Configuration Properties</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Property</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Use cases</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a524408f9430d13c783762dce32f1126e">heartbeat</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Reduce to detect connection errors sooner</p>
</li>
<li>
<p>Align to load-balancer or proxy <code>keep-alive</code> interval&#8201;&#8212;&#8201;see Sync Gateway&#8217;s topic <a href="../../../sync-gateway/current/load-balancer.html#websocket-connection" class="page">Load Balancer - Keep Alive</a></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The interval (in seconds) between the heartbeat pulses.</p>
</div>
<div class="paragraph">
<p>Default: The replicator pings the Sync Gateway every 300 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a5b6435c711d93f71566d8814506e0dff">maxAttempts</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change this to limit or extend the number of retry attempts.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of retry attempts</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set this to zero (0) to prevent any retry attempt</p>
</li>
<li>
<p>The retry attempt count is reset when the replicator is able to connect and replicate</p>
</li>
<li>
<p>Default values are:</p>
<div class="ulist">
<ul>
<li>
<p>Single-shot replication = 9;</p>
</li>
<li>
<p>Continuous replication = maximum integer value</p>
</li>
</ul>
</div>
</li>
<li>
<p>Negative values generate a Couchbase exception <code>InvalidArgumentException</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a5b6435c711d93f71566d8814506e0dff">maxAttemptWaitTime</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change this to adjust the interval between retries.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum interval between retry attempts</p>
</div>
<div class="paragraph">
<p>Whilst you can configure the <strong>maximum permitted</strong> wait time,  each individual interval is calculated by the replicator&#8217;s exponential backoff algorithm and is not configurable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default value: 300 seconds (5 minutes)</p>
</li>
<li>
<p>Zero or negative values generate a Couchbase exception, <code>InvalidArgumentException</code>.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When necessary you can adjust any or all of those configurable values&#8201;&#8212;&#8201;see: <a href="#ex-repl-retry">Example 4</a> for how to do this.</p>
</div>
<div id="ex-repl-retry" class="exampleblock">
<div class="title">Example 4. Configuring Replication Retries</div>
<div class="content">
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Configure replication retries
config.heartbeat = 120; //  <i class="conum" data-value="1"></i><b>(1)</b>

config.maxAttempts = 20; //  <i class="conum" data-value="2"></i><b>(2)</b>

config.maxAttemptWaitTime = 600; //  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we use <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a524408f9430d13c783762dce32f1126e">heartbeat</a> to set the required interval (in seconds) between the heartbeat pulses</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we use <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a5b6435c711d93f71566d8814506e0dff">maxAttempts</a> to set the required number of retry attempts</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here we use <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a5b6435c711d93f71566d8814506e0dff">maxAttemptWaitTime</a> to set the required interval between retry attempts.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-user-auth"><a class="anchor" href="#lbl-user-auth"></a>User Authorization</h3>
<div class="paragraph">
<p>By default, Sync Gateway does not enable user authorization.
This is to make it easier to get up and running with synchronization.
You can enable authorization with the following properties in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "databases": {
    "mydatabase": {
      "users": {
        "GUEST": {"disabled": true}
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To authorize with Sync Gateway, an associated user must first be created.
Sync Gateway users can be created through the <a href="../../../sync-gateway/current/rest-api-admin.html#/user/post__db___user_" class="page"><code>POST /{tkn-db}/_user</code></a> endpoint on the Admin REST API.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-client-auth"><a class="anchor" href="#lbl-client-auth"></a>Client Authentication</h3>
<div class="paragraph">
<p>There are two ways to authenticate from a Couchbase Lite client: <a href="#basic-authentication">Basic Authentication</a> or <a href="#session-authentication">Session Authentication</a>.</p>
</div>
<div class="sect3">
<h4 id="basic-authentication"><a class="anchor" href="#basic-authentication"></a>Basic Authentication</h4>
<div class="paragraph">
<p>You can provide a user name and password to the basic authenticator class method.
Under the hood, the replicator will send the credentials in the first request to retrieve a <code>SyncGatewaySession</code> cookie and use it for all subsequent requests during the replication.
This is the recommended way of using basic authentication.
<a href="#ex-base-auth">Example 5</a> shows how to initiate a one-shot replication as the user <strong>username</strong> with the password <strong>password</strong>.</p>
</div>
<div id="ex-base-auth" class="exampleblock">
<div class="title">Example 5. Basic Authentication</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Configure Client Authentication to Basic Authentication
// Providing username and password credentials
if(docs_example_ShowBasicAuth) {
    CBLAuthenticator* basicAuth =
        CBLAuth_CreatePassword(FLSTR("username"),
                               FLSTR("passwd"));
    config.authenticator = basicAuth; <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-authentication"><a class="anchor" href="#session-authentication"></a>Session Authentication</h4>
<div class="paragraph">
<p>Session authentication is another way to authenticate with Sync Gateway.
A user session must first be created through the <a href="../../../sync-gateway/current/rest-api.html#/session/post__db___session" class="page"><code>POST /{tkn-db}/_session</code></a> endpoint on the Public REST API.
The HTTP response contains a session ID which can then be used to authenticate as the user it was created for.</p>
</div>
<div class="paragraph">
<p><a href="#ex-session-auth">Example 6</a> shows how to initiate a one-shot replication with the session ID that is returned from the <code>POST /{tkn-db}/_session</code> endpoint.</p>
</div>
<div id="ex-session-auth" class="exampleblock">
<div class="title">Example 6. Session Authentication</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">if(docs_example_ShowSessionAuth) {
    CBLAuthenticator* sessionAuth =
        CBLAuth_CreateSession(FLSTR("904ac010862f37c8dd99015a33ab5a3565fd8447"),
                              FLSTR("optionalCookieName"));
    config.authenticator = sessionAuth; <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-hdrs"><a class="anchor" href="#lbl-repl-hdrs"></a>Custom&#160;Headers</h3>
<div class="paragraph">
<p>Custom headers can be set on the configuration object.
And the replicator will send those header(s) in every request.
As an example, this feature can be useful to pass additional credentials when there is an authentication or authorization step being done by a proxy server (between Couchbase Lite and Sync Gateway).</p>
</div>
<div id="ex-cust-hdr" class="exampleblock">
<div class="title">Example 7. Setting custom headers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Optionally, add custom headers
FLMutableDict customHdrs = FLMutableDict_New();
FLMutableDict_SetString(customHdrs,
                        FLSTR("customHeaderName"),
                        FLSTR("customHeaderValue"));

config.headers = customHdrs;

char cert_buf[10000];
FILE* cert_file = fopen("cert.pem", "r");
size_t read = fread(cert_buf, 1, sizeof(cert_buf), cert_file);
config.pinnedServerCertificate = (FLSlice){cert_buf, read};</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-fltrs"><a class="anchor" href="#lbl-repl-fltrs"></a>Replication Filters</h3>
<div class="paragraph">
<p>Replication Filters allow you to have quick control over which documents are stored as the result of a push and/or pull replication.</p>
</div>
<div class="sect3">
<h4 id="push-filter"><a class="anchor" href="#push-filter"></a>Push Filter</h4>
<div class="paragraph">
<p>A push filter allows an app to push a subset of a database to the server, which can be very useful in some circumstances.
For instance, high-priority documents could be pushed first, or documents in a "draft" state could be skipped.</p>
</div>
<div class="listingblock">
<div class="title">Push Filter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Purpose -- illustrate a simple replication filter function
static bool simpleReplicationFilter(void* context,
                                    CBLDocument* argDoc,
                                    CBLDocumentFlags argFlags)
{
    bool result = (argFlags == kCBLDocumentFlagsDeleted);
    return result;
}

    // Purpose - Illustrate use of push and-or pull filter functions
    config.pushFilter = simpleReplicationFilter;

    config.pullFilter = simpleReplicationFilter;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Do not provide long running functions, which could slow down the replicator. Nor make assumptions about the thread the function is being called on.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pull-filter"><a class="anchor" href="#pull-filter"></a>Pull Filter</h4>
<div class="paragraph">
<p>A pull filter gives an app the ability to validate documents being pulled, and skip ones that fail.
This is an important security mechanism in a peer-to-peer topology with peers that are not fully trusted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Pull replication filters are not a substitute for channels.
Sync Gateway <a href="../../../sync-gateway/current/channels.html" class="page">channels</a> are designed to be scalable (documents are filtered on the server) whereas a pull replication filter is applied to a document once it has been downloaded.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Purpose -- illustrate a simple replication filter function
static bool simpleReplicationFilter(void* context,
                                    CBLDocument* argDoc,
                                    CBLDocumentFlags argFlags)
{
    bool result = (argFlags == kCBLDocumentFlagsDeleted);
    return result;
}

    // Purpose - Illustrate use of push and-or pull filter functions
    config.pushFilter = simpleReplicationFilter;

    config.pullFilter = simpleReplicationFilter;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Do not provide long running functions, which could slow down the replicator. Nor make assumptions about the thread the function is being called on.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Losing access to a document (via the Sync Function) also triggers the pull replication filter.
Filtering out such an event would retain the document locally.
As a result, there would be a local copy of the document disjointed from the one that resides on Couchbase Server.
Further updates to the document stored on Couchbase Server would not be received in pull replications and further local edits could be potentially pushed, which would result in 409 errors since access has been revoked.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-chan"><a class="anchor" href="#lbl-repl-chan"></a>Channels</h3>
<div class="paragraph">
<p>By default, Couchbase Lite gets all the channels to which the configured user account has access.
This behavior is suitable for most apps that rely on <a href="../../../sync-gateway/current/authentication-users.html" class="page">user authentication</a> and the <a href="../../../sync-gateway/current/sync-function-api.html" class="page">sync function</a> to specify which data to pull for each user.</p>
</div>
<div class="paragraph">
<p>Optionally, it&#8217;s also possible to specify a comma-separated list of channel names on Couchbase Lite&#8217;s replicator configuration object.
In this case, the replication from Sync Gateway will only pull documents tagged with those channels.</p>
</div>
</div>
<div class="sect2">
<h3 id="anchor-auto-purge-on-revoke"><a class="anchor" href="#anchor-auto-purge-on-revoke"></a>Auto-purge on Channel Access Revocation</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Breaking Change</div>
<div class="paragraph">
<p>By default, when a user loses access to a channel all documents in the channel (that do not also belong to any of user’s other channels) are auto-purged from the local database (in devices belonging to the user).<br>
<em>In release 2.x these documents will remain in the local database.</em></p>
</div>
<div class="paragraph">
<p>In 2.x, CBL does and auto-purge only in the case when the user loses access to a document by removing the doc from all of the channels belong to the user.
In 3.0, in addition to 2.x auto purge, Couchbase Lite will also auto-purge the docs when the user loses access to the doc via channel access revocation.
This feature is enabled by default, but an opt-out is available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="behavior"><a class="anchor" href="#behavior"></a>Behavior</h4>
<div class="paragraph">
<p>Users may lose access to channels in a number of ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User loses direct access to channel</p>
</li>
<li>
<p>User is removed from a role</p>
</li>
<li>
<p>A channel is removed from a role the user is assigned to</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In 3.x, by default, when a user loses access to a channel, the next Couchbase Lite Pull replication auto-purges all documents in the channel from local Couchbase Lite databases (on devices belonging to the user) <strong>unless</strong> they belong to any of the user’s other channels&#8201;&#8212;&#8201;see: <a href="#tbl-revoke-behavior">Table 2</a>.</p>
</div>
<div class="paragraph">
<p>Documents that exist in multiple channels belonging to the user (even if they are not actively replicating that channel) are not auto-purged unless the user loses access to all channels.</p>
</div>
<div class="paragraph">
<p>Users will be receive an <code>AccessRemoved</code> notification from the DocumentListener if they lose document access due to channel access revocation; this is sent regardless of the current auto-purge setting.</p>
</div>
<table id="tbl-revoke-behavior" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Behavior following access revocation</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">System State</th>
<th class="tableblock halign-center valign-top">Impact on Sync</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-bottom"><p class="tableblock">Replication Type</p></th>
<th class="tableblock halign-center valign-bottom"><p class="tableblock">Access Control on Sync Gateway</p></th>
<th class="tableblock halign-center valign-bottom"><p class="tableblock">Expected behavior when <em>enable_auto_purge=true</em></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Pull only</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User revoked access to channel.</p>
</div>
<div class="paragraph">
<p>Sync Function includes <code>requireAccess(revokedChannel)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Previously synced documents are auto purged on local</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Push only</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User revoked access to channel. Sync Function includes <code>requireAccess(revokedChannel)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>No impact of auto-purge</p>
</div>
<div class="paragraph">
<p>Documents get pushed but are rejected by Sync Gateway</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Push-pull</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User revoked access to channel<br>
Sync Function includes <code>requireAccess(revokedChannel)</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Previously synced documents are auto purged on Couchbase Lite.</p>
</div>
<div class="paragraph">
<p>Local changes continue to be  pushed to remote but are rejected by Sync Gateway</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a user subsequently regains access to a lost channel, then any previously auto-purged documents still assigned to any of their channels are automatically pulled down by the active Sync Gateway when they are next updated&#8201;&#8212;&#8201;see behavior summary in <a href="#tbl-regain-behavior">Table 3</a></p>
</div>
<table id="tbl-regain-behavior" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Behavior if access is regained</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">System State</th>
<th class="tableblock halign-center valign-top">Impact on Sync</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-bottom"><p class="tableblock">Replication Type</p></th>
<th class="tableblock halign-center valign-bottom"><p class="tableblock">Access Control on Sync Gateway</p></th>
<th class="tableblock halign-center valign-bottom"><p class="tableblock">Expected behavior when <em>enable_auto_purge=true</em></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Pull only</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User REASSIGNED access to channel</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Previously purged documents that are still in the channel are automatically pulled by Couchbase Lite when they are next updated</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Push only</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User REASSIGNED access to channel
Sync Function includes requireAccess
(reassignedChannel)
No impact of auto-purge</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Local changes previously rejected by Sync Gateway will not be automatically pushed to remote unless resetCheckpoint is involved on CBL.
Document changes subsequent to the channel reassignment will be pushed up as usual.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Push-pull</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>User REASSIGNED access to channel</p>
</div>
<div class="paragraph">
<p>Sync Function includes requireAccess
(reassignedChannel)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Previously purged documents are automatically pulled by couchbase lite</p>
</div>
<div class="paragraph">
<p>Local changes previously rejected by Sync Gateway will not be automatically pushed to remote unless resetCheckpoint is involved.
Document changes subsequent to the channel reassignment will be pushed up as usual</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="config"><a class="anchor" href="#config"></a>Config</h4>
<div class="paragraph">
<p>Auto-purge behavior is controlled primarily by the ReplicationConfiguration option <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a3795c0097264ccd1ed612d9a0746d58d">disableAutoPurge</a>.
Changing the state of this will impact <strong>only</strong> future replications; the replicator will not attempt to sync revisions that were auto purged on channel access removal.
Clients wishing to sync previously removed documents must use the resetCheckpoint API to resync from the start.</p>
</div>
<div id="ex-set-auto-purge" class="exampleblock">
<div class="title">Example 8. Setting auto-purge</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">config.disableAutoPurge = true; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we have opted to turn off the auto purge behavior. By default this is ON (true)</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="overrides"><a class="anchor" href="#overrides"></a>Overrides</h4>
<div class="paragraph">
<p>Where necessary, clients can override the default auto-purge behavior.
This can be done either by setting <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/struct_c_b_l_replicator_configuration.html#a3795c0097264ccd1ed612d9a0746d58d">disableAutoPurge</a> to false, or for finer control by applying pull-filters&#8201;&#8212;&#8201;see: <a href="#tbl-pull-filters">Table 4</a> and <a href="#lbl-repl-fltrs">Replication Filters</a>
This ensures backwards compatible with 2.8 clients that use pull filters to prevent auto purge of removed docs.</p>
</div>
<table id="tbl-pull-filters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Impact of Pull-Filters</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock">purge_on_removal setting</p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Pull Filter</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Not Defined</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">Defined to filter removals/revoked docs</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>Doc remains in local database</p>
</div>
<div class="paragraph">
<p>App notified of “accessRemoved” if a <em>Documentlistener</em> is registered</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">enabled (DEFAULT)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Doc is auto purged</p>
</div>
<div class="paragraph">
<p>App notified of “accessRemoved” if <em>Documentlistener</em> registered</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Doc remains in local database</p>
</div>
<div class="paragraph">
<p>App notified of “Rejected Rev(403)” if <em>Documentlistener</em> registered</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-delta"><a class="anchor" href="#lbl-repl-delta"></a>Delta Sync</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With Delta Sync <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, only the changed parts of a Couchbase document are replicated.
This can result in significant savings in bandwidth consumption as well as throughput improvements, especially when network bandwidth is typically constrained.</p>
</div>
<div class="paragraph">
<p>Replications to a Server (for example, a Sync Gateway, or passive listener) automatically use delta sync if the property is enabled at database level by the server&#8201;&#8212;&#8201;see: <a href="../../../sync-gateway/current/configuration-properties.html#databases-foo_db-delta_sync" class="page">databases.$db.delta_sync.enabled</a>.</p>
</div>
<div class="paragraph">
<p><a href="dbreplica.html" class="page">Intra-device Data Sync</a> replications automatically <strong>disable</strong> delta sync, whilst <a href="p2psync-websocket.html" class="page">Peer-to-Peer</a> replications automatically <strong>enable</strong> delta sync.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-init-repl"><a class="anchor" href="#lbl-init-repl"></a>Initialize</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-repl-start">Start Replicator</a>  | <a href="#lbl-repl-ckpt">Checkpoint Starts</a></p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="lbl-repl-start"><a class="anchor" href="#lbl-repl-start"></a>Start Replicator</h3>
<div class="paragraph">
<p>Use the <code><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html">Replication</a></code> class&#8217;s <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#(im)initWithConfig:">initWith(config:)</a> constructor, to initialize the replicator with the configuration you have defined.
You can, optionally, add a change listener (see <a href="#lbl-repl-mon">Monitor</a>) before starting the replicator running using <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga224926daa794a424c470bf86dd57aaf9">CBLReplicator_Start()</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Initialize and run replicator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">CBLReplicator* thisRepl =
CBLReplicator_Create(&amp;argConfig, &amp;err); <i class="conum" data-value="1"></i><b>(1)</b>

  CBLReplicator_Start(thisRepl, false); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize the replicator with the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start the replicator</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-ckpt"><a class="anchor" href="#lbl-repl-ckpt"></a>Checkpoint Starts</h3>
<div class="paragraph">
<p>Replicators use <a href="refer-glossary.html#checkpoint" class="page">checkpoints</a> to keep track of documents sent to the target database.
Without <a href="refer-glossary.html#checkpoint" class="page">checkpoints</a> , Couchbase Lite would replicate the entire database content to the target database on each connection, even though previous replications may already have replicated some or all of that content.</p>
</div>
<div class="paragraph">
<p>This functionality is generally not a concern to application developers.
However, if you do want to force the replication to start again from zero, use the <a href="refer-glossary.html#checkpoint" class="page">checkpoint</a> reset argument when starting the replicator.</p>
</div>
<div id="ex-repl-ckpt" class="exampleblock">
<div class="title">Example 10. Resetting checkpoints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">CBLReplicator_Start(thisRepl, true); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set start&#8217;s reset option to <code>true</code>.<br></td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-repl-mon"><a class="anchor" href="#lbl-repl-mon"></a>Monitor</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-repl-chng">Change Listeners</a>  |
<a href="#lbl-repl-status">Replicator Status</a>  |
<a href="#lbl-repl-evnts">Monitor Document Changes</a> |
<a href="#lbl-repl-pend">Documents Pending Push</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can monitor a replication’s status by using a combination of <a href="#lbl-repl-chng">Change Listeners</a> and the <code>replication.status.activity</code> property&#8201;&#8212;&#8201;see; <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__ReplicatorStatus.html#ReplicatorStatus(py)activity">activity enum</a>.
This enables you to know, for example, when the replication is actively transferring data and when it has stopped.</p>
</div>
<div class="paragraph">
<p>You can also choose to monitor document changes&#8201;&#8212;&#8201;see: <a href="#lbl-repl-evnts">Monitor Document Changes</a>.</p>
</div>
<div class="sect2">
<h3 id="lbl-repl-chng"><a class="anchor" href="#lbl-repl-chng"></a>Change Listeners</h3>
<div class="paragraph">
<p>Use this to monitor changes and to inform on sync progress; this is an optional step.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Best Practice</div>
You should register the listener before starting your replication, to avoid having to do a restart to activate it &#8230;&#8203; and don&#8217;t forget to save the token so you can remove the listener later
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html">Replication</a> class to add a change listener as a callback to the Replicator (<a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#(im)addChangeListener:">addChangeListener(_:)</a>)&#8201;&#8212;&#8201;see: <a href="#ex-repl-mon">Example 11</a>.
You will then be asynchronously notified of state changes.</p>
</div>
<div class="paragraph">
<p>Remove your change listener before stopping the replicator&#8201;&#8212;&#8201;use the <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#(im)removeChangeListenerWithToken">removeChangeListenerWithToken(ListenerToken:)</a> method to do this.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-status"><a class="anchor" href="#lbl-repl-status"></a>Replicator Status</h3>
<div class="paragraph">
<p>You can use the <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html">Replication</a> class&#8217;s {url-api-property-replicator-status} property to check the replicator status.
That is, whether it is actively transferring data or if it has stopped&#8201;&#8212;&#8201;see: <a href="#ex-repl-mon">Example 11</a>.</p>
</div>
<div class="paragraph">
<p>The returned <em>ReplicationStatus</em> structure comprises:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__ReplicatorStatus.html#ReplicatorStatus(py)activity">activity enum</a>&#8201;&#8212;&#8201;stopped, offline, connecting, idle or busy&#8201;&#8212;&#8201;see states described in: <a href="#tbl-states">Table 5</a></p>
</li>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__ReplicatorStatus.html#ReplicatorStatus(py)progress)">progress enum</a></p>
<div class="ulist">
<ul>
<li>
<p>completed&#8201;&#8212;&#8201;the total number of changes completed</p>
</li>
<li>
<p>total&#8201;&#8212;&#8201;the total number of changes to be processed</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__ReplicatorStatus.html#ReplicatorStatus(py)error">error enum</a>&#8201;&#8212;&#8201;the current error, if any</p>
</li>
</ul>
</div>
<div id="ex-repl-mon" class="exampleblock">
<div class="title">Example 11. Monitor replication</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_adding-a-change-listener"></a>Adding a Change Listener</p>
</li>
<li>
<p><a id="tabset1_using-replicator-status"></a>Using replicator.status</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_adding-a-change-listener">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">// Purpose -- illustrate a simple change listener
static void simpleChangeListener(void* context,
                                 CBLReplicator* repl,
                                 const CBLReplicatorStatus* status)
{
     if(status-&gt;error.code != 0) {
         printf("Error %d / %d\n",
                status-&gt;error.domain,
                status-&gt;error.code);
     }
}
// end::replication-error-handling
    // Purpose -- illustrate addition of a Replicator change listener
    CBLListenerToken* token_ReplChangeListener =
            CBLReplicator_AddChangeListener(thisRepl,
                                            simpleChangeListener,
                                            NULL);</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_using-replicator-status">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">// Purpose -- illustrate use of CBLReplicator_Status()
CBLReplicatorStatus thisState = CBLReplicator_Status(thisRepl);
if(thisState.activity==kCBLReplicatorStopped) {
    if(thisState.error.code==0) {
        CBLReplicator_Start(thisRepl,false);
    } else {
        printf("Replicator stopped -- code %d", thisState.error.code);
        // ... handle error ...
        CBLReplicator_Release(thisRepl);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lbl-repl-states"><a class="anchor" href="#lbl-repl-states"></a>Replication States</h4>
<div class="paragraph">
<p><a href="#tbl-states">Table 5</a> shows the different states, or activity levels, reported in the API; and the meaning of each.</p>
</div>
<table id="tbl-states" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Replicator activity levels</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">State</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Meaning</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>STOPPED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is finished or hit a fatal error.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>OFFLINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is offline as the remote host is unreachable.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CONNECTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is connecting to the remote host.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>IDLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication caught up with all the changes available from the server.
The <code>IDLE</code> state is only used in continuous replications.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BUSY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is actively transferring data.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The replication change object also has properties to track the progress (<code>change.status.completed</code> and <code>change.status.total</code>).
Since the replication occurs in batches the total count can vary through the course of a replication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-evnts"><a class="anchor" href="#lbl-repl-evnts"></a>Monitor Document Changes</h3>
<div class="paragraph">
<p>You can choose to register for document updates during a replication.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You should register the listener before starting your replication, to avoid having to do a restart to activate it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the code snippet in <a href="#ex-reg-doc-listener">Example 12</a> registers a listener to monitor document replication performed by the replicator referenced by the variable <code>replicator</code>.
It prints the document ID of each document received and sent.
Stop the listener as shown in <a href="#ex-stop-doc-listener">Example 13</a>.</p>
</div>
<div id="ex-reg-doc-listener" class="exampleblock">
<div class="title">Example 12. Register a document listener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Purpose -- illustrate addition of a Document Replicator  listener
CBLListenerToken* token_ReplDocListener =
        CBLReplicator_AddDocumentReplicationListener(
                                                    thisRepl,
                                                    SimpleReplicationDocumentListener,
                                                    context);</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-stop-doc-listener" class="exampleblock">
<div class="title">Example 13. Stop document listener</div>
<div class="content">
<div class="paragraph">
<p>This code snippet shows how to stop the document listener using the token from the previous example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Purpose -- illustrate removal of a listener
CBLListener_Remove(token_ReplDocListener);
CBLListener_Remove(token_ReplChangeListener);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="document-access-removal-behavior"><a class="anchor" href="#document-access-removal-behavior"></a>Document Access Removal Behavior</h4>
<div class="paragraph">
<p>When access to a document is removed on Sync Gateway (see: Sync Gateway&#8217;s <a href="../../../sync-gateway/current/sync-function-api.html" class="page">Sync Function</a>), the document replication listener sends a notification with the <code>AccessRemoved</code> flag set to <code>true</code> and subsequently purges the document from the database.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-pend"><a class="anchor" href="#lbl-repl-pend"></a>Documents Pending Push</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga493eeac915dd54a274b907a010664a2e">CBLReplicator.isDocumentPending()</a> is quicker and more efficient.
Use it in preference to returning a list of pending document IDs, where possible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can check whether documents are waiting to be pushed in any forthcoming sync by using either of the following API methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga6e9902ae56d5fec0fc19b29c28f1828f">CBLReplicator_PendingDocumentIDs()</a> method, which returns a list of document IDs that have local changes, but which have not yet been pushed to the server.</p>
<div class="paragraph">
<p>This can be very useful in tracking the progress of a push sync, enabling the app to provide a visual indicator to the end user on its status, or decide when it is safe to exit.</p>
</div>
</li>
<li>
<p>Use the <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga493eeac915dd54a274b907a010664a2e">CBLReplicator.isDocumentPending()</a> method to quickly check whether an individual document is pending a push.</p>
</li>
</ul>
</div>
<div id="ex-pending" class="exampleblock">
<div class="title">Example 14. Use Pending Document ID API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">FLDict thisPendingIdList =
    CBLReplicator_PendingDocumentIDs(thisRepl, &amp;err); <i class="conum" data-value="1"></i><b>(1)</b>
if(!FLDict_IsEmpty(thisPendingIdList)) {
    FLDictIterator item;
    FLDictIterator_Begin(thisPendingIdList, &amp;item);
    FLValue itemValue;
    FLString pendingId;
    while(NULL != (itemValue = FLDictIterator_GetValue(&amp;item))) {
        pendingId = FLValue_AsString(itemValue);
        if(CBLReplicator_IsDocumentPending(thisRepl,
                                           pendingId,
                                           &amp;err)) {
            // ... process the still pending docid as required <i class="conum" data-value="2"></i><b>(2)</b>
        } else {
            // Doc Id no longer pending
            if(err.code==0) {
                // No fail so must have already been pushed
                printf("Document already pushed");
            } else {
                // Error detected so handle it
                printf("Error code %d checking for pendingId", err.code);
                break;
            }
        }
        FLDictIterator_Next(&amp;item);
    }
    FLDictIterator_End(&amp;item);
    FLValue_Release(itemValue);
} else {
    printf("No Pending Id Docs to process");
}
FLDict_Release(thisPendingIdList);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga6e9902ae56d5fec0fc19b29c28f1828f">CBLReplicator_PendingDocumentIDs()</a> returns a list of the document IDs for all documents waiting to be pushed.
This is a snapshot and may have changed by the time the response is received and processed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga493eeac915dd54a274b907a010664a2e">CBLReplicator.isDocumentPending()</a> returns <code>true</code> if the document is waiting to be pushed, and <code>false</code> otherwise.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-repl-stop"><a class="anchor" href="#lbl-repl-stop"></a>Stop</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stopping a replication is straightforward.
It is done using <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga548ce284032009546d4092745e89fa8e">CBLReplicator_Stop()</a>.
This initiates an asynchronous operation and so is not necessarily immediate.
Your app should account for this potential delay before attempting any subsequent operations.</p>
</div>
<div class="paragraph">
<p>You can find further information on database operations in {xref-cbl-gp-database}.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Stop replicator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Purpose -- show how to stop a replication
if(CBLReplicator_Status(argRepl).activity!=kCBLReplicatorStopped) {
    CBLReplicator_Stop(argRepl);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we initiate the stopping of the replication using the <a href="https://ibsoln.github.io/api/mobile/3.0/couchbase-lite-c/group__replication.html#ga548ce284032009546d4092745e89fa8e">CBLReplicator_Stop()</a> method.
It will stop any active <a href="#lbl-repl-chng">change listener</a> once the replication is stopped.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-nwk-errs"><a class="anchor" href="#lbl-nwk-errs"></a>Error Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <em>replicator</em> detects a network error it updates its status depending on the error type (permanent or temporary) and returns an appropriate HTTP error code.</p>
</div>
<div class="paragraph">
<p>The following code snippet adds a <code>Change Listener</code>, which monitors a replication for errors and logs the the returned error code.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Monitoring for network errors</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">// Purpose -- illustrate a simple change listener
static void simpleChangeListener(void* context,
                                 CBLReplicator* repl,
                                 const CBLReplicatorStatus* status)
{
     if(status-&gt;error.code != 0) {
         printf("Error %d / %d\n",
                status-&gt;error.domain,
                status-&gt;error.code);
     }
}
// end::replication-error-handling

static const CBLDocument* simpleConflictResolver_localWins(
                                void* context, FLString documentID,
                                const CBLDocument* localDocument,
                                const CBLDocument* remoteDocument)
{
    return localDocument;
}

// Purpose -- illustrate a simple replication filter function
static bool simpleReplicationFilter(void* context,
                                    CBLDocument* argDoc,
                                    CBLDocumentFlags argFlags)
{
    bool result = (argFlags == kCBLDocumentFlagsDeleted);
    return result;
}


// Purpose -- Illustrate a simple replication document listener
static void SimpleReplicationDocumentListener(
                                  void <strong>context,
                                  CBLReplicator *replicator,
                                  bool isPush,
                                  unsigned numDocuments,
                                  const CBLReplicatedDocument *documents)
{
    if(isPush) {
        printf("We pushed %d documents",numDocuments);
    }
}

// END lower-level function declarations


static void getting_started_change_listener(void</strong> context,
                                            CBLReplicator* repl,
                                            const CBLReplicatorStatus* status)
{
    if(status-&gt;error.code != 0) {
        printf("Error %d / %d\n", status-&gt;error.domain, status-&gt;error.code);
    }
}

// Page=build and run
// url=https://docs-staging.couchbase.com/couchbase-lite/current/c/gs-build.html
static void getting_started() {
    //  Purpose-- provide an overview of available crud  and sync functionality
    //
    // Get the database (and create it if it doesn't exist)
    CBLError err;
    CBLDatabase* database = CBLDatabase_Open(FLSTR("mydb"), NULL, &amp;err);
    if(!database) {
        // Error handling.  For brevity, this is truncated in the rest of the snippet
        // and omitted in other doc code snippets
        fprintf(stderr, "Error opening database (%d / %d)\n", err.domain, err.code);
        FLSliceResult msg = CBLError_Message(&amp;err);
        fprintf(stderr, "%.<strong>s\n", (int)msg.size, (const char *)msg.buf);
        FLSliceResult_Release(msg);
        return;
    }

    // The lack of 'const' indicates this document is mutable
    // Create a new document (i.e. a record) in the database
    CBLDocument</strong> mutableDoc = CBLDocument_Create();
    FLMutableDict properties = CBLDocument_MutableProperties(mutableDoc);
    FLMutableDict_SetFloat(properties, FLSTR("version"), 3.0f);

    // Save it to the database
    if(!CBLDatabase_SaveDocument(database, mutableDoc, &amp;err)) {
        // Failed to save, do error handling as above
        return;
    }

    // Since we will release the document, make a copy of the ID since it
    // is an internal pointer.  Whenever we create or get an FLSliceResult
    // or FLStringResult we will need to free it later too!
    FLStringResult id = FLSlice_Copy(CBLDocument_ID(mutableDoc));
    CBLDocument_Release(mutableDoc);

    // Update a document
    mutableDoc = CBLDatabase_GetMutableDocument(database, FLSliceResult_AsSlice(id), &amp;err);
    if(!mutableDoc) {
        // Failed to retrieve, do error handling as above.  NOTE: error code 0 simply means
        // the document does not exist.
        return;
    }

    properties = CBLDocument_MutableProperties(mutableDoc);
    FLMutableDict_SetString(properties, FLSTR("language"), FLSTR("C"));
    if(!CBLDatabase_SaveDocument(database, mutableDoc, &amp;err)) {
        // Failed to save, do error handling as above
        return;
    }

    // Note const here, means readonly
    const CBLDocument* docAgain = CBLDatabase_GetDocument(database, FLSliceResult_AsSlice(id), &amp;err);
    if(!docAgain) {
        // Failed to retrieve, do error handling as above.  NOTE: error code 0 simply means
        // the document does not exist.
        return;
    }

    // No copy this time, so no release later (notice it is not FLStringResult this time)
    FLString retrievedID = CBLDocument_ID(docAgain);
    FLDict retrievedProperties = CBLDocument_Properties(docAgain);
    FLString retrievedLanguage = FLValue_AsString(FLDict_Get(retrievedProperties, FLSTR("language")));
    printf("Document ID :: %.<strong>s\n", (int)retrievedID.size, (const char *)retrievedID.buf);
    printf("Learning %.*s\n", (int)retrievedLanguage.size, (const char *)retrievedLanguage.buf);

    CBLDocument_Release(mutableDoc);
    CBLDocument_Release(docAgain);
    FLSliceResult_Release(id);

    // Create a query to fetch documents of type SDK
    int errorPos;
    CBLQuery</strong> query = CBLDatabase_CreateQuery(database, kCBLN1QLLanguage, FLSTR("SELECT * FROM _ WHERE type = \"SDK\""), &amp;errorPos, &amp;err);
    if(!query) {
        // Failed to create query, do error handling as above
        // Note that errorPos will contain the position in the N1QL string
        // that the parse failed, if applicable
        return;
    }

    CBLResultSet* result = CBLQuery_Execute(query, &amp;err);
    if(!result) {
        // Failed to run query, do error handling as above
        return;
    }

    // TODO: Result set count?
    CBLResultSet_Release(result);
    CBLQuery_Release(query);

    // Create replicator to push and pull changes to and from the cloud
    CBLEndpoint* targetEndpoint = CBLEndpoint_CreateWithURL(FLSTR("ws://localhost:4984/getting-started-db"), &amp;err);
    if(!targetEndpoint) {
        // Failed to create endpoint, do error handling as above
        return;
    }

    CBLReplicatorConfiguration replConfig;
    CBLAuthenticator* basicAuth = CBLAuth_CreatePassword(FLSTR("john"), FLSTR("pass"));
    memset(&amp;replConfig, 0, sizeof(replConfig));
    replConfig.database = database;
    replConfig.endpoint = targetEndpoint;
    replConfig.authenticator = basicAuth;

    CBLReplicator* replicator = CBLReplicator_Create(&amp;replConfig, &amp;err);
    CBLAuth_Free(basicAuth);
    CBLEndpoint_Free(targetEndpoint);
    if(!replicator) {
        // Failed to create replicator, do error handling as above
        return;
    }

    // Assume a function like the simple following
    //
    // static void getting_started_change_listener(void* context, CBLReplicator* repl, const CBLReplicatorStatus* status) {
    //     if(status-&gt;error.code != 0) {
    //         printf("Error %d / %d\n", status-&gt;error.domain, status-&gt;error.code);
    //     }
    // }

    CBLListenerToken* token = CBLReplicator_AddChangeListener(replicator, getting_started_change_listener, NULL);

    CBLReplicator_Start(replicator, false);

    // Later, stop and release the replicator

    // When finished release resources ... eg
    CBLListener_Remove(token);

    stop_replicator(replicator);
}


static const CBLDocument* local_win_conflict_resolver(void* context,
                                                      FLString documentID,
                                                      const CBLDocument* localDocument,
                                                      const CBLDocument* remoteDocument)
{
    return localDocument;
}

static const CBLDocument* remote_win_conflict_resolver(void* context,
                                                       FLString documentID,
                                                       const CBLDocument* localDocument,
                                                       const CBLDocument* remoteDocument)
{
    return remoteDocument;
}

static const CBLDocument* merge_conflict_resolver(void* context,
                                                  FLString documentID,
                                                  const CBLDocument* localDocument,
                                                  const CBLDocument* remoteDocument)
{
    FLDict localProps = CBLDocument_Properties(localDocument);
    FLDict remoteProps = CBLDocument_Properties(remoteDocument);
    FLMutableDict mergeProps = FLDict_MutableCopy(localProps, kFLDefaultCopy);
    
    FLDictIterator d;
    FLDictIterator_Begin(localProps, &amp;d);
    FLValue value;
    whilevalue = FLDictIterator_GetValue(&amp;d) {
        FLString key = FLDictIterator_GetKeyString(&amp;d);
        if(FLDict_Get(mergeProps, key)) {
            continue;
        }

        FLMutableDict_SetValue(mergeProps, key, value);
        FLDictIterator_Next(&amp;d);
    }
    
    CBLDocument* mergeDocument = CBLDocument_CreateWithID(documentID);
    CBLDocument_SetProperties(mergeDocument, mergeProps);
    
    return mergeDocument;
}

static void test_replicator_conflict_resolve() {
    CBLDatabase* database = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)
    CBLError err;
    CBLEndpoint* target = CBLEndpoint_CreateWithURL(FLSTR("ws://localhost:4984/mydatabase"), &amp;err);

    CBLReplicatorConfiguration replConfig;
    memset(&amp;replConfig, 0, sizeof(replConfig));
    replConfig.database = database;
    replConfig.endpoint = target;
    replConfig.conflictResolver = local_win_conflict_resolver;

    CBLReplicator* replicator = CBLReplicator_Create(&amp;replConfig, &amp;err);
    CBLEndpoint_Free(target);
    CBLReplicator_Start(replicator, false);


    stop_replicator(replicator);
}

static bool custom_conflict_handler(void* context,
                                    CBLDocument* documentBeingSaved,
                                    const CBLDocument* conflictingDocument)
{
    FLDict currentProps = CBLDocument_Properties(conflictingDocument);
    FLDict updatedProps = CBLDocument_Properties(documentBeingSaved);
    FLMutableDict newProps = FLDict_MutableCopy(updatedProps, kFLDefaultCopy);

    FLDictIterator d;
    FLDictIterator_Begin(currentProps, &amp;d);
    FLValue currentValue;
    whilecurrentValue = FLDictIterator_GetValue(&amp;d) {
        FLString currentKey = FLDictIterator_GetKeyString(&amp;d);
        if(FLDict_Get(newProps, currentKey)) {
            continue;
        }

        FLMutableDict_SetValue(newProps, currentKey, currentValue);
        FLDictIterator_Next(&amp;d);
    }

    return true;
}

static void test_save_with_conflict_handler() {
    CBLDatabase* database = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLDocument* mutableDocument = CBLDatabase_GetMutableDocument(database, FLSTR("xyz"), &amp;err);
    FLMutableDict properties = CBLDocument_MutableProperties(mutableDocument);
    FLMutableDict_SetString(properties, FLSTR("name"), FLSTR("apples"));

    /*
    static bool custom_conflict_handler(void* context, CBLDocument* documentBeingSaved,
        const CBLDocument* conflictingDocument) {
        FLDict currentProps = CBLDocument_Properties(conflictingDocument);
        FLDict updatedProps = CBLDocument_Properties(documentBeingSaved);
        FLMutableDict newProps = FLDict_MutableCopy(updatedProps, kFLDefaultCopy);

        FLDictIterator d;
        FLDictIterator_Begin(currentProps, &amp;d);
        FLSlice currentKey = FLDictIterator_GetKeyString(&amp;d);
        for(; currentKey.buf; currentKey = FLDictIterator_GetKeyString(&amp;d)) {
            if(FLDict_Get(newProps, currentKey)) {
                continue;
            }

            FLValue currentValue = FLDictIterator_GetValue(&amp;d);
            FLMutableDict_SetValue(newProps, currentKey, currentValue);
        }

        return true;
    }
    <strong>/
    CBLDatabase_SaveDocumentWithConflictHandler(database, mutableDocument, custom_conflict_handler, NULL, &amp;err);

}

static void use_encryption() {
    #ifdef COUCHBASE_ENTERPRISE

    // NOTE: No error handling, for brevity (see getting started)

    CBLDatabaseConfiguration config = CBLDatabaseConfiguration_Default();

    // This returns a boolean, so check it in production code
    CBLEncryptionKey_FromPassword(&amp;config.encryptionKey, FLSTR("password"));

    CBLError err;
    CBLDatabase</strong> db = CBLDatabase_Open(FLSTR("seekrit"), &amp;config, &amp;err);

    // Change the encryption key (or add encryption if the DB is unencrypted)
    CBLEncryptionKey betterKey;
    CBLEncryptionKey_FromPassword(&amp;betterKey, FLSTR("betterpassw0rd"));
    CBLDatabase_ChangeEncryptionKey(db, &amp;betterKey, &amp;err);

    // Remove encryption
    CBLDatabase_ChangeEncryptionKey(db, NULL, &amp;err);

    #endif
}

static void reset_replicator_checkpoint() {
    CBLEndpoint* target = CBLEndpoint_CreateWithURL(FLSTR("ws://localhost:4984/db"), NULL);
    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
    config.database = kDatabase;
    config.endpoint = target;
    CBLReplicator* replicator = CBLReplicator_Create(&amp;config, NULL);
    CBLEndpoint_Free(target);

    // replicator is a CBLReplicator* instance
    CBLReplicator_Start(replicator, true); <i class="conum" data-value="1"></i><b>(1)</b>


    stop_replicator(replicator);
}

static void read_1x_attachment() {
    CBLDocument* document = CBLDocument_Create();

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    FLDict properties = CBLDocument_Properties(document);
    FLDict attachments = FLValue_AsDict(FLDict_Get(properties, FLSTR("_attachments")));
    const CBLBlob* avatar = FLDict_GetBlob(FLValue_AsDict(FLDict_Get(attachments, FLSTR("avatar"))));
    FLSliceResult content = CBLBlob_Content(avatar, &amp;err);

    FLSliceResult_Release(content);

    CBLDocument_Release(document);
}

static void create_new_database() {
    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLDatabase* db = CBLDatabase_Open(FLSTR("my-database"), NULL, &amp;err);

    kDatabase = db;
}

static void close_database() {
    CBLDatabase* db = kDatabase;
    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLDatabase_Close(db, &amp;err);
}

static void change_logging() {
    // For output to stdout
    CBLLog_SetConsoleLevel(kCBLLogVerbose);

    // For output to custom logging
    CBLLog_SetCallbackLevel(kCBLLogVerbose);
}

static void load_prebuilt() {
    CBL_DeleteDatabase(FLSTR("travel-sample.cblite2"), kFLSliceNull, NULL);

    // Note: Getting the path to a database is platform-specific.  For desktop (including RPi)
    // this can be a simple filesystem path.  For iOS you need to get the path from the
    // main bundle.  For Android you need to extract it from your assets to a temporary directory
    // and then pass that path.

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    const char* path = "/path/to/travel-sample.cblite2";
    if(!CBL_DatabaseExists(FLSTR("travel-sample.cblite2"), kFLSliceNull)) {
        CBL_CopyDatabase(FLStr(path), FLSTR("travel-sample"), NULL, &amp;err);
    }

    CBLDatabase_Close(kDatabase, NULL);
    CBLDatabase_Release(kDatabase);
    kDatabase = CBLDatabase_Open(FLSTR("travel-sample"), NULL, NULL);
}

static void query_deleted_document() {
    CBLDatabase* db = kDatabase;

    // Query documents that have been deleted
    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id FROM _ WHERE meta().deleted"), NULL, &amp;err);

    CBLQuery_Release(query);
}

static void create_document() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLDocument* newTask = CBLDocument_CreateWithID(FLSTR("xyz"));
    FLMutableDict properties = CBLDocument_MutableProperties(newTask);
    FLMutableDict_SetString(properties, FLSTR("type"), FLSTR("task"));
    FLMutableDict_SetString(properties, FLSTR("owner"), FLSTR("todo"));

    // Storing time in millisecond, bluntly
    FLMutableDict_SetUInt(properties, FLSTR("createdAt"), time(NULL) * 1000);

    CBLError err;
    CBLDatabase_SaveDocument(db, newTask, &amp;err);
    CBLDocument_Release(newTask);
}

static void update_document() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLDocument* mutableDocument = CBLDatabase_GetMutableDocument(db, FLSTR("xyz"), &amp;err);
    FLMutableDict properties = CBLDocument_MutableProperties(mutableDocument);
    FLMutableDict_SetString(properties, FLSTR("name"), FLSTR("apples"));
    CBLDatabase_SaveDocument(db, mutableDocument, &amp;err);
    CBLDocument_Release(mutableDocument);
}

// Note use_typed_accessors not applicable

static void do_batch_operation() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLDatabase_BeginTransaction(db, &amp;err);
    char buffer[7];
    for(int i = 0; i &lt; 10; i) {
        CBLDocument* doc = CBLDocument_Create();
        FLMutableDict properties = CBLDocument_MutableProperties(doc);
        FLMutableDict_SetString(properties, FLSTR("type"), FLSTR("user"));
        sprintf(buffer, "user %d", i);
        FLMutableDict_SetString(properties, FLSTR("name"), FLStr(buffer));
        FLMutableDict_SetBool(properties, FLSTR("admin"), false);
        CBLDatabase_SaveDocument(db, doc, &amp;err);
        CBLDocument_Release(doc);
        printf("Saved user document %s\n", buffer);
    }

    CBLDatabase_EndTransaction(db, true, &amp;err);
}

static void document_listener(void* context, const CBLDatabase* db, FLString id) {
    CBLError err;
    const CBLDocument* doc = CBLDatabase_GetDocument(db, id, &amp;err);
    FLDict properties = CBLDocument_Properties(doc);
    FLString verified_account = FLValue_AsString(FLDict_Get(properties, FLSTR("verified_account")));
    printf("Status :: %.*s\n", (int)verified_account.size, (const char *)verified_account.buf);
    CBLDocument_Release(doc);
}

static void database_change_listener() {
    CBLDatabase* db = kDatabase;

    /*
    static void document_listener(void* context, const CBLDatabase* db, FLString id) {
        CBLError err;
        const CBLDocument* doc = CBLDatabase_GetDocument(db, id, &amp;err);
        FLDict properties = CBLDocument_Properties(doc);
        FLString verified_account = FLValue_AsString(FLDict_Get(properties, FLSTR("verified_account")));
        printf("Status :: %.*s\n", (int)verified_account.size, (const char *)verified_account.buf);
        CBLDocument_Release(doc);
    }
    */
    CBLListenerToken* token = CBLDatabase_AddDocumentChangeListener(db, FLSTR("user.john"),
        document_listener, NULL);

    CBLListener_Remove(token);
}

static void document_expiration() {
    CBLDatabase* db = kDatabase;

    // Purge the document one day from now

    // Overly simplistic for example purposes
    // NOTE: API takes milliseconds
    // NOTE: No error handling, for brevity (see getting started)
    time_t ttl = time(NULL) + 24 * 60 * 60;
    ttl *= 1000;

    CBLError err;
    CBLDatabase_SetDocumentExpiration(db, FLSTR("doc123"), ttl, &amp;err);

    // Reset expiration
    CBLDatabase_SetDocumentExpiration(db, FLSTR("doc1"), 0, &amp;err);

    // Query documents that will be expired in less than five minutes
    time_t fiveMinutesFromNow = time(NULL) + 5 * 60;
    fiveMinutesFromNow *= 1000;
    FLMutableDict parameters = FLMutableDict_New();
    FLMutableDict_SetInt(parameters, FLSTR("five_minutes"), fiveMinutesFromNow);

    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id FROM _ WHERE meta().expiration &lt; $five_minutes"), NULL, &amp;err);
    CBLQuery_SetParameters(query, parameters);
    FLMutableDict_Release(parameters);
}

static void use_blob() {
    CBLDatabase* db = kDatabase;

    CBLDocument* newTask = CBLDocument_Create();

    // Note: Reading the data is implementation dependent, as with prebuilt databases
    // NOTE: No error handling, for brevity (see getting started)

    uint8_t buffer[128000];
    FILE* avatar_file = fopen("avatar.jpg", "rb");
    size_t read = fread(buffer, 1, 128000, avatar_file); // &lt;.&gt;

    FLSliceResult avatar = FLSliceResult_CreateWith(buffer, read);
    CBLBlob* blob = CBLBlob_CreateWithData(FLSTR("image/jpeg"), FLSliceResult_AsSlice(avatar)); // &lt;.&gt;
    FLSliceResult_Release(avatar);

    // TODO: Create shortcut blob method
    CBLError err;
    FLMutableDict properties = CBLDocument_MutableProperties(newTask);
    FLSlot_SetBlob(FLMutableDict_Set(properties, FLSTR("avatar")), blob);
    CBLDatabase_SaveDocument(db, newTask, &amp;err); // &lt;.&gt;




    CBLDocument_Release(newTask);
    CBLBlob_Release(blob);
}

static void doc_json() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    FLString json = FLSTR("{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\",\"city\":\"Balmain\",\"country\":\"Australia\"}");

    // Create a document and set the JSON data to the document
    CBLError err;
    CBLDocument* newDoc = CBLDocument_CreateWithID(FLSTR("hotel_1002"));
    CBLDocument_SetJSON(newDoc, json, &amp;err);

    // Save the document to the database
    CBLDatabase_SaveDocument(db, newDoc, &amp;err);

    // Release created doc after using it
    CBLDocument_Release(newDoc);

    // Get the document from the database
    const CBLDocument* doc = CBLDatabase_GetDocument(db, FLSTR("hotel_1002"), &amp;err);

    // Get document body as JSON
    FLSliceResult docJson = CBLDocument_CreateJSON(doc);
    printf("Document in JSON :: %.*s\n", (int)docJson.size, (const char *)docJson.buf);

    // Release JSON data after using it
    FLSliceResult_Release(docJson);

    // Release doc read from the database after using it
    CBLDocument_Release(doc);
}

static void dict_json() {
    // NOTE: No error handling, for brevity (see getting started)

    FLString json = FLSTR("{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\",\"city\":\"Balmain\",\"country\":\"Australia\"}");

    // Create a dictionary from the JSON string
    FLError err;
    FLSliceResult jsonData1 = FLData_ConvertJSON(json, &amp;err);
    FLDict hotel = FLValue_AsDict(FLValue_FromData(FLSliceResult_AsSlice(jsonData1), kFLTrusted));

    // Iterate through the dictionary
    FLDictIterator iter;
    FLDictIterator_Begin(hotel, &amp;iter);
    FLValue value;
    while (NULL != (value = FLDictIterator_GetValue(&amp;iter))) {
        FLString key = FLDictIterator_GetKeyString(&amp;iter);
        FLString strValue = FLValue_AsString(value);
        printf("%.*s :: %.*s\n", (int)key.size, (const char*)key.buf, (int)strValue.size, (const char*)strValue.buf);
        FLDictIterator_Next(&amp;iter);
    }

    // Convert the dictionary to JSON
    FLSliceResult jsonData2 = FLValue_ToJSON((FLValue)hotel);
    printf("Hotel in JSON :: %.*s\n", (int)jsonData2.size, (const char *)jsonData2.buf);

    // Release JSON data after finish using it
    FLSliceResult_Release(jsonData1);
    FLSliceResult_Release(jsonData2);
}

static void array_json() {
    // NOTE: No error handling, for brevity (see getting started)

    FLString json = FLSTR("[\"Hotel Ned\", \"Hotel Ted\"]");

    // Create an array from the JSON string
    FLError err;
    FLSliceResult jsonData1 = FLData_ConvertJSON(json, &amp;err);
    FLArray hotels = FLValue_AsArray(FLValue_FromData(FLSliceResult_AsSlice(jsonData1), kFLTrusted));

    // Iterate through the array
    FLArrayIterator iter;
    FLArrayIterator_Begin(hotels, &amp;iter);
    FLValue value;
    while (NULL != (value = FLArrayIterator_GetValue(&amp;iter))) {
        FLString hotel = FLValue_AsString(value);
        printf("Hotel :: %.*s\n", (int)hotel.size, (const char *)hotel.buf);
        FLArrayIterator_Next(&amp;iter);
    }

    // Convert the array to JSON
    FLSliceResult jsonData2 = FLValue_ToJSON((FLValue)hotels);
    printf("Hotels in JSON :: %.*s\n", (int)jsonData2.size, (const char *)jsonData2.buf);

    // Release JSON data after finish using it
    FLSliceResult_Release(jsonData1);
    FLSliceResult_Release(jsonData2);
}


static void create_index() {
    CBLDatabase* db = kDatabase;

    // For value types, this is optional but provides performance enhancements
    // NOTE: No error handling, for brevity (see getting started)

    // Syntax for second argument is the same as taking from a N1QL SELECT
    // i.e. SELECT (type, name) FROM _;
    CBLValueIndexConfiguration config = {
        kCBLN1QLLanguage,
        FLSTR("type, name")
    };

    CBLError err;
    CBLDatabase_CreateValueIndex(db, FLSTR("TypeNameIndex"), config, &amp;err);
}

static void select_meta() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id, type, name FROM _"), NULL, &amp;err);
    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString id = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("id")));
        FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
        printf("Document ID :: %.*s\n", (int)id.size, (const char *)id.buf);
        printf("Document Name :: %.*s\n", (int)name.size, (const char *)name.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void select_id() {
    CBLDatabase* db = kDatabase;

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id FROM _"), NULL, &amp;err);

    // NOTE: No error handling, for brevity (see getting started)

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString id = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("id")));
        printf("Document ID :: %.*s\n", (int)id.size, (const char *)id.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void query_change_listener(void* context, CBLQuery* query, CBLListenerToken* token) {
    CBLError err;
    CBLResultSet* results = CBLQuery_CopyCurrentResults(query, token, &amp;err);
    while(CBLResultSet_Next(results)) {
        // Update UI
    }
}

static void select_all() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT * FROM _"), NULL, &amp;err);

    // All results will be available from the above query
    CBLQuery_Release(query);

    /*
    static void query_change_listener(void* context, CBLQuery* query, CBLListenerToken* token) {
        CBLError err;
        CBLResultSet* results = CBLQuery_CopyCurrentResults(query, token, &amp;err);
        while(CBLResultSet_Next(results)) {
            // Update UI
        }
    }
    */

    query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT * FROM _"), NULL, &amp;err); // &lt;.&gt;

    CBLListenerToken* token = CBLQuery_AddChangeListener(query, query_change_listener, NULL); // &lt;.&gt;

    CBLListener_Remove(token); // The token received from AddChangeListener
    CBLQuery_Release(query);
}

static void select_and_access_all() {
    CBLDatabase* db = kDatabase;

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT * FROM _"), NULL, &amp;err);

    // NOTE: No error handling, for brevity (see getting started)

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLDict dict = FLValue_AsDict(CBLResultSet_ValueForKey(results, FLSTR("_")));

        FLString id = FLValue_AsString(FLDict_Get(dict, FLSTR("id")));
        FLString type = FLValue_AsString(FLDict_Get(dict, FLSTR("type")));
        FLString name = FLValue_AsString(FLDict_Get(dict, FLSTR("name")));
        FLString city = FLValue_AsString(FLDict_Get(dict, FLSTR("city")));

        printf("ID :: %.*s\n", (int)id.size, (const char *)id.buf);
        printf("Type :: %.*s\n", (int)type.size, (const char *)type.buf);
        printf("Name :: %.*s\n", (int)name.size, (const char *)name.buf);
        printf("City :: %.*s\n", (int)city.size, (const char *)city.buf);
    }

    // All results will be available from the above query
    CBLResultSet_Release(results);

    CBLQuery_Release(query);
}

static void select_props() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT type, name, city FROM _"), NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString type = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("type")));
        FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
        FLString city = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("city")));

        printf("Type :: %.*s\n", (int)type.size, (const char *)type.buf);
        printf("Name :: %.*s\n", (int)name.size, (const char *)name.buf);
        printf("City :: %.*s\n", (int)city.size, (const char *)city.buf);
    }

    // All results will be available from the above query
    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void select_where() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT * FROM _ WHERE type = \"hotel\" LIMIT 10"), NULL, &amp;err);
    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLDict dict = FLValue_AsDict(CBLResultSet_ValueForKey(results, FLSTR("_")));
        FLString name = FLValue_AsString(FLDict_Get(dict, FLSTR("name")));
        printf("Document Name :: %.*s\n", (int)name.size, (const char *)name.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void use_collection_contains() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id, name, public_likes FROM _ WHERE type = \"hotel\" "
              "AND ARRAY_CONTAINS(public_likes, \"Armani Langworth\")"), NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLArray publicLikes = FLValue_AsArray(CBLResultSet_ValueForKey(results, FLSTR("public_likes")));
        FLStringResult json = FLValue_ToJSON((FLValue)publicLikes);
        printf("Public Likes :: %.*s\n", (int)json.size, (const char *)json.buf);
        FLSliceResult_Release(json);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void use_collection_in() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT * FROM _ WHERE \"Armani\" IN (first, last, username)"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLDict body = FLValue_AsDict(CBLResultSet_ValueAtIndex(results, 0));
        FLStringResult json = FLValue_ToJSON((FLValue)body);
        printf("In results :: %.*s\n", (int)json.size, (const char *)json.buf);
        FLSliceResult_Release(json);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void select_like() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id, name FROM _ WHERE type = \"landmark\" "
              "AND lower(name) LIKE \"Royal Engineers Museum\" LIMIT 10"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
        printf("Name Property :: %.*s\n", (int)name.size, (const char *)name.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void select_wildcard_like() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

     CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id, name FROM _ WHERE type = \"landmark\" "
              "AND lower(name) LIKE \"Eng%e%\" LIMIT 10"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
        printf("Name Property :: %.*s\n", (int)name.size, (const char *)name.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void select_wildcard_character_like() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id, name FROM _ WHERE type = \"landmark\" "
              "AND lower(name) LIKE \"Royal Eng____rs Museum\" LIMIT 10"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
        printf("Name Property :: %.*s\n", (int)name.size, (const char *)name.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void select_regex() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id, name FROM _ WHERE type = \"landmark\" "
              "AND regexp_like(name, \"\\bEng.*e\\b\") LIMIT 10"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
        printf("Name Property :: %.*s\n", (int)name.size, (const char *)name.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void select_join() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT airline.name, airline.callsign, route.destinationairport, route.stops, route.airline "
              "FROM _ AS airline INNER JOIN _ AS route ON meta(airline).id = route.airlineid "
              "WHERE route.type = \"route\" AND airline.type = \"airline\" AND route.sourceairport = \"RIX\""),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
        printf("Name Property :: %.*s\n", (int)name.size, (const char *)name.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void group_by() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT count(*), country, tz FROM _ WHERE type = \"airport\" AND geo.alt &gt;= 300 "
              "GROUP BY country, tz"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        int64_t count = FLValue_AsInt(CBLResultSet_ValueForKey(results, FLSTR("$1")));
        FLString tz = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("tz")));
        FLString country = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("country")));
        printf("There are %" PRIi64 " airports in the %.*s timezone located in %.*s and above 300 ft\n",
            count, (int)tz.size, (const char *)tz.buf, (int)country.size, (const char *)country.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void order_by() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id, title FROM _ WHERE type = \"hotel\" ORDER BY title ASC LIMIT 10"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString title = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("title")));
        printf("Title :: %.*s\n", (int)title.size, (const char *)title.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void test_explain_statement() {
    CBLDatabase* db = kDatabase;

    {
    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT * FROM _ WHERE type = \"hotel\" GROUP BY country ORDER BY title ASC LIMIT 10"),
        NULL, &amp;err);

    FLSliceResult explanation = CBLQuery_Explain(query);
    printf("%.*s", (int)explanation.size, (const char *)explanation.buf);
    FLSliceResult_Release(explanation);
    }

    // DOCS NOTE: Others omitted for now
}

static void query_result_json() {
    CBLDatabase* db = kDatabase;

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id as id, name, city, type FROM _ LIMIT 10"),
        NULL, &amp;err);

    // NOTE: No error handling, for brevity (see getting started)

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLDict result = CBLResultSet_ResultDict(results);
        FLStringResult json = FLValue_ToJSON((FLValue)result);
        printf("JSON Result :: %.*s\n", (int)json.size, (const char *)json.buf);
        FLSliceResult_Release(json);
    }
    CBLResultSet_Release(results);


    CBLQuery_Release(query);
}

static void create_full_text_index() {
    CBLDatabase* db = kDatabase;

    const char* tasks[] = { "buy groceries", "play chess", "book travels", "buy museum tickets" };
    char idBuffer[7];
    for(int i = 0; i &lt; 4; i) {
        const char* task = tasks[i];
        sprintf(idBuffer, "extra%d", i);
        const CBLDocument* doc = CBLDatabase_GetDocument(db, FLStr(idBuffer), NULL);
        if(doc) {
            CBLDocument_Release(doc);
            continue;
        }

        CBLDocument* mutableDoc = CBLDocument_CreateWithID(FLStr(idBuffer));
        FLMutableDict properties = CBLDocument_MutableProperties(mutableDoc);
        FLMutableDict_SetString(properties, FLSTR("type"), FLSTR("task"));
        FLMutableDict_SetString(properties, FLSTR("task"), FLStr(task));
        CBLDatabase_SaveDocument(db, mutableDoc, NULL);
        CBLDocument_Release(mutableDoc);
    }

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLFullTextIndexConfiguration config = {
        kCBLN1QLLanguage,
        FLSTR("name"),
        false
    };

    CBLDatabase_CreateFullTextIndex(db, FLSTR("nameFTSIndex"), config, &amp;err);
}

static void full_text_search() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT meta().id FROM _ WHERE MATCH(nameFTSIndex, \"'buy'\")"),
        NULL, &amp;err);

    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        FLString id = FLValue_AsString(CBLResultSet_ValueAtIndex(results, 0));
        printf("Document id :: %.<strong>s\n", (int)id.size, (const char *)id.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);
}

static void start_replication() {
    CBLDatabase</strong> db = kDatabase;

    /*
    * This requires Sync Gateway running with the following config, or equivalent:
    *
    * {
    *     "log":["<strong>"],
    *     "databases": {
    *         "db": {
    *             "server":"walrus:",
    *             "users": {
    *                 "GUEST": {"disabled": false, "admin_channels": ["</strong>"] }
    *             }
    *         }
    *     }
    * }
    <strong>/

    // NOTE: No error handling, for brevity (see getting started)
    // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)

    CBLError err;
    FLString url = FLSTR("ws://localhost:4984/db");
    CBLEndpoint</strong> target = CBLEndpoint_CreateWithURL(url, &amp;err);
    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
    config.database = db;
    config.endpoint = target;
    config.replicatorType = kCBLReplicatorTypePull;

    CBLReplicator* replicator = CBLReplicator_Create(&amp;config, &amp;err);
    CBLEndpoint_Free(target);
    CBLReplicator_Start(replicator, false);

    stop_replicator(replicator);
}

// Console logging domain methods are not applicable to C

static void file_logging() {
    // NOTE: No error handling, for brevity (see getting started)
    // NOTE: You will need to use a platform appropriate method for finding
    // a temporary directory

    FLString tempFolder = FLSTR("/tmp/cbllog");

    CBLLogFileConfiguration config; // Don't bother zeroing, since we set all properties
    config.level = kCBLLogInfo;
    config.directory = tempFolder;
    config.maxRotateCount = 5;
    config.maxSize = 10240;
    config.usePlaintext = false;

    CBLError err;
    CBLLog_SetFileConfig(config, &amp;err);
}

static void custom_log_callback(CBLLogDomain domain, CBLLogLevel level, FLString message) {
    // handle the message, for example piping it to
    // a third party framework
}

static void enable_custom_logging() {
    CBLLog_SetCallback(custom_log_callback);
}

static void enable_basic_auth() {
    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    FLString url = FLSTR("ws://localhost:4984/mydatabase");
    CBLEndpoint* target = CBLEndpoint_CreateWithURL(url, &amp;err);
    CBLAuthenticator* basicAuth = CBLAuth_CreatePassword(FLSTR("john"), FLSTR("pass"));

    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
    config.database = db;
    config.endpoint = target;
    config.authenticator = basicAuth;

    CBLReplicator* replicator = CBLReplicator_Create(&amp;config, &amp;err);
    CBLEndpoint_Free(target);
    CBLAuth_Free(basicAuth);

    CBLReplicator_Start(replicator, false);

    stop_replicator(replicator);
}

static void docsonly_N1QL_Params(CBLDatabase* argDb)
{
    CBLDatabase* database = argDb;

    int errorPos;

    CBLError err;

    FLString n1qlstr = FLSTR("SELECT * FROM _ WHERE type = $type");

    FLMutableDict n1qlparams = FLMutableDict_New();
    FLMutableDict_SetString(n1qlparams, FLSTR("type"), FLSTR("hotel"));

    CBLQuery* query = CBLDatabase_CreateQuery(database,
                          kCBLN1QLLanguage,
                          n1qlstr,
                          &amp;errorPos,
                          &amp;err);

    CBLQuery_SetParameters(query, n1qlparams);

    if(!query) {
        /* Do appropriate error handling ...
            Note that (where applicable) errorPos contains the position
            in the N1QL string that the parse failed
        <strong>/
        FLMutableDict_Release(n1qlparams);
        CBLQuery_Release(query);
        return;
    }

    CBLResultSet</strong> result = CBLQuery_Execute(query, &amp;err);
    if(!result) {
        // Failed to run query, do error handling ...
        return;
    }

    // Release query when finished with
    FLMutableDict_Release(n1qlparams);
    CBLQuery_Release(query);

    // ... process results as required

    // Release result set then finished with
    CBLResultSet_Release(result);

}



//Placeholder for code to increase level of console logging for kCBLLogDomainDatabase domain

//Placeholder for code to increase level of console logging for all domains

//Placeholder for Date accessors.



// placeholder


// DOCS NOTE
// Page=Data Sync &gt;&gt; Configuration Summary
// URL=https://docs.couchbase.com/couchbase-lite/current/c/replication.html#configuration-summary
static void docs_act_replication(CBLDatabase* argDb)
{
    CBLDatabase* database = argDb;

    /*
    * This requires Sync Gateway running with the following config, or equivalent:
    *
    * {
    *     "log":["<strong>"],
    *     "databases": {
    *         "db": {
    *             "server":"walrus:",
    *             "users": {
    *                 "GUEST": {"disabled": false, "admin_channels": ["</strong>"] }
    *             }
    *         }
    *     }
    * }
    <strong>/

    // Purpose -- Show configuration , initialization and running of a replicator

    // NOTE: No error handling, for brevity (see getting started)
    // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)

    CBLError err;
    FLString url = FLSTR("ws://localhost:4984/db");
    CBLEndpoint</strong> target = CBLEndpoint_CreateWithURL(url, &amp;err); <i class="conum" data-value="2"></i><b>(2)</b>

    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
    config.database = database;
    config.endpoint = target; <i class="conum" data-value="3"></i><b>(3)</b>

    // Set replication direction and mode
    config.replicatorType = kCBLReplicatorTypePull; <i class="conum" data-value="4"></i><b>(4)</b>
    config.continuous = true;


    // Optionally, set auto-purge behavior (here we override default)
    config.disableAutoPurge = true; <i class="conum" data-value="5"></i><b>(5)</b>

    // Optionally, configure Client Authentication
    // Here we are using to Basic Authentication,
    // Providing username and password credentials
    CBLAuthenticator* basicAuth =
        CBLAuth_CreatePassword(FLSTR("username"),
                               FLSTR("passwd")); <i class="conum" data-value="6"></i><b>(6)</b>
    config.authenticator = basicAuth;

    // Optionally, configure how we handle conflicts
    config.conflictResolver = simpleConflictResolver_localWins; <i class="conum" data-value="7"></i><b>(7)</b>

    // Initialize replicator with created config
    CBLReplicator* replicator =
        CBLReplicator_Create(&amp;config, &amp;err); <i class="conum" data-value="8"></i><b>(8)</b>

    CBLEndpoint_Free(target);

    // Optionally, add change listener
    CBLListenerToken* token =
            CBLReplicator_AddChangeListener(replicator,
                                            simpleChangeListener,
                                            NULL); <i class="conum" data-value="9"></i><b>(9)</b>

    // Start replication
    CBLReplicator_Start(replicator, false); <i class="conum" data-value="10"></i><b>(10)</b>


    //    ... other processing as required

    // When finished release resources e.g.
    CBLAuth_Free(basicAuth);
    stop_replicator(replicator);
}
// END configuration summary snippets


// DOCS NOTE:
// Page=Data Sync &gt;&gt; Configuration
// URL=https://docs.couchbase.com/couchbase-lite/current/c/replication.html#configuration-summary
// This function is not pulled into docs en-bloc
// it is a slightly more in-depth than the configurationsummary above
// and the snippets within it are used individually or in sets
// to illustrate specific points as required
//
static void docs_act_replication_config_section_snippets()
{
    CBLDatabase* db = kDatabase;
    bool docs_example_ShowBasicAuth = false;
    bool docs_example_ShowSessionAuth = false;

    /*
    * This requires Sync Gateway running with the following config, or equivalent:
    *
    * {
    *     "log":["<strong>"],
    *     "databases": {
    *         "db": {
    *             "server":"walrus:",
    *             "users": {
    *                 "GUEST": {"disabled": false, "admin_channels": ["</strong>"] }
    *             }
    *         }
    *     }
    * }
    <strong>/
    // NOTE: No error handling, for brevity (see getting started)
    // Note: Android emulator needs to use 10.0.2.2 for localhost (10.0.3.2 for GenyMotion)

    // Initialize the configuration object and set db target
    CBLError err;
    FLString url = FLSTR("ws://localhost:4984/db");
    CBLEndpoint</strong> target =
        CBLEndpoint_CreateWithURL(url, &amp;err); <i class="conum" data-value="11"></i><b>(11)</b>

    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
    config.database = db;
    config.endpoint = target; <i class="conum" data-value="12"></i><b>(12)</b>


    config.replicatorType = kCBLReplicatorTypePull;

    config.continuous = true;

    // Configure replication retries
    config.heartbeat = 120; //  <i class="conum" data-value="13"></i><b>(13)</b>

    config.maxAttempts = 20; //  <i class="conum" data-value="14"></i><b>(14)</b>

    config.maxAttemptWaitTime = 600; //  <i class="conum" data-value="15"></i><b>(15)</b>

    // Configure Client Authentication to Basic Authentication
    // Providing username and password credentials
    if(docs_example_ShowBasicAuth) {
        CBLAuthenticator* basicAuth =
            CBLAuth_CreatePassword(FLSTR("username"),
                                   FLSTR("passwd"));
        config.authenticator = basicAuth; <i class="conum" data-value="16"></i><b>(16)</b>
    }

    if(docs_example_ShowSessionAuth) {
        CBLAuthenticator* sessionAuth =
            CBLAuth_CreateSession(FLSTR("904ac010862f37c8dd99015a33ab5a3565fd8447"),
                                  FLSTR("optionalCookieName"));
        config.authenticator = sessionAuth; <i class="conum" data-value="17"></i><b>(17)</b>
    }


    // Optionally, add custom headers
    FLMutableDict customHdrs = FLMutableDict_New();
    FLMutableDict_SetString(customHdrs,
                            FLSTR("customHeaderName"),
                            FLSTR("customHeaderValue"));

    config.headers = customHdrs;
    
    char cert_buf[10000];
    FILE* cert_file = fopen("cert.pem", "r");
    size_t read = fread(cert_buf, 1, sizeof(cert_buf), cert_file);
    config.pinnedServerCertificate = (FLSlice){cert_buf, read};

    // FILTERS
    // Purpose - Illustrate use of push and-or pull filter functions
    config.pushFilter = simpleReplicationFilter;

    config.pullFilter = simpleReplicationFilter;


    //  Auto-purge over-ride
    config.disableAutoPurge = true; <i class="conum" data-value="18"></i><b>(18)</b>

    // Initialize replicator with created config
    CBLReplicator* replicator =
        CBLReplicator_Create(&amp;config, &amp;err); <i class="conum" data-value="19"></i><b>(19)</b>

    CBLEndpoint_Free(target);

    // Add optional change listener
    CBLListenerToken* token_ReplChangeListener =
        CBLReplicator_AddChangeListener(replicator,
                                        simpleChangeListener,
                                        NULL); <i class="conum" data-value="20"></i><b>(20)</b>
}
// END replication.html &gt;&gt; configure section


// PAGE=Data Sync &gt;&gt; Initialize section
// URL=https://docs.couchbase.com/couchbase-lite/current/c/replication.html#lbl-init-repl
static CBLReplicator* docs_act_replication_Intialize(
                        void* context,
                        CBLReplicatorConfiguration argConfig,
                        bool argResetRequired)
{
    CBLError err;
    bool docs_example_resetRequired = argResetRequired;
    CBLReplicator* thisRepl =
    CBLReplicator_Create(&amp;argConfig, &amp;err); <i class="conum" data-value="21"></i><b>(21)</b>

    if(!docs_example_resetRequired) {
      CBLReplicator_Start(thisRepl, false); <i class="conum" data-value="22"></i><b>(22)</b>

    } else {
      CBLReplicator_Start(thisRepl, true); <i class="conum" data-value="23"></i><b>(23)</b>

    }
    return thisRepl;
}
// END replication.html &gt;&gt; initialize section

// PAGE=Data Sync &gt;&gt; Monitor section
// URL=https://docs.couchbase.com/couchbase-lite/current/c/replication.html#lbl-repl-mon
static void docs_act_replication_Monitor(
                                       void* context,
                                       CBLReplicator* argRepl) {
    CBLError err;
    CBLReplicator* thisRepl = argRepl;
    // Purpose -- illustrate addition of a Replicator change listener
    CBLListenerToken* token_ReplChangeListener =
            CBLReplicator_AddChangeListener(thisRepl,
                                            simpleChangeListener,
                                            NULL);

    // Purpose -- illustrate addition of a Document Replicator  listener
    CBLListenerToken* token_ReplDocListener =
            CBLReplicator_AddDocumentReplicationListener(
                                                        thisRepl,
                                                        SimpleReplicationDocumentListener,
                                                        context);

    // Purpose -- illustrate removal of a listener
    CBLListener_Remove(token_ReplDocListener);
    CBLListener_Remove(token_ReplChangeListener);


    // Purpose -- illustrate use of CBLReplicator_Status()
    CBLReplicatorStatus thisState = CBLReplicator_Status(thisRepl);
    if(thisState.activity==kCBLReplicatorStopped) {
        if(thisState.error.code==0) {
            CBLReplicator_Start(thisRepl,false);
        } else {
            printf("Replicator stopped -- code %d", thisState.error.code);
            // ... handle error ...
            CBLReplicator_Release(thisRepl);
        }
    }

    FLDict thisPendingIdList =
        CBLReplicator_PendingDocumentIDs(thisRepl, &amp;err); <i class="conum" data-value="24"></i><b>(24)</b>
    if(!FLDict_IsEmpty(thisPendingIdList)) {
        FLDictIterator item;
        FLDictIterator_Begin(thisPendingIdList, &amp;item);
        FLValue itemValue;
        FLString pendingId;
        while(NULL != (itemValue = FLDictIterator_GetValue(&amp;item))) {
            pendingId = FLValue_AsString(itemValue);
            if(CBLReplicator_IsDocumentPending(thisRepl,
                                               pendingId,
                                               &amp;err)) {
                // ... process the still pending docid as required <i class="conum" data-value="25"></i><b>(25)</b>
            } else {
                // Doc Id no longer pending
                if(err.code==0) {
                    // No fail so must have already been pushed
                    printf("Document already pushed");
                } else {
                    // Error detected so handle it
                    printf("Error code %d checking for pendingId", err.code);
                    break;
                }
            }
            FLDictIterator_Next(&amp;item);
        }
        FLDictIterator_End(&amp;item);
        FLValue_Release(itemValue);
    } else {
        printf("No Pending Id Docs to process");
    }
    FLDict_Release(thisPendingIdList);

}
// END replication.html &gt;&gt; Monitor section

// BEGIN replication.html &gt;&gt; Stop section
// PAGE=Data Sync &gt;&gt; Stop
// URL=https://docs.couchbase.com/couchbase-lite/current/c/replication.html#lbl-repl-stop
static void docs_act_replication_Stop(
                                       void* context,
                                       CBLReplicator* argRepl) {
    // Purpose -- show how to stop a replication
    if(CBLReplicator_Status(argRepl).activity!=kCBLReplicatorStopped) {
        CBLReplicator_Stop(argRepl);
    }

}
// END replication.html &gt;&gt; Stop section

static void replication_error_handling() {
    CBLDatabase* db = kDatabase;
    CBLError err;
    FLString url = FLSTR("ws://localhost:4984/db");
    CBLEndpoint* target = CBLEndpoint_CreateWithURL(url, &amp;err);
    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));
    config.database = db;
    config.endpoint = target;

    CBLReplicator* replicator = CBLReplicator_Create(&amp;config, &amp;err);
    CBLEndpoint_Free(target);
    
    
    
    stop_replicator(replicator);
}

static void create_encryptable() {
    #ifdef COUCHBASE_ENTERPRISE

    // NOTE: No error handling, for brevity (see getting started)

    // Create with premitive type
    CBLEncryptable* encNull = CBLEncryptable_CreateWithNull();
    CBLEncryptable* encBool = CBLEncryptable_CreateWithBool(true);
    CBLEncryptable* encInt = CBLEncryptable_CreateWithInt(256);
    CBLEncryptable* encUInt = CBLEncryptable_CreateWithUInt(1024);
    CBLEncryptable* encFloat = CBLEncryptable_CreateWithFloat(1.2);
    CBLEncryptable* encDouble = CBLEncryptable_CreateWithDouble(100.50);
    CBLEncryptable* encString = CBLEncryptable_CreateWithString(FLSTR("foo"));

    // Create with dictionary
    FLMutableDict dict = FLMutableDict_New();
    FLSlot_SetString(FLMutableDict_Set(dict, FLSTR("greeting")), FLSTR("hello"));
    CBLEncryptable* encDict = CBLEncryptable_CreateWithDict(dict);

    // Create with array
    FLMutableArray array = FLMutableArray_New();
    FLSlot_SetString(FLMutableArray_Append(array), FLSTR("item1"));
    CBLEncryptable* encArray = CBLEncryptable_CreateWithArray(array);

    // Create with FLValue
    FLMutableDict dict2 = FLMutableDict_New();
    FLSlot_SetString(FLMutableDict_Set(dict2, FLSTR("greeting")), FLSTR("hello"));
    CBLEncryptable* encValue = CBLEncryptable_CreateWithValueFLValue)dict2);      // Release after using it     CBLEncryptable_Release(encNull);     CBLEncryptable_Release(encBool);     CBLEncryptable_Release(encInt);     CBLEncryptable_Release(encBool);     CBLEncryptable_Release(encUInt);     CBLEncryptable_Release(encFloat);     CBLEncryptable_Release(encDouble);     CBLEncryptable_Release(encString);     CBLEncryptable_Release(encDict);     CBLEncryptable_Release(encArray);     CBLEncryptable_Release(encValue);      FLMutableDict_Release(dict);     FLMutableDict_Release(dict2);     FLMutableArray_Release(array);      #endif }  static void release_encryptable() {     #ifdef COUCHBASE_ENTERPRISE      CBLEncryptable* encValue = CBLEncryptable_CreateWithString(FLSTR("foo";
    // Release the encryptable value after finish using it
    CBLEncryptable_Release(encValue);

    #endif
}

static void use_encryptable() {
    #ifdef COUCHBASE_ENTERPRISE

    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)
    CBLDocument* doc = CBLDocument_CreateWithID(FLSTR("doc1"));

    // Set encryptable:
    FLMutableDict props = CBLDocument_MutableProperties(doc);
    CBLEncryptable* encryptable = CBLEncryptable_CreateWithString(FLSTR("My secret"));
    FLSlot_SetEncryptableValue(FLMutableDict_Set(props, FLSTR("secret")), encryptable);

    CBLError error;
    CBLDatabase_SaveDocument(db, doc, &amp;error);

    // Release
    CBLDocument_Release(doc);
    CBLEncryptable_Release(encryptable);

    #endif
}

static void query_encryptable() {
    #ifdef COUCHBASE_ENTERPRISE

    CBLDatabase* db = kDatabase;

    // NOTE: No error handling, for brevity (see getting started)
    CBLError err;
    CBLQuery* query = CBLDatabase_CreateQuery(db, kCBLN1QLLanguage,
        FLSTR("SELECT secret, secret.value as secretValue FROM _ WHERE type = \"profile\""), NULL, &amp;err);
    CBLResultSet* results = CBLQuery_Execute(query, &amp;err);
    while(CBLResultSet_Next(results)) {
        // Get secret as CBLEncryptable value
        FLValue value = CBLResultSet_ValueForKey(results, FLSTR("secret"));
        const CBLEncryptable* encValue = FLValue_GetEncryptableValue(value);
        FLString secretStr = FLValue_AsString(CBLEncryptable_Value(encValue));
        printf("Secret :: %.<strong>s\n", (int)secretStr.size, (const char *)secretStr.buf);

        // Get secret value directly
        value = CBLResultSet_ValueForKey(results, FLSTR("secretValue"));
        secretStr = FLValue_AsString(value);
        printf("Secret :: %.*s\n", (int)secretStr.size, (const char *)secretStr.buf);
    }

    CBLResultSet_Release(results);
    CBLQuery_Release(query);

    #endif
}

#ifdef COUCHBASE_ENTERPRISE

// Purpose: Declare property-level encryptor callback functions
static FLSliceResult my_cipher_function(FLSlice input) {
    FLSliceResult result = FLSliceResult_New(input.size);
    for(int i = 0; i &lt; input.size; ++i) {
        uint8_t</strong>)(result.buf[i] = uint8_t*)input.buf)[i] ^ 'K';}     return result; }   static FLSliceResult property_encryptor(void* context, FLString docID, FLDict props, FLString path,                                         FLSlice input, FLStringResult* algorithm, FLStringResult* keyID, CBLError* error) {     <strong>algorithm = FLSlice_Copy(FLSTR("MyEnc";
    return my_cipher_function(input);
}


static FLSliceResult property_decryptor(void</strong> context, FLString documentID, FLDict properties, FLString keyPath,
                                        FLSlice input, FLString algorithm, FLString keyID, CBLError* error) {
    return my_cipher_function(input);
}


#endif

// PAGE=Field Level Encryption
// URL=https://docs.couchbase.com/couchbase-lite/current/c/field-level-encryption.html
//
static void replicator_property_encryption() {
    #ifdef COUCHBASE_ENTERPRISE

    CBLDatabase* db = kDatabase;

    // Purpose: Show how to declare en(de)cryptors in replicator config
    // NOTE: No error handling, for brevity (see getting started)

    CBLError err;
    FLString url = FLSTR("ws://localhost:4984/db");
    CBLEndpoint* target = CBLEndpoint_CreateWithURL(url, &amp;err);

    CBLReplicatorConfiguration config;
    memset(&amp;config, 0, sizeof(CBLReplicatorConfiguration));

    config.database = db;
    config.endpoint = target;
    config.propertyEncryptor = property_encryptor; <i class="conum" data-value="26"></i><b>(26)</b>
    config.propertyDecryptor = property_decryptor; <i class="conum" data-value="27"></i><b>(27)</b>

    CBLReplicator* replicator = CBLReplicator_Create(&amp;config, &amp;err);
    CBLEndpoint_Free(target);

    CBLReplicator_Start(replicator, false);

    stop_replicator(replicator);

    #endif
}

int main(int argc, char** argv) {
    create_new_database();
    create_document();
    update_document();
    do_batch_operation();
    // Disable use_blob() as no avatar.jpg to load and crash
    // use_blob();
    doc_json();
    dict_json();
    array_json();
    load_prebuilt();
    create_index();
    select_all();
    select_and_access_all();
    select_props();
    select_meta();
    select_id();
    select_where();
    use_collection_contains();
    select_like();
    select_wildcard_like();
    select_wildcard_character_like();
    select_regex();
    select_join();
    group_by();
    order_by();
    query_result_json();

    create_full_text_index();
    full_text_search();
    start_replication();
    replicator_property_encryption();

    CBLDatabase_Close(kDatabase, NULL);

    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>For permanent network errors</strong> (for example, <code>404</code> not found, or <code>401</code> unauthorized):
<em>Replicator</em> will stop permanently, whether <code>setContinuous</code>  is <em>true</em> or <em>false</em>. Of course, it sets its status to <code>STOPPED</code></p>
</div>
<div class="paragraph">
<p><strong>For recoverable or temporary errors:</strong> <em>Replicator</em> sets its status to <code>OFFLINE</code>, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>setContinuous=<em>true</em></code> it retries the connection indefinitely</p>
</li>
<li>
<p>If <code>setContinuous=<em>false</em></code> (one-shot) it retries the connection a limited number of times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following error codes are considered temporary by the Couchbase Lite replicator and thus will trigger a connection retry.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>408</code>: Request Timeout</p>
</li>
<li>
<p><code>429</code>: Too Many Requests</p>
</li>
<li>
<p><code>500</code>: Internal Server Error</p>
</li>
<li>
<p><code>502</code>: Bad Gateway</p>
</li>
<li>
<p><code>503</code>: Service Unavailable</p>
</li>
<li>
<p><code>504</code>: Gateway Timeout</p>
</li>
<li>
<p><code>1001</code>: DNS resolution error</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="load-balancers"><a class="anchor" href="#load-balancers"></a>Load Balancers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> uses WebSockets as the communication protocol to transmit data.
Some load balancers are not configured for WebSocket connections by default (NGINX for example);
so it might be necessary to explicitly enable them in the load balancer&#8217;s configuration (see <a href="../../../sync-gateway/current/load-balancer.html" class="page">Load Balancers</a>).</p>
</div>
<div class="paragraph">
<p>By default, the WebSocket protocol uses compression to optimize for speed and bandwidth utilization.
The level of compression is set on Sync Gateway and can be tuned in the configuration file (<a href="../../../sync-gateway/current/configuration-properties.html#replicator_compression" class="page"><code>replicator_compression</code></a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-cert-pinning"><a class="anchor" href="#lbl-cert-pinning"></a>Certificate Pinning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite for C supports certificate pinning.</p>
</div>
<div class="paragraph">
<p>Certificate pinning is a technique that can be used by applications to "pin" a host to its certificate.
The certificate is typically delivered to the client by an out-of-band channel and bundled with the client.
In this case, Couchbase Lite uses this embedded certificate to verify the trustworthiness of the server (for example, a Sync Gateway) and no longer needs to rely on a trusted third party for that (commonly referred to as the Certificate Authority).</p>
</div>
<div class="paragraph">
<p>The following steps describe how to configure certificate pinning between Couchbase Lite and Sync Gateway.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="../../../sync-gateway/current/authentication-certs.html#creating-your-own-self-signed-certificate" class="page">Create your own self-signed certificate</a> with the <code>openssl</code> command.
After completing this step, you should have 3 files: <code>cert.pem</code>, <code>cert.cer</code> and <code>privkey.pem</code>.</p>
</li>
<li>
<p><a href="../../../sync-gateway/current/authentication-certs.html#installing-the-certificate" class="page">Configure Sync Gateway</a> with the <code>cert.pem</code> and <code>privkey.pem</code> files.
After completing this step, Sync Gateway is reachable over <code>https</code>/<code>wss</code>.</p>
</li>
<li>
<p>On the Couchbase Lite side, the replication must point to a URL with the <code>wss</code> scheme and configured with the <code>cert.cer</code> file created in step 1.</p>
<div class="paragraph">
<p>This example loads the certificate from the application sandbox, then converts it to the appropriate type to configure the replication object.</p>
</div>
</li>
</ol>
</div>
<div id="ex-crt-pinning" class="exampleblock">
<div class="title">Example 17. Cert Pinnings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c">char cert_buf[10000];
FILE* cert_file = fopen("cert.pem", "r");
size_t read = fread(cert_buf, 1, sizeof(cert_buf), cert_file);
config.pinnedServerCertificate = (FLSlice){cert_buf, read};</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run your app.
The replication should now run successfully over https/wss with certificate pinning.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more on pinning certificates see the blog entry: <a href="https://blog.couchbase.com/certificate-pinning-android-with-couchbase-mobile/" target="_blank" rel="noopener">Certificate Pinning with Couchbase Mobile</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-trouble"><a class="anchor" href="#lbl-trouble"></a>Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="logs"><a class="anchor" href="#logs"></a>Logs</h3>
<div class="paragraph">
<p>As always, when there is a problem with replication, logging is your friend.
You can increase the log output for activity related to replication with Sync Gateway&#8201;&#8212;&#8201;see <a href="#ex-logs">Example 18</a>.</p>
</div>
<div id="ex-logs" class="exampleblock">
<div class="title">Example 18. Set logging verbosity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">[data-source-url=https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/c/examples/code_snippets/main.c]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more on troubleshooting with logs, see: <a href="troubleshooting-logs.html" class="page">Using Logs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="authentication-errors"><a class="anchor" href="#authentication-errors"></a>Authentication Errors</h3>
<div class="paragraph">
<p>If Sync Gateway is configured with a self signed certificate but your app points to a <code>ws</code> scheme instead of <code>wss</code> you will encounter an error with status code <code>11006</code>&#8201;&#8212;&#8201;see: <a href="#ex-11006">Example 19</a></p>
</div>
<div id="ex-11006" class="exampleblock">
<div class="title">Example 19. Protocol Mismatch</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">CouchbaseLite Replicator ERROR: {Repl#2} Got LiteCore error: WebSocket error 1006 "connection closed abnormally"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If Sync Gateway is configured with a self signed certificate, and your app points to a <code>wss</code> scheme but the replicator configuration isn&#8217;t using the certificate you will encounter an error with status code <code>5011</code>&#8201;&#8212;&#8201;see: <a href="#ex-5011">Example 20</a></p>
</div>
<div id="ex-5011" class="exampleblock">
<div class="title">Example 20. Certificate Mismatch or Not Found</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">CouchbaseLite Replicator ERROR: {Repl#2} Got LiteCore error: Network error 11 "server TLS certificate is self-signed or has unknown root cert"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to . . .</div>
<ul>
<li>
<p><a href="gs-prereqs.html" class="page">Prerequisites</a></p>
</li>
<li>
<p><a href="gs-install.html" class="page">Install</a></p>
</li>
<li>
<p><a href="gs-build.html" class="page">Build and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Learn more . . .</div>
<ul>
<li>
<p><a href="database.html" class="page">Databases</a></p>
</li>
<li>
<p><a href="document.html" class="page">Documents</a></p>
</li>
<li>
<p><a href="blob.html" class="page">Blobs</a></p>
</li>
<li>
<p><a href="replication.html" class="page">Remote Sync using Sync Gateway</a></p>
</li>
<li>
<p><a href="conflict.html" class="page">Handling Data Conflicts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="paragraph">
<div class="title">Dive Deeper . . .</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Forum</a> |
<a href="https://blog.couchbase.com/">Blog</a> |
 <a href="https://docs.couchbase.com/tutorials/index.html">Tutorials</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Couchbase Mobile 2.5+
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. From 2.0
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
